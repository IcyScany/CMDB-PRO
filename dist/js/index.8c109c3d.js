import{s as e,_ as t}from"./subPage.2201bfd5.js";import{_ as l}from"./index.7d980246.js";import{h as a,m as i,_ as o,l as n,dy as d,aI as r,aC as s,d as u,u as c,aD as v,e8 as _,q as m,b4 as p,t as f,c as y,g,aG as b,e9 as h,P as k,o as C,a as x,ea as w,eb as S,ec as T,ed as D,ee as $,aR as A,b5 as L,al as U,r as j,i as B,O as I,Q as R,U as O,W as F,ah as E,Y as H,$ as P,Z as q,R as M,X as z,F as N,S as Y,b6 as G,cH as W,cI as V,aV as K,au as X,a8 as Z,aN as Q,H as J,cZ as ee,a3 as te,ag as le,ad as ae,a6 as ie,am as oe,a0 as ne,aj as de,av as re,a9 as se,aa as ue,x as ce,I as ve,aU as _e,v as me,aZ as pe,ab as fe,ac as ye,J as ge,z as be,p as he,ax as ke,a_ as Ce,a$ as xe,ak as we,cE as Se,B as Te}from"./index.872a2bd0.js";import{t as De}from"./tableRender.a6ff99b7.js";import{o as $e,_ as Ae,b as Le,u as Ue}from"./opsFormInit.3a4e1794.js";import{a as je,_ as Be}from"./index.029351cd.js";import{c as Ie}from"./certManage.ef938e3f.js";import{h as Re}from"./moment.39d4ecb7.js";import"./index.6e2fd079.js";import{R as Oe,_ as Fe}from"./Group.b415afa6.js";import{_ as Ee}from"./index.461e6114.js";import{_ as He}from"./index.5101deeb.js";import{_ as Pe}from"./index.de966786.js";import{_ as qe,T as Me}from"./index.0ff804f5.js";import{_ as ze}from"./index.9846e408.js";import{S as Ne,_ as Ye}from"./index.44a4e190.js";import{S as Ge,_ as We}from"./index.6f715054.js";import{_ as Ve}from"./RadioButton.534ff50d.js";import{_ as Ke}from"./ServerTable.53881589.js";import{B as Xe}from"./index.2b3e44f4.js";import{A as Ze}from"./index.a6841843.js";import{_ as Qe}from"./index.87ccdcd1.js";import{_ as Je}from"./index.e3d002e2.js";import"./opsDescriptions.dfa169bd.js";import"./index.fc9664cf.js";import"./index.a533313d.js";import"./index.2c670fa1.js";import"./opsTable.7b07fc7b.js";import"./alertLevel.8dae0e72.js";import"./index.65b2e021.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.48209b21.js";import"./index.64f8d8d4.js";import"./useBreakpoint.e81952b0.js";import"./dropdown.337fa54f.js";import"./eagerComputed.bb706adf.js";const et=e=>{const{componentCls:t,antCls:l}=e;return{[t]:o(o({},n(e)),{position:"relative",padding:`${e.pageHeaderPaddingVertical}px ${e.pageHeaderPadding}px`,backgroundColor:e.colorBgContainer,[`&${t}-ghost`]:{backgroundColor:e.pageHeaderGhostBg},"&.has-footer":{paddingBottom:0},[`${t}-back`]:{marginRight:e.marginMD,fontSize:e.fontSizeLG,lineHeight:1,"&-button":o(o({},d(e)),{color:e.pageHeaderBackColor,cursor:"pointer"})},[`${l}-divider-vertical`]:{height:"14px",margin:`0 ${e.marginSM}`,verticalAlign:"middle"},[`${l}-breadcrumb + &-heading`]:{marginTop:e.marginXS},[`${t}-heading`]:{display:"flex",justifyContent:"space-between","&-left":{display:"flex",alignItems:"center",margin:e.marginXS/2+"px 0",overflow:"hidden"},"&-title":o({marginRight:e.marginSM,marginBottom:0,color:e.colorTextHeading,fontWeight:600,fontSize:e.pageHeaderHeadingTitle,lineHeight:`${e.controlHeight}px`},r),[`${l}-avatar`]:{marginRight:e.marginSM},"&-sub-title":o({marginRight:e.marginSM,color:e.colorTextDescription,fontSize:e.pageHeaderHeadingSubTitle,lineHeight:e.lineHeight},r),"&-extra":{margin:e.marginXS/2+"px 0",whiteSpace:"nowrap","> *":{marginLeft:e.marginSM,whiteSpace:"unset"},"> *:first-child":{marginLeft:0}}},[`${t}-content`]:{paddingTop:e.pageHeaderContentPaddingVertical},[`${t}-footer`]:{marginTop:e.marginMD,[`${l}-tabs`]:{[`> ${l}-tabs-nav`]:{margin:0,"&::before":{border:"none"}},[`${l}-tabs-tab`]:{paddingTop:e.paddingXS,paddingBottom:e.paddingXS,fontSize:e.pageHeaderTabFontSize}}},[`${t}-compact ${t}-heading`]:{flexWrap:"wrap"},[`&${e.componentCls}-rtl`]:{direction:"rtl"}})}},tt=a("PageHeader",(e=>{const t=i(e,{pageHeaderPadding:e.paddingLG,pageHeaderPaddingVertical:e.paddingMD,pageHeaderPaddingBreadcrumb:e.paddingSM,pageHeaderContentPaddingVertical:e.paddingSM,pageHeaderBackColor:e.colorTextBase,pageHeaderGhostBg:"transparent",pageHeaderHeadingTitle:e.fontSizeHeading4,pageHeaderHeadingSubTitle:e.fontSize,pageHeaderTabFontSize:e.fontSizeLG});return[et(t)]})),lt=s(u({compatConfig:{MODE:3},name:"APageHeader",inheritAttrs:!1,props:{backIcon:h(),prefixCls:String,title:h(),subTitle:h(),breadcrumb:k.object,tags:h(),footer:h(),extra:h(),avatar:C(),ghost:{type:Boolean,default:void 0},onBack:Function},slots:Object,setup(e,t){let{emit:l,slots:a,attrs:i}=t;const{prefixCls:o,direction:n,pageHeader:d}=c("page-header",e),[r,s]=tt(o),u=v(!1),h=_(),k=e=>{let{width:t}=e;h.value||(u.value=t<768)},C=m((()=>{var t,l,a;return null===(a=null!==(t=e.ghost)&&void 0!==t?t:null===(l=null==d?void 0:d.value)||void 0===l?void 0:l.ghost)||void 0===a||a})),A=()=>{var t;return e.breadcrumb?y(Xe,e.breadcrumb,null):null===(t=a.breadcrumb)||void 0===t?void 0:t.call(a)},L=()=>{var t,i,d,r,s,u,c,v,_;const{avatar:m}=e,p=null!==(t=e.title)&&void 0!==t?t:null===(i=a.title)||void 0===i?void 0:i.call(a),f=null!==(d=e.subTitle)&&void 0!==d?d:null===(r=a.subTitle)||void 0===r?void 0:r.call(a),g=null!==(s=e.tags)&&void 0!==s?s:null===(u=a.tags)||void 0===u?void 0:u.call(a),b=null!==(c=e.extra)&&void 0!==c?c:null===(v=a.extra)||void 0===v?void 0:v.call(a),h=`${o.value}-heading`,k=p||f||g||b;if(!k)return null;const C=(()=>{var t,l,i;return null!==(i=null!==(t=e.backIcon)&&void 0!==t?t:null===(l=a.backIcon)||void 0===l?void 0:l.call(a))&&void 0!==i?i:"rtl"===n.value?y(S,null,null):y(T,null,null)})(),x=(t=>t&&e.onBack?y($,{componentName:"PageHeader",children:e=>{let{back:a}=e;return y("div",{class:`${o.value}-back`},[y(D,{onClick:e=>{l("back",e)},class:`${o.value}-back-button`,"aria-label":a},{default:()=>[t]})])}},null):null)(C);return y("div",{class:h},[(x||m||k)&&y("div",{class:`${h}-left`},[x,m?y(Ze,m,null):null===(_=a.avatar)||void 0===_?void 0:_.call(a),p&&y("span",{class:`${h}-title`,title:"string"==typeof p?p:void 0},[p]),f&&y("span",{class:`${h}-sub-title`,title:"string"==typeof f?f:void 0},[f]),g&&y("span",{class:`${h}-tags`},[g])]),b&&y("span",{class:`${h}-extra`},[y(je,null,{default:()=>[b]})])])},U=()=>{var t,l;const i=null!==(t=e.footer)&&void 0!==t?t:x(null===(l=a.footer)||void 0===l?void 0:l.call(a));return w(i)?null:y("div",{class:`${o.value}-footer`},[i])},j=e=>y("div",{class:`${o.value}-content`},[e]);return()=>{var t,l;const d=(null===(t=e.breadcrumb)||void 0===t?void 0:t.routes)||a.breadcrumb,c=e.footer||a.footer,v=p(null===(l=a.default)||void 0===l?void 0:l.call(a)),_=f(o.value,{"has-breadcrumb":d,"has-footer":c,[`${o.value}-ghost`]:C.value,[`${o.value}-rtl`]:"rtl"===n.value,[`${o.value}-compact`]:u.value},i.class,s.value);return r(y(b,{onResize:k},{default:()=>[y("div",g(g({},i),{},{class:_}),[A(),L(),v.length?j(v):null,U()])]}))}}})),at={getServerTime:()=>A.get("bcm-public/server-time")},it=["aria-label"],ot=["aria-label"],nt={key:0},dt={key:0,class:"text-error",style:{float:"left"}},rt=z("span",{class:"vxe-icon-warning-triangle-fill text-orange"},null,-1),st={key:1,class:"text-error"},ut={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:L}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const l=e,{open:a,sid:i,formType:o}=U(l),n=t,d=j(null),{putCertEdit:r,getCertOneList:s,postCertAddDataApi:u}=Ie,c=B("canUserAction");let v=j(!1),_=j({}),p=j({key:{type:"text",list:[]},cert:{type:"text",list:[]}});const{edit_data:f,formRenderContent:g,formDataLoading:b,confirmLoading:h,initForm:k,formDataInit:C,editSubmit:x}=$e({formRef:d,TITLE_LAYER:1,formType:o,sid:i,emits:n,addApi:u,editApi:r,oneDataApi:s,customSubmitData:async function(e){var t,l;o.value!==G||(null==(t=null==g?void 0:g.value)?void 0:t.formState.key)||(null==(l=null==g?void 0:g.value)?void 0:l.formState.cert)||(delete e.key,delete e.cert,delete e.snis,delete e.expire_time,delete e.certificate_id);return e},customEditData:function(e){var t;e.value.virtual_team_v3_id||(e.value.virtual_team_v3_id=null==(t=g.value)?void 0:t.initFormState.virtual_team_v3_id);return e}});const w=()=>{n("update:open",!1)},S=()=>{p.value={key:{type:"text",list:[]},cert:{type:"text",list:[]}}},T=async e=>{e&&(await k(),await C(),S(),o.value===G?(delete g.value.rules.key,delete g.value.rules.cert):(g.value.rules.key&&g.value.rules.key.length||(g.value.rules.key=[{required:!0,message:"此项不能为空"}]),g.value.rules.cert&&g.value.rules.cert.length||(g.value.rules.cert=[{required:!0,message:"此项不能为空"}])),L(),g.value.formState.key="",g.value.formState.cert="",g.value.formState.expire_time="",g.value.formState.snis=null)};let D=j(null);const $=async()=>{v.value=!1,g.value.formState.cert&&g.value.formState.key&&Ie.postCertVerifyApi({cert:g.value.formState.cert,key:g.value.formState.key}).then((e=>{let{certificate_id:t,labels:l,snis:a,key:i,cert:o,status:n,top_domain:d}=e;v.value=!0,_.value=e,(async()=>{at.getServerTime().then((e=>{D.value=e.timestamp}))})(),Object.assign(g.value.formState,{certificate_id:t,expire_time:l&&(null==l?void 0:l.validity_end)?Re(1e3*(null==l?void 0:l.validity_end)).format("YYYY-MM-DD HH:mm:ss"):"",snis:a,key:i,cert:o,status:n,top_domain:d,labels:l})})).catch((()=>{v.value=!1,_.value={}}))},A=()=>{for(let e in g.value.formState)g.value.formState[e]=g.value.initFormState[e];v.value=!1,_.value={},S()},L=()=>{v.value=!1,_.value={}},J=m((()=>{var e,t;let l=[],a=null==(t=null==(e=g.value)?void 0:e.title_data)?void 0:t.cloud_master_account_id;return a&&(l=a.map((e=>{const t=g.value.formState.cloud_master_account_id||[],l=e.cloud_type,i=t.some((e=>{const t=a.find((t=>t.id===e));return t&&t.cloud_type===l}))&&!t.includes(e.id);return{label:`${e.page_display} ${e.username}`,value:e.id,icon:e.cloud_type,disabled:i}}))),l}));return(e,t)=>{const l=I("vxe-button"),i=Ae,n=Oe,r=Fe,s=W,u=Ee,m=V,k=K,C=X,S=Le,U=Z,j=Q,B=Be;return R(),O(B,{open:P(a),onAfterOpenChange:T,onClose:w},{title:F((()=>[E(H(e.$route.meta.title)+H(P(o)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增证书":`NO.[${P(f).certificate_id}]编辑证书`)+" ",1),P(v)?(R(),O(l,{key:0,status:"primary",content:"重新完善证书信息",size:"mini",onClick:L})):q("",!0)])),footer:F((()=>{var t,a,i,n,d,r,s,u,m,p,f,b,k;return[Boolean(P(o)===e.$CONFIG.FORM_TYPE.ADD_TYPE&&!P(v)||P(o)===e.$CONFIG.FORM_TYPE.EDIT_TYPE&&((null==(a=null==(t=P(g))?void 0:t.formState)?void 0:a.key)||(null==(n=null==(i=P(g))?void 0:i.formState)?void 0:n.cert))&&!P(v))?(R(),M("span",dt,[rt,E(" 请先进行证书验证再执行提交 ")])):q("",!0),P(_).labels&&1e3*P(_).labels.validity_end<P(D)?(R(),M("span",st,[E("当前证书已过期, 过期时间为"),z("b",null,"("+H(e.formState.expire_time)+")",1)])):q("",!0),(null==(d=P(c))?void 0:d.check_cert)?(R(),O(l,{key:2,disabled:!((null==(s=null==(r=P(g))?void 0:r.formState)?void 0:s.key)&&(null==(m=null==(u=P(g))?void 0:u.formState)?void 0:m.cert)),content:"证书验证",status:"primary",size:"mini",onClick:$},null,8,["disabled"])):q("",!0),y(l,{content:"取消",onClick:w}),y(l,{type:"submit",loading:P(h),disabled:Boolean(P(o)===e.$CONFIG.FORM_TYPE.ADD_TYPE&&!P(v)||P(o)===e.$CONFIG.FORM_TYPE.EDIT_TYPE&&((null==(f=null==(p=P(g))?void 0:p.formState)?void 0:f.key)||(null==(k=null==(b=P(g))?void 0:b.formState)?void 0:k.cert))&&!P(v)),content:"提交",status:"primary",size:"mini",onClick:P(x)},null,8,["loading","disabled","onClick"]),y(l,{content:"重置",size:"mini",onClick:A})]})),default:F((()=>[y(j,{spinning:P(b)},{default:F((()=>[y(U,{ref_key:"formRef",ref:d,model:P(g).formState,rules:P(g).rules},{default:F((()=>[(R(!0),M(N,null,Y(e.$utils.filter(P(g).title,(e=>e.edit_display)),(e=>{var t,a;return R(),M(N,{key:e.field},["certificate_id"===e.field?(R(),M(N,{key:0},[P(v)?(R(),O(i,{key:0,value:P(g).formState[e.field],"onUpdate:value":t=>P(g).formState[e.field]=t,title:e,disabled:P(v)?Boolean(P(g).formState[e.field]):!e.edit_change},null,8,["value","onUpdate:value","title","disabled"])):q("",!0)],64)):"cert"===e.field||"key"===e.field?(R(),O(i,{key:1,title:e},{default:F((()=>[y(s,null,{default:F((()=>[y(r,{value:P(p)[e.field].type,"onUpdate:value":t=>P(p)[e.field].type=t,size:"small",style:{"margin-bottom":"10px",display:"block"},onChange:t=>{return l=e.field,p.value[l].list=[],void(g.value.formState[l]=null);var l}},{default:F((()=>[y(n,{value:"text"},{default:F((()=>[E("文本")])),_:1}),y(n,{value:"file"},{default:F((()=>[E("附件")])),_:1})])),_:2},1032,["value","onUpdate:value","onChange"])])),_:2},1024),"file"===P(p)[e.field].type?(R(),O(s,{key:0},{default:F((()=>[y(u,{"file-list":P(p)[e.field].list,"onUpdate:fileList":t=>P(p)[e.field].list=t,name:`${e.field}_file`,accept:"."+("key"===e.field?"key":"crt"),"show-upload-list":!0,"with-credentials":!0,method:"POST","before-upload":(t,l)=>((e,t,l)=>{let a=new FileReader;return a.onload=e=>{const t=e.target.result;g.value.formState[l]=t},a.readAsText(e),!1})(t,0,e.field),onChange:t=>((e,t)=>{let l=[...e.fileList];l=l.slice(-1),l=l.map((e=>(e.response&&(e.url=e.response.url),e))),p.value[t].list=l})(t,e.field)},{default:F((()=>[y(l,{mode:"text",status:"primary",content:"上传",icon:"vxe-icon-upload",style:{"margin-left":"2%","margin-bottom":"10px"}})])),_:2},1032,["file-list","onUpdate:fileList","name","accept","before-upload","onChange"])])),_:2},1024)):q("",!0),"text"===P(p)[e.field].type?(R(),O(m,{key:1,value:P(g).formState[e.field],"onUpdate:value":t=>P(g).formState[e.field]=t,disabled:P(v)?P(v):!e.edit_change,rows:10},null,8,["value","onUpdate:value","disabled"])):q("",!0)])),_:2},1032,["title"])):"expire_time"===e.field?(R(),M(N,{key:2},[P(v)?(R(),O(i,{key:0,value:P(g).formState[e.field],"onUpdate:value":t=>P(g).formState[e.field]=t,title:e,disabled:P(v)?P(v):!e.edit_change},null,8,["value","onUpdate:value","title","disabled"])):q("",!0)],64)):"cloud_master_account_id"===e.field?(R(),O(i,{key:3,title:e},{default:F((()=>{var t,l;return[y(S,{value:P(g).formState[e.field],"onUpdate:value":t=>P(g).formState[e.field]=t,options:P(J),mode:(null==(t=null==e?void 0:e.page_data_source)?void 0:t.multiple)?null==(l=null==e?void 0:e.page_data_source)?void 0:l.multiple:"default","option-label-prop":"label"},{option:F((({value:e,label:t,icon:l})=>[z("span",{role:"img","aria-label":e},[y(k,{type:l,class:"xy-w-2"},null,8,["type"])],8,it),E(" "+H(t),1)])),tagRender:F((({value:e,label:t,closable:l,onClose:a,option:i})=>[y(C,{closable:l,style:{"margin-right":"3px"},onClose:a},{default:F((()=>[z("span",{role:"img","aria-label":e},[y(k,{type:i.icon,class:"xy-w-2"},null,8,["type"])],8,ot),E(" "+H(t)+"   ",1)])),_:2},1032,["closable","onClose"])])),_:2},1032,["value","onUpdate:value","options","mode"])]})),_:2},1032,["title"])):"snis"===e.field?(R(),M(N,{key:4},[P(v)?(R(),O(i,{key:0,value:P(g).formState[e.field],"onUpdate:value":t=>P(g).formState[e.field]=t,title:e},{default:F((()=>[P(g).formState[e.field]?(R(),M("span",nt,[Array.isArray(P(g).formState[e.field])?(R(!0),M(N,{key:0},Y(P(g).formState[e.field],(e=>(R(),O(C,{key:e,color:"green"},{default:F((()=>[E(H(e),1)])),_:2},1024)))),128)):(R(),M(N,{key:1},[E(H(P(g).formState[e.field]),1)],64))])):q("",!0)])),_:2},1032,["value","onUpdate:value","title"])):q("",!0)],64)):(R(),O(i,{key:5,value:P(g).formState[e.field],"onUpdate:value":t=>P(g).formState[e.field]=t,title:e,"title-data":null==(a=null==(t=P(g))?void 0:t.title_data)?void 0:a[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["open"])}}},ct=["aria-label"],vt=["aria-label"],_t={__name:"CertImport",props:{open:{type:Boolean,default:!1},certSid:{type:[String,Number],default:""},formType:{type:Number,default:L},title:{type:String,default:""},action:{type:String,default:""},importAction:{type:Object,default:()=>({})},service:{type:String,default:""}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const l=e,{open:a,certSid:i,formType:o,importAction:n,action:d,service:r}=U(l),s=t;let u=B("updateCertState");const c=j(null),{postScmCertUpload:v,getScmCertList:_}=Ie;let p=J({scmLoading:!1,scmListData:[]});const{formRenderContent:f,formDataLoading:g,confirmLoading:b,initForm:h,formDataInit:k,editSubmit:C}=$e({formRef:c,editTitleLayer:3,formType:o,emits:s,addApi:e=>v({action:n.value.action,service:r.value,data:e}),customSubmitData:async function(e){var t;"huawei_cert_update"===r.value&&(n.value.service&&(e.target_service=n.value.service),"cdn_domain_list"===d.value&&(e.cert_sid=e.cert_id,delete e.scm_cert_sid),"waf_domain_list"!==d.value&&"elb_listener_list"!==d.value||("waf_or_elb_import_cert"===n.value.action&&(e.scm_cert_name=null==(t=p.scmListData.find((t=>t.cert_id===e.scm_cert_sid)))?void 0:t.cert_name,e.target_project=e.region_id),delete e.cert_id,delete e.enterprise_project_id,delete e.region_id));"ali_cert_update"===r.value&&(e.cert_sid=e.cert_id);return delete e.cert_id,e}});const x=()=>{s("update:open",!1)},w=async e=>{p.scmLoading=!0,p.scmListData=[];try{p.scmListData=await _(e),p.scmLoading=!1}catch(t){}finally{p.scmLoading=!1}},S=async e=>{e&&(await h(),await k(),w(i.value))},T=m((()=>{var e,t;let l=[],a=null==(t=null==(e=f.value)?void 0:e.title_data)?void 0:t.cloud_master_account_id;return a&&(l=a.filter((e=>{let t={label:`${e.page_display} ${e.username}`,value:e.id,icon:e.cloud_type};return Object.assign(e,t),"ali_cert_update"===r.value?"阿里云"===e.cloud_type:"华为云"===e.cloud_type}))),l}));return(t,i)=>{const o=Fe,s=je,v=I("vxe-button"),_=ee,m=Ae,h=K,k=X,D=Le,$=Z,A=Q,L=Be;return R(),O(L,{title:e.title,open:P(a),onAfterOpenChange:S,onClose:x},{footer:F((()=>[y(v,{content:"取消",onClick:x}),y(v,{type:"submit",loading:P(b),status:"primary",content:"提交",onClick:P(C)},null,8,["loading","onClick"])])),default:F((()=>[y(A,{spinning:P(g)},{default:F((()=>[y($,{ref_key:"formRef",ref:c,model:P(f).formState,rules:P(f).rules},{default:F((()=>[(R(!0),M(N,null,Y(t.$utils.filter(P(f).title,(e=>e.edit_display)),(e=>{var t,a,c,g,b,C;return R(),M(N,{key:e.field},["scm_cert_sid"===e.field?(R(),M(N,{key:0},[["waf_domain_list","elb_listener_list"].includes(P(d))&&"huawei_cert_update"===P(r)?(R(),O(m,{key:0,title:e},{default:F((()=>[z("div",null,[y(_,{block:""},{default:F((()=>[y(s,{direction:"vertical"},{default:F((()=>[y(o,{value:P(f).formState[e.field],"onUpdate:value":t=>P(f).formState[e.field]=t,options:P(p).scmListData.map((e=>({value:e.cert_id,label:`${e.cert_id}：${e.cert_name} ( ${e.expire_time})  `})))},null,8,["value","onUpdate:value","options"])])),_:2},1024),y(v,{loading:P(p).scmLoading,mode:"text",status:"primary",icon:"vxe-icon-repeat",class:"cursor-pointer",onClick:i[0]||(i[0]=e=>w(l.certSid))},null,8,["loading"])])),_:2},1024)])])),_:2},1032,["title"])):q("",!0)],64)):"cloud_master_account_id"===e.field?(R(),O(m,{key:1,title:e},{default:F((()=>{var t,l;return[y(D,{value:P(f).formState[e.field],"onUpdate:value":t=>P(f).formState[e.field]=t,options:P(T),mode:(null==(t=null==e?void 0:e.page_data_source)?void 0:t.multiple)?null==(l=null==e?void 0:e.page_data_source)?void 0:l.multiple:"default","option-label-prop":"label"},{option:F((({value:e,label:t,icon:l})=>[z("span",{role:"img","aria-label":e},[y(h,{type:l,class:"xy-w-2"},null,8,["type"])],8,ct),E(" "+H(t),1)])),tagRender:F((({value:e,label:t,closable:l,onClose:a,option:i})=>[y(k,{closable:l,style:{"margin-right":"3px"},onClose:a},{default:F((()=>[z("span",{role:"img","aria-label":e},[y(h,{type:i.icon,class:"xy-w-2"},null,8,["type"])],8,vt),E(" "+H(t)+"   ",1)])),_:2},1032,["closable","onClose"])])),_:2},1032,["value","onUpdate:value","options","mode"])]})),_:2},1032,["title"])):"cert_id"===e.field?(R(),M(N,{key:2},[["cdn_domain_list","waf_domain_list"].includes(P(d))&&"waf_or_elb_import_cert"!==P(n).action?(R(),O(m,{key:0,title:e,label:null},{label:F((()=>[E("上传证书")])),default:F((()=>{var t,l,a;return[y(D,{value:P(f).formState[e.field],"onUpdate:value":t=>P(f).formState[e.field]=t,options:null==(t=P(u).currentDomainData)?void 0:t.cert_list.map((e=>{var t,l;return e.expire_days>0?{label:`${e.cert_name} (${(null==(t=null==e?void 0:e.is_post_cert)?void 0:t.reason)?null==(l=null==e?void 0:e.is_post_cert)?void 0:l.reason:`${e.expire_days}天到期`} )`,value:e.id,...(null==e?void 0:e.is_post_cert)||{}}:null})),mode:(null==(l=null==e?void 0:e.page_data_source)?void 0:l.multiple)?null==(a=null==e?void 0:e.page_data_source)?void 0:a.multiple:"default","option-label-prop":"label"},null,8,["value","onUpdate:value","options","mode"])]})),_:2},1032,["title"])):q("",!0)],64)):"enterprise_project_id"===e.field?(R(),M(N,{key:3},["ali_cert_update"!==P(r)&&"waf_or_elb_import_cert"!==P(n).action?(R(),O(m,{key:0,value:P(f).formState[e.field],"onUpdate:value":t=>P(f).formState[e.field]=t,title:e,"title-data":null==(a=null==(t=P(f))?void 0:t.title_data)?void 0:a[e.field]},null,8,["value","onUpdate:value","title","title-data"])):q("",!0)],64)):"region_id"===e.field?(R(),M(N,{key:4},["ali_cert_update"!==P(r)&&"waf_or_elb_import_cert"===P(n).action?(R(),O(m,{key:0,value:P(f).formState[e.field],"onUpdate:value":t=>P(f).formState[e.field]=t,title:e,"title-data":null==(g=null==(c=P(f))?void 0:c.title_data)?void 0:g[e.field]},null,8,["value","onUpdate:value","title","title-data"])):q("",!0)],64)):(R(),O(m,{key:5,value:P(f).formState[e.field],"onUpdate:value":t=>P(f).formState[e.field]=t,title:e,"title-data":null==(C=null==(b=P(f))?void 0:b.title_data)?void 0:C[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},mt=e=>(se("data-v-85b8b100"),e=e(),ue(),e),pt=mt((()=>z("div",null,[z("h3",null,[z("b",null,"是否选择测试域名进行证书验证？")])],-1))),ft={key:1,class:"mt-5 pl-5"},yt=mt((()=>z("br",null,null,-1))),gt=mt((()=>z("br",null,null,-1))),bt={style:{height:"100%",width:"250px","border-right":"1px solid #f0f0f0"},class:"pl-2 pt-2"},ht=te({__name:"CertStartUpdate",props:{open:{type:Boolean,default:!1},data:{type:Object,default:()=>({})},checkData:{type:Object,default:()=>({})},ways:{type:String,default:""},hostList:{type:Array,default:()=>[]},service:{type:String,default:""},updateAction:{type:Object,default:()=>({})}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const l=e;let{open:a,data:i,checkData:o,ways:n,hostList:d,service:r,updateAction:s}=U(l),u=t;const c={error:{icon:"vxe-icon-error-circle-fill",status:"error"},finish:{icon:"vxe-icon-success-circle-fill",status:"finish"},process:{status:"process"},wait:{icon:"vxe-icon-spinner roll",status:"wait"}};let{getCertUpdateTaskId:v,postCertUpdateDomainSaveToDb:_,postCertCheckDomain:p,putCertUpdate:f,getCertUpdateLogOne:g,getCertCheckDomain:b}=Ie;const h={batch:"批量",single:"单个"},k=()=>{u("update:open",!1),u("editSuccess")};let C=j(null),x=j(!1),w=J({steps:[],taskId:null,test_domain:{method:"GET",protocol:"https://",domain:"",path:"/",uri:""},test_domain_status:{msg:"",status:""},current_step_log:[],getVerifyDomain:""}),S=j(null);const T=()=>{C.value=null,x.value=!1,w.steps=[],w.taskId=null,w.test_domain_status={msg:"",status:""},w.current_step_log=[],S.value=null,w.test_domain={method:"GET",protocol:"https://",domain:"",path:"/",uri:""},$()},D=m((()=>{var e;let t="batch"===n.value?(null==(e=o.value)?void 0:e.checkbox)||[]:[i.value];return null==t?void 0:t.map((e=>{var t,a,i;return{...e,title:(null==e?void 0:e[(null==(t=null==B?void 0:B[r.value])?void 0:t[l.updateAction.action])?null==(i=null==(a=null==B?void 0:B[r.value])?void 0:a[l.updateAction.action])?void 0:i.domain_name:"domain_name"])||"",status:"process"}}))})),$=async()=>{var e,t;if(!0===C.value){w.steps=[{title:"证书验证",status:"process",domain_name:"demo"},...D.value];let a=await b({type_domain:s.value.type_domain});w.getVerifyDomain=(null==a?void 0:a.param)?ne.parseUrl(null==a?void 0:a.param):"",w.getVerifyDomain&&d.value.find((e=>{var t,a,i;return(null==e?void 0:e[null==(a=null==(t=null==B?void 0:B[r.value])?void 0:t[l.updateAction.action])?void 0:a.domain_name])===(null==(i=w.getVerifyDomain)?void 0:i.hostname)}))&&(w.test_domain.domain=(null==(e=w.getVerifyDomain)?void 0:e.hostname)||"",w.test_domain.uri=(null==(t=w.getVerifyDomain)?void 0:t.pathname.split("/")[1])||"")}!1===C.value&&(w.steps=[...D.value])},A=({is_demo:e,body:t={}})=>f({service:r.value,action:s.value.action,data:{is_demo:e,...t}}),L=async(e={},t,l=!1)=>{S.value=t,g({task_id:e.task_id,domain_id:l?"demo":e.domain_id}).then((e=>{w.current_step_log=(null==e?void 0:e.param)||[]})).catch((e=>{}))},B={huawei_cert_update:{update_waf_cert:{domain_id:"host_id",domain_name:"host_name",commonField:["domain_id","domain_name","waf_type","region_name","region_id","enterprise_project_id","cloud_master_account_id"]},update_elb_cert:{domain_id:"listener_id",domain_name:"listener_name",commonField:["domain_id","domain_name","region_name","region_id","enterprise_project_id","cloud_master_account_id"]},update_cdn_cert:{domain_id:"host_id",domain_name:"host_name",commonField:["domain_id","domain_name","cloud_master_account_id"]}},ali_cert_update:{update_cdn_cert:{domain_id:"domain_id",domain_name:"domain",commonField:["domain_id","domain_name","cloud_master_account_id","ssl_protocol"]},update_waf_cert:{domain_name:"domain",commonField:["domain_name","instance_id","cloud_master_account_id"]}}},G=e=>{var t,l,a;let i={};return(null==(t=null==B?void 0:B[r.value])?void 0:t[s.value.action])&&(null==(a=null==(l=null==B?void 0:B[r.value])?void 0:l[s.value.action])||a.commonField.forEach((t=>{var l,a,o,n;i[t]=(null==(a=null==(l=null==B?void 0:B[r.value])?void 0:l[s.value.action])?void 0:a[t])?e[null==(n=null==(o=null==B?void 0:B[r.value])?void 0:o[s.value.action])?void 0:n[t]]:null==e?void 0:e[t]}))),i},W=async(e,t={})=>{var l,a,i,n;w.steps[e].taskId=w.taskId,w.steps[e].status="wait",w.steps[e].msg="证书更新中...",S.value=e;try{t.domain_id&&(t.domain_id=t.domain_id+"");let d=await A({is_demo:0,body:{task_id:w.taskId,cert_id:(null==(a=null==(l=o.value)?void 0:l.radio)?void 0:a.cert_id)+"",cert_name:null==(n=null==(i=o.value)?void 0:i.radio)?void 0:n.cert_name,...t}});w.steps[e].status="finish",w.steps[e].msg=`${d.status_code}`||"证书验证成功",w.steps[e].log=d.msg}catch(d){let{data:t,status_code:l}=(null==d?void 0:d.response)||{};return w.steps[e].status="error",void(w.steps[e].msg=(null==t?void 0:t.msg)||(null==t?void 0:t.message)||`证书验证失败(${l})`)}finally{L({task_id:w.taskId,domain_id:t.domain_name},e)}},V=async()=>{x.value=!0,v().then((async e=>{if(w.taskId=null==e?void 0:e.param,S.value=0,!0===C.value){let e=`${w.test_domain.protocol}${w.test_domain.domain}${w.test_domain.uri?`${w.test_domain.path}${w.test_domain.uri}`:""}`;p({data:{url:e},type_domain:s.value.type_domain}).then((async t=>{var a,i,n,s;let{msg:u,status_code:c}=t;w.test_domain_status.msg=`${u}${c}`||"测试域名连通性成功",w.test_domain_status.status=c,w.steps[0].taskId=w.taskId,w.steps[0].status="wait",w.steps[0].msg="证书验证中...",S.value=0,w.steps[0].domain_name="demo",_({task_id:w.taskId,domain:["demo",...D.value.map((e=>{var t,a;return null==e?void 0:e[null==(a=null==(t=null==B?void 0:B[r.value])?void 0:t[l.updateAction.action])?void 0:a.domain_name]}))]});try{let t=G(d.value.find((e=>{var t,a;return(null==e?void 0:e[null==(a=null==(t=null==B?void 0:B[r.value])?void 0:t[l.updateAction.action])?void 0:a.domain_name])===w.test_domain.domain})));t.domain_id&&(t.domain_id=t.domain_id+"");let u=await A({is_demo:1,body:{task_id:w.taskId,cert_id:(null==(i=null==(a=o.value)?void 0:a.radio)?void 0:i.cert_id)+"",cert_name:null==(s=null==(n=o.value)?void 0:n.radio)?void 0:s.cert_name,url:e,...t}});if(200!==(null==u?void 0:u.status_code))return w.steps[0].status="error",w.steps[0].msg=(null==u?void 0:u.msg)||`证书验证失败(${null==u?void 0:u.status_code})`,void L({task_id:w.taskId},0,!0);if(w.steps[0].status="finish",w.steps[0].msg=`${u.status_code}`||"证书验证成功",w.steps[0].log=u.msg,L({task_id:w.taskId},0,!0),D.value.length)for(let e=0;e<D.value.length;e++){let t=G(d.value.find((t=>{var a,i,o,n,d;return(null==t?void 0:t[null==(i=null==(a=null==B?void 0:B[r.value])?void 0:a[l.updateAction.action])?void 0:i.domain_name])===(null==(d=D.value[e])?void 0:d[null==(n=null==(o=null==B?void 0:B[r.value])?void 0:o[l.updateAction.action])?void 0:n.domain_name])})));await W(e+1,{...t})}}catch(v){let{data:e,status:t}=(null==v?void 0:v.response)||{};return w.steps[0].status="error",w.steps[0].msg=(null==e?void 0:e.msg)||(null==e?void 0:e.message)||`证书验证失败(${t})`,w.steps[0].domain_name=w.test_domain.domain,void L({task_id:w.taskId},0,!0)}})).catch((e=>{let{data:t,status:l}=(null==e?void 0:e.response)||{};w.test_domain_status.msg=(null==t?void 0:t.msg)||(null==e?void 0:e.message)||`测试域名连通性失败(${l})`,w.test_domain_status.status=l,x.value=!1}))}if(!1===C.value&&(await _({task_id:w.taskId,domain:D.value.map((e=>{var t,a;return null==e?void 0:e[null==(a=null==(t=null==B?void 0:B[r.value])?void 0:t[l.updateAction.action])?void 0:a.domain_name]}))}),D.value.length))for(let t=0;t<D.value.length;t++){let e=G(d.value.find((e=>{var a,i,o,n,d;return(null==e?void 0:e[null==(i=null==(a=null==B?void 0:B[r.value])?void 0:a[l.updateAction.action])?void 0:i.domain_name])===(null==(d=D.value[t])?void 0:d[null==(n=null==(o=null==B?void 0:B[r.value])?void 0:o[l.updateAction.action])?void 0:n.domain_name])})));await W(t,{...e})}}))};return(e,t)=>{const i=Oe,u=Fe,v=ze,_=de,m=Ne,p=Ye,f=ee,g=I("vxe-tip"),b=I("CheckCircleOutlined"),D=I("CloseCircleOutlined"),A=qe,U=Me,j=Ge,G=We,W=re,K=I("vxe-modal");return R(),O(K,{"model-value":P(a),width:"80%",height:"80%","mask-closable":!1,"esc-closable":!1,"show-zoom":"","show-footer":"",resize:"",onClose:k,onHide:k,onShow:T},le({title:F((()=>{var e,t,l,a;return[E(H(`${h[P(n)]} - ${P(s).title}`)+" 目标更新证书：【"+H(null==(t=null==(e=P(o))?void 0:e.radio)?void 0:t.cert_id)+"："+H(null==(a=null==(l=P(o))?void 0:l.radio)?void 0:a.cert_name)+"】 ",1)]})),default:F((()=>{var e;return[P(x)?q("",!0):(R(),M(N,{key:0},[y(v,null,{default:F((()=>[pt,y(u,{value:P(C),"onUpdate:value":t[0]||(t[0]=e=>ae(C)?C.value=e:C=e),onChange:$},{default:F((()=>[y(i,{value:!0},{default:F((()=>[E("是")])),_:1}),y(i,{value:!1},{default:F((()=>[E("否")])),_:1})])),_:1},8,["value"])])),_:1}),P(C)?(R(),O(f,{key:0,block:""},{default:F((()=>[y(_,{class:"site-input-split",style:{width:"100px",borderLef:0,borderRight:0,pointerEvents:"none"},placeholder:P(w).test_domain.method,disabled:""},null,8,["placeholder"]),y(_,{class:"site-input-split",style:{width:"10%",borderLef:0,borderRight:0,pointerEvents:"none"},placeholder:P(w).test_domain.protocol,disabled:""},null,8,["placeholder"]),y(p,{value:P(w).test_domain.domain,"onUpdate:value":t[1]||(t[1]=e=>P(w).test_domain.domain=e),style:{width:"80%",borderLef:0,borderRight:0},"show-search":"","allow-clear":"","option-filter-prop":"label",placeholder:"选择检测域名"},{default:F((()=>[(R(!0),M(N,null,Y(P(d),(e=>{var t,a,i,o,n,d;return R(),O(m,{key:null==e?void 0:e[(null==(t=null==B?void 0:B[P(r)])?void 0:t[l.updateAction.action])?null==(i=null==(a=null==B?void 0:B[P(r)])?void 0:a[l.updateAction.action])?void 0:i.domain_id:"domain_id"],value:null==e?void 0:e[(null==(o=null==B?void 0:B[P(r)])?void 0:o[l.updateAction.action])?null==(d=null==(n=null==B?void 0:B[P(r)])?void 0:n[l.updateAction.action])?void 0:d.domain_name:"domain_name"]},{default:F((()=>{var t,a,i;return[E(H(null==e?void 0:e[(null==(t=null==B?void 0:B[P(r)])?void 0:t[l.updateAction.action])?null==(i=null==(a=null==B?void 0:B[P(r)])?void 0:a[l.updateAction.action])?void 0:i.domain_name:"domain_name"]),1)]})),_:2},1032,["value"])})),128))])),_:1},8,["value"]),y(_,{class:"site-input-split",style:{width:"50px",borderLef:0,borderRight:0,pointerEvents:"none"},placeholder:P(w).test_domain.path,disabled:""},null,8,["placeholder"]),y(_,{value:P(w).test_domain.uri,"onUpdate:value":t[2]||(t[2]=e=>P(w).test_domain.uri=e),class:"site-input-right",style:{width:"50%",textAlig:"center"},placeholder:""},null,8,["value"])])),_:1})):q("",!0),P(C)&&!P(w).test_domain.domain?(R(),O(g,{key:1,status:"warning"},{default:F((()=>[E("选择了测试域名验证，需要选择/填写检测域名！")])),_:1})):q("",!0),P(C)&&P(w).test_domain_status.status?(R(),O(g,{key:2,status:"error"},{default:F((()=>[E("测试域名连通性失败："+H(P(w).test_domain_status.msg)+"("+H(P(w).test_domain_status.status)+")",1)])),_:1})):q("",!0)],64)),(null==(e=P(w))?void 0:e.taskId)?(R(),M("div",ft,[y(U,{mode:"left"},{default:F((()=>[(R(!0),M(N,null,Y(P(w).current_step_log,(e=>(R(),O(A,{key:e.id,color:e.status?"green":"red"},{dot:F((()=>[e.status?(R(),O(b,{key:0,class:"text-base"})):(R(),O(D,{key:1,class:"text-base"}))])),default:F((()=>[z("span",{style:oe({color:e.status?"var(--success-color)":"var(--error-color)"})},"【"+H(e.create_time)+"】"+H(e.run_action),5),E(),yt,E("   "+H(e.msg),1),gt,E("   "+H(e.describe),1)])),_:2},1032,["color"])))),128))])),_:1})])):q("",!0)]})),footer:F((()=>[P(x)?q("",!0):(R(),O(W,{key:0,disabled:null===P(C)||P(C)&&!P(w).test_domain.domain,type:"primary",onClick:V},{default:F((()=>[E("开始更新")])),_:1},8,["disabled"]))])),_:2},[null!==P(C)?{name:"left",fn:F((()=>[z("div",bt,[y(G,{current:P(S),"onUpdate:current":t[3]||(t[3]=e=>ae(S)?S.value=e:S=e),direction:"vertical",size:"small",onChange:t[4]||(t[4]=e=>{var t,a,i,o,n;return L({task_id:null==(t=P(w))?void 0:t.taskId,domain_id:(null==(o=P(w).steps[e])?void 0:o[null==(i=null==(a=null==B?void 0:B[P(r)])?void 0:a[l.updateAction.action])?void 0:i.domain_name])||(null==(n=P(w).steps[e])?void 0:n.domain_name)},e)})},{default:F((()=>[(R(!0),M(N,null,Y(P(w).steps,((e,t)=>{var l;return R(),O(j,{key:t,status:(null==e?void 0:e.taskId)?e.status:"wait",description:e.msg,disabled:!(null==e?void 0:e.taskId)},le({title:F((()=>[E(H(e.title),1)])),_:2},[(null==(l=null==c?void 0:c[e.status])?void 0:l.icon)?{name:"icon",fn:F((()=>{var t;return[z("span",{class:ie(null==(t=null==c?void 0:c[e.status])?void 0:t.icon)},null,2)]})),key:"0"}:void 0]),1032,["status","description","disabled"])})),128))])),_:1},8,["current"])])])),key:"0"}:void 0]),1032,["model-value"])}}},[["__scopeId","data-v-85b8b100"]]),kt=e=>(se("data-v-bee97c2e"),e=e(),ue(),e),Ct={class:"mb-4"},xt={key:0},wt=kt((()=>z("br",null,null,-1))),St=kt((()=>z("i",{class:"vxe-icon-warning-triangle-fill"},null,-1))),Tt={key:1,class:"text-error ml-2"},Dt=kt((()=>z("i",{class:"vxe-icon-warning-triangle-fill"},null,-1))),$t=kt((()=>z("i",{class:"vxe-icon-warning-triangle-fill"},null,-1))),At=te({__name:"CertList",props:{columns:{type:Array,default:()=>[]},service:{type:String,default:""},action:{type:String,default:"cdn_domain_list"},hostColumns:{type:Array,default:()=>[]},certSid:{type:[String,Number]}},setup(e,{expose:t}){const a=e;let i=J({cert_list:[],host_list:[],loading:!1,fullData:[],currentSearchParams:{},certFilter:"valid",title_data:{}}),o=B("updateCertState");const n=e=>"offline"===e.d_status||"offline"===e.status?"已停用的域名不能更新证书":"ali_cert_update"!==(null==a?void 0:a.service)||"waf_domain_list"!==(null==a?void 0:a.action)||(null==e?void 0:e.cert_name)?"":"没有证书名称的不能更新证书",d=m((()=>{var e,t;let l={canUpdate:!0,reason:""};const{expire_days:a,latest_cert:i}=(null==(e=D.value)?void 0:e.radio)||{},{update_date:n}=o.timeLimit;return(null==(t=D.value)?void 0:t.radio)?a?a<0?(l.canUpdate=!1,l.reason="证书已经到期"):a<n&&i&&(l.canUpdate=!1,l.reason=`到期时间 < ${n} 天且有比它更新的证书`):(l.canUpdate=!1,l.reason="证书没有到期时间"):(l.canUpdate=!1,l.reason="请先选择需更新的目标SCM证书才能进行证书的更新"),l}));let r=m((()=>{var e;return{disabled:!(null==(e=d.value)?void 0:e.canUpdate),tip:()=>{var e,t;return(null==(e=d.value)?void 0:e.canUpdate)?"":null==(t=d.value)?void 0:t.reason}}}));const s=j(null),u=j(null),c={huawei_cert_update:{common:1,cdn_domain_list:{block:{cert_block:2,host_block:2},hide:["cert_type","region"],hostHide:[],certText:"SCM证书",canCertImport:!1,canCertUpdate:!1,importAction:{action:"scm_import_cert",title:"SCM证书导入"},updateAction:{action:"update_cdn_cert",title:"华为云CDN域名证书更新",service:"CDN",type_domain:`hw_cdn_${null==o?void 0:o.domain}`}},waf_domain_list:{block:{cert_block:3,host_block:3},hide:["description"],hostHide:[],certText:"WAF证书",canCertImport:!1,canCertUpdate:!1,importAction:{action:"waf_or_elb_import_cert",title:"WAF证书导入",service:"WAF"},updateAction:{action:"update_waf_cert",title:"华为云WAF域名证书更新",service:"WAF",type_domain:`hw_waf_${null==o?void 0:o.domain}`}},elb_listener_list:{block:{cert_block:4,host_block:4},hide:["enterprise_project","exp_status"],hostHide:["host_id","host_name"],certText:"ELB证书",canCertImport:!1,canCertUpdate:!1,importAction:{action:"waf_or_elb_import_cert",title:"ELB证书导入",service:"ELB"},updateAction:{action:"update_elb_cert",title:"华为云ELB域名证书更新",service:"ELB",type_domain:`hw_elb_${null==o?void 0:o.domain}`}}},ali_cert_update:{common:1,cdn_domain_list:{block:{cert_block:5,host_block:2},hide:["cert_type","region","enterprise_project","exp_status","enterprise_project_id","expire_time","description"],hostHide:[],certText:"SSL证书",canCertImport:!1,canCertUpdate:!1,importAction:{action:"ssl_import_cert",title:"SSL证书导入"},updateAction:{action:"update_cdn_cert",title:"阿里云CDN域名证书更新",service:"CDN",type_domain:`ali_cdn_${null==o?void 0:o.domain}`}},waf_domain_list:{block:{cert_block:6,host_block:3},hide:["description","cert_type","region","enterprise_project_id","enterprise_project","exp_status"],hostHide:["name"],certText:"SSL证书",canCertImport:!1,canCertUpdate:!1,importAction:{action:"ssl_import_cert",title:"SSL证书导入",service:"WAF"},updateAction:{action:"update_waf_cert",title:"阿里云WAF域名证书更新",service:"WAF",type_domain:`ali_waf_${null==o?void 0:o.domain}`}}}},v={showSearch:!0,authBtn:{add:{page_display:!1},edit:{page_display:!1},del:{page_display:!1}},requestConfig:{immediate:!0,autoLoad:!0}},_={...v,radioConfig:{highlight:!0,reserve:!0,visibleMethod:({row:e})=>new Date(e.expire_time)>new Date},rowConfig:{keyField:"cert_id"}},p={...v,checkboxConfig:{highlight:!0,reserve:!0,visibleMethod:({row:e})=>!n(e)},rowConfig:{keyField:"host_id"}};let f=m((()=>[{type:"radio",title:"证书选择",field:"custom_select_cert",width:100},...a.columns.filter((e=>{var t,l,o,n;let{field:d,title_data:r}=e;["domain_status","certificate_type","https_status","region_id","enterprise_project_id","status","cloud_master_account_id","exp_status"].includes(d)&&(i.title_data[d]=null==r?void 0:r[d],e.formatter=({cellValue:e})=>{var t;return(null==(t=null==r?void 0:r[d])?void 0:t[e])||e});return["expire_time","subject_alternative_names","cloud_master_account_id"].includes(d)&&(e.slots={default:d},e.showOverflow=!1),e.oriTitle.block===(null==c?void 0:c[a.service].common)&&!(null==(l=null==(t=null==c?void 0:c[a.service])?void 0:t[a.action])?void 0:l.hide.includes(e.field))||e.oriTitle.block===(null==(n=null==(o=null==c?void 0:c[a.service])?void 0:o[a.action])?void 0:n.block.cert_block)}))])),g=m((()=>{var e;const t=a.hostColumns.filter((e=>{var t,l,o,n,d;let{field:r,title_data:s}=e;return["domain_status","certificate_type","https_status","region_id","status","enterprise_project_id","cloud_master_account_id"].includes(r)&&(i.title_data[r]=null==s?void 0:s[r],e.formatter=({cellValue:e,row:t})=>{var l,i,o,n,d,u,c;return"region_id"===r?("waf_domain_list"===a.action&&(t.region_name=(null==s?void 0:s[r])&&(null==(o=null==(i=null==(l=ne.groupBy(null==s?void 0:s[r],"projects_id"))?void 0:l[e])?void 0:i[0])?void 0:o.name)||e),(null==s?void 0:s[r])&&(null==(u=null==(d=null==(n=ne.groupBy(null==s?void 0:s[r],"projects_id"))?void 0:n[e])?void 0:d[0])?void 0:u.cn_name)||e):(null==(c=null==s?void 0:s[r])?void 0:c[e])||e}),["expiration_time","cert_expire_tconsoleime","cloud_master_account_id","status","host_name","cert_name"].includes(r)&&(e.slots={default:r}),e.oriTitle.block===(null==(t=null==c?void 0:c[a.service])?void 0:t.common)&&!(null==(o=null==(l=null==c?void 0:c[a.service])?void 0:l[a.action])?void 0:o.hostHide.includes(e.field))||e.oriTitle.block===(null==(d=null==(n=null==c?void 0:c[a.service])?void 0:n[a.action])?void 0:d.block.host_block)}));return[(null==(e=null==c?void 0:c[a.service])?void 0:e[a.action].canCertUpdate)&&{type:"checkbox",title:"选择更新证书",field:"custom_select_update_cert",width:120},...t]}));const b=m((()=>"valid"===i.certFilter?i.cert_list.filter((e=>new Date(e.expire_time)>new Date)):"expired"===i.certFilter?i.cert_list.filter((e=>new Date(e.expire_time)<=new Date)):i.cert_list)),h=async e=>{i.loading=!0,i.currentSearchParams=e,i.certFilter="valid";try{const t=await Ie.getHuaweiCertList(e);if(t){const{cert_list:e=[],host_list:l=[]}=t;i.cert_list=e,i.host_list=l.map((e=>{var t,l,o,n,d;return"waf_domain_list"===a.action&&(e.region_name=(null==(t=i.title_data)?void 0:t.region_id)&&(null==(d=null==(n=null==(o=ne.groupBy(null==(l=i.title_data)?void 0:l.region_id,"projects_id"))?void 0:o[null==e?void 0:e.region_id])?void 0:n[0])?void 0:d.name)||""),e})),i.fullData=[...e,...l],ve((()=>{var e,t;(null==(e=s.value)?void 0:e.commitRequest)&&s.value.commitRequest(),(null==(t=u.value)?void 0:t.commitRequest)&&u.value.commitRequest()}))}}catch(t){}finally{i.loading=!1}};ce((()=>i.cert_list),(e=>{var t;(null==e?void 0:e.length)&&(null==(t=s.value)?void 0:t.commitRequest)&&ve((()=>{s.value.commitRequest()}))}),{deep:!0}),ce((()=>i.certFilter),(()=>{ve((()=>{var e;(null==(e=s.value)?void 0:e.commitRequest)&&s.value.commitRequest()}))})),ce((()=>i.host_list),(e=>{var t;(null==e?void 0:e.length)&&(null==(t=u.value)?void 0:t.commitRequest)&&ve((()=>{u.value.commitRequest()}))}),{deep:!0}),ce((()=>{var e;return null==(e=null==o?void 0:o.hostList)?void 0:e.initButton}),(e=>{if(null==e?void 0:e.length)for(let t of e){let{field:e}=t;switch(e){case"scm_import_cert":c[a.service].cdn_domain_list.canCertImport=t;break;case"ssl_import_cert":c[a.service].cdn_domain_list.canCertImport=t,c[a.service].waf_domain_list.canCertImport=t;break;case"waf_or_elb_import_cert":c[a.service].waf_domain_list.canCertImport=t,c[a.service].elb_listener_list.canCertImport=t;break;case"update_cdn_cert":c[a.service].cdn_domain_list.canCertUpdate=t;break;case"update_waf_cert":c[a.service].waf_domain_list.canCertUpdate=t;break;case"update_elb_cert":c[a.service].elb_listener_list.canCertUpdate=t}}}),{deep:!0,immediate:!0});const{userEdit:k,formOpen:C,formType:x}=Ue();let w=j(null);let S=j([]);const T=()=>{var e,t;S.value=null==(t=null==(e=u.value)?void 0:e.tableCheckboxCheckedAll)?void 0:t.call(e)},D=m((()=>({checkbox:S.value||[],radio:w.value||null})));ce((()=>a.action),(()=>{var e,t,l,a;null==(t=null==(e=s.value)?void 0:e.clearRadioCheck)||t.call(e),w.value=null,S.value=[],null==(a=null==(l=u.value)?void 0:l.clearCheckBox)||a.call(l)}));let $=j(!1),A=j({}),L=j("");const U=(e,t)=>{var l,a;$.value=!0,L.value=t,"single"===t&&(A.value=e,null==(a=null==(l=u.value)?void 0:l.clearCheckBox)||a.call(l)),"batch"===t&&(A.value={})};return t({commitRequest:e=>{h(e)}}),(e,t)=>{var o,d,v;const m=ze,S=Ve,j=Fe,B=I("vxe-button"),G=Pe,W=X,V=me,K=He,Z=Q;return R(),M(N,null,[y(Z,{spinning:P(i).loading},{default:F((()=>[y(m,null,{default:F((()=>{var e;return[z("b",null,H(null==(e=null==c?void 0:c[a.service])?void 0:e[a.action].certText),1)]})),_:1}),z("div",Ct,[y(j,{value:P(i).certFilter,"onUpdate:value":t[0]||(t[0]=e=>P(i).certFilter=e),"button-style":"solid"},{default:F((()=>[y(S,{value:"valid"},{default:F((()=>[E("有效证书")])),_:1}),y(S,{value:"all"},{default:F((()=>[E("全部证书")])),_:1}),y(S,{value:"expired"},{default:F((()=>[E("过期证书")])),_:1})])),_:1},8,["value"])]),y(l,_e({ref_key:"certTableRef",ref:s,columns:P(f),"onUpdate:columns":t[2]||(t[2]=e=>ae(f)?f.value=e:f=e),data:P(b)},_,{onRefresh:t[3]||(t[3]=()=>h({action:a.action,domain:e.$route.query.domain,service:a.service})),onRadioChange:t[4]||(t[4]=({row:e})=>(()=>{var e,t;w.value=null==(t=null==(e=s.value)?void 0:e.tableRadioCheckedAll)?void 0:t.call(e)})())}),{other_toolbar_buttons_left:F((()=>{var l,i;return[(null==(l=null==c?void 0:c[a.service])?void 0:l[a.action].canCertImport)?(R(),O(B,{key:0,status:"primary",content:`${null==(i=null==c?void 0:c[a.service])?void 0:i[a.action].certText}导入`,onClick:t[1]||(t[1]=t=>P(k)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE}))},null,8,["content"])):q("",!0)]})),expire_time:F((({row:e})=>[y(G,{"expired-time":String(e.expire_time)},null,8,["expired-time"])])),subject_alternative_names:F((({row:e})=>[e.subject_alternative_names?(R(),M("span",xt,[Array.isArray(e.subject_alternative_names)?(R(!0),M(N,{key:0},Y(e.subject_alternative_names,(e=>(R(),M(N,{key:e},[y(W,{color:"green"},{default:F((()=>[E(H(e),1)])),_:2},1024),wt],64)))),128)):(R(),M(N,{key:1},[E(H(e.subject_alternative_names),1)],64))])):q("",!0)])),cloud_master_account_id:F((({row:e})=>{var t,l,a;return[E(H((null==(a=null==(l=null==(t=P(i).title_data)?void 0:t.cloud_master_account_id)?void 0:l[e.cloud_master_account_id])?void 0:a.page_display)||""),1)]})),_:1},16,["columns","data"]),y(m,null,{default:F((()=>[E("域名列表")])),_:1}),y(l,_e({ref_key:"hostTableRef",ref:u,columns:P(g),"onUpdate:columns":t[6]||(t[6]=e=>ae(g)?g.value=e:g=e),data:P(i).host_list},p,{onRefresh:t[7]||(t[7]=()=>h({action:a.action,domain:e.$route.query.domain,service:a.service})),onCheckboxChange:T,onCheckboxAll:T}),{other_toolbar_buttons_left:F((()=>{var l,i,o,n;return[(null==(l=null==c?void 0:c[a.service])?void 0:l[a.action].canCertUpdate)?(R(),O(V,{key:0},le({default:F((()=>[y(B,{disabled:P(r).disabled||0===P(D).checkbox.length||!P(D).radio,status:"primary",content:"批量更新",onClick:t[5]||(t[5]=t=>U(e.row,"batch"))},null,8,["disabled"])])),_:2},[P(r).tip()||0===P(D).checkbox.length||!P(D).radio?{name:"title",fn:F((()=>{var e,t;return[St,P(r).tip()?(R(),M(N,{key:0},[E(H(P(r).tip()),1)],64)):P(D).radio?0===P(D).checkbox.length?(R(),M(N,{key:2},[E("请选择需更新的证书")],64)):q("",!0):(R(),M(N,{key:1},[E("请先选择需更新的目标"+H(null==(t=null==(e=null==c?void 0:c[a.service])?void 0:e[a.action])?void 0:t.certText)+"才能进行证书的更新",1)],64))]})),key:"0"}:void 0]),1024)):q("",!0),!P(D).radio&&(null==(i=null==c?void 0:c[a.service])?void 0:i[a.action].canCertUpdate)?(R(),M("span",Tt,[Dt,E(" * 请先选择需更新的目标"+H(null==(n=null==(o=null==c?void 0:c[a.service])?void 0:o[a.action])?void 0:n.certText)+"才能进行证书的更新",1)])):q("",!0)]})),other_operation:F((({row:e})=>{var t;return[(null==(t=null==c?void 0:c[a.service])?void 0:t[a.action].canCertUpdate)?(R(),O(V,{key:0},le({default:F((()=>[y(B,{disabled:!(!P(r).disabled&&P(D).radio&&!n(e)),status:"primary",content:"重新更新",onClick:t=>U(e,"single")},null,8,["disabled","onClick"])])),_:2},[P(r).tip()||!P(D).radio||n(e)?{name:"title",fn:F((()=>{var t,l;return[$t,P(r).tip()?(R(),M(N,{key:0},[E(H(P(r).tip()),1)],64)):P(D).radio?q("",!0):(R(),M(N,{key:1},[E("请先选择需更新的目标"+H(null==(l=null==(t=null==c?void 0:c[a.service])?void 0:t[a.action])?void 0:l.certText)+"才能进行证书的更新",1)],64)),n(e)?(R(),M(N,{key:2},[E(H(n(e)),1)],64)):q("",!0)]})),key:"0"}:void 0]),1024)):q("",!0)]})),expiration_time:F((({row:e})=>[y(G,{"expired-time":String(e.expiration_time)},null,8,["expired-time"])])),cloud_master_account_id:F((({row:e})=>{var t,l,a;return[E(H((null==(a=null==(l=null==(t=P(i).title_data)?void 0:t.cloud_master_account_id)?void 0:l[e.cloud_master_account_id])?void 0:a.page_display)||""),1)]})),status:F((({row:e})=>{var t,l;return[z("span",{class:ie({"text-error":"offline"===e.status})},H((null==(l=null==(t=P(i).title_data)?void 0:t.status)?void 0:l[e.status])||e.status),3)]})),host_name:F((({row:e})=>[y(V,{placement:"topLeft"},{title:F((()=>[y(K,{content:e.host_id,type:"text",style:{color:"#fff"}},{default:F((()=>[E(H(e.host_id),1)])),_:2},1032,["content"])])),default:F((()=>[z("span",null,H(e.host_name),1)])),_:2},1024)])),cert_name:F((({row:e})=>[y(V,{placement:"topLeft"},{title:F((()=>[y(K,{content:e.cert_id,type:"text",style:{color:"#fff"}},null,8,["content"])])),default:F((()=>[z("span",null,H(e.cert_name),1)])),_:2},1024)])),cert_expire_time:F((({row:e})=>[y(G,{"expired-time":String(e.cert_expire_time)},null,8,["expired-time"])])),_:1},16,["columns","data"])])),_:1},8,["spinning"]),y(_t,{open:P(C),"onUpdate:open":t[8]||(t[8]=e=>ae(C)?C.value=e:null),"cert-sid":a.certSid,"form-type":P(x),title:`${null==(o=null==c?void 0:c[a.service])?void 0:o[a.action].certText}导入`,action:a.action,service:a.service,"import-action":null==(d=null==c?void 0:c[a.service])?void 0:d[a.action].importAction,onEditSuccess:t[9]||(t[9]=()=>h({action:a.action,domain:e.$route.query.domain,service:a.service}))},null,8,["open","cert-sid","form-type","title","action","service","import-action"]),y(ht,{open:P($),"onUpdate:open":t[10]||(t[10]=e=>ae($)?$.value=e:$=e),data:P(A),"check-data":P(D),"host-list":P(i).host_list,ways:P(L),service:a.service,"update-action":null==(v=null==c?void 0:c[a.service])?void 0:v[a.action].updateAction,onEditSuccess:t[11]||(t[11]=()=>h({action:a.action,domain:e.$route.query.domain,service:a.service}))},null,8,["open","data","check-data","host-list","ways","service","update-action"])],64)}}},[["__scopeId","data-v-bee97c2e"]]),Lt={__name:"CertImportLog",props:{service:{type:String}},setup(e){const t={ali_cert_update:"阿里云",huawei_cert_update:"华为云"};let a=J({initColumn:[],initTitleData:[]}),i=j(null);const{getCertImportLog:o}=Ie;let n=j(!1);const d=async()=>{n.value=!0},r=()=>{n.value=!1},s=async e=>{var t;if(e){const{columns:e,title_data:l}=await De.setColumn({layer:4});a.initColumn=e.value||[],a.initTitleData=l.value||[];for(let t of a.initColumn){let{field:e}=t;if("cloud_master_account_id"===e)t.slots={default:t.field},t.showOverflow=!1}i.value&&(null==(t=i.value)||t.commitRequest())}};return(u,c)=>{const v=re,_=pe,m=K,p=X,f=me,g=l,b=Be;return R(),M(N,null,[y(v,{type:"primary",onClick:d},{default:F((()=>[E("证书上传日志")])),_:1}),y(b,{open:P(n),width:"80%",onClose:r,onAfterOpenChange:s},{title:F((()=>[E(" 服务： "+H(null==t?void 0:t[e.service])+" 证书上传日志 ",1)])),default:F((()=>[y(g,{ref_key:"tableRef",ref:i,columns:P(a).initColumn,"request-config":{api:P(o),params:{service:null==t?void 0:t[e.service]}}},{cloud_master_account_id:F((({row:e})=>{var t,l,i;return[(null==(t=P(a).initTitleData)?void 0:t.cloud_master_account_id)&&(null==(i=u.$utils.groupBy(null==(l=P(a).initTitleData)?void 0:l.cloud_master_account_id,"id"))?void 0:i[null==e?void 0:e.cloud_master_account_id])?(R(),O(f,{key:0,placement:"topLeft",class:"mb-2"},{title:F((()=>[y(_,{copyable:{tooltip:!1},class:"copy-text"},{default:F((()=>{var t,l,i,o;return[E(H((null==(o=null==(i=null==(l=u.$utils.groupBy(null==(t=P(a).initTitleData)?void 0:t.cloud_master_account_id,"id"))?void 0:l[null==e?void 0:e.cloud_master_account_id])?void 0:i[0])?void 0:o.access_key)||""),1)]})),_:2},1024)])),default:F((()=>[y(p,{class:"xy-tag-2"},{default:F((()=>{var t,l,i,o,n,d,r,s,c,v,_,p;return[y(m,{type:null==(o=null==(i=null==(l=u.$utils.groupBy(null==(t=P(a).initTitleData)?void 0:t.cloud_master_account_id,"id"))?void 0:l[null==e?void 0:e.cloud_master_account_id])?void 0:i[0])?void 0:o.cloud_type,class:"xy-w-2"},null,8,["type"]),E(" "+H((null==(s=null==(r=null==(d=u.$utils.groupBy(null==(n=P(a).initTitleData)?void 0:n.cloud_master_account_id,"id"))?void 0:d[null==e?void 0:e.cloud_master_account_id])?void 0:r[0])?void 0:s.page_display)||"")+" "+H((null==(p=null==(_=null==(v=u.$utils.groupBy(null==(c=P(a).initTitleData)?void 0:c.cloud_master_account_id,"id"))?void 0:v[null==e?void 0:e.cloud_master_account_id])?void 0:_[0])?void 0:p.username)||""),1)]})),_:2},1024)])),_:2},1024)):(R(),M(N,{key:1},[E(H(e.cloud_master_account_id),1)],64))]})),_:1},8,["columns","request-config"])])),_:1},8,["open"])],64)}}},Ut=e=>(se("data-v-d0f30279"),e=e(),ue(),e),jt={class:"h-full min-h-[500px]"},Bt={style:{height:"100%",width:"250px","border-right":"1px solid #f0f0f0"},class:"pl-2 pt-2"},It={style:{height:"100%"},class:"pl-2 pt-2"},Rt={class:"part-box",style:{"margin-bottom":"2rem"}},Ot={class:"custom-table custom-table-bordered"},Ft=Ut((()=>z("thead",null,[z("th",null,"任务ID"),z("th",null,"域名"),z("th",null,"产品"),z("th",null,"操作者")],-1))),Et=Ut((()=>z("br",null,null,-1))),Ht=Ut((()=>z("br",null,null,-1))),Pt=te({__name:"CertUpdateLog",props:{service:{type:String}},setup(e){const{getCertOneUpdateLog:t,postCertUpdateLog:l,getCertUpdateLogOne:a}=Ie;let i=j(!1),o=j(null),n=J({initColumn:[],initTitleData:{},titleFieldSearch:[],tableOrder:{},current_step_domain:[],current_step_log:[]});const d={1:"成功",0:"失败",2:"该域名没有执行更新操作"},r=()=>{i.value=!0},s=m((()=>{for(let e of n.initColumn){let{field:t}=e;if("result"===t)e.slots={default:t}}return n.initColumn})),u=()=>{i.value=!1},c=async()=>{if(i.value){let{title_data:e,order:t,columns:l,title_field_search:a}=await De.setColumn({layer:5,tableType:"server"});n.initColumn=(null==l?void 0:l.value)||[],n.initTitleData=e.value,n.titleFieldSearch=a.value||[],n.tableOrder=t.value?t.value:{},await(async()=>{o.value&&o.value.serverTableRef.commitProxy("query")})()}};let v=j(null);const _=async({item:e={},index:t,domain_id:l})=>{v.value=t,a({task_id:e.task_id,domain_id:l}).then((e=>{n.current_step_log=(null==e?void 0:e.param)||[]})).catch((e=>{}))};let p=j(!1),f=j({}),g=j(null);const b=e=>{p.value=!0,f.value=e,(async(e={},l)=>{t({task_id:e.task_id}).then((t=>{n.current_step_domain=t||[],0===l&&_({item:e,index:l,domain_id:n.current_step_domain[l].domain})})).catch((e=>{}))})(e,0)},h=async()=>{var e,t;g.value&&(null==(t=null==(e=g.value)?void 0:e.$el)||t.scrollTo(0,0))},k=()=>{p.value=!1,v.value=null};return(t,a)=>{const m=re,C=I("vxe-button"),x=me,w=Ke,S=Be,T=I("CloseCircleOutlined"),D=I("CheckCircleOutlined"),$=I("StopOutlined"),A=Ge,L=We,U=qe,j=Me,B=I("vxe-modal");return R(),M(N,null,[y(m,{type:"primary",class:"ml-2",onClick:r},{default:F((()=>[E("证书更新日志")])),_:1}),y(S,{open:P(i),width:"100%",height:"100vh",onClose:u,onAfterOpenChange:c},{title:F((()=>[E(H("huawei_cert_update"===e.service?"华为云证书更新日志":"阿里云证书更新日志"),1)])),default:F((()=>[z("div",jt,[y(w,{ref_key:"serverTableRef",ref:o,"table-column":P(s),"query-api":P(l),"title-field-search":P(n).titleFieldSearch,order:P(n).tableOrder},{result:F((({row:e})=>[y(x,null,{title:F((()=>[E(" 查看日志 ")])),default:F((()=>[y(C,{content:e.result?"成功":"失败",size:"mini",status:e.result?"success":"danger",onClick:t=>b(e)},null,8,["content","status","onClick"])])),_:2},1024)])),_:1},8,["table-column","query-api","title-field-search","order"])])])),_:1},8,["open"]),y(B,{ref_key:"logModalRef",ref:g,"model-value":P(p),width:"80%",height:"80%","mask-closable":!0,"esc-closable":!0,"show-zoom":"","show-footer":"",resize:"",onClose:k,onHide:k,onShow:h},{title:F((()=>[E(" [NO."+H(P(f).id)+"]证书日志 ",1)])),left:F((()=>[z("div",Bt,[y(L,{current:P(v),"onUpdate:current":a[0]||(a[0]=e=>ae(v)?v.value=e:v=e),direction:"vertical",size:"small",onChange:a[1]||(a[1]=e=>{var t,l,a;return _({item:P(f),index:e,domain_id:(null==(a=null==(l=null==(t=P(n).current_step_domain[e])?void 0:t.domain)?void 0:l.domain)?void 0:a[0])?"demo":P(n).current_step_domain[e].domain})})},{default:F((()=>[(R(!0),M(N,null,Y(P(n).current_step_domain,((e,t)=>(R(),O(A,{key:t,status:e.status?2===e.status?"wait":"success":"error",description:e.msg,disabled:2===e.status},{icon:F((()=>[0===e.status?(R(),O(T,{key:0,class:"text-base"})):q("",!0),1===e.status?(R(),O(D,{key:1,class:"text-base"})):q("",!0),2===e.status?(R(),O($,{key:2,class:"text-base"})):q("",!0)])),title:F((()=>{var t,l;return[E(H((null==(l=null==(t=e.domain)?void 0:t.domain)?void 0:l[0])||e.domain),1)]})),subTitle:F((()=>[z("div",null,H(null==d?void 0:d[e.status]),1)])),_:2},1032,["status","description","disabled"])))),128))])),_:1},8,["current"])])])),default:F((()=>{var e,t,l,a;return[z("div",It,[z("div",Rt,[z("table",Ot,[Ft,z("tbody",null,[z("tr",null,[z("td",null,H(null==(e=P(f))?void 0:e.task_id),1),z("td",null,H(null==(t=P(f))?void 0:t.domain),1),z("td",null,H(null==(l=P(f))?void 0:l.service),1),z("td",null,H(null==(a=P(f))?void 0:a.username),1)])])])]),y(j,{mode:"left"},{default:F((()=>[(R(!0),M(N,null,Y(P(n).current_step_log,(e=>(R(),O(U,{key:e.id,color:e.status?"green":"red"},{dot:F((()=>[e.status?(R(),O(D,{key:0,class:"text-base"})):(R(),O(T,{key:1,class:"text-base"}))])),default:F((()=>[z("span",{style:oe({color:e.status?"var(--success-color)":"var(--error-color)"})},"【"+H(e.create_time)+"】"+H(e.run_action),5),E(),Et,E("   "+H(e.msg),1),Ht,E("   "+H(e.describe),1)])),_:2},1032,["color"])))),128))])),_:1})])]})),_:1},8,["model-value"])],64)}}},[["__scopeId","data-v-d0f30279"]]),qt={id:"update-cert-box"},Mt=(e=>(se("data-v-0193e8fa"),e=e(),ue(),e))((()=>z("span",null,"暂无权限更新相关云类型证书，请联系相关人员开启其权限~~",-1))),zt=te({__name:"UpdateCert",setup(e,{expose:t}){var l;const a=fe(),i=ye(),{getCertTimeLimit:o,getCertAllDataList:n}=Ie;let d=J({currentDomainData:{},loading:!1,certDataList:[],domain:(null==(l=i.query)?void 0:l.domain)||null,activeType:null,activeChildrenType:null,initButton:[],initClumns:[],hostList:{initButton:[],initClumns:[]},timeLimit:{}}),r=B("canUserAction"),s=j(null);const u=()=>{var e;s.value&&(null==(e=s.value)||e.commitRequest({action:d.activeChildrenType,domain:d.domain,service:d.activeType}))},c=async e=>{let t=await o()||{};d.timeLimit=(null==t?void 0:t.custom_data)||{post_date:20,update_date:10},d.domain=e,d.loading=!0;let l=await n();d.certDataList=l||[];let a=l.map((e=>((null==e?void 0:e.cert_list)&&(e.cert_list=e.cert_list.map((e=>(e.is_post_cert=(e=>{const{expire_days:t}=e,{post_date:l}=(null==d?void 0:d.timeLimit)||{post_date:20,update_date:10};return{disabled:t<l,reason:t<l?`当前证书剩余${t}天 < 限制${l}天，不能用于上传`:""}})(e),e)))),e)));d.currentDomainData=a.find((t=>t.top_domain===e))||{},d.loading=!1,u()},v={huawei_cert_update:{label:"华为云",value:"huawei_cert_update",children:[{label:"CDN",value:"cdn_domain_list"},{label:"WAF",value:"waf_domain_list"},{label:"ELB",value:"elb_listener_list"}]},ali_cert_update:{label:"阿里云",value:"ali_cert_update",children:[{label:"CDN",value:"cdn_domain_list"},{label:"WAF",value:"waf_domain_list"}]}},_=()=>document.getElementById("update-cert-box"),p=e=>{const t=document.querySelector(".main-content");t&&t.style.setProperty("background-color",e)},f=async()=>{d.hostList.initClumns=[],d.hostList.initButton=[];const{button:e,columns:t}=await De.setColumn({layer:"huawei_cert_update"===d.activeType?3:6});d.hostList.initClumns=t.value||[],d.hostList.initButton=e.value||[]};ge((async()=>{var e,t,l,a,o,n;const{button:r,columns:s}=await De.setColumn({layer:2});d.initClumns=s.value||[],d.initButton=r.value||[],d.activeType=null==(t=null==(e=r.value)?void 0:e[0])?void 0:t.field,d.activeChildrenType=null==(o=null==(a=null==(l=v[d.activeType])?void 0:l.children)?void 0:a[0])?void 0:o.value,await f(),c(null==(n=i.query)?void 0:n.domain),p("rgb(246 247 250)")}));const g=m((()=>d.initClumns)),b=m((()=>d.hostList.initClumns)),h=e=>{e&&(c(e),a.push({name:"certificateManagement",query:{domain:e}}))},k=async e=>{var t,l,a;d.activeType=e,d.activeChildrenType=null==(a=null==(l=null==(t=v[e])?void 0:t.children)?void 0:l[0])?void 0:a.value,await f(),u()};return be((()=>{p("white")})),t({handleQueryData:c}),he("updateCertState",d),(e,t)=>{const l=Qe,a=ke,i=Ne,o=Ye,n=K,c=Ce,m=xe,p=we,f=lt,C=ze;return R(),M("div",qt,[y(f,{onBack:t[3]||(t[3]=()=>e.$router.push({name:"certificateManagement"}))},{title:F((()=>[y(l,{style:{"font-size":"inherit"}},{default:F((()=>[E(" 证书更新   域名： "),y(o,{value:P(d).domain,"onUpdate:value":t[0]||(t[0]=e=>P(d).domain=e),style:{width:"500px",marginRight:"16px"},"get-popup-container":_,placeholder:"请选择证书",onChange:h},{default:F((()=>[(R(!0),M(N,null,Y(P(d).certDataList,(e=>(R(),O(i,{key:e.top_domain,value:e.top_domain},{default:F((()=>[y(a,{justify:"space-between"},{default:F((()=>{var t;return[y(l,null,{default:F((()=>[E(H(e.top_domain),1)])),_:2},1024),(null==(t=null==e?void 0:e.cert_list)?void 0:t.length)?(R(),O(l,{key:0},{default:F((()=>{var t;return[E("（相关证书共 "),z("b",null,H(null==(t=null==e?void 0:e.cert_list)?void 0:t.length),1),E(" 条）")]})),_:2},1024)):q("",!0)]})),_:2},1024)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1})])),footer:F((()=>[P(d).initButton.length?(R(),M(N,{key:0},[y(m,{activeKey:P(d).activeType,"onUpdate:activeKey":t[2]||(t[2]=e=>P(d).activeType=e),type:"card",onChange:k},{default:F((()=>[(R(!0),M(N,null,Y(P(d).initButton,(({field:e})=>(R(),O(c,{key:e},{tab:F((()=>{var t,l;return[y(n,{type:null==(t=null==v?void 0:v[e])?void 0:t.label,class:"xy-w-2 xy-font-size-20"},null,8,["type"]),E(H(null==(l=null==v?void 0:v[e])?void 0:l.label),1)]})),default:F((()=>[y(m,{activeKey:P(d).activeChildrenType,"onUpdate:activeKey":t[1]||(t[1]=e=>P(d).activeChildrenType=e),style:{"margin-top":"10px"},onChange:u},{rightExtra:F((()=>{var t,l;return[(null==(t=P(r))?void 0:t.import_cert_log)?(R(),O(Lt,{key:0,service:e},null,8,["service"])):q("",!0),(null==(l=P(r))?void 0:l.update_cert_log)?(R(),O(Pt,{key:1,service:e},null,8,["service"])):q("",!0)]})),default:F((()=>[(R(!0),M(N,null,Y(null==v?void 0:v[e].children,(({value:e,label:t})=>(R(),O(c,{key:e,tab:t},null,8,["tab"])))),128))])),_:2},1032,["activeKey"])])),_:2},1024)))),128))])),_:1},8,["activeKey"]),y(At,{ref_key:"certListRef",ref:s,columns:P(g),service:P(d).activeType,action:P(d).activeChildrenType,"host-columns":P(b),"cert-sid":e.$route.query.domain},null,8,["columns","service","action","host-columns","cert-sid"])],64)):(R(),O(p,{key:1},{description:F((()=>[Mt])),_:1}))])),_:1}),y(C)])}}},[["__scopeId","data-v-0193e8fa"]]),Nt=e=>(se("data-v-a6552466"),e=e(),ue(),e),Yt={class:"w-full mb-1"},Gt=["onClick"],Wt={key:0},Vt=Nt((()=>z("br",null,null,-1))),Kt={class:"text-primary"},Xt={class:"text-error"},Zt=Nt((()=>z("br",null,null,-1))),Qt=["onClick"],Jt=["onClick"],el={key:0,class:"cert-item"},tl=["title","onClick"],ll={class:"cert-name"},al={class:"cert-name"},il={key:0},ol={class:"w-5 inline-block text-center"},nl={key:1},dl={class:"text-primary"},rl={class:"text-error"},sl=te({__name:"index",props:{domain:{type:String,default:""}},setup(a){const i=a,o=fe(),{getCertAllDataList:n,getCertOneList:d,getCertUserList:r}=Ie,s=[{value:1,label:"有效证书",color:"#67c23a"},{value:"all",label:"全部证书",color:"#666666"},{value:0,label:"过期证书",color:"#fb6340"}],u=j(null),c=J({initColumn:[],initButton:[],initTitleData:[],fullData:[],filterConditions:{status:1},userList:[],subPageColumns:[]}),{userEdit:v,userDel:_,formOpen:p,formType:f,formSid:g}=Ue(),b=m((()=>{for(let e of c.initColumn){let{field:t}=e;switch(t){case"virtual_team_v3_id":e.showOverflow=!1;break;case"labels":e.minWidth="180",delete e.showOverflow,e.slots={default:t};break;case"cloud_master_account_id":e.slots={default:t},e.minWidth=180,e.showOverflow=!1;break;case"expire_days":e.minWidth="150";break;case"certificate_id":case"top_domain":e.slots={default:t};break;case"id":case"snis":case"status":case"cert_list":e.showOverflow=!1,e.slots={default:t};break;case"expire_time":case"update_time":e.showOverflow="ellipsis"}}return c.initColumn})),h=m((()=>{let e={};if(c.initButton)for(let t of c.initButton){let{field:l}=t;switch(l){case"edit":case"add":case"check_cert":case"update_cert_log":case"import_cert_log":e[l]=t;break;case"delete":e.del=t}}return e}));ge((async()=>{const{button:e,columns:t,title_data:l,sub_page_columns:a}=await De.setColumn({layer:1});c.initColumn=t.value||[],c.initButton=e.value||[],c.initTitleData=l.value||[],c.subPageColumns=a||[],c.userList=await r()}));const k=async()=>{u.value&&await u.value.commitRequest()},C=({type:e,row:t})=>{v({type:e,sid:t.id})},x=e=>"all"!==e?c.fullData.reduce(((t,l)=>t+l.cert_list.filter((t=>t.status===e)).length),0):c.fullData.reduce(((e,t)=>e+t.cert_list.length),0),w=e=>{c.fullData=e},S=({row:e})=>{let t=Re(e.expire_time).diff(e.start_time,"days"),l=e.expire_days/t*100;return{background:`linear-gradient(90deg, #c8f5d1 ${l}%, ${l}%, #c6c2c2)`}},{subPageOpen:T,subPageRow:D,handleSubPageOpen:$}=e();let A=j(null),L=j(null);const U=e=>{A.value=e,o.push({name:"certificateManagement",query:{domain:e.top_domain}})},B=(e,t,l)=>{if(!e||!t)return 0;const a=Re(t).diff(Re(e),"days");return Math.min(100,Math.max(0,(a-l)/a*100))},G=e=>e<=30?"#f56c6c":e<=90?"#e6a23c":"#67c23a";return he("canUserAction",h),he("domain",i.domain),(e,a)=>{var i,o;const r=re,m=Te,A=ze,j=pe,W=me,V=X,Z=K,Q=I("vxe-tag"),J=Je,ee=I("vxe-button"),te=l,le=t;return R(),M(N,null,[e.$route.query.domain?(R(),O(zt,{key:0,ref_key:"updateCertRef",ref:L},null,512)):(R(),O(te,{key:1,ref_key:"tableRef",ref:u,columns:P(b),"auth-btn":P(h),"request-config":{api:P(n),immediate:!0},"row-style":S,onUserAdd:a[0]||(a[0]=t=>P(v)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),"onUpdate:fullData":w},{topPrefix:F((()=>[z("div",Yt,[(R(),M(N,null,Y(s,(({value:e,color:t,label:l},a)=>y(m,{key:e,count:x(e),"overflow-count":Infinity,"number-style":{backgroundColor:"all"!==e?t:"var(--primary-color)"},size:"small"},{default:F((()=>[y(r,{class:ie([{"ml-3":0!==a},"xy-13"]),type:"primary",ghost:!(P(c).filterConditions.status===e||"all"===e&&null===P(c).filterConditions.status),disabled:!x(e)&&"all"!==e,onClick:t=>(e=>{c.filterConditions.status="all"===e?null:e,ve((()=>{var e,t,l,a;u.value&&(null==(e=u.value)?void 0:e.getDom())&&(null==(a=null==(l=null==(t=u.value)?void 0:t.getDom())?void 0:l.recalculate)||a.call(l,!0))}))})(e)},{default:F((()=>[E(H(l),1)])),_:2},1032,["class","ghost","disabled","onClick"])])),_:2},1032,["count","number-style"]))),64)),y(A)])])),id:F((({row:e})=>[y(W,{placement:"topLeft"},{title:F((()=>[y(j,{copyable:{tooltip:!1},class:"copy-text"},{default:F((()=>[E(H(e.certificate_id),1)])),_:2},1024)])),default:F((()=>[z("span",{class:"cursor-pointer text-primary",onClick:t=>P($)(e)},H(e.id),9,Gt)])),_:2},1024)])),snis:F((({row:e})=>[e.snis?(R(),M("span",Wt,[Array.isArray(e.snis)?(R(!0),M(N,{key:0},Y(e.snis,(e=>(R(),M(N,{key:e},[y(V,{color:"green"},{default:F((()=>[E(H(e),1)])),_:2},1024),Vt],64)))),128)):(R(),M(N,{key:1},[E(H(e.snis),1)],64))])):q("",!0)])),labels:F((({row:e})=>[e.labels?(R(!0),M(N,{key:0},Y(e.labels,((e,t)=>(R(),M(N,{key:t},["validity_end"!==t&&"validity_start"!==t?(R(),O(V,{key:0,class:"block"},{default:F((()=>[z("b",Kt,H(t),1),E(": "),z("span",Xt,H(e),1)])),_:2},1024)):q("",!0)],64)))),128)):q("",!0)])),cloud_master_account_id:F((({row:t})=>[Array.isArray(t.cloud_master_account_id)?(R(!0),M(N,{key:0},Y(t.cloud_master_account_id,(t=>{var l,a,i;return R(),M(N,{key:t},[(null==(l=P(c).initTitleData)?void 0:l.cloud_master_account_id)&&(null==(i=e.$utils.groupBy(null==(a=P(c).initTitleData)?void 0:a.cloud_master_account_id,"id"))?void 0:i[t])?(R(),O(W,{key:0,placement:"topLeft",class:"mb-2"},{title:F((()=>[y(j,{copyable:{tooltip:!1},class:"copy-text"},{default:F((()=>{var l,a,i,o;return[E(H((null==(o=null==(i=null==(a=e.$utils.groupBy(null==(l=P(c).initTitleData)?void 0:l.cloud_master_account_id,"id"))?void 0:a[t])?void 0:i[0])?void 0:o.access_key)||""),1)]})),_:2},1024)])),default:F((()=>[y(V,{class:"xy-tag-2"},{default:F((()=>{var l,a,i,o,n,d,r,s,u,v,_,m;return[y(Z,{type:null==(o=null==(i=null==(a=e.$utils.groupBy(null==(l=P(c).initTitleData)?void 0:l.cloud_master_account_id,"id"))?void 0:a[t])?void 0:i[0])?void 0:o.cloud_type,class:"xy-w-2"},null,8,["type"]),E(" "+H((null==(s=null==(r=null==(d=e.$utils.groupBy(null==(n=P(c).initTitleData)?void 0:n.cloud_master_account_id,"id"))?void 0:d[t])?void 0:r[0])?void 0:s.page_display)||"")+" "+H((null==(m=null==(_=null==(v=e.$utils.groupBy(null==(u=P(c).initTitleData)?void 0:u.cloud_master_account_id,"id"))?void 0:v[t])?void 0:_[0])?void 0:m.username)||""),1)]})),_:2},1024)])),_:2},1024)):q("",!0)],64)})),128)):(R(),M(N,{key:1},[E(H(t.cloud_master_account_id),1)],64))])),status:F((({row:e})=>[y(Q,{status:e.status?"success":"error",size:"small"},{default:F((()=>[E(H(P(c).initTitleData.status&&P(c).initTitleData.status[e.status]?P(c).initTitleData.status[e.status]:e.status),1)])),_:2},1032,["status"])])),update_name_id:F((({row:t})=>{var l,a,i,o,n,d;return[E(H((null==(i=null==(a=null==(l=e.$utils.groupBy(P(c).userList,"id"))?void 0:l[t.create_name_id])?void 0:a[0])?void 0:i.username)||t.create_name_id),1),Zt,E(" "+H((null==(d=null==(n=null==(o=e.$utils.groupBy(P(c).userList,"id"))?void 0:o[t.update_name_id])?void 0:n[0])?void 0:d.username)||t.update_name_id),1)]})),certificate_id:F((({row:e})=>[z("span",{class:"cursor-pointer text-primary",onClick:t=>U(e)},H(e.certificate_id),9,Qt)])),top_domain:F((({row:e})=>[z("span",{class:"cursor-pointer text-primary",onClick:t=>U(e)},H(e.top_domain),9,Jt)])),cert_list:F((({row:t})=>[t.cert_list?(R(!0),M(N,{key:0},Y(t.cert_list,(t=>{var l,a,i,o;return R(),M(N,{key:t.id},[t.status===P(c).filterConditions.status||null===P(c).filterConditions.status?(R(),M("div",el,[z("div",{class:"progress-wrapper cursor-pointer",title:`${t.cert_name}\n 证书有效期：${t.start_time} 至 ${t.expire_time}`,onClick:e=>P($)(t)},[z("span",ll,H(t.cert_name),1),y(J,{percent:B(t.start_time,t.expire_time,t.expire_days),"stroke-color":G(t.expire_days),"show-info":!1,size:[20,30],"stroke-linecap":"square"},{default:F((()=>[z("span",al,H(t.cert_name),1)])),_:2},1032,["percent","stroke-color"]),z("span",{class:"expire-days",style:oe({color:G(t.expire_days)})},[t.expire_days>=0?(R(),M("span",il,[E(" 剩余 "),z("span",ol,H(t.expire_days),1),E(" 天 ")])):(R(),M("span",nl," 已过期 "+H(String(t.expire_days).indexOf("-")>-1?String(t.expire_days).split("-")[1]:t.expire_days)+" 天 ",1))],4),z("span",null,[(null==(a=null==(l=P(h))?void 0:l.edit)?void 0:a.page_display)?(R(),O(ee,{key:0,icon:"vxe-icon-edit",status:"primary",mode:"text",onClick:Se((l=>C({row:t,type:e.$CONFIG.FORM_TYPE.EDIT_TYPE})),["stop"])},null,8,["onClick"])):q("",!0),(null==(o=null==(i=P(h))?void 0:i.del)?void 0:o.page_display)?(R(),M(N,{key:1},[y(A,{type:"vertical"}),E(),y(ee,{mode:"text",status:"error",icon:"vxe-icon-delete",onClick:Se((e=>(e=>{_({delApi:Ie.deleteCert,sid:e.id,loadData:k})})(t)),["stop"])},null,8,["onClick"])],64)):q("",!0)])],8,tl)])):q("",!0)],64)})),128)):q("",!0)])),_:1},8,["columns","auth-btn","request-config"])),y(ut,{open:P(p),"onUpdate:open":a[1]||(a[1]=e=>ae(p)?p.value=e:null),sid:P(g),"form-type":P(f),onEditSuccess:k},null,8,["open","sid","form-type"]),y(le,{open:P(T),"onUpdate:open":a[2]||(a[2]=e=>ae(T)?T.value=e:null),title:`证书编码：${null==(i=P(D))?void 0:i.cert_name}`,"basic-config":{columns:P(c).subPageColumns,api:P(d),sid:null==(o=P(D))?void 0:o.id},onClickEdit:a[3]||(a[3]=t=>C({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:P(D)}))},{status:F((({row:e})=>[y(Q,{status:e.status?"success":"error",size:"small"},{default:F((()=>[E(H(P(c).initTitleData.status&&P(c).initTitleData.status[e.status]?P(c).initTitleData.status[e.status]:e.status),1)])),_:2},1032,["status"])])),labels:F((({row:e})=>[e.labels?(R(!0),M(N,{key:0},Y(e.labels,((e,t)=>(R(),M(N,{key:t},["validity_end"!==t&&"validity_start"!==t?(R(),O(V,{key:0,class:"block"},{default:F((()=>[z("b",dl,H(t),1),E(": "),z("span",rl,H(e),1)])),_:2},1024)):q("",!0)],64)))),128)):q("",!0)])),update_name_id:F((({row:t})=>{var l,a,i;return[E(H((null==(i=null==(a=null==(l=e.$utils.groupBy(P(c).userList,"id"))?void 0:l[t.update_name_id])?void 0:a[0])?void 0:i.username)||t.update_name_id),1)]})),create_name_id:F((({row:t})=>{var l,a,i;return[E(H((null==(i=null==(a=null==(l=e.$utils.groupBy(P(c).userList,"id"))?void 0:l[t.create_name_id])?void 0:a[0])?void 0:i.username)||t.create_name_id),1)]})),cloud_master_account_id:F((({row:t})=>[Array.isArray(t.cloud_master_account_id)?(R(!0),M(N,{key:0},Y(t.cloud_master_account_id,(t=>{var l,a,i;return R(),M(N,{key:t},[(null==(l=P(c).initTitleData)?void 0:l.cloud_master_account_id)&&(null==(i=e.$utils.groupBy(null==(a=P(c).initTitleData)?void 0:a.cloud_master_account_id,"id"))?void 0:i[t])?(R(),O(W,{key:0,placement:"topLeft"},{title:F((()=>[y(j,{copyable:{tooltip:!1},class:"copy-text"},{default:F((()=>{var l,a,i,o;return[E(H((null==(o=null==(i=null==(a=e.$utils.groupBy(null==(l=P(c).initTitleData)?void 0:l.cloud_master_account_id,"id"))?void 0:a[t])?void 0:i[0])?void 0:o.access_key)||""),1)]})),_:2},1024)])),default:F((()=>[y(V,null,{default:F((()=>{var l,a,i,o,n,d,r,s,u,v,_,m;return[y(Z,{type:null==(o=null==(i=null==(a=e.$utils.groupBy(null==(l=P(c).initTitleData)?void 0:l.cloud_master_account_id,"id"))?void 0:a[t])?void 0:i[0])?void 0:o.cloud_type,class:"xy-w-2"},null,8,["type"]),E(" "+H((null==(s=null==(r=null==(d=e.$utils.groupBy(null==(n=P(c).initTitleData)?void 0:n.cloud_master_account_id,"id"))?void 0:d[t])?void 0:r[0])?void 0:s.page_display)||"")+" "+H((null==(m=null==(_=null==(v=e.$utils.groupBy(null==(u=P(c).initTitleData)?void 0:u.cloud_master_account_id,"id"))?void 0:v[t])?void 0:_[0])?void 0:m.username)||""),1)]})),_:2},1024)])),_:2},1024)):q("",!0)],64)})),128)):(R(),M(N,{key:1},[E(H(t.cloud_master_account_id),1)],64))])),_:1},8,["open","title","basic-config"])],64)}}},[["__scopeId","data-v-a6552466"]]);export{sl as default};
