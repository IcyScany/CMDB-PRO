import{a3 as e,H as a,r as t,J as s,I as o,z as i,Q as n,R as r,X as l,F as c,S as u,a6 as m,am as d,$ as _,Y as p,Z as v,c as g,W as y,U as b,ah as f,ai as h,aV as w,v as x,aY as k,a9 as D,aa as $}from"./index.872a2bd0.js";import{A as j}from"./kvstore.f031d3ae.js";import{i as E}from"./index.165d9fa7.js";import{_ as z}from"./index.fc9664cf.js";const O={class:"overview-container"},C={class:"summary-box"},L=["onClick"],R={class:"summary-title"},T=["src"],A=(e=>(D("data-v-238bbbe2"),e=e(),$(),e))((()=>l("div",{class:"summary-border"},null,-1))),B={class:"desc-box"},F={class:"desc-title"},G={class:"desc-list"},I={class:"desc-label truncate"},J={class:"desc-value"},N={key:0},S={style:{color:"#888"}},Y={key:1},H=e({__name:"index",emits:["update:viewType"],setup(e,{emit:D}){const $=D,H=a({overviewData:{}}),P=t(null);let Q=null;const U={total:{label:"数据库总数",color:"#4fb050",icon:"kvstore.png",pointer:!0},status:{label:"状态分布",color:"#e88250"},expire_time:{label:"即将过期",color:"#3c79bf"},charge_type:{label:"付费类型",color:"#4fb050"}},V={cloud_source:{label:"云来源分布",icon:!0},region_id:{label:"区域分布",icon:!0},environment:{label:"环境分布"},spec_code:{label:"规格分布"},engine:{label:"引擎分布"}},W=e=>e.sort(((e,a)=>a.count-e.count)),X=()=>{Q&&Q.resize()};return s((async()=>{await(async()=>{const e=await j.getOverview({expire_days:[10,30],group_by_fields:[["environment"],["charge_type"],["status"],["region_id","cloud_source"],["spec_code"],["cloud_source"],["engine","engine_version"]],volume_usage_rate_top_n:10,mem_usage_rate_top_n:10});H.overviewData.total=[{total:"数据库总数",count:e.count}],H.overviewData.expire_time=[],e.expire_soon.forEach((e=>{H.overviewData.expire_time.push({expire_time:`即将过期(小于${e.days}天)`,count:e.instances.length})})),e.group_by.forEach((e=>{let a=e.fields[0];H.overviewData[a]=e.items})),H.overviewData.mem_usage_rate_top_n=e.mem_usage_rate_top_n,H.overviewData.mem_usage_rate_top_n.forEach((e=>{e.mem=Number(e.mem/1024).toFixed(1),e.mem_used=Number(e.mem_used/1024).toFixed(1)}))})(),await(async()=>{let e=H.overviewData;Object.entries(e).forEach((([e,a])=>{a.forEach((a=>{a[e]||(a[e]="其他")}))}));const a=await h.getCloudRegionList();e.region_id.forEach((e=>{e.region_id=(null==a?void 0:a[e.region_id])||e.region_id}));let t=W(e.region_id);t.length>5&&(e.region_id=t.slice(0,4),e.region_id.push({region_id:"其他",count:t.slice(4).reduce(((e,a)=>e+a.count),0),other_data:t.slice(4)}));let s=W(e.spec_code);s.length>10&&(e.spec_code=s.slice(0,9),e.spec_code.push({spec_code:"其他",count:s.slice(9).reduce(((e,a)=>e+a.count),0),other_data:s.slice(9)}));let o=W(e.engine);e.engine=o.map((e=>({engine:e.engine+" "+e.engine_version,count:e.count})))})(),o((()=>{(()=>{if(!H.overviewData.mem_usage_rate_top_n)return;const e=[...H.overviewData.mem_usage_rate_top_n].sort(((e,a)=>e.mem_usage_rate-a.mem_usage_rate)),a={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){const a=e[0].data.dataObj||{};return`\n                    <b>${a.name}</b><br/>\n                    环境：${a.environment}<br/>\n                    总容量：${a.mem} GB<br/>\n                    已用容量：${a.mem_used} GB<br/>\n                    使用率：${a.mem_usage_rate}%\n                `}},grid:{left:150,right:100,bottom:20,top:20},xAxis:{type:"value",name:"使用率(%)",min:0,max:100},yAxis:{type:"category",data:e.map((e=>e.name)),axisLabel:{interval:0}},series:[{type:"bar",data:e.map((e=>({value:e.mem_usage_rate,dataObj:e}))),color:"#3c79bf",label:{show:!0,position:"right",formatter:function(e){const a=e.data.dataObj;return`${a.mem_usage_rate}%  (${a.mem_used}/${a.mem}GB)`}}}]};Q||(Q=E(P.value)),Q.setOption(a),setTimeout((()=>{Q&&Q.resize()}),0)})(),window.addEventListener("resize",X)}))})),i((()=>{window.removeEventListener("resize",X)})),(e,a)=>{const t=w,s=x,o=z,i=k;return n(),r("div",O,[l("div",C,[(n(),r(c,null,u(U,((e,a)=>l("div",{key:a,class:m(["summary-item",{"cursor-pointer":e.pointer}]),style:d({"--summary-color":e.color}),onClick:a=>e.pointer?$("update:viewType","RDS"):null},[(n(!0),r(c,null,u(_(H).overviewData[a],((t,s)=>(n(),r(c,{key:s},[l("div",null,[l("div",{class:"summary-value",style:d({"font-size":"total"===a?"32px":""})},p(t.count),5),l("div",R,p(t[a]),1)]),e.icon?(n(),r("img",{key:0,class:"summary-icon",src:`/images/${e.icon}`},null,8,T)):v("",!0),A],64)))),128))],14,L))),64))]),g(i,{title:"资源分布"},{default:y((()=>[l("div",B,[(n(),r(c,null,u(V,((e,a)=>{var i;return l("div",{key:a,class:"desc-card"},[l("div",F,p(e.label),1),l("div",G,[(n(!0),r(c,null,u(null==(i=_(H).overviewData)?void 0:i[a],(i=>(n(),r("div",{key:i.label,class:m({"two-col":"spec_code"===a})},[g(s,{title:i[a]},{default:y((()=>[l("span",I,[!e.icon||"cloud_source"===a&&"自建"===i.cloud_source?v("",!0):(n(),b(t,{key:0,type:i.cloud_source,style:{width:"22px"}},null,8,["type"])),f(" "+p(i[a])+"： ",1)])])),_:2},1032,["title"]),l("span",J,[i.other_data?(n(),r("span",N,[g(o,{placement:"right"},{content:y((()=>[(n(!0),r(c,null,u(i.other_data,((s,o)=>(n(),r("div",{key:o},[l("span",S,[e.icon?(n(),b(t,{key:0,type:s.cloud_source,style:{width:"22px"}},null,8,["type"])):v("",!0),f(" "+p(s[a])+": ",1)]),f(" "+p(s.count),1)])))),128))])),default:y((()=>[l("span",null,p(i.count),1)])),_:2},1024)])):(n(),r("span",Y,p(i.count),1))])],2)))),128))])])})),64))])])),_:1}),g(i,{title:"内存使用率Top10"},{default:y((()=>[l("div",{ref_key:"volumeChartRef",ref:P,style:{width:"100%",height:"400px","margin-bottom":"24px"}},null,512)])),_:1})])}}},[["__scopeId","data-v-238bbbe2"]]);export{H as default};
