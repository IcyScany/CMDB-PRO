import{_ as e}from"./index.029351cd.js";import{_ as t}from"./index.7d980246.js";import{h as a,aC as l,d as i,n as o,_ as n,ca as s,r as d,b2 as r,w as u,bQ as p,u as m,q as c,cT as f,dA as v,aF as y,t as _,c as w,dR as g,g as b,bB as S,cb as k,aJ as h,s as x,o as C,ce as U,dS as T,av as R,dT as F,bz as O,al as L,H as j,b0 as P,O as A,Q as z,U as $,W as B,$ as D,R as E,F as I,S as N,ah as M,Z as q,b6 as W,Y as H,X as K,aT as Y,I as V,cI as G,cH as J,v as Q,a8 as X,aN as Z,a3 as ee,J as te,ai as ae,cE as le,ad as ie,cF as oe,d6 as ne,aj as se,aS as de,a7 as re,a9 as ue,aa as pe}from"./index.872a2bd0.js";import{t as me}from"./tableRender.a6ff99b7.js";import{A as ce}from"./pwdManagementApi.077bb090.js";import{o as fe,_ as ve,b as ye,u as _e,a as we,d as ge}from"./opsFormInit.3a4e1794.js";import"./index.6e2fd079.js";import{R as be,_ as Se}from"./Group.b415afa6.js";import{_ as ke}from"./index.461e6114.js";import{_ as he}from"./index.fc9664cf.js";import"./index.64f8d8d4.js";import"./index.2c670fa1.js";import"./opsTable.7b07fc7b.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.44a4e190.js";import"./index.65b2e021.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.48209b21.js";import"./RadioButton.534ff50d.js";import"./index.e3d002e2.js";const xe=a("Popconfirm",(e=>(e=>{const{componentCls:t,iconCls:a,zIndexPopup:l,colorText:i,colorWarning:o,marginXS:n,fontSize:s,fontWeightStrong:d,lineHeight:r}=e;return{[t]:{zIndex:l,[`${t}-inner-content`]:{color:i},[`${t}-message`]:{position:"relative",marginBottom:n,color:i,fontSize:s,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${t}-message-icon ${a}`]:{color:o,fontSize:s,flex:"none",lineHeight:1,paddingTop:(Math.round(s*r)-s)/2},"&-title":{flex:"auto",marginInlineStart:n},"&-title-only":{fontWeight:d}},[`${t}-description`]:{position:"relative",marginInlineStart:s+n,marginBottom:n,color:i,fontSize:s},[`${t}-buttons`]:{textAlign:"end",button:{marginInlineStart:n}}}}})(e)),(e=>{const{zIndexPopupBase:t}=e;return{zIndexPopup:t+60}}));var Ce=globalThis&&globalThis.__rest||function(e,t){var a={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(l=Object.getOwnPropertySymbols(e);i<l.length;i++)t.indexOf(l[i])<0&&Object.prototype.propertyIsEnumerable.call(e,l[i])&&(a[l[i]]=e[l[i]])}return a};const Ue=l(i({compatConfig:{MODE:3},name:"APopconfirm",inheritAttrs:!1,props:o(n(n({},k()),{prefixCls:String,content:h(),title:h(),description:h(),okType:x("primary"),disabled:{type:Boolean,default:!1},okText:h(),cancelText:h(),icon:h(),okButtonProps:C(),cancelButtonProps:C(),showCancel:{type:Boolean,default:!0},onConfirm:Function,onCancel:Function}),n(n({},s()),{trigger:"click",placement:"top",mouseEnterDelay:.1,mouseLeaveDelay:.1,arrowPointAtCenter:!1,autoAdjustOverflow:!0,okType:"primary",disabled:!1})),slots:Object,setup(e,t){let{slots:a,emit:l,expose:i,attrs:o}=t;const s=d();r(void 0===e.visible),i({getPopupDomNode:()=>{var e,t;return null===(t=null===(e=s.value)||void 0===e?void 0:e.getPopupDomNode)||void 0===t?void 0:t.call(e)}});const[k,h]=u(!1,{value:p(e,"open")}),x=(t,a)=>{void 0===e.open&&h(t),l("update:open",t),l("openChange",t,a)},C=e=>{x(!1,e)},L=t=>{var a;return null===(a=e.onConfirm)||void 0===a?void 0:a.call(e,t)},j=t=>{var a;x(!1,t),null===(a=e.onCancel)||void 0===a||a.call(e,t)},P=t=>{const{disabled:a}=e;a||x(t)},{prefixCls:A,getPrefixCls:z}=m("popconfirm",e),$=c((()=>z())),B=c((()=>z("btn"))),[D]=xe(A),[E]=f("Popconfirm",v.Popconfirm),I=()=>{var t,l,i,o,s;const{okButtonProps:d,cancelButtonProps:r,title:u=(null===(t=a.title)||void 0===t?void 0:t.call(a)),description:p=(null===(l=a.description)||void 0===l?void 0:l.call(a)),cancelText:m=(null===(i=a.cancel)||void 0===i?void 0:i.call(a)),okText:c=(null===(o=a.okText)||void 0===o?void 0:o.call(a)),okType:f,icon:v=(null===(s=a.icon)||void 0===s?void 0:s.call(a))||w(U,null,null),showCancel:y=!0}=e,{cancelButton:_,okButton:g}=a,b=n({onClick:j,size:"small"},r),S=n(n(n({onClick:L},T(f)),{size:"small"}),d);return w("div",{class:`${A.value}-inner-content`},[w("div",{class:`${A.value}-message`},[v&&w("span",{class:`${A.value}-message-icon`},[v]),w("div",{class:[`${A.value}-message-title`,{[`${A.value}-message-title-only`]:!!p}]},[u])]),p&&w("div",{class:`${A.value}-description`},[p]),w("div",{class:`${A.value}-buttons`},[y?_?_(b):w(R,b,{default:()=>[m||E.value.cancelText]}):null,g?g(S):w(F,{buttonProps:n(n({size:"small"},T(f)),d),actionFn:L,close:C,prefixCls:B.value,quitOnNullishReturnValue:!0,emitEvent:!0},{default:()=>[c||E.value.okText]})])])};return()=>{var t;const{placement:l,overlayClassName:i,trigger:n="click"}=e,d=Ce(e,["placement","overlayClassName","trigger"]),r=y(d,["title","content","cancelText","okText","onUpdate:open","onConfirm","onCancel","prefixCls"]),u=_(A.value,i);return D(w(he,b(b(b({},r),o),{},{trigger:n,placement:l,onOpenChange:P,open:k.value,overlayClassName:u,transitionName:S($.value,"zoom-big",e.transitionName),ref:s,"data-popover-inject":!0}),{default:()=>[g((null===(t=a.default)||void 0===t?void 0:t.call(a))||[],{onKeydown:e=>{(e=>{e.keyCode===O.ESC&&k&&x(!1,e)})(e)}},!1)],content:I}))}}})),Te=K("i",{class:"bi bi-question-circle-fill text-orange"},null,-1),Re={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number},fieldName:{type:Object,default:()=>({})},allOptions:{type:Object}},emits:["update:open","editSuccess"],setup(t,{emit:a}){const l=t,{open:i,sid:o,formType:n}=L(l),s=a,{putPwdManageEdit:r,getPwdManageDetail:u,postPwdManageAdd:p}=ce,m=d(null),f=j({usernameType:"text",usernameFileList:[],pwdType:"text",pwdFileList:[],originPwd:""}),{edit_data:v,formRenderContent:y,formDataLoading:_,confirmLoading:g,initForm:b,formDataInit:S,editSubmit:k}=fe({formRef:m,TITLE_LAYER:1,formType:n,sid:o,emits:s,addApi:p,editApi:r,oneDataApi:u,customSubmitData:async function(e){e.pwd==f.originPwd?delete e.pwd:e.pwd=await Y(e.pwd);return e.encryption_private_key=e.encryption_private_key?await Y(e.encryption_private_key):"",e},customEditData:function(){}});const h=()=>{s("update:open",!1)},x=async e=>{e?(await b(),await S(),f.originPwd=y.value.formState.pwd,y.value.formState.share_limits=y.value.formState.share_limits||[]):(f.usernameFileList=[],f.pwdFileList=[],f.usernameType="text",f.pwdType="text")},C=c((()=>{var e;return(null==(e=y.value)?void 0:e.formState.share_limits.includes("ALL"))?[{label:"公共",value:"ALL"}]:[{label:"公共",options:[{label:"公共",value:"ALL"}]},{label:"虚拟组",options:Object.keys(l.allOptions).reduce(((e,t)=>(t.startsWith("team-")&&e.push({label:l.allOptions[t],value:t}),e)),[])},{label:"域账号",options:Object.keys(l.allOptions).reduce(((e,t)=>(t.startsWith("user-")&&e.push({label:l.allOptions[t],value:t}),e)),[])}]})),U=c((()=>{var e,t,a;if("CMDB内部使用"===(null==(t=null==(e=y.value)?void 0:e.formState)?void 0:t.use_limits))return y.value.rules;const l=P.clone(null==(a=y.value)?void 0:a.rules,!0)||{};return l.encryption_private_key=[{required:1===v.value.is_check,message:"此项不能为空"}],l})),T=c((()=>{var e;if(!y.value.title)return[];let t=null==(e=y.value.formState)?void 0:e.types;return y.value.title.map((e=>{var a,i;return t&&("username"===e.field&&(e.field_name=(null==(a=l.fieldName[t])?void 0:a.username)||"username"),"pwd"===e.field&&(e.field_name=(null==(i=l.fieldName[t])?void 0:i.pwd)||"pwd")),e}))})),R=(e,t)=>{const a=new FileReader;return a.onload=async()=>{y.value.formState[t]=a.result},a.readAsText(e),!1},F=e=>{var t;const a={username(){y.value.formState.username="",f.usernameFileList=[]},pwd(){y.value.formState.pwd="",f.pwdFileList=[]},types(){Object.assign(y.value.formState,{username:"",pwd:"",encryption_private_key:"",tips:"",share_limits:[],describe:""}),f.usernameType="text",f.pwdType="text"},share_limits(){var e;(null==(e=y.value.formState)?void 0:e.share_limits.includes("ALL"))&&(y.value.formState.share_limits=["ALL"])},use_limits(){"CMDB内部使用"===y.value.formState.use_limits&&(y.value.formState.tips="",y.value.formState.encryption_private_key="")}};null==(t=a[e])||t.call(a),V((()=>{m.value.clearValidate()}))};return(t,a)=>{const l=ve,o=be,s=Se,d=A("vxe-button"),r=ke,u=G,p=J,c=ye,b=Q,S=X,O=Z,L=e;return z(),$(L,{title:`${t.$route.meta.title}${D(n)===t.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:D(i),onAfterOpenChange:x,onClose:h},{footer:B((()=>[w(d,{content:"取消",onClick:h}),w(d,{type:"submit",loading:D(g),status:"primary",content:"提交",onClick:D(k)},null,8,["loading","onClick"])])),default:B((()=>[w(O,{spinning:D(_)},{default:B((()=>[w(S,{ref_key:"formRef",ref:m,model:D(y).formState,rules:D(U)},{default:B((()=>[(z(!0),E(I,null,N(t.$utils.filter(D(T),(e=>e.edit_display)),(e=>{var t,i,m,_,g,S,k,h,x,U,T,O,L,j,P,A,N,K,Y,V,G,J,Q,X;return z(),E(I,{key:e.field},["username"===e.field?(z(),E(I,{key:0},[D(y).formState.types&&["Username with password","SSH Username with private key","AccessKey+SecretAccessKey"].includes(D(y).formState.types)?(z(),$(l,{key:0,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(i=null==(t=D(y))?void 0:t.title_data)?void 0:i[e.field]},null,8,["value","onUpdate:value","title","title-data"])):D(y).formState.types&&"Certificate"===D(y).formState.types?(z(),$(l,{key:1,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(_=null==(m=D(y))?void 0:m.title_data)?void 0:_[e.field]},{default:B((()=>[w(s,{value:D(f).usernameType,"onUpdate:value":a[0]||(a[0]=e=>D(f).usernameType=e),size:"small",style:{"margin-bottom":"10px",display:"block"},onChange:a[1]||(a[1]=e=>F("username"))},{default:B((()=>[w(o,{value:"text"},{default:B((()=>[M("粘贴文本")])),_:1}),w(o,{value:"file"},{default:B((()=>[M("上传文件")])),_:1})])),_:1},8,["value"]),w(p,null,{default:B((()=>["file"===D(f).usernameType?(z(),$(r,{key:0,"file-list":D(f).usernameFileList,"onUpdate:fileList":a[2]||(a[2]=e=>D(f).usernameFileList=e),"before-upload":e=>R(e,"username")},{default:B((()=>[w(d,{icon:"vxe-icon-upload",status:"primary",mode:"text",size:"mini",class:"ml-2 cursor-pointer",disabled:!!D(f).usernameFileList.length},{default:B((()=>[M(" 上传 ")])),_:1},8,["disabled"])])),_:1},8,["file-list","before-upload"])):(z(),$(u,{key:1,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t},null,8,["value","onUpdate:value"]))])),_:2},1024)])),_:2},1032,["value","onUpdate:value","title","title-data"])):q("",!0)],64)):"pwd"===e.field?(z(),E(I,{key:1},[D(y).formState.types&&["Secret file","Certificate"].includes(D(y).formState.types)?(z(),$(l,{key:0,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(S=null==(g=D(y))?void 0:g.title_data)?void 0:S[e.field]},{default:B((()=>[w(s,{value:D(f).pwdType,"onUpdate:value":a[3]||(a[3]=e=>D(f).pwdType=e),size:"small",style:{"margin-bottom":"10px",display:"block"},onChange:a[4]||(a[4]=e=>F("pwd"))},{default:B((()=>[w(o,{value:"text"},{default:B((()=>[M("粘贴文本")])),_:1}),w(o,{value:"file"},{default:B((()=>[M("上传文件")])),_:1})])),_:1},8,["value"]),w(p,null,{default:B((()=>["file"===D(f).pwdType?(z(),$(r,{key:0,"file-list":D(f).pwdFileList,"onUpdate:fileList":a[5]||(a[5]=e=>D(f).pwdFileList=e),"before-upload":e=>R(e,"pwd")},{default:B((()=>[w(d,{icon:"vxe-icon-upload",status:"primary",mode:"text",size:"mini",class:"ml-2 cursor-pointer",disabled:!!D(f).pwdFileList.length},{default:B((()=>[M(" 上传 ")])),_:1},8,["disabled"])])),_:1},8,["file-list","before-upload"])):(z(),$(u,{key:1,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t},null,8,["value","onUpdate:value"]))])),_:2},1024)])),_:2},1032,["value","onUpdate:value","title","title-data"])):D(y).formState.types?(z(),$(l,{key:1,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(h=null==(k=D(y))?void 0:k.title_data)?void 0:h[e.field]},null,8,["value","onUpdate:value","title","title-data"])):q("",!0)],64)):"share_limits"===e.field?(z(),E(I,{key:2},[D(y).formState.types?(z(),$(l,{key:0,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(U=null==(x=D(y))?void 0:x.title_data)?void 0:U[e.field]},{default:B((()=>[w(c,{value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,options:D(C),mode:"multiple",onChange:a[6]||(a[6]=e=>F("share_limits"))},null,8,["value","onUpdate:value","options"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):q("",!0)],64)):"tips"===e.field?(z(),E(I,{key:3},[D(y).formState.types&&"CMDB内部使用"!==D(y).formState.use_limits?(z(),$(l,{key:0,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(O=null==(T=D(y))?void 0:T.title_data)?void 0:O[e.field]},null,8,["value","onUpdate:value","title","title-data"])):q("",!0)],64)):"encryption_private_key"===e.field?(z(),E(I,{key:4},[D(y).formState.types&&"CMDB内部使用"!==D(y).formState.use_limits?(z(),$(l,{key:0,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(j=null==(L=D(y))?void 0:L.title_data)?void 0:j[e.field],disabled:1!==D(v).is_check&&D(n)===D(W)},null,8,["value","onUpdate:value","title","title-data","disabled"])):q("",!0)],64)):"describe"===e.field?(z(),E(I,{key:5},[D(y).formState.types?(z(),$(l,{key:0,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(A=null==(P=D(y))?void 0:P.title_data)?void 0:A[e.field]},null,8,["value","onUpdate:value","title","title-data"])):q("",!0)],64)):"types"===e.field?(z(),$(l,{key:6,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(K=null==(N=D(y))?void 0:N.title_data)?void 0:K[e.field],disabled:D(n)===D(W),onChange:a[7]||(a[7]=e=>F("types"))},null,8,["value","onUpdate:value","title","title-data","disabled"])):"use_limits"===e.field?(z(),$(l,{key:7,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(V=null==(Y=D(y))?void 0:Y.title_data)?void 0:V[e.field],disabled:D(n)===D(W),onChange:a[8]||(a[8]=e=>F("use_limits"))},null,8,["value","onUpdate:value","title","title-data","disabled"])):"uuid"===e.field?(z(),$(l,{key:8,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(J=null==(G=D(y))?void 0:G.title_data)?void 0:J[e.field],disabled:D(n)===D(W),label:null,onBlur:()=>D(y).formState[e.field]=D(y).formState[e.field].replace(/[^\w\.\/]/gi,"")},{label:B((()=>[M(H(e.field_name)+" ",1),e.page_data_source.form_tip_text?(z(),$(b,{key:0},{title:B((()=>[M(H(e.page_data_source.form_tip_text),1)])),default:B((()=>[Te])),_:2},1024)):q("",!0)])),_:2},1032,["value","onUpdate:value","title","title-data","disabled","onBlur"])):(z(),$(l,{key:9,value:D(y).formState[e.field],"onUpdate:value":t=>D(y).formState[e.field]=t,title:e,"title-data":null==(X=null==(Q=D(y))?void 0:Q.title_data)?void 0:X[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},Fe=e=>(ue("data-v-fcd3e1ed"),e=e(),pe(),e),Oe=["onClick"],Le=["href"],je={key:1},Pe=Fe((()=>K("br",null,null,-1))),Ae=Fe((()=>K("br",null,null,-1))),ze={class:"info-box"},$e={key:0,class:"info-content"},Be={class:"info-title"},De={class:"info-item"},Ee={class:"info-content"},Ie={class:"info-title"},Ne={class:"info-item"},Me={class:"info-content"},qe=Fe((()=>K("span",{class:"info-title"},"自定义密钥密码:",-1))),We={class:"info-item"},He={class:"info-content"},Ke=Fe((()=>K("span",{class:"info-title"},"自定义密钥密码提示符:",-1))),Ye={class:"info-item"},Ve={class:"flex items-center mb-2"},Ge=Fe((()=>K("div",{class:"w-40"},"自定义密钥密码: ",-1))),Je={key:0,class:"text-primary"},Qe=ee({__name:"index",setup(a){const l={encryption_private_key:[{required:!0,message:"此项不能为空",trigger:"change"}],new_key:[{required:!0,message:"此项不能为空",trigger:"change"}],auth_code:[{required:!0,message:"此项不能为空",trigger:"change"}],tips:[{required:!1,message:"此项不能为空",trigger:"change"}]},i={"Username with password":{username:"Username",pwd:"password"},"SSH Username with private key":{username:"SSH Username",pwd:"private key"},"Secret file":{username:"",pwd:"Secret file"},"Secret text":{username:"",pwd:"Secret text"},"AccessKey+SecretAccessKey":{username:"AccessKey",pwd:"SecretAccessKey"},Token:{username:"",pwd:"Token"},Certificate:{username:"证书公钥",pwd:"证书私钥"}},o=d(null),n=j({initColumn:[],initButton:[],allOptions:{},verifyCode:"",modalType:"copy",modalForm:{},modalRow:null,infoRow:null,visibleStates:{verify:!1,change:!1,reset:!1,info:!1},btnLoading:!1}),s={change:d(null),reset:d(null)},{userEdit:r,formOpen:u,formType:p,formSid:m}=_e(),f=c((()=>{const e=["uuid","share_limits","app_name","types"];return n.initColumn.map((t=>e.includes(t.field)?{...t,slots:{default:t.field}}:"create_name"===t.field?{...t,showOverflow:!1,slots:{default:t.field}}:"create_time"===t.field?{...t,showOverflow:!1,minWidth:"150px",slots:{default:t.field}}:t))})),v=c((()=>{const e=["edit","add","edit_key","edit_key_other","del"];return n.initButton.reduce(((t,a)=>(e.includes(a.field)&&(t[a.field]=a),t)),{})}));te((async()=>{const{button:e,columns:t}=await me.setColumn({layer:1});n.initColumn=t.value||[],n.initButton=e.value||[],await y()}));const y=async()=>{try{const[e,t]=await Promise.all([ae.getVirtualTeamList(),ce.getUserList()]);Object.values(e).forEach((e=>{n.allOptions[`team-${e.id}`]=e.group_name})),t.forEach((e=>{n.allOptions[`user-${e.id}`]=`${e.username}`})),n.allOptions.ALL="公共"}catch(e){we({content:"获取选项数据失败",type:"error"})}},_=async()=>{o.value&&(u.value=!1,await o.value.commitRequest())},g=e=>{n.visibleStates.info&&V((()=>{n.infoRow=e.find((e=>e.id===n.infoRow.id))}))},b=({type:e,row:t})=>{r({type:e,sid:t.id})},S=async e=>{1!==e.is_check||n.visibleStates.verify?ge((()=>{ce.delPwdManage(e.id,n.verifyCode).then((e=>{we({content:null==e?void 0:e.msg,closeCallback:()=>{C("del"),_()}})})).catch((()=>{}))})):h("del",e)},k=e=>{we({type:200===e.status_code?"success":"error",content:e.msg})},h=async(e,t)=>{var a;n.modalRow=t,n.modalType=e,n.verifyCode="";const l={copy(){n.visibleStates.verify=!0},del(){n.visibleStates.verify=!0},change(){var e;null==(e=s.change.value)||e.clearValidate(),n.modalForm={encryption_private_key:"",new_key:"",tips:""},n.visibleStates.change=!0},reset(){var e;null==(e=s.reset.value)||e.clearValidate(),n.modalForm={new_key:"",auth_code:"",tips:""},n.visibleStates.reset=!0},info(){n.infoRow=t,n.visibleStates.info=!0}};await(null==(a=l[e])?void 0:a.call(l))},x=async e=>{var t;try{n.btnLoading=!0;const a={async copy(){const e=await ce.copyPwd(n.modalRow.id,await Y(n.verifyCode));200===e.status_code&&(oe.clipboard.copy(ne(e)),C("verify")),k(e)},async change(){var e;await(null==(e=s.change.value)?void 0:e.validate());const t=await ce.changePwd({...n.modalForm,id:n.modalRow.id});200===t.status_code&&(C("change"),_()),k(t)},async sendCode(){ce.sendCode(n.infoRow.cmdb_user_v3_id).then((e=>{200===e.status_code&&(k(e),h("reset",n.modalRow))}))},async reset(){var e;await(null==(e=s.reset.value)?void 0:e.validate());const t=await ce.resetPwd({...n.modalForm,id:n.modalRow.id});200===t.status_code&&(C("reset"),_()),k(t)},async del(){S(n.modalRow)}};await(null==(t=a[e])?void 0:t.call(a))}catch(a){a.message&&we({content:a.message,type:"error"})}finally{n.btnLoading=!1}},C=e=>{n.visibleStates[e]=!1,n.modalRow=null,n.modalForm={},n.verifyCode=""};return(a,d)=>{var c,y,C;const U=t,T=A("vxe-button"),R=Ue,F=e,O=se,L=de,j=re,P=X;return z(),E(I,null,[w(U,{ref_key:"tableRef",ref:o,columns:D(f),"auth-btn":D(v),"request-config":{api:D(ce).getPwdManageList,immediate:!0},"filter-config":{remote:!1,showIcon:!0},"is-show-doc":!0,"onUpdate:fullData":g,onUserEdit:b,onUserAdd:d[0]||(d[0]=e=>D(r)({type:a.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:S},{uuid:B((({row:e})=>[K("span",{class:"text-primary cursor-pointer",onClick:t=>h("info",e)},H(e.uuid),9,Oe)])),share_limits:B((({row:e})=>[(z(!0),E(I,null,N(e.share_limits,((e,t)=>(z(),E("span",{key:t,class:"mr-2"},H(D(n).allOptions[e]),1)))),128))])),app_name:B((({row:e})=>{return[(t=e.app_name,new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)?(z(),E("a",{key:0,href:e.app_name,target:"_blank"},H(e.app_name),9,Le)):(z(),E("span",je,H(e.app_name),1)))];var t})),types:B((({row:e})=>[M(H(D(n).initColumn.find((e=>"types"===e.field)).page_data_source.data[e.types]),1)])),create_name:B((({row:e})=>[M(H(D(n).allOptions[`user-${e.cmdb_user_v3_id}`])+" ",1),Pe,M(" "+H(e.update_name),1)])),create_time:B((({row:e})=>[M(H(e.create_time)+" ",1),Ae,M(" "+H(e.update_time),1)])),_:1},8,["columns","auth-btn","request-config"]),w(F,{title:null==(c=D(n).infoRow)?void 0:c.uuid,open:D(n).visibleStates.info,onClose:d[5]||(d[5]=e=>D(n).visibleStates.info=!1)},{default:B((()=>{var e,t,a,l,o,s,r,u,p;return[K("div",ze,[(null==(e=D(n).infoRow)?void 0:e.username)?(z(),E("div",$e,[K("span",Be,H(null==(a=i[null==(t=D(n).infoRow)?void 0:t.types])?void 0:a.username)+":",1),K("span",De,["Certificate"===(null==(l=D(n).infoRow)?void 0:l.types)?(z(),$(T,{key:0,icon:"vxe-icon-copy",status:"primary",mode:"text",size:"mini",class:"ml-2 cursor-pointer",onClick:d[1]||(d[1]=le((e=>(async e=>{oe.clipboard.copy(null==e?void 0:e.username),we({content:"复制成功",type:"success"})})(D(n).infoRow)),["stop"]))})):(z(),E(I,{key:1},[M(H(null==(o=D(n).infoRow)?void 0:o.username),1)],64))])])):q("",!0),K("div",Ee,[K("span",Ie,H(null==(r=i[null==(s=D(n).infoRow)?void 0:s.types])?void 0:r.pwd)+":",1),K("span",Ne,[w(T,{icon:"vxe-icon-copy",status:"primary",mode:"text",size:"mini",class:"ml-2 cursor-pointer",onClick:d[2]||(d[2]=le((e=>{var t;return 1===(null==(t=D(n).infoRow)?void 0:t.is_check)?h("copy",D(n).infoRow):(async e=>{try{const t=await ce.copyPwd(null==e?void 0:e.id,"");200===t.status_code&&oe.clipboard.copy(ne(t)),k(t)}catch(t){we({content:"复制失败",type:"error"})}})(D(n).infoRow)}),["stop"]))})])]),K("div",Me,[qe,K("span",We,["外部使用"===(null==(u=D(n).infoRow)?void 0:u.use_limits)?(z(),E(I,{key:0},[w(T,{icon:"vxe-icon-edit",status:"primary",mode:"text",size:"mini",class:"ml-2 cursor-pointer",onClick:d[3]||(d[3]=le((e=>h("change",D(n).infoRow)),["stop"]))},{default:B((()=>[M(" 修改 ")])),_:1}),D(v).edit_key_other?(z(),$(R,{key:0,title:"重置密码时会将验证码发送至创建者的手机号与邮箱，是否要重置？","ok-text":"Yes","cancel-text":"No",onConfirm:d[4]||(d[4]=e=>x("sendCode"))},{default:B((()=>[w(T,{icon:"vxe-icon-repeat",status:"primary",mode:"text",size:"mini",class:"ml-2 cursor-pointer"},{default:B((()=>[M(" 重置 ")])),_:1})])),_:1})):q("",!0)],64)):q("",!0)])]),K("div",He,[Ke,K("span",Ye,H(null==(p=D(n).infoRow)?void 0:p.tips),1)])])]})),_:1},8,["title","open"]),w(L,{open:D(n).visibleStates.verify,"confirm-loading":D(n).btnLoading,onOk:d[7]||(d[7]=e=>x(D(n).modalType)),onCancel:d[8]||(d[8]=e=>D(n).visibleStates.verify=!1)},{title:B((()=>{var e,t;return[M(H("copy"===D(n).modalType?`复制密码 - ${null==(e=D(n).modalRow)?void 0:e.uuid}`:`删除凭证 - ${null==(t=D(n).modalRow)?void 0:t.uuid}`),1)]})),default:B((()=>{var e,t;return[K("div",Ve,[Ge,w(O,{value:D(n).verifyCode,"onUpdate:value":d[6]||(d[6]=e=>D(n).verifyCode=e)},null,8,["value"])]),(null==(e=D(n).modalRow)?void 0:e.tips)?(z(),E("div",Je," (自定义密钥密码提示符: "+H(null==(t=D(n).modalRow)?void 0:t.tips)+") ",1)):q("",!0)]})),_:1},8,["open","confirm-loading"]),w(L,{open:D(n).visibleStates.change,title:`修改密码 - ${null==(y=D(n).modalRow)?void 0:y.uuid}`,"confirm-loading":D(n).btnLoading,onOk:d[12]||(d[12]=e=>x("change")),onCancel:d[13]||(d[13]=e=>D(n).visibleStates.change=!1)},{default:B((()=>[w(P,{ref:s.change,model:D(n).modalForm,rules:l,"label-col":{span:5},"label-align":"left"},{default:B((()=>[w(j,{label:"旧密码",name:"encryption_private_key"},{default:B((()=>[w(O,{value:D(n).modalForm.encryption_private_key,"onUpdate:value":d[9]||(d[9]=e=>D(n).modalForm.encryption_private_key=e)},null,8,["value"])])),_:1}),w(j,{label:"新密码",name:"new_key"},{default:B((()=>[w(O,{value:D(n).modalForm.new_key,"onUpdate:value":d[10]||(d[10]=e=>D(n).modalForm.new_key=e)},null,8,["value"])])),_:1}),w(j,{label:"提示符",name:"tips"},{default:B((()=>[w(O,{value:D(n).modalForm.tips,"onUpdate:value":d[11]||(d[11]=e=>D(n).modalForm.tips=e)},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title","confirm-loading"]),w(L,{open:D(n).visibleStates.reset,title:`重置密码 - ${null==(C=D(n).modalRow)?void 0:C.uuid}`,"confirm-loading":D(n).btnLoading,onOk:d[17]||(d[17]=e=>x("reset")),onCancel:d[18]||(d[18]=e=>D(n).visibleStates.reset=!1)},{default:B((()=>[w(P,{ref:s.reset,model:D(n).modalForm,rules:l,"label-col":{span:5},"label-align":"left"},{default:B((()=>[w(j,{label:"手机验证码",name:"auth_code"},{default:B((()=>[w(O,{value:D(n).modalForm.auth_code,"onUpdate:value":d[14]||(d[14]=e=>D(n).modalForm.auth_code=e)},null,8,["value"])])),_:1}),w(j,{label:"新密码",name:"new_key"},{default:B((()=>[w(O,{value:D(n).modalForm.new_key,"onUpdate:value":d[15]||(d[15]=e=>D(n).modalForm.new_key=e)},null,8,["value"])])),_:1}),w(j,{label:"提示符",name:"tips"},{default:B((()=>[w(O,{value:D(n).modalForm.tips,"onUpdate:value":d[16]||(d[16]=e=>D(n).modalForm.tips=e)},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title","confirm-loading"]),w(Re,{open:D(u),"onUpdate:open":d[19]||(d[19]=e=>ie(u)?u.value=e:null),sid:D(m),"form-type":D(p),"field-name":i,"all-options":D(n).allOptions,onEditSuccess:_},null,8,["open","sid","form-type","all-options"])],64)}}},[["__scopeId","data-v-fcd3e1ed"]]);export{Qe as default};
