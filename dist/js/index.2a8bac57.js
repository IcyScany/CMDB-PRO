import{s as e,_ as t}from"./subPage.2201bfd5.js";import{a as l}from"./opsDescriptions.dfa169bd.js";import{_ as a}from"./index.7d980246.js";import{b5 as o,al as i,r as n,H as s,q as d,x as u,O as r,Q as c,U as p,W as m,c as f,$ as _,R as v,F as w,S as y,b6 as b,b7 as g,aV as x,a8 as k,aN as S,a3 as h,X as O,Y as C,ah as D,a6 as j,Z as A,v as E,aZ as U,aY as $,a9 as N,aa as T,J as P,ad as R}from"./index.872a2bd0.js";import{t as F}from"./tableRender.a6ff99b7.js";import{o as I,_ as B,b as L,u as M}from"./opsFormInit.3a4e1794.js";import{_ as Y}from"./index.029351cd.js";import{A as W}from"./extranetDomain.0df38996.js";import"./index.87ccdcd1.js";import"./index.fc9664cf.js";import"./index.a533313d.js";import"./index.2c670fa1.js";import"./opsTable.7b07fc7b.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.44a4e190.js";import"./index.65b2e021.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.48209b21.js";import"./index.64f8d8d4.js";const q={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:o}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const l=e,{open:a,sid:h,formType:O}=i(l),C=t,D=n(null),{putEdit:j,getDetail:A,postAdd:E}=W,U=s({typeOptions:[],zoneOptions:[],cloudAccountOptions:[]}),{formRenderContent:$,formDataLoading:N,confirmLoading:T,initForm:P,formDataInit:R,editSubmit:F}=I({formRef:D,TITLE_LAYER:1,formType:O,sid:h,emits:C,addApi:E,editApi:j,oneDataApi:A,customSubmitData:async function(e){O.value===b&&delete e.cloud_master_account_id;return e},customEditData:function(){}});const M=()=>{C("update:open",!1)},q=async e=>{e&&(await G(),await P(),await R())},z=d((()=>{var e,t,l;return null==(l=Object.entries(null==(t=null==(e=$.value)?void 0:e.title_data)?void 0:t.regions_id))?void 0:l.map((([e,t])=>({label:t,value:e})))})),G=async()=>{const e=await W.getCloudAccountList();U.cloudAccountOptions=e.map((e=>({label:g("span",{},[g(x,{type:e.cloud_type,style:{marginRight:"10px",width:"none"}}),`${e.page_display}(${e.primary_username})`]),value:e.id,cloud_type:e.cloud_type})))};return u((()=>{var e,t;return null==(t=null==(e=$.value)?void 0:e.formState)?void 0:t.cloud_master_account_id}),(async e=>{var t,l,a,o;if(!e)return;let i=null==(t=U.cloudAccountOptions.find((t=>t.value===e)))?void 0:t.cloud_type;$.value.title.find((e=>"regions_id"===e.field)).edit_display="华为云"===i,U.typeOptions=Object.entries((null==(o=null==(a=null==(l=$.value)?void 0:l.title_data)?void 0:a.type)?void 0:o[i])||{}).map((([e,t])=>({label:`${e} - ${t}`,value:e,key:`${e} - ${t}`}))),await(async e=>{const t=await W.getZoneList(e);U.zoneOptions=t.map((e=>({label:e,value:e})))})(e)})),(e,t)=>{const l=B,i=L,n=k,s=S,d=r("vxe-button"),u=Y;return c(),p(u,{title:`${e.$route.meta.title}${_(O)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:_(a),onAfterOpenChange:q,onClose:M},{footer:m((()=>[f(d,{content:"取消",onClick:M}),f(d,{type:"submit",loading:_(T),status:"primary",content:"提交",onClick:_(F)},null,8,["loading","onClick"])])),default:m((()=>[f(s,{spinning:_(N)},{default:m((()=>[f(n,{ref_key:"formRef",ref:D,model:_($).formState,rules:_($).rules},{default:m((()=>[(c(!0),v(w,null,y(e.$utils.filter(_($).title,(e=>e.edit_display)),(e=>{var t,a;return c(),v(w,{key:e.field},["type"===e.field?(c(),p(l,{key:0,value:_($).formState[e.field],"onUpdate:value":t=>_($).formState[e.field]=t,title:e,options:_(U).typeOptions},null,8,["value","onUpdate:value","title","options"])):"cloud_master_account_id"===e.field?(c(),p(l,{key:1,title:e},{default:m((()=>[f(i,{value:_($).formState[e.field],"onUpdate:value":t=>_($).formState[e.field]=t,options:_(U).cloudAccountOptions,"option-label-prop":"label",disabled:_(O)===_(b)},null,8,["value","onUpdate:value","options","disabled"])])),_:2},1032,["title"])):"regions_id"===e.field?(c(),p(l,{key:2,value:_($).formState[e.field],"onUpdate:value":t=>_($).formState[e.field]=t,title:e,options:_(z),disabled:_(O)===_(b)},null,8,["value","onUpdate:value","title","options","disabled"])):"domain_suffix"===e.field?(c(),p(l,{key:3,value:_($).formState[e.field],"onUpdate:value":t=>_($).formState[e.field]=t,title:e,options:_(U).zoneOptions,disabled:_(O)===_(b)},null,8,["value","onUpdate:value","title","options","disabled"])):"view"===e.field?(c(),p(l,{key:4,value:_($).formState[e.field],"onUpdate:value":t=>_($).formState[e.field]=t,title:e,disabled:!0},null,8,["value","onUpdate:value","title"])):"status"===e.field?(c(),p(l,{key:5,value:_($).formState[e.field],"onUpdate:value":t=>_($).formState[e.field]=t,title:e,disabled:_(O)===_(o)},null,8,["value","onUpdate:value","title","disabled"])):(c(),p(l,{key:6,value:_($).formState[e.field],"onUpdate:value":t=>_($).formState[e.field]=t,title:e,"title-data":null==(a=null==(t=_($))?void 0:t.title_data)?void 0:a[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},z=e=>(N("data-v-5e773775"),e=e(),T(),e),G={key:0,class:"data-flow"},J=z((()=>O("div",{class:"flow-item bg-red"},"域名",-1))),Z=z((()=>O("div",{class:"flow-item bg-orange"},"CNAME",-1))),H={class:"flow-item bg-blue"},K={class:"flow-item bg-green"},Q={class:"flow-item bg-red"},V={class:"flow-item bg-orange"},X={class:"absolute"},ee={class:"flow-item bg-blue"},te=z((()=>O("span",{class:"font-bold"},"CNAME: ",-1))),le=z((()=>O("span",{class:"font-bold"},"端口: ",-1))),ae=z((()=>O("span",{class:"font-bold"},"回源地址: ",-1))),oe={class:"flow-item bg-green"},ie=z((()=>O("span",{class:"font-bold"},"CNAME: ",-1))),ne=z((()=>O("span",{class:"font-bold"},"端口: ",-1))),se=z((()=>O("span",{class:"font-bold"},"回源地址: ",-1))),de={class:"truncate inline-block",style:{"max-width":"100%"}},ue=h({__name:"dataFlow",props:{row:{type:Object,required:!0},isDesc:{type:Boolean,default:!1}},setup(e){const t=e,a={maxWidth:"500px",fontSize:"12px"},o={"源站":"cyan","华为云OBS":"obs","阿里云OSS":"oss"},i=d((()=>{var e,l,a,o;let i="源站";return(null==(e=t.row.value)?void 0:e.includes(".obs"))&&(null==(l=t.row.value)?void 0:l.includes("myhuaweicloud.com"))&&(i="华为云OBS"),(null==(a=t.row.value)?void 0:a.includes(".oss"))&&(null==(o=t.row.value)?void 0:o.includes("aliyuncs.com"))&&(i="阿里云OSS"),i})),n=d((()=>t.row.cdn_cname||t.row.cloud_protective?t.row.cdn_cname||t.row.cloud_protective:t.row.value)),s=d((()=>{let e=[{field:"domain_name",title:"域名"},{field:"cname",title:"CNAME"}];return t.row.cdn_cname&&e.push({field:"cdn_cname",title:`CDN(${t.row.cdn_source})`}),t.row.cloud_protective&&e.push({field:"cloud_protective",title:`WAF(${t.row.cloud_source})`}),e.push({field:"value",title:i}),e}));return(t,d)=>{var u,r;const b=E,g=U,x=l,k=$;return e.row.cdn_cname||e.row.cloud_protective||(!(S=e.row.value)||!/^(\d{1,3}\.){3}\d{1,3}$/.test(S))?(c(),v("div",G,[e.isDesc?(c(),p(k,{key:1},{default:m((()=>[f(x,{columns:_(s),column:1},{"domain_name-label":m((({label:e})=>[O("div",Q,C(e),1)])),domain_name:m((()=>[D(C(e.row.domain_name)+"."+C(e.row.domain_suffix),1)])),"cname-label":m((({label:e})=>[O("div",V,C(e),1)])),cname:m((()=>[O("div",X,[f(g,{copyable:{tooltip:!1},class:"copy-text"},{default:m((()=>[D(C(_(n)),1)])),_:1})])])),"cdn_cname-label":m((()=>[O("div",ee,[D(" CDN( "),O("span",{class:j({"text-orange":"阿里云"===e.row.cdn_source})},C(e.row.cdn_source),3),D(" ) ")])])),cdn_cname:m((()=>[O("div",null,[te,D(C(e.row.cdn_cname),1)]),O("div",null,[le,D(C(e.row.cdn_port),1)]),O("pre",null,[ae,D(C(JSON.stringify(e.row.cdn_source_address,null,2)),1)])])),"cloud_protective-label":m((()=>[O("div",oe,[D(" WAF( "),O("span",{class:j({"text-orange":!e.row.cloud_protective.includes("huawei")})},C(e.row.cloud_protective.includes("huawei")?"华为云":"阿里云"),3),D(" ) ")])])),cloud_protective:m((()=>[O("div",null,[ie,D(C(e.row.cloud_protective),1)]),O("div",null,[ne,D(C(e.row.cloud_protective_port),1)]),O("pre",null,[se,D(C(JSON.stringify(e.row.cloud_source_address,null,2)),1)])])),"value-label":m((({label:e})=>[O("div",{class:j(["flow-item",`bg-${o[_(i)]}`])},C(e),3)])),value:m((()=>[f(b,{"overlay-style":a,title:e.row.value},{default:m((()=>[O("span",de,C(e.row.value),1)])),_:1},8,["title"])])),_:1},8,["columns"])])),_:1})):(c(),v(w,{key:0},[J,f(b,{title:_(n),"overlay-style":a},{default:m((()=>[Z])),_:1},8,["title"]),e.row.cdn_cname?(c(),p(b,{key:0,"overlay-style":a},{title:m((()=>[O("div",null,"CNAME: "+C(e.row.cdn_cname),1),O("div",null,"端口: "+C(e.row.cdn_port),1),O("pre",null,"回源地址: "+C(JSON.stringify(e.row.cdn_source_address,null,2)),1)])),default:m((()=>[O("div",H,[D(" CDN( "),O("span",{class:j({"text-orange":"阿里云"===e.row.cdn_source})},C(e.row.cdn_source),3),D(" ) ")])])),_:1})):A("",!0),e.row.cloud_protective?(c(!0),v(w,{key:1},y(null==(r=null==(u=e.row)?void 0:u.cloud_protective)?void 0:r.split(";"),((t,l)=>(c(),p(b,{key:l,"overlay-style":a},{title:m((()=>[O("div",null,"CNAME: "+C(t),1),O("div",null,"端口: "+C(e.row.cloud_protective_port),1),O("pre",null,"回源地址: "+C(JSON.stringify(e.row.cloud_source_address,null,2)),1)])),default:m((()=>[O("div",K,[D(" WAF( "),O("span",{class:j({"text-orange":!t.includes("huawei")})},C(t.includes("huawei")?"华为云":"阿里云"),3),D(" ) ")])])),_:2},1024)))),128)):A("",!0),f(b,{title:e.row.value,"overlay-style":a},{default:m((()=>[O("div",{class:j(["flow-item",`bg-${o[_(i)]}`])},C(_(i)),3)])),_:1},8,["title"])],64))])):A("",!0);var S}}},[["__scopeId","data-v-5e773775"]]),re=["onClick"],ce=["onClick"],pe={style:{display:"flex","align-items":"center"}},me={key:0},fe={key:1},_e={class:"truncate inline-block",style:{"max-width":"100%"}},ve=h({__name:"index",setup(o){const i={fontSize:"12px",maxWidth:"500px"},u=n(null),y=s({initColumn:[],initButton:[],initTitleData:[],subPageColumns:[]}),{userEdit:b,userDel:g,formOpen:k,formType:S,formSid:h}=M(),j=d((()=>{for(let e of y.initColumn){let{field:t}=e;switch(t){case"id":case"status":case"domain_id":case"domain":e.slots={default:t};break;case"data_flow":e.slots={default:t},e.showOverflow=!1,e.minWidth=540;break;case"virtual_team_v3_id":e.showOverflow=!1}}return y.initColumn})),A=d((()=>{const e=["edit","add","del"];return y.initButton.reduce(((t,l)=>(e.includes(l.field)&&(t[l.field]=l),t)),{})}));P((async()=>{const{button:e,columns:t,title_data:l,sub_page_columns:a}=await F.setColumn({layer:1});y.initColumn=t.value||[],y.initButton=e.value||[],y.initTitleData=l.value||[],y.subPageColumns=a||[]}));const N=async()=>{u.value&&await u.value.commitRequest()},T=()=>{u.value.tableAllData.forEach((e=>{e.wholeIp=`${e.domain_name}.${e.domain_suffix}`}))},I=({type:e,row:t})=>{b({type:e,sid:t.id})},B=e=>{g({sid:e.id,delApi:W.del,loadData:N})},{subPageOpen:L,subPageRow:Y,handleSubPageOpen:z}=e();return(e,o)=>{var n,s;const d=U,g=E,P=x,F=r("vxe-tag"),M=a,G=l,J=$,Z=t;return c(),v(w,null,[f(M,{ref_key:"tableRef",ref:u,columns:_(j),"auth-btn":_(A),"request-config":{api:_(W).getList,immediate:!0},"filter-config":{remote:!1,showIcon:!0},"is-show-sync":{show:!0,uri:"cloud-dns"},onUserEdit:I,onUserAdd:o[0]||(o[0]=t=>_(b)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:B,"onUpdate:fullData":T},{id:m((({row:e})=>[f(g,{placement:"topLeft"},{title:m((()=>[f(d,{copyable:{tooltip:!1},class:"copy-text"},{default:m((()=>[D(C(e.domain_id),1)])),_:2},1024)])),default:m((()=>[O("span",{class:"cursor-pointer text-primary",onClick:t=>_(z)(e)},C(e.id),9,re)])),_:2},1024)])),domain_id:m((({row:e})=>[O("span",{class:"cursor-pointer text-primary",onClick:t=>_(z)(e)},C(e.domain_id),9,ce)])),cloud_master_account_id:m((({row:e})=>{var t,l,a;return[O("div",pe,[f(P,{type:null==e?void 0:e.cloud_source},null,8,["type"])]),D(" "+C((null==(a=null==(l=null==(t=_(y).initTitleData)?void 0:t.cloud_master_account_id)?void 0:l[e.cloud_master_account_id])?void 0:a.page_display)||""),1)]})),domain:m((({row:e})=>[e.domain_name?(c(),v("span",me,C(e.domain_name)+"."+C(e.domain_suffix),1)):(c(),v("span",fe,C(e.domain_suffix),1))])),status:m((({row:e})=>[1==e.status?(c(),p(F,{key:0,class:"theme--primary"},{default:m((()=>[D("启用解析")])),_:1})):16==e.status?(c(),p(F,{key:1,class:"theme--warning"},{default:m((()=>[D("智能切换")])),_:1})):(c(),p(F,{key:2,class:"theme--error"},{default:m((()=>[D("暂停解析")])),_:1}))])),data_flow:m((({row:e})=>[f(ue,{row:e},null,8,["row"])])),_:1},8,["columns","auth-btn","request-config"]),f(q,{open:_(k),"onUpdate:open":o[1]||(o[1]=e=>R(k)?k.value=e:null),sid:_(h),"form-type":_(S),onEditSuccess:N},null,8,["open","sid","form-type"]),f(Z,{open:_(L),"onUpdate:open":o[2]||(o[2]=e=>R(L)?L.value=e:null),title:null==(n=_(Y))?void 0:n.domain_id,"basic-config":{columns:_(y).subPageColumns,api:_(W).getDetail,sid:null==(s=_(Y))?void 0:s.id},onClickEdit:o[3]||(o[3]=t=>I({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:_(Y)}))},{cloud_master_account_id:m((({row:e})=>{var t,l,a;return[D(C((null==(a=null==(l=null==(t=_(y).initTitleData)?void 0:t.cloud_master_account_id)?void 0:l[e.cloud_master_account_id])?void 0:a.page_display)||""),1)]})),domain:m((({row:e})=>[D(C(e.domain_name)+"."+C(e.domain_suffix),1)])),value:m((({row:e})=>[f(g,{"overlay-style":i,title:e.value},{default:m((()=>[O("span",_e,C(e.value),1)])),_:2},1032,["title"])])),status:m((({row:e})=>[1==e.status?(c(),p(F,{key:0,class:"theme--primary"},{default:m((()=>[D("OK")])),_:1})):16==e.status?(c(),p(F,{key:1,class:"theme--warning"},{default:m((()=>[D("智能切换")])),_:1})):(c(),p(F,{key:2,class:"theme--error"},{default:m((()=>[D("NG")])),_:1}))])),"basic-extra":m((({row:e})=>[f(J,{class:"data-flow-card"},{default:m((()=>[f(G,{columns:[{field:"data_flow",title:"数据流向"}],column:1},{data_flow:m((()=>[f(ue,{row:e},null,8,["row"])])),_:2},1024),f(ue,{row:e,"is-desc":!0},null,8,["row"])])),_:2},1024)])),_:1},8,["open","title","basic-config"])],64)}}},[["__scopeId","data-v-35373eb0"]]);export{ve as default};
