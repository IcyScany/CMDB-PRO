import{_ as e}from"./index.7d980246.js";import{_ as t}from"./index.de966786.js";import{t as l}from"./tableRender.a6ff99b7.js";import{o as a,_ as i,u as o}from"./opsFormInit.3a4e1794.js";import{_ as n}from"./index.029351cd.js";import{A as d}from"./expireRemind.7c97f83a.js";import{b5 as s,al as u,r,O as m,Q as f,U as p,W as v,c,$ as _,R as y,F as b,S,a8 as D,aN as U,H as w,q as j,J as Y,ah as k,Y as C,X as h,ad as x,av as g,B as T,au as A}from"./index.872a2bd0.js";import{D as E}from"./dayjs.c124633a.js";import"./index.2c670fa1.js";import"./opsTable.7b07fc7b.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.44a4e190.js";import"./index.65b2e021.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.48209b21.js";import"./index.64f8d8d4.js";const R={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:s},options:{type:Object,default:()=>({})}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const l=e,{open:o,sid:s,formType:w,options:j}=u(l),Y=t,k=r(null),{putEdit:C,getDetail:h,postAdd:x}=d,{formRenderContent:g,formDataLoading:T,confirmLoading:A,initForm:R,formDataInit:O,editSubmit:M}=a({formRef:k,TITLE_LAYER:1,formType:w,sid:s,emits:Y,addApi:x,editApi:C,oneDataApi:h,customSubmitData:async function(e){e.end_time||(e.end_time=null);return e},customOneData:function(e){e.warn_mobile=e.warn_mobile||[],e.warn_email=e.warn_email||[]}});const L=()=>{Y("update:open",!1)},B=async e=>{if(e){await R(),await O();const{warn_mobile:e,warn_email:t}=g.value.formState;g.value.formState.warn_mobile=e||[],g.value.formState.warn_email=t||[]}};return(e,t)=>{const l=E,a=i,d=D,s=U,u=m("vxe-button"),r=n;return f(),p(r,{title:`${e.$route.meta.title}${_(w)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:_(o),onAfterOpenChange:B,onClose:L},{footer:v((()=>[c(u,{content:"取消",onClick:L}),c(u,{type:"submit",loading:_(A),status:"primary",content:"提交",onClick:_(M)},null,8,["loading","onClick"])])),default:v((()=>[c(s,{spinning:_(T)},{default:v((()=>[c(d,{ref_key:"formRef",ref:k,model:_(g).formState,rules:_(g).rules},{default:v((()=>[(f(!0),y(b,null,S(e.$utils.filter(_(g).title,(e=>e.edit_display)),(e=>{var t,i,o,n,d,s,u,r,m,S,D,U,w,Y,k,C,h,x;return f(),y(b,{key:e.field},["start_time"===e.field?(f(),p(a,{key:0,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(i=null==(t=_(g))?void 0:t.title_data)?void 0:i[e.field]},{default:v((()=>[c(l,{value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value","onUpdate:value"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"end_time"===e.field?(f(),p(a,{key:1,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(n=null==(o=_(g))?void 0:o.title_data)?void 0:n[e.field]},{default:v((()=>[c(l,{value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["value","onUpdate:value"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"applicant_user"===e.field?(f(),p(a,{key:2,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(s=null==(d=_(g))?void 0:d.title_data)?void 0:s[e.field],options:_(j).username},null,8,["value","onUpdate:value","title","title-data","options"])):"employ_user"===e.field?(f(),p(a,{key:3,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(r=null==(u=_(g))?void 0:u.title_data)?void 0:r[e.field],options:_(j).username},null,8,["value","onUpdate:value","title","title-data","options"])):"email"===e.field?(f(),p(a,{key:4,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(S=null==(m=_(g))?void 0:m.title_data)?void 0:S[e.field],options:_(j).email},null,8,["value","onUpdate:value","title","title-data","options"])):"relevance_mobile"===e.field?(f(),p(a,{key:5,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(U=null==(D=_(g))?void 0:D.title_data)?void 0:U[e.field],options:_(j).mobile},null,8,["value","onUpdate:value","title","title-data","options"])):"warn_mobile"===e.field?(f(),p(a,{key:6,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(Y=null==(w=_(g))?void 0:w.title_data)?void 0:Y[e.field],options:_(j).mobile},null,8,["value","onUpdate:value","title","title-data","options"])):"warn_email"===e.field?(f(),p(a,{key:7,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(C=null==(k=_(g))?void 0:k.title_data)?void 0:C[e.field],options:_(j).email},null,8,["value","onUpdate:value","title","title-data","options"])):(f(),p(a,{key:8,value:_(g).formState[e.field],"onUpdate:value":t=>_(g).formState[e.field]=t,title:e,"title-data":null==(x=null==(h=_(g))?void 0:h.title_data)?void 0:x[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},O={__name:"index",setup(a){const i={"全部":"","使用中":"#67c23a","快到期":"#5e72e4","已到期":"#fb6340","停用":"#474747"},n=r(null),s=w({initColumn:[],initButton:[],initTitleData:[],fullData:[],filterConditions:{status:null},options:{username:[],email:[],mobile:[]}}),{userEdit:u,userDel:m,formOpen:p,formType:D,formSid:U}=o(),E=j((()=>{for(let e of s.initColumn){let{field:t}=e;switch(t){case"status":e.slots={default:t};break;case"end_time":e.slots={default:t},e.showOverflow=!1,e.minWidth=150;break;case"virtual_team_v3_id":e.showOverflow=!1}}return s.initColumn})),O=j((()=>{const e=["edit","add","del"];return s.initButton.reduce(((t,l)=>(e.includes(l.field)&&(t[l.field]=l),t)),{})}));Y((async()=>{F();const{button:e,columns:t,title_data:a}=await l.setColumn({layer:1});s.initColumn=t.value||[],s.initButton=e.value||[],s.initTitleData=a.value||[]}));const M=async()=>{n.value&&await n.value.commitRequest()},L=({type:e,row:t})=>{u({type:e,sid:t.id})},B=e=>{m({sid:e.id,delApi:d.deleteDel,loadData:M})},F=async()=>{(await d.getUserList()).forEach((e=>{e.username&&s.options.username.push({label:e.username,value:e.username}),e.email&&s.options.email.push({label:e.email,value:e.email}),e.mobile&&s.options.mobile.push({label:e.mobile,value:e.mobile})}))},I=e=>s.fullData.filter((t=>t.status===e)).length,$=e=>{s.fullData=e};return(l,a)=>{const o=g,r=T,m=A,w=t,j=e;return f(),y(b,null,[c(j,{ref_key:"tableRef",ref:n,"filter-conditions":_(s).filterConditions,columns:_(E),"auth-btn":_(O),"request-config":{api:_(d).getList,immediate:!0},"filter-config":{remote:!1,showIcon:!1},onUserEdit:L,onUserAdd:a[0]||(a[0]=e=>_(u)({type:l.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:B,"onUpdate:fullData":$},{other_toolbar_buttons:v((()=>[(f(),y(b,null,S(i,((e,t)=>c(r,{key:t,count:I(t),"overflow-count":Infinity,"number-style":{backgroundColor:e},size:"small"},{default:v((()=>[c(o,{class:"ml-3",style:{"font-size":"13px"},type:"primary",ghost:!(_(s).filterConditions.status===t||"全部"===t&&!_(s).filterConditions.status),disabled:!I(t)&&"全部"!==t,onClick:e=>(e=>{s.filterConditions.status="全部"===e?null:e})(t)},{default:v((()=>[k(C(t),1)])),_:2},1032,["ghost","disabled","onClick"])])),_:2},1032,["count","number-style"]))),64))])),status:v((({row:e})=>[c(m,{color:i[e.status]},{default:v((()=>[k(C(e.status),1)])),_:2},1032,["color"])])),end_time:v((({row:e})=>[h("div",null,C(e.end_time),1),c(w,{"expired-time":e.end_time},null,8,["expired-time"])])),_:1},8,["filter-conditions","columns","auth-btn","request-config"]),c(R,{open:_(p),"onUpdate:open":a[1]||(a[1]=e=>x(p)?p.value=e:null),sid:_(U),"form-type":_(D),options:_(s).options,onEditSuccess:M},null,8,["open","sid","form-type","options"])],64)}}};export{O as default};
