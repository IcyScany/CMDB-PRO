import{_ as e}from"./index.7d980246.js";import{aR as t,a3 as i,al as a,r as l,O as s,Q as n,U as d,W as o,c as r,$ as u,R as p,F as _,S as c,a8 as f,aN as m,i as y,H as g,q as b,J as h,x as v,p as w,X as x,Y as k,Z as C,ad as $,aS as q,C as T,D as O,B}from"./index.872a2bd0.js";import{t as D}from"./tableRender.a6ff99b7.js";import{o as R,_ as A,u as j}from"./opsFormInit.3a4e1794.js";import{_ as E}from"./index.029351cd.js";import{s as S}from"./alertLevel.8dae0e72.js";import"./index.2c670fa1.js";import"./opsTable.7b07fc7b.js";import"./index.9846e408.js";import"./index.44a4e190.js";import"./index.65b2e021.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.48209b21.js";import"./index.64f8d8d4.js";const L={1:[{layer:1,block:1,types:1,sorting:12,page_sort:!0,field:"operation",field_name:"操作",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!1,search_display:!1,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:1,field:"id",field_name:"NO.",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!0,search_display:!0,data_source:null,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:7,page_sort:!0,field:"business",field_name:"业态名",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:6,lower_layer:0,field:"abbreviation",field_name:"简写",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,data_source:null,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:12,page_sort:!0,field:"theme",field_name:"主题",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!1,page_data_source:{form_type:"color"},field_explain:null},{layer:1,block:1,types:1,sorting:7,lower_layer:0,field:"feishu_app_id",field_name:"飞书自建应用的app id",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,data_source:null,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:8,lower_layer:0,field:"feishu_app_secret",field_name:"飞书自建应用的app secret",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,data_source:null,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:9,lower_layer:0,field:"feishu_departments_id",field_name:"飞书一级部门id",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,data_source:null,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:10,lower_layer:0,field:"business_config",field_name:"业态配置",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!0,search_display:!1,data_source:null,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:10,lower_layer:0,field:"create_time",field_name:"创建时间",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!1,search_display:!0,data_source:null,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:11,lower_layer:0,field:"update_time",field_name:"更新时间",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!1,search_display:!0,data_source:null,page_data_source:null,field_explain:null}],2:[{layer:2,block:1,types:1,sorting:1,page_sort:!0,field:"operation",field_name:"操作",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!1,search_display:!1,page_data_source:null,field_explain:null},{layer:2,block:1,types:1,sorting:2,field:"id",field_name:"NO.",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!0,search_display:!0,data_source:null,page_data_source:null,field_explain:null},{layer:2,block:1,types:1,sorting:3,field:"name",field_name:"名称",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:2,block:1,types:1,sorting:4,field:"environment",field_name:"环境",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:{default_value:"默认环境"},field_explain:null},{layer:2,block:1,types:1,sorting:5,field:"key",field_name:"Key",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:2,block:1,types:1,sorting:6,field:"value",field_name:"Value",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:7,field:"custom_data",field_name:"自定义数据",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"json"},field_explain:null}]},U="manage/business/",F={getBusinessList:e=>t.get(`${U}list${e?`/${e}`:""}`),postOneBusinessAdd:e=>t.post(`${U}add`,e),putOneBusinessEdit:(e,i)=>t.put(`${U}edit/${e}`,i),getBusinessConfigList:(e,i)=>t.get(`${U}config-data${e?`/${e}/list${i?`/${i}`:""}`:""}`),putOneBusinessConfigEdit:(e,i,a)=>t.put(`${U}config-data${e?`/${e}/edit${i?`/${i}`:""}`:""}`,a),delOneBusinessConfig:(e,i)=>t.delete(`${U}config-data${e?`/${e}/del${i?`/${i}`:""}`:""}`),postOneBusinessConfigAdd:(e,i)=>t.post(`${U}config-data${e?`/${e}/add`:""}`,i)},N=i({__name:"BusinessEdit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const i=e,{open:y,sid:g,formType:b}=a(i),h=t;let v=l(null);const{postOneBusinessAdd:w,getBusinessList:x,putOneBusinessEdit:k}=F;let{formRenderContent:C,formDataLoading:$,confirmLoading:q,initForm:T,formDataInit:O,editSubmit:B}=R({formRef:v,editTitleLayer:1,formType:b,sid:g,emits:h,editApi:k,addApi:w,oneDataApi:x,customTitle:L[1]});const D=()=>{h("update:open",!1)},j=async e=>{e&&(await T(),await O())};return(e,t)=>{const i=A,a=f,l=m,g=s("vxe-button"),h=E;return n(),d(h,{title:`${e.$route.meta.title}${u(b)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:u(y),onAfterOpenChange:j,onClose:D},{footer:o((()=>[r(g,{content:"取消",onClick:D}),r(g,{type:"submit",loading:u(q),status:"primary",content:"提交",onClick:u(B)},null,8,["loading","onClick"])])),default:o((()=>[r(l,{spinning:u($)},{default:o((()=>[r(a,{ref_key:"formRef",ref:v,model:u(C).formState,rules:u(C).rules},{default:o((()=>[(n(!0),p(_,null,c(e.$utils.filter(u(C).title,(e=>e.edit_display)),(e=>{var t,a;return n(),d(i,{key:e.field,value:u(C).formState[e.field],"onUpdate:value":t=>u(C).formState[e.field]=t,title:e,"title-data":null==(a=null==(t=u(C))?void 0:t.title_data)?void 0:a[e.field],required:!!(null==e?void 0:e.edit_required)},null,8,["value","onUpdate:value","title","title-data","required"])})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},[["__scopeId","data-v-24fc48b1"]]),I=i({__name:"ConfigListEdit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const i=e,{open:g,sid:b,formType:h}=a(i),v=t;let w=l(null);const{postOneBusinessConfigAdd:x,getBusinessConfigList:k,putOneBusinessConfigEdit:C}=F;let $=y("businessRow");let{formRenderContent:q,formDataLoading:T,confirmLoading:O,initForm:B,formDataInit:D,editSubmit:j}=R({formRef:w,editTitleLayer:2,formType:h,sid:b,emits:v,editApi:(e,t)=>C($.value.id,e,t),addApi:e=>x($.value.id,e),oneDataApi:e=>k($.value.id,e),customTitle:L[2],customSubmitData:async e=>{const t={...e};return e.custom_data&&"string"==typeof e.custom_data&&(t.custom_data=JSON.parse(e.custom_data)),t}});const S=()=>{v("update:open",!1)},U=async e=>{e&&(await B(),await D())};return(e,t)=>{const i=A,a=f,l=m,y=s("vxe-button"),b=E;return n(),d(b,{title:`${u($).business}配置详情${u(h)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:u(g),onAfterOpenChange:U,onClose:S},{footer:o((()=>[r(y,{content:"取消",onClick:S}),r(y,{type:"submit",loading:u(O),status:"primary",content:"提交",size:"small",onClick:u(j)},null,8,["loading","onClick"])])),default:o((()=>[r(l,{spinning:u(T)},{default:o((()=>[r(a,{ref_key:"formRef",ref:w,model:u(q).formState,rules:u(q).rules},{default:o((()=>[(n(!0),p(_,null,c(e.$utils.filter(u(q).title,(e=>e.edit_display)),(e=>{var t,a;return n(),d(i,{key:e.field,value:u(q).formState[e.field],"onUpdate:value":t=>u(q).formState[e.field]=t,title:e,"title-data":null==(a=null==(t=u(q))?void 0:t.title_data)?void 0:a[e.field],required:!!(null==e?void 0:e.edit_required)},null,8,["value","onUpdate:value","title","title-data","required"])})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},[["__scopeId","data-v-92708357"]]),P=["innerHTML"],Y={__name:"ConfigList",props:{show:{type:Boolean,default:!1},row:{type:Object,default:()=>({})}},emits:["update:show"],setup(t,{emit:i}){const c=t;let{row:f,show:m}=a(c);const y=i,T=g({initTableColumns:[],customVisible:!1,customData:""});let O=l(null);const B=()=>{y("update:show",!1)},R=async()=>{var e;await(null==(e=O.value)?void 0:e.commitRequest())};let A={edit:{page_display:!0},add:{page_display:!0},del:{page_display:!0}},E=["custom_data"];const U=b((()=>{for(let e of T.initTableColumns){let{field:t}=e;E.indexOf(t)>-1&&(e.slots={default:t})}return T.initTableColumns}));h((async()=>{let{table_columns:e}=await D.formatTitle({title:L[2]});T.initTableColumns=e||[]})),v((()=>m.value),(e=>{e&&R()}));const{userDel:N,userEdit:Y,formOpen:M,formType:G,formSid:V}=j(),H=({type:e,row:t})=>{Y({type:e,sid:t.id})},z=e=>{N({delApi:e=>{var t;return F.delOneBusinessConfig(null==(t=null==f?void 0:f.value)?void 0:t.id,e)},sid:e.id,loadData:R})};return w("businessRow",f),(i,a)=>{const l=s("vxe-button"),c=e,f=q;return n(),p(_,null,[r(c,{ref_key:"configTableRef",ref:O,columns:u(U),"request-config":{api:u(F).getBusinessConfigList,params:t.row.id,immediate:!0},"filter-config":{remote:!1,showIcon:!0},"auth-btn":u(A),onUserEdit:H,onUserAdd:a[0]||(a[0]=e=>u(Y)({type:i.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:z},{topPrefix:o((()=>{var e;return[x("h2",null,k(null==(e=t.row)?void 0:e.business)+" 配置详情",1)]})),other_toolbar_buttons_left:o((()=>[r(l,{status:"primary",content:"返回上一页",icon:"vxe-icon-arrow-left",onClick:B})])),custom_data:o((({row:e})=>[e.custom_data?(n(),d(l,{key:0,status:"primary",content:"点击查看",onClick:t=>{return i=e.custom_data,T.customData=S(i),void(T.customVisible=!0);var i}},null,8,["onClick"])):C("",!0)])),_:1},8,["columns","request-config","auth-btn"]),r(f,{open:u(T).customVisible,"onUpdate:open":a[1]||(a[1]=e=>u(T).customVisible=e),title:"",centered:!0,closable:!1,footer:null},{default:o((()=>[x("pre",{innerHTML:u(T).customData},null,8,P)])),_:1},8,["open"]),r(I,{open:u(M),"onUpdate:open":a[2]||(a[2]=e=>$(M)?M.value=e:null),sid:u(V),"form-type":u(G),onEditSuccess:R},null,8,["open","sid","form-type"])],64)}}},M={__name:"index",setup(t){const i=l([]),a=l(null),c=async()=>{var e;await(null==(e=a.value)?void 0:e.commitRequest())};let f=g({show:!1,businessRow:{}});h((async()=>{let{table_columns:e}=await D.formatTitle({title:L[1]}),t=["theme","business_config"];if(e&&Array.isArray(e))for(let i of e){let{field:e}=i;t.indexOf(e)>-1&&(i.slots={default:e})}i.value=e||[],c()})),v((()=>f.show),(async e=>{e||await c()}));let m={edit:{page_display:!0},add:{page_display:!0}};const{userEdit:y,formOpen:b,formType:w,formSid:x}=j(),k=({type:e,row:t})=>{y({type:e,sid:t.id})};return(t,l)=>{const g=B,h=s("vxe-button"),v=e;return n(),p(_,null,[T(r(v,{ref_key:"clientTableMenuTitleRef",ref:a,columns:u(i),"auth-btn":u(m),"row-config":{isHover:!0,isCurrent:!0,useKey:!0},"request-config":{api:u(F).getBusinessList,immediate:!1},onUserEdit:k,onUserAdd:l[0]||(l[0]=e=>u(y)({type:t.$CONFIG.FORM_TYPE.ADD_TYPE}))},{theme:o((({row:e})=>[r(g,{color:e.theme,text:e.theme},null,8,["color","text"])])),business_config:o((({row:e})=>[r(h,{content:"配置详情",status:"primary",mode:"text",onClick:t=>(e=>{f.businessRow=e,f.show=!0})(e)},null,8,["onClick"])])),_:1},8,["columns","auth-btn","request-config"]),[[O,!u(f).show]]),u(f).show?(n(),d(Y,{key:0,show:u(f).show,"onUpdate:show":l[1]||(l[1]=e=>u(f).show=e),row:u(f).businessRow},null,8,["show","row"])):C("",!0),r(N,{open:u(b),"onUpdate:open":l[2]||(l[2]=e=>$(b)?b.value=e:null),sid:u(x),"form-type":u(w),onEditSuccess:c},null,8,["open","sid","form-type"])],64)}}};export{M as default};
