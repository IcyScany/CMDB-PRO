import{s as e,_ as t}from"./subPage.2201bfd5.js";import{_ as a}from"./ServerTable.53881589.js";import{_ as l}from"./index.1e532bb2.js";import{_ as i}from"./index.de966786.js";import{b5 as o,al as s,r as n,H as r,O as u,Q as d,U as m,W as c,c as p,$ as b,R as f,F as v,S as _,aT as y,a8 as h,aN as g,a3 as x,q as w,x as k,X as C,Y as S,Z as P,a6 as T,ah as j,aU as D,dB as R,aZ as E,v as F,aY as M,dC as A,J as Y,ap as O,I as z,av as H,ad as L,ag as U,aV as B}from"./index.872a2bd0.js";import{t as N}from"./tableRender.a6ff99b7.js";import{o as $,_ as I,u as G}from"./opsFormInit.3a4e1794.js";import{_ as W}from"./index.029351cd.js";import{A as V,a as q}from"./kvstore.f031d3ae.js";import{a as K}from"./opsDescriptions.dfa169bd.js";import{d as X}from"./opsTable.7b07fc7b.js";import{_ as Z}from"./Title.f705c4e3.js";import{c as J,i as Q}from"./index.165d9fa7.js";import{_ as ee}from"./index.44a4e190.js";import{R as te}from"./dayjs.c124633a.js";import{_ as ae}from"./index.8338e1f7.js";import{_ as le}from"./index.48209b21.js";import"./index.2c670fa1.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.fc9664cf.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.65b2e021.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.64f8d8d4.js";import"./index.87ccdcd1.js";import"./index.a533313d.js";import"./useMaxLevel.bba6798c.js";const ie={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:o}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const a=e,{open:l,sid:i,formType:o}=s(a),x=t,w=n(null),{putEdit:k,getDetail:C,postAdd:S}=V,P=r({originPwd:null}),{formRenderContent:T,formDataLoading:j,confirmLoading:D,initForm:R,formDataInit:E,editSubmit:F}=$({formRef:w,TITLE_LAYER:1,formType:o,sid:i,emits:x,addApi:S,editApi:k,oneDataApi:C,customSubmitData:async function(e){e.password!==P.originPwd?e.password=await y(e.password):delete e.password;return e},customEditData:function(e){P.originPwd=e.value.password}});const M=()=>{x("update:open",!1)},A=async e=>{e&&(await R(),await E())};return(e,t)=>{const a=I,i=h,s=g,n=u("vxe-button"),r=W;return d(),m(r,{title:`${e.$route.meta.title}${b(o)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:b(l),onAfterOpenChange:A,onClose:M},{footer:c((()=>[p(n,{content:"取消",onClick:M}),p(n,{type:"submit",loading:b(D),status:"primary",content:"提交",onClick:b(F)},null,8,["loading","onClick"])])),default:c((()=>[p(s,{spinning:b(j)},{default:c((()=>[p(i,{ref_key:"formRef",ref:w,model:b(T).formState,rules:b(T).rules},{default:c((()=>[(d(!0),f(v,null,_(e.$utils.filter(b(T).title,(e=>e.edit_display)),(e=>{var t,l,i,o;return d(),f(v,{key:e.field},[""===e.field?(d(),m(a,{key:0,value:b(T).formState[e.field],"onUpdate:value":t=>b(T).formState[e.field]=t,title:e,"title-data":null==(l=null==(t=b(T))?void 0:t.title_data)?void 0:l[e.field]},null,8,["value","onUpdate:value","title","title-data"])):(d(),m(a,{key:1,value:b(T).formState[e.field],"onUpdate:value":t=>b(T).formState[e.field]=t,title:e,"title-data":null==(o=null==(i=b(T))?void 0:i.title_data)?void 0:o[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},oe={class:"ml-4"},se={class:"truncate"},ne=x({__name:"basicTab",props:{data:{type:Object,default:()=>({})},columns:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>({})}},setup(e){const t=e,a=[{title:"基础信息",block:1,columns:[]},{title:"规格配置",block:2,columns:[]},{title:"连接信息",block:3,columns:[]},{title:"网络信息",block:4,columns:[]},{title:"付费信息",block:5,columns:[]},{title:"节点信息",block:6,columns:[]}],l=w((()=>{var e;return{...t.data,...null==(e=t.data)?void 0:e.cloud_specific}})),o=w((()=>({id:"kvstoreNodes",...X,columns:t.columns.filter((e=>{var t;return 10===(null==(t=null==e?void 0:e.oriTitle)?void 0:t.block)})),maxHeight:"500px"})));return k((()=>t.data),(()=>{a.forEach((e=>{e.columns=t.columns.filter((t=>{var a,i;if(10!==(null==(a=null==t?void 0:t.oriTitle)?void 0:a.block)){let a=Object.keys(l.value);return(null==(i=null==t?void 0:t.oriTitle)?void 0:i.block)===e.block&&a.includes(null==t?void 0:t.field)}}))}))})),(t,s)=>{const n=Z,r=R,y=u("vxe-tag"),h=E,g=F,x=i,w=K,k=u("vxe-grid"),A=M;return d(),f(v,null,_(a,(t=>C("div",{key:t.title,class:"mb-4"},[p(n,{level:5},{default:c((()=>[C("span",oe,S(t.title),1)])),_:2},1024),p(A,{style:{borderColor:"#cccccc"}},{default:c((()=>{var a;return[0===t.columns.length?(d(),m(r,{key:0})):P("",!0),"节点信息"!==t.title?(d(),m(w,{key:1,data:b(l),columns:t.columns,column:2,"label-style":{width:"200px",marginRight:"10px",color:"#868686"},size:"small"},{status:c((({row:e})=>[p(y,{class:T("运行中"==e.status?"theme--primary":"theme--error"),size:"small"},{default:c((()=>[j(S(e.status),1)])),_:2},1032,["class"])])),cloud_master_account_id:c((({row:t})=>{var a,l,i;return[j(S((null==(i=null==(l=null==(a=e.titleData)?void 0:a.cloud_master_account_id)?void 0:l[t.cloud_master_account_id])?void 0:i.page_display)||""),1)]})),addresses:c((({row:e})=>[(d(!0),f(v,null,_(e.addresses,(e=>(d(),f("div",{key:e.id},[p(g,{"overlay-style":{fontSize:"12px",maxWidth:"400px"}},{title:c((()=>[C("div",null,S(e.address)+":"+S(e.port),1)])),default:c((()=>[p(h,{copyable:{tooltip:!1},class:"copy-text inline-block"},{default:c((()=>[p(y,{class:"theme--primary",size:"small"},{default:c((()=>[C("span",se,S(e.address)+":"+S(e.port),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])))),128))])),expire_time:c((({row:e})=>[p(x,{"expired-time":e.expire_time,"sub-page":!0},null,8,["expired-time"])])),mem:c((({row:e})=>[C("div",null,S(Number(e.mem/1024).toFixed(1))+"GB",1)])),mem_used:c((({row:e})=>[C("div",null,S(Number(e.mem_used/1024).toFixed(1))+"GB",1)])),_:2},1032,["data","columns"])):(d(),m(k,D({key:2,data:null==(a=b(l))?void 0:a.nodes,ref_for:!0},b(o)),null,16,["data"]))]})),_:2},1024)]))),64)}}},[["__scopeId","data-v-aeb68e91"]]),re=[{label:"近30分钟",value:[A().add(-30,"m"),A()]},{label:"近1小时",value:[A().add(-1,"h"),A()]},{label:"近2小时",value:[A().add(-2,"h"),A()]},{label:"近3小时",value:[A().add(-2,"h"),A()]},{label:"近12小时",value:[A().add(-12,"h"),A()]},{label:"近24小时",value:[A().add(-24,"h"),A()]},{label:"近7天",value:[A().add(-7,"d"),A()]},{label:"近30天",value:[A().add(-30,"d"),A()]}],ue=[{value:"300",label:"5分钟"},{value:"1200",label:"20分钟"},{value:"3600",label:"1小时"},{value:"14400",label:"4小时"},{value:"86400",label:"24小时"}],de=[{value:["average","1"],label:"原始值"},{value:"average",label:"平均值"},{value:"sum",label:"求和"},{value:"max",label:"最大值"},{value:"min",label:"最小值"}],me={cpu_usage:{label:"CPU利用率",unit:"%",tooltip:"该指标对于统计周期内的测量对象的CPU使用率进行多次采样，表示多次采样的最高值。"},cpu_avg_usage:{label:"CPU平均使用率",unit:"%",tooltip:"该指标对于统计周期内的测量对象的CPU使用率进行多次采样，表示多次采样的平均值。"},memory_usage:{label:"内存利用率",unit:"%",tooltip:"该指标用于统计测量对象的内存利用率。"},connected_clients:{label:"活跃的客户端数量",unit:"个",tooltip:"该指标用于统计已连接的客户端数量，包括系统监控、配置同步和业务相关的连接数，不包括来自从节点的连接。"},client_longest_out_list:{label:"客户端最长输出列表",unit:"个",tooltip:"该指标用于统计客户端所有现存连接的最长输出列表。"},client_biggest_in_buf:{label:"客户端最大输入缓冲",unit:"byte",tooltip:"该指标用于统计客户端所有现存连接的最大输入数据长度。"},blocked_clients:{label:"阻塞的客户端数量",unit:"个",tooltip:"该指标用于被阻塞操作挂起的客户端的数量。阻塞操作如BLPOP，BRPOP，BRPOPLPUSH。"},used_memory:{label:"已用内存",unit:"byte",tooltip:"该指标用于统计Redis已使用的内存字节数。"},used_memory_rss:{label:"已用内存RSS",unit:"byte",tooltip:'该指标用于统计Redis已使用的RSS内存。即实际驻留"在内存中"的内存数，包含堆内存，但不包括换出的内存。'},used_memory_peak:{label:"已用内存峰值",unit:"byte",tooltip:"该指标用于统计Redis服务器启动以来使用内存的峰值。"},used_memory_lua:{label:"Lua已用内存",unit:"byte",tooltip:"该指标用于统计Lua引擎已使用的内存字节。"},memory_frag_ratio:{label:"内存碎片率",unit:"",tooltip:"该指标用于统计当前的内存碎片率。其数值上等于used_memory_rss / used_memory。"},total_connections_received:{label:"新建连接数",unit:"个",tooltip:"该指标用于统计周期内新建的连接数，包括从节点，系统监控、配置同步和业务相关的连接数。"},total_commands_processed:{label:"处理的命令数",unit:"个",tooltip:"该指标用于统计周期内处理的命令数。"},instantaneous_ops:{label:"每秒并发操作数",unit:"次/秒",tooltip:"该指标用于统计每秒处理的命令数。"},total_net_input_bytes:{label:"网络收到字节数",unit:"byte",tooltip:"该指标用于统计周期内收到的字节数。"},total_net_output_bytes:{label:"网络发送字节数",unit:"byte",tooltip:"该指标用于统计周期内发送的字节数。"},instantaneous_input_kbps:{label:"网络瞬时输入流量",unit:"KiB/s",tooltip:"该指标用于统计瞬时的输入流量。"},instantaneous_output_kbps:{label:"网络瞬时输出流量",unit:"KiB/s",tooltip:"该指标用于统计瞬时的输出流量。"},rejected_connections:{label:"已拒绝的连接数",unit:"个",tooltip:"该指标用于统计周期内因为超过maxclients而拒绝的连接数量。"},expired_keys:{label:"已过期的键数量",unit:"个",tooltip:"该指标用于统计周期内因过期而被删除的键数量。"},evicted_keys:{label:"已逐出的键数量",unit:"个",tooltip:"该指标用于统计周期内因为内存不足被删除的键数量。"},pubsub_channels:{label:"Pubsub通道个数",unit:"个",tooltip:"该指标用于统计Pub/Sub通道个数。"},pubsub_patterns:{label:"Pubsub模式个数",unit:"个",tooltip:"该指标用于统计Pub/Sub模式个数。"},keyspace_hits_perc:{label:"缓存命中率",unit:"%",tooltip:"该指标用于统计Redis的缓存命中率，其命中率算法为：keyspace_hits/(keyspace_hits+keyspace_misses)"},command_max_delay:{label:"命令最大时延",unit:"ms",tooltip:"统计节点的命令最大时延。"},is_slow_log_exist:{label:"是否存在慢日志",unit:"",tooltip:"统计节点是否存在慢日志。1：表示存在，0：表示不存在。该监控不统计由migrate、slaveof、config、bgsave、bgrewriteaof命令导致的慢查询。"},keys:{label:"缓存键总数",unit:"个",tooltip:"该指标用于统计Redis缓存中键总数。"},bandwidth_usage:{label:"带宽使用率",unit:"%",tooltip:"计算当前流量带宽与最大带宽限制的百分比。"},connections_usage:{label:"连接数使用率",unit:"%",tooltip:"该指标用于统计当前连接数与最大连接数限制的百分比。"},command_max_rt:{label:"最大时延",unit:"μs",tooltip:"节点从接收命令到发出响应的时延最大值。"},command_avg_rt:{label:"平均时延",unit:"μs",tooltip:"节点从接收命令到发出响应的时延平均值。"},sync_full:{label:"全量同步次数",unit:"次",tooltip:"该指标用于统计Redis服务器启动以来总共完成的全量同步次数。"},slow_log_counts:{label:"慢日志出现次数",unit:"次",tooltip:"该指标用于统计在一个统计周期内，慢日志出现的次数。"},used_storage:{label:"已使用的存储空间",unit:"byte",tooltip:"已使用的存储空间。"},storage_usage:{label:"存储空间使用率",unit:"%",tooltip:"存储空间使用率。"},sadd:{label:"SADD",unit:"Count/s",tooltip:"该指标用于统计平均每秒sadd操作数。"},smembers:{label:"SMEMBERS",unit:"Count/s",tooltip:"该指标用于统计平均每秒smembers操作数。"},ms_repl_offset:{label:"主从数据同步差值",unit:"Byte",tooltip:"该指标用于统计主从节点之间的数据同步差值。"},del:{label:"DEL",unit:"Count/s",tooltip:"该指标用于统计平均每秒del操作数。"},expire:{label:"EXPIRE",unit:"Count/s",tooltip:"该指标用于统计平均每秒expire操作数。"},get:{label:"GET",unit:"Count/s",tooltip:"该指标用于统计平均每秒get操作数。"},hdel:{label:"HDEL",unit:"Count/s",tooltip:"该指标用于统计平均每秒hdel操作数。"},hget:{label:"HGET",unit:"Count/s",tooltip:"该指标用于统计平均每秒hget操作数。"},hmget:{label:"HMGET",unit:"Count/s",tooltip:"该指标用于统计平均每秒hmget操作数。"},hmset:{label:"HMSET",unit:"Count/s",tooltip:"该指标用于统计平均每秒hmset操作数。"},hset:{label:"HSET",unit:"Count/s",tooltip:"该指标用于统计平均每秒hset操作数。"},mget:{label:"MGET",unit:"Count/s",tooltip:"该指标用于统计平均每秒mget操作数。"},mset:{label:"MSET",unit:"Count/s",tooltip:"该指标用于统计平均每秒mset操作数。"},set:{label:"SET",unit:"Count/s",tooltip:"该指标用于统计平均每秒set操作数。"},rx_controlled:{label:"流控次数",unit:"Count",tooltip:"该指标用于统计周期时间段内客户端请求被流控的次数。客户端发送请求时如果被流控，流控次数会加一。"},scan:{label:"SCAN",unit:"Count/s",tooltip:"每秒scan操作数。"},setex:{label:"SETEX",unit:"Count/s",tooltip:"每秒setex操作数。"},auth_errors:{label:"认证失败次数",unit:"Count",tooltip:"统计实例的认证失败次数。"},expires:{label:"有过期时间的键总数",unit:"个",tooltip:"该指标用于统计Redis缓存中将会过期失效的键数目。"},used_memory_dataset:{label:"数据集使用内存",unit:"byte",tooltip:"该指标用于统计Redis中数据集使用的内存。"},used_memory_dataset_perc:{label:"数据集使用内存百分比",unit:"%",tooltip:"该指标用于统计Redis中数据集使用的内存所占总内存百分比。"},net_in_throughput:{label:"网络输入吞吐量",unit:"byte/s",tooltip:"该指标用于统计网口平均每秒的输入流量。"},net_out_throughput:{label:"网络输出吞吐量",unit:"byte/s",tooltip:"该指标用于统计网口平均每秒的输出流量。"}},ce={class:"chart-box"},pe="kvstore-metric-group",be=x({__name:"metricChart",props:{sid:{type:[String,Number],default:""},metricName:{type:String,default:""},param:{type:Object,default:()=>({})}},setup(e){const t=e,a=n(null);let l=null;const i=r({chartData:[],isVisible:!1,analysis:{max:0,min:0,avg:0,sum:0}}),o=async()=>{const e=new IntersectionObserver((async o=>{o.forEach((async o=>{o.isIntersecting&&(i.isVisible=!0,await(async()=>{const{metrics:e}=await q.monitor.postChartData(t.sid,t.param);i.chartData=e[0];const a=i.chartData.values.map((e=>e.value));a.length&&(i.analysis.max=Math.max(...a).toFixed(2),i.analysis.min=Math.min(...a).toFixed(2),i.analysis.sum=a.reduce(((e,t)=>e+t),0).toFixed(2),i.analysis.avg=(a.length?i.analysis.sum/a.length:0).toFixed(2))})(),(()=>{var e,o,s;l||(l=Q(a.value),l.group=pe);const n=(null==(e=me[t.metricName])?void 0:e.unit)||i.chartData.unit||"",r=(null==(o=me[t.metricName])?void 0:o.label)||t.metricName,u=i.analysis,d=[{value:u.max,label:"最大值"},{value:u.min,label:"最小值"},{value:u.avg,label:"平均值"}],m=document.createElement("canvas").getContext("2d");m.font='bolder 14px "PingFang SC", "Microsoft YaHei", Arial';const c=d.map((e=>m.measureText(`${e.value} ${n}`).width)),p=d.map((e=>m.measureText(e.label).width)),b=c.map(((e,t)=>Math.max(e,p[t])));let f=0;const v=d.map(((e,t)=>{const a={type:"group",left:f,top:35,children:[{type:"text",style:{text:`${e.value} ${n}`,font:'bolder 15px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222"},tooltip:{show:!0,formatter:()=>['<div style="text-align: center">',`<div style="font-weight: bold; font-size: 15px; color: #222; margin-bottom: 4px">${e.value} ${n}</div>`,`<div style="font-size: 12px; color: #888">${e.label}</div>`,"</div>"].join(""),backgroundColor:"#fff",borderColor:"#e8e8e8",borderWidth:1,textStyle:{color:"#222",fontSize:12,fontFamily:'"PingFang SC", "Microsoft YaHei", Arial'},padding:[8,12],extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);"}},{type:"text",top:22,style:{text:e.label,font:'12px "PingFang SC", "Microsoft YaHei", Arial',fill:"#888"}}]};return f+=b[t]+20,a})),_=document.createElement("canvas").getContext("2d");_.font='600 16px "PingFang SC", "Microsoft YaHei", Arial';const y={title:{show:!1},tooltip:{trigger:"axis"},legend:{data:[r],bottom:0,icon:"path://M904 476H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"},grid:{left:40,right:20,top:120,bottom:55},graphic:[{type:"text",left:0,top:0,style:{text:r,font:'600 16px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222"}},{type:"group",left:_.measureText(r).width+8,top:0,children:[{type:"circle",shape:{cx:8,cy:8,r:7},style:{stroke:"#222",fill:"#fff",lineWidth:1}},{type:"text",left:5,top:3,style:{text:"?",x:8,y:9,font:'11px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222",textAlign:"center",textVerticalAlign:"middle"},tooltip:{show:!0,formatter:null==(s=me[t.metricName])?void 0:s.tooltip,backgroundColor:"#fff",borderColor:"#e8e8e8",borderWidth:1,textStyle:{color:"#222",fontSize:12,fontFamily:'"PingFang SC", "Microsoft YaHei", Arial'},extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);",position:function(e,t,a,l,i){let o=e[0]+16,s=e[1]-i.contentSize[1]/2;return o+i.contentSize[0]>i.viewSize[0]&&(o=i.viewSize[0]-i.contentSize[0]-10),s<0&&(s=10),s+i.contentSize[1]>i.viewSize[1]&&(s=i.viewSize[1]-i.contentSize[1]-10),[o,s]}}}],cursor:"pointer"},...v],xAxis:{type:"category",data:i.chartData.values.map((e=>{const t=A(e.date),a=A(i.chartData.values[0].date);return A(i.chartData.values[i.chartData.values.length-1].date).diff(a,"day")>0?t.format("YYYY/MM/DD\nHH:mm"):t.format("HH:mm")})),boundaryGap:!1},yAxis:{type:"value",name:n,nameLocation:"end",nameTextStyle:{fontSize:12,fontWeight:400,color:"black",padding:[0,5,0,0]},axisLabel:{formatter:"{value}",width:40,overflow:"break"}},series:[{name:r,type:"line",data:i.chartData.values.map((e=>e.value)),smooth:!0,symbol:"none",lineStyle:{width:2,color:"#3b82f6"},itemStyle:{color:"#3b82f6"},markPoint:{symbol:"triangle",symbolSize:10,data:[{type:"max",name:"最大值",symbolRotate:0,itemStyle:{color:"#3b82f6"},symbolOffset:[0,-8]},{type:"min",name:"最小值",symbolRotate:180,itemStyle:{color:"#3b82f6"},symbolOffset:[0,8]}],label:{show:!1}}}]};l.setOption(y)})(),e.unobserve(o.target))}))}),{threshold:.1});a.value&&e.observe(a.value)};return Y((()=>{o(),setTimeout((()=>{J(pe)}),300)})),O((()=>{l&&(l.dispose(),l=null)})),(e,t)=>{const l=g;return d(),m(l,{spinning:!b(i).isVisible},{default:c((()=>[C("div",ce,[C("div",{ref_key:"chartRef",ref:a,class:"chart-content"},null,512)])])),_:1},8,["spinning"])}}},[["__scopeId","data-v-4363e3be"]]),fe={class:"search-box"},ve={class:"ml-4"},_e={class:"metric-chart-box"},ye=x({__name:"monitor",props:{sid:{type:[String,Number],default:""}},setup(e){const t=e,a=r({metricList:[],chartList:[],searchParams:{metrics:[],date:[A().add(-1,"h"),A()],filter:["average","1"]},refresh:!1,autoRefresh:!1,timer:null});Y((async()=>{const{metrics:e}=await q.monitor.postMetric(t.sid,{});a.metricList=e.map((e=>{var t;return{label:(null==(t=me[e.metric_name])?void 0:t.label)||e.metric_name,value:e.metric_name}}))}));const l=()=>{const e=a.searchParams.date[1].diff(a.searchParams.date[0],"day");let t=[...ue],l=[...de];return e>10&&(t=t.filter((e=>"300"!==e.value)),l=l.filter((e=>"原始值"!==e.label))),e>20&&(t=t.filter((e=>"1200"!==e.value))),e>155&&(t=t.filter((e=>"3600"!==e.value))),t=t.filter((e=>e.value<=a.searchParams.date[1].diff(a.searchParams.date[0],"seconds"))),l.map((e=>({...e,children:"原始值"===e.label?null:t})))},i=()=>{a.refresh=!0,z((()=>{a.refresh=!1}))};return k((()=>[a.searchParams.metrics,a.searchParams.filter]),(()=>{i()}),{deep:!0}),k((()=>a.searchParams.date),(()=>{"原始值"===l()[0].label?a.searchParams.filter=["average","1"]:a.searchParams.filter=["average",l()[0].children[0].value],i()}),{deep:!0}),k((()=>a.autoRefresh),(e=>{e?a.timer=setInterval((()=>{i()}),3e4):clearInterval(a.timer)})),(e,o)=>{const s=ee,n=te,r=ae,y=u("RedoOutlined"),h=H,g=F,x=le;return d(),f(v,null,[C("div",fe,[p(s,{value:b(a).searchParams.metrics,"onUpdate:value":o[0]||(o[0]=e=>b(a).searchParams.metrics=e),placeholder:"指标名称",options:b(a).metricList,"dropdown-match-select-width":!1,mode:"multiple"},null,8,["value","options"]),p(n,{value:b(a).searchParams.date,"onUpdate:value":o[1]||(o[1]=e=>b(a).searchParams.date=e),"show-time":"","allow-clear":!1,presets:b(re),format:"YYYY/MM/DD HH:mm:ss"},null,8,["value","presets"]),p(r,{value:b(a).searchParams.filter,"onUpdate:value":o[2]||(o[2]=e=>b(a).searchParams.filter=e),options:l(),"allow-clear":!1},{displayRender:c((({labels:e})=>[j(S("1"===e[1]?"原始值":`${e[0]} / ${e[1]}`),1)])),_:1},8,["value","options"]),p(g,{title:"刷新"},{default:c((()=>[p(h,{onClick:i},{default:c((()=>[p(y)])),_:1})])),_:1}),C("div",ve,[j(" 自动刷新： "),p(g,{title:"每30秒自动刷新"},{default:c((()=>[p(x,{checked:b(a).autoRefresh,"onUpdate:checked":o[3]||(o[3]=e=>b(a).autoRefresh=e)},null,8,["checked"])])),_:1})])]),C("div",_e,[(d(!0),f(v,null,_(b(a).metricList,(e=>{return d(),f(v,{key:e.value},[b(a).refresh||!b(a).searchParams.metrics.includes(e.value)&&b(a).searchParams.metrics.length?P("",!0):(d(),m(be,{key:0,sid:t.sid,"metric-name":e.value,param:(l=e.value,{metrics:[l],start_time:a.searchParams.date[0],end_time:a.searchParams.date[1],filter:a.searchParams.filter[0],period:a.searchParams.filter[1]})},null,8,["sid","metric-name","param"]))],64);var l})),128))])],64)}}},[["__scopeId","data-v-8d1b4590"]]),he={class:"table-section"},ge=["onClick"],xe=["onClick"],we={class:"text-12"},ke={class:"mb-2"},Ce={class:"truncate inline-block"},Se={style:{display:"flex","align-items":"center"}},Pe={class:"flex items-center gap-2"},Te={key:0,class:"custom-tabs"},je=x({__name:"index",setup(o){const s=n(null),y=r({initColumn:[],initButton:[],initTitleData:[],subPageColumns:[],titleFieldSearch:[]}),{userEdit:h,formOpen:g,formType:x,formSid:k}=G(),D=w((()=>{for(let e of y.initColumn){let{field:t}=e;switch(t){case"engine":case"status":case"id":case"name":case"charge_type":e.slots={default:t};break;case"addresses":case"mem":e.showOverflow=!1,e.minWidth=180,e.slots={default:t}}}return y.initColumn})),R=w((()=>y.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),M=w((()=>[{title:"监控",key:"monitor",isCustomTab:!0}].filter((e=>R.value[`${e.key}_permission`]))));Y((async()=>{const{button:e,columns:t,title_data:a,sub_page_columns:l,title_field_search:i}=await N.setColumn({layer:1,tableType:"server"});y.initColumn=t.value||[],y.initButton=e.value||[],y.initTitleData=a.value||[],y.subPageColumns=l||[],y.titleFieldSearch=i.value||[],await A()}));const A=async()=>{s.value&&await s.value.serverTableRef.commitProxy("query")},O=({type:e,row:t})=>{h({type:e,sid:t.id})},{subPageOpen:z,subPageRow:H,handleSubPageOpen:$}=e();return(e,o)=>{var n,r;const w=E,Y=F,N=u("vxe-tag"),I=B,G=i,W=l,q=a,K=t;return d(),f(v,null,[C("div",he,[p(q,{ref_key:"tableRef",ref:s,"table-column":b(D),"auth-btn":b(R),order:b(y).tableOrder,"query-api":b(V).getList,"is-show-doc":!0,"is-show-sync":{show:!0,uri:"sync_kv_store_instance"},"title-field-search":b(y).titleFieldSearch,onUserEdit:O,onUserAdd:o[0]||(o[0]=t=>{b(h)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})})},{id:c((({row:e})=>[p(Y,{placement:"topLeft"},{title:c((()=>[p(w,{copyable:{tooltip:!1},class:"copy-text"},{default:c((()=>[j(S(e.cloud_instance_id),1)])),_:2},1024)])),default:c((()=>[C("span",{class:"cursor-pointer text-primary",onClick:t=>b($)(e)},S(e.id),9,ge)])),_:2},1024)])),name:c((({row:e})=>[C("span",{class:"cursor-pointer text-primary",onClick:t=>b($)(e)},S(e.name),9,xe)])),engine:c((({row:e})=>[C("span",null,S(e.engine)+" "+S(e.engine_version),1)])),addresses:c((({row:e})=>[(d(!0),f(v,null,_(e.addresses,(e=>(d(),m(Y,{key:e.id},{title:c((()=>[C("div",we,S(e.address)+":"+S(e.port),1)])),default:c((()=>[C("div",ke,[p(N,{class:"theme--primary",size:"small"},{default:c((()=>[C("span",Ce,S(e.address)+":"+S(e.port),1)])),_:2},1024)])])),_:2},1024)))),128))])),status:c((({row:e})=>[p(N,{class:T("运行中"==e.status?"theme--primary":"theme--error"),size:"small"},{default:c((()=>[j(S(e.status),1)])),_:2},1032,["class"])])),cloud_master_account_id:c((({row:e})=>{var t,a,l;return[C("div",Se,[p(I,{type:null==e?void 0:e.cloud_source},null,8,["type"])]),j(" "+S((null==(l=null==(a=null==(t=b(y).initTitleData)?void 0:t.cloud_master_account_id)?void 0:a[e.cloud_master_account_id])?void 0:l.page_display)||""),1)]})),region_id:c((({row:e})=>{var t,a,l;return[C("div",null,S(null==e?void 0:e.zone_id),1),C("div",null,S((null==(t=b(y).initTitleData)?void 0:t.region_id)&&(null==(l=null==(a=b(y).initTitleData)?void 0:a.region_id)?void 0:l[null==e?void 0:e.region_id])||(null==e?void 0:e.region_id)),1)]})),charge_type:c((({row:e})=>[p(G,{"charge-type":e.charge_type,"expired-time":e.expire_time},null,8,["charge-type","expired-time"])])),mem:c((({row:e})=>[C("div",Pe,[C("span",null,S(Number(e.mem/1024).toFixed(1))+"GB",1),p(W,{percentage:e.mem_used/e.mem},null,8,["percentage"])])])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search"])]),p(ie,{open:b(g),"onUpdate:open":o[1]||(o[1]=e=>L(g)?g.value=e:null),sid:b(k),"form-type":b(x),onEditSuccess:A},null,8,["open","sid","form-type"]),p(K,{open:b(z),"onUpdate:open":o[2]||(o[2]=e=>L(z)?z.value=e:null),width:"100%",title:null==(n=b(H))?void 0:n.name,"basic-config":{api:b(V).getDetail,sid:null==(r=b(H))?void 0:r.id,title:"实例信息",isCustomTab:!0},"custom-tabs":b(M),onClickEdit:o[3]||(o[3]=t=>O({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:b(H)}))},U({basic:c((({data:e})=>[p(ne,{data:e,columns:b(y).subPageColumns,"title-data":b(y).initTitleData},null,8,["data","columns","title-data"])])),_:2},[_(b(M),(e=>({name:e.key,fn:c((()=>{var t;return[b(z)?(d(),f("div",Te,["monitor"===e.key?(d(),m(ye,{key:0,sid:null==(t=b(H))?void 0:t.id},null,8,["sid"])):P("",!0)])):P("",!0)]}))})))]),1032,["open","title","basic-config","custom-tabs"])],64)}}},[["__scopeId","data-v-3ab71290"]]);export{je as default};
