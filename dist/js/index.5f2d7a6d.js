import{s as e,_ as t}from"./subPage.2201bfd5.js";import{_ as r}from"./ServerTable.53881589.js";import{al as a,r as i,O as s,Q as l,U as o,W as n,c as d,$ as u,R as p,F as m,S as _,a8 as c,aN as v,aT as f,a3 as y,H as b,J as g,a0 as h,b0 as x,I as w,q as C,p as T,X as j,ah as D,Y as O,a6 as I,ad as P,aZ as S,v as k,aV as E,a9 as F,aa as R}from"./index.872a2bd0.js";import{_ as A}from"./index.de966786.js";import{c as $}from"./cloudServerApi.fb0556ca.js";import{o as B,_ as L,u as Y}from"./opsFormInit.3a4e1794.js";import{_ as G}from"./index.029351cd.js";import{t as U}from"./tableRender.a6ff99b7.js";import"./opsDescriptions.dfa169bd.js";import"./index.87ccdcd1.js";import"./index.fc9664cf.js";import"./index.a533313d.js";import"./index.2c670fa1.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.9846e408.js";import"./index.44a4e190.js";import"./index.65b2e021.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.48209b21.js";import"./index.64f8d8d4.js";import"./alertLevel.8dae0e72.js";const N={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open"],setup(e,{emit:t}){const r=e,{open:y,sid:b,formType:g}=a(r),h=t;let x=i(null);const{postAccountAddDataApi:w,putCloudServerEdit:C,getCloudServerOneList:T}=$;let j=i(null);const D=["description","virtual_team_v3_id","server_status","environment","server_passwd"];let{formRenderContent:O,formDataLoading:I,confirmLoading:P,initForm:S,formDataInit:k,editSubmit:E,edit_data:F}=B({formRef:x,editTitleLayer:1,formType:g,sid:b,addApi:w,editApi:C,oneDataApi:T,customSubmitData:async e=>(e.server_passwd==j.value?delete e.server_passwd:e.server_passwd=await f(e.server_passwd),e),customEditData:()=>{j.value=F.server_passwd}});const R=()=>{h("update:open",!1)},A=async e=>{e&&(await S(),await k())};return(e,t)=>{const r=L,a=c,i=v,f=s("vxe-button"),b=G;return l(),o(b,{title:`${e.$route.meta.title}${u(g)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:u(y),onAfterOpenChange:A,onClose:R},{footer:n((()=>[d(f,{content:"取消",onClick:R}),d(f,{type:"submit",loading:u(P),status:"primary",content:"提交",onClick:u(E)},null,8,["loading","onClick"])])),default:n((()=>[d(i,{spinning:u(I)},{default:n((()=>[d(a,{ref_key:"formRef",ref:x,model:u(O).formState,rules:u(O).rules,"label-col":{span:3},"label-align":"left",colon:!1},{default:n((()=>[(l(!0),p(m,null,_(e.$utils.filter(u(O).title,(e=>e.edit_display)),(t=>{var a,i;return l(),o(r,{key:t.field,value:u(O).formState[t.field],"onUpdate:value":e=>u(O).formState[t.field]=e,title:t,"title-data":null==(i=null==(a=u(O))?void 0:a.title_data)?void 0:i[t.field],disabled:u(g)!==e.$CONFIG.FORM_TYPE.ADD_TYPE&&("自建"!==u(F).cloud_source?-1===D.indexOf(t.field):!t.edit_change)},null,8,["value","onUpdate:value","title","title-data","disabled"])})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},z=e=>(F("data-v-f5f59839"),e=e(),R(),e),q={class:"table-section"},M=["onClick"],H=["onClick"],W=z((()=>j("br",null,null,-1))),J=z((()=>j("br",null,null,-1))),K={style:{"margin-bottom":"10px"}},Q={style:{display:"flex","align-items":"center"}},V=y({__name:"index",setup(a){const o=i(null),_=b({initColumn:[],subPageColumns:[],initButton:[],initTitleData:{},tableOrder:{},titleFieldSearch:[]});g((async()=>{let{title_data:e,order:t,button:r,columns:a,sub_page_columns:i,title_field_search:s}=await U.setColumn({layer:1,tableType:"server"});_.initButton=r.value,_.initTitleData=e.value,_.tableOrder=t.value?t.value:{},_.initColumn=(null==a?void 0:a.value)||[],_.subPageColumns=i||[],_.titleFieldSearch=s.value||[],await w(),await f()}));const c=C((()=>{for(let e of _.initColumn){let{field:t}=e;switch(t){case"virtual_team_v3_id":e.showOverflow=!1;break;case"cloud_source":e.cellRender={name:"myCloud"};break;case"server_type":e.slots={default:t},e.minWidth="20%",e.showOverflow=!1;break;case"server_hostname":case"charge_type":e.slots={default:t};break;case"id":e.showOverflow="ellipsis",e.slots={default:t}}}return _.initColumn}));let v=C((()=>{let e={};if(_.initButton)for(let t of _.initButton){let{field:r}=t;e[r]=t}return e}));const f=async()=>{var e;(null==(e=o.value)?void 0:e.serverTableRef)&&o.value.serverTableRef.commitProxy("query")},{subPageOpen:y,subPageRow:x,handleSubPageOpen:F}=e(),{userEdit:R,formOpen:B,formType:L,formSid:G}=Y(),z=({type:e,row:t})=>{R({type:e,sid:t.id})},V={fields:[{field:"server_id",field_name:"实例ID",operator:"=",validate:h.isInstanceId},{field:"server_ip",field_name:"服务IP",operator:"vague",validate:h.isServerIp},{field:"server_hostname",field_name:"主机名",operator:"vague",validate:e=>!h.isServerIp(e)&&!h.isInstanceId(e)}],placeholder:"支持实例ID、IP、主机名搜索"};return T("urlPrefix","server/cloud-server/"),T("initTitleData",_.initTitleData),(e,a)=>{var i,b;const g=S,h=k,w=A,C=s("vxe-tag"),T=E,Y=r,U=t;return l(),p(m,null,[j("div",q,[d(Y,{ref_key:"serverTableRef",ref:o,"table-column":u(c),"auth-btn":u(v),order:u(_).tableOrder,"query-api":u($).postAccountListApi,"default-search-field":V,"title-field-search":u(_).titleFieldSearch,onUserEdit:z,onUserAdd:a[0]||(a[0]=t=>{u(R)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})})},{id:n((({row:e})=>[d(h,{placement:"topLeft"},{title:n((()=>[d(g,{copyable:{tooltip:!1},class:"copy-text"},{default:n((()=>[D(O(e.server_id),1)])),_:2},1024)])),default:n((()=>[j("span",{class:"cursor-pointer text-primary",onClick:t=>u(F)(e)},O(e.id),9,M)])),_:2},1024)])),server_hostname:n((({row:e})=>[j("span",{class:"cursor-pointer text-primary",onClick:t=>u(F)(e)},O(e.server_hostname),9,H)])),server_type:n((({row:e})=>[j("span",null,O(e.server_cpu?`${e.server_cpu}vCPUs`:"")+" | "+O(0===e.server_cpu||e.server_cpu?`${e.server_cpu} GiB`:"")+" | "+O(e.server_memory?`${e.server_memory} GiB`:"")+" | "+O(null==e?void 0:e.server_type),1),W,j("span",null,O(e.server_os),1)])),region_id:n((({row:e})=>{var t,r,a;return[D(O(e.zone_id),1),J,D(" "+O((null==(t=u(_).initTitleData)?void 0:t.region_id)&&(null==(a=null==(r=u(_).initTitleData)?void 0:r.region_id)?void 0:a[e.region_id])||e.region_id),1)]})),charge_type:n((({row:e})=>[d(w,{"charge-type":e.charge_type,"expired-time":e.server_expired_time},null,8,["charge-type","expired-time"])])),server_cloud_status:n((({row:e})=>[j("div",K,[d(C,{class:I("已上线"==e.server_status?"theme--primary":"theme--error"),size:"small"},{default:n((()=>[D(O(e.server_status),1)])),_:2},1032,["class"])]),j("div",null,[d(C,{class:I("运行中"==e.server_cloud_status?"theme--primary":"theme--error"),size:"small"},{default:n((()=>[D(O(e.server_cloud_status),1)])),_:2},1032,["class"])])])),cloud_master_account_id:n((({row:e})=>{var t,r,a;return[j("div",Q,[d(T,{type:e.cloud_source},null,8,["type"])]),D(" "+O((null==(a=null==(r=null==(t=u(_).initTitleData)?void 0:t.cloud_master_account_id)?void 0:r[e.cloud_master_account_id])?void 0:a.page_display)||""),1)]})),_:1},8,["table-column","auth-btn","order","query-api","title-field-search"])]),d(N,{open:u(B),"onUpdate:open":a[1]||(a[1]=e=>P(B)?B.value=e:null),sid:u(G),"form-type":u(L),onEditSuccess:f},null,8,["open","sid","form-type"]),d(U,{open:u(y),"onUpdate:open":a[2]||(a[2]=e=>P(y)?y.value=e:null),title:null==(i=u(x))?void 0:i.server_id,"basic-config":{columns:u(_).subPageColumns,api:u($).getCloudServerOneList,sid:null==(b=u(x))?void 0:b.id},onClickEdit:a[3]||(a[3]=t=>z({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:u(x)}))},{region_id:n((({row:e})=>{var t,r;return[D(O((null==(r=null==(t=u(_).initTitleData)?void 0:t.region_id)?void 0:r[e.region_id])||e.region_id),1)]})),server_expired_time:n((({row:e})=>[d(w,{"expired-time":e.server_expired_time,"sub-page":!0},null,8,["expired-time"])])),server_cloud_status:n((({row:e})=>[d(C,{class:I("运行中"==e.server_cloud_status?"theme--primary":"theme--error"),size:"small"},{default:n((()=>[D(O(e.server_cloud_status),1)])),_:2},1032,["class"])])),server_status:n((({row:e})=>[d(C,{class:I("已上线"==e.server_status?"theme--primary":"theme--error"),size:"small"},{default:n((()=>[D(O(e.server_status),1)])),_:2},1032,["class"])])),cloud_master_account_id:n((({row:e})=>{var t,r,a;return[D(O((null==(a=null==(r=null==(t=u(_).initTitleData)?void 0:t.cloud_master_account_id)?void 0:r[e.cloud_master_account_id])?void 0:a.page_display)||""),1)]})),_:1},8,["open","title","basic-config"])],64)}}},[["__scopeId","data-v-f5f59839"]]);export{V as default};
