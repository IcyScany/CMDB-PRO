import{s as e,_ as t}from"./subPage.2201bfd5.js";import{_ as i}from"./ServerTable.53881589.js";import{_ as n}from"./index.de966786.js";import{b5 as o,al as r,r as a,H as s,O as l,Q as c,U as p,W as d,c as u,$ as h,R as m,F as f,S as g,aT as b,a8 as v,aN as _,a3 as y,q as x,x as w,X as S,Y as k,Z as C,a6 as T,ah as R,aU as M,dB as L,aZ as P,v as E,aY as $,J as A,ad as D,ao as O,dC as I,dQ as N,aj as F,aS as H,a9 as B,aa as z,ap as U,I as j,av as q,C as Y,D as G,ag as V,aV as W}from"./index.872a2bd0.js";import{_ as K}from"./index.1e532bb2.js";import{t as X}from"./tableRender.a6ff99b7.js";import{o as Q,_ as Z,u as J}from"./opsFormInit.3a4e1794.js";import{_ as ee}from"./index.029351cd.js";import{A as te,a as ie}from"./rdsApi.1fa29748.js";import{a as ne}from"./opsDescriptions.dfa169bd.js";import{d as oe}from"./opsTable.7b07fc7b.js";import{_ as re}from"./Title.f705c4e3.js";import{_ as ae}from"./index.7d980246.js";import{o as se}from"./index.2c670fa1.js";import{V as le}from"./index.8820ea9e.js";import"./theme-github.7758cee8.js";import{_ as ce}from"./index.44a4e190.js";import{R as pe}from"./dayjs.c124633a.js";import{_ as de}from"./index.9846e408.js";import{c as ue,i as he}from"./index.165d9fa7.js";import{_ as me}from"./index.8338e1f7.js";import{_ as fe}from"./index.48209b21.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.fc9664cf.js";import"./alertLevel.8dae0e72.js";import"./index.65b2e021.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.64f8d8d4.js";import"./index.87ccdcd1.js";import"./index.a533313d.js";import"./useMaxLevel.bba6798c.js";const ge={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:o}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const i=e,{open:n,sid:o,formType:y}=r(i),x=t,w=a(null),{putEdit:S,getDetail:k,postAdd:C}=te,T=s({originPwd:""}),{formRenderContent:R,formDataLoading:M,confirmLoading:L,initForm:P,formDataInit:E,editSubmit:$}=Q({formRef:w,TITLE_LAYER:1,formType:y,sid:o,emits:x,addApi:C,editApi:S,oneDataApi:k,customSubmitData:async function(e){e.password!==T.originPwd?e.password=await b(e.password):delete e.password;return e},customOneData:function(e){var t;return e.value.password=(null==(t=e.value)?void 0:t.password)||"",T.originPwd=e.value.password,e}});const A=()=>{x("update:open",!1)},D=async e=>{e&&(await P(),await E())};return(e,t)=>{const i=Z,o=v,r=_,a=l("vxe-button"),s=ee;return c(),p(s,{title:`${e.$route.meta.title}${h(y)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:h(n),onAfterOpenChange:D,onClose:A},{footer:d((()=>[u(a,{content:"取消",onClick:A}),u(a,{type:"submit",loading:h(L),status:"primary",content:"提交",onClick:h($)},null,8,["loading","onClick"])])),default:d((()=>[u(r,{spinning:h(M)},{default:d((()=>[u(o,{ref_key:"formRef",ref:w,model:h(R).formState,rules:h(R).rules},{default:d((()=>[(c(!0),m(f,null,g(e.$utils.filter(h(R).title,(e=>e.edit_display)),(e=>{var t,n,o,r;return c(),m(f,{key:e.field},[""===e.field?(c(),p(i,{key:0,value:h(R).formState[e.field],"onUpdate:value":t=>h(R).formState[e.field]=t,title:e,"title-data":null==(n=null==(t=h(R))?void 0:t.title_data)?void 0:n[e.field]},null,8,["value","onUpdate:value","title","title-data"])):(c(),p(i,{key:1,value:h(R).formState[e.field],"onUpdate:value":t=>h(R).formState[e.field]=t,title:e,"title-data":null==(r=null==(o=h(R))?void 0:o.title_data)?void 0:r[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},be={class:"ml-4"},ve={class:"truncate inline-block"},_e=y({__name:"basicTab",props:{data:{type:Object,default:()=>({})},columns:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>({})}},setup(e){const t=e,i=[{title:"基础信息",block:1,columns:[]},{title:"规格配置",block:6,columns:[]},{title:"连接信息",block:2,columns:[]},{title:"网络信息",block:3,columns:[]},{title:"付费信息",block:4,columns:[]},{title:"节点信息",block:5,columns:[]}],o=x((()=>{var e;return{...t.data,...null==(e=t.data)?void 0:e.cloud_specific}})),r=x((()=>({id:"rdsNodes",...oe,columns:t.columns.filter((e=>{var t;return 10===(null==(t=null==e?void 0:e.oriTitle)?void 0:t.block)})),maxHeight:"500px"})));return w((()=>t.data),(()=>{i.forEach((e=>{e.columns=t.columns.filter((t=>{var i,n;if(10!==(null==(i=null==t?void 0:t.oriTitle)?void 0:i.block)){let i=Object.keys(o.value);return(null==(n=null==t?void 0:t.oriTitle)?void 0:n.block)===e.block&&i.includes(null==t?void 0:t.field)}}))}))})),(t,a)=>{const s=re,b=L,v=l("vxe-tag"),_=P,y=E,x=n,w=ne,A=l("vxe-grid"),D=$;return c(),m(f,null,g(i,(t=>S("div",{key:t.title,class:"mb-4"},[u(s,{level:5},{default:d((()=>[S("span",be,k(t.title),1)])),_:2},1024),u(D,{style:{borderColor:"#cccccc"}},{default:d((()=>{var i;return[0===t.columns.length?(c(),p(b,{key:0})):C("",!0),"节点信息"!==t.title?(c(),p(w,{key:1,data:h(o),columns:t.columns,column:2,"label-style":{width:"200px",marginRight:"10px",color:"#868686"},size:"small"},{addresses:d((({row:e})=>[(c(!0),m(f,null,g(e.addresses,(e=>(c(),m("div",{key:e.id},[u(y,{"overlay-style":{fontSize:"12px",maxWidth:"400px"}},{title:d((()=>[S("div",null,k(e.address)+":"+k(e.port),1)])),default:d((()=>[u(_,{copyable:{tooltip:!1},style:{"max-width":"calc(100% - 40px)"},class:"inline-block"},{default:d((()=>[u(v,{class:"theme--primary",size:"small"},{default:d((()=>[S("span",ve,k(e.address)+":"+k(e.port),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])))),128))])),status:d((({row:e})=>[u(v,{class:T("运行中"==e.status?"theme--primary":"theme--error"),size:"small"},{default:d((()=>[R(k(e.status),1)])),_:2},1032,["class"])])),cloud_master_account_id:d((({row:t})=>{var i,n,o;return[R(k((null==(o=null==(n=null==(i=e.titleData)?void 0:i.cloud_master_account_id)?void 0:n[t.cloud_master_account_id])?void 0:o.page_display)||""),1)]})),expire_time:d((({row:e})=>[u(x,{"expired-time":e.expire_time,"sub-page":!0},null,8,["expired-time"])])),region_id:d((({row:t})=>{var i,n,o;return[S("div",null,k((null==(i=e.titleData)?void 0:i.region_id)&&(null==(o=null==(n=e.titleData)?void 0:n.region_id)?void 0:o[null==t?void 0:t.region_id])||(null==t?void 0:t.region_id)),1)]})),_:2},1032,["data","columns"])):(c(),p(A,M({key:2,data:null==(i=h(o))?void 0:i.nodes,ref_for:!0},h(r)),null,16,["data"]))]})),_:2},1024)]))),64)}}},[["__scopeId","data-v-dd28302c"]]),ye={class:"text-error error-msg"},xe=y({__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:o},type:{type:String,default:"account"}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const i=e,{open:n,sid:o,formType:y}=r(i),x=t,w=a(null),{putEdit:C,getDetail:T}=ie[i.type],R=s({originPwd:"",errorMsg:""}),{formRenderContent:M,formDataLoading:L,confirmLoading:P,initForm:E,formDataInit:$,editSubmit:A}=Q({formRef:w,editTitleLayer:{account:2,database:3,table:4}[i.type],formType:y,sid:o,emits:x,editApi:C,oneDataApi:T,customSubmitData:async function(e){"account"===i.type&&(e.password!==R.originPwd?e.password=await b(e.password):delete e.password);return e},customEditData:function(e){var t;return e.value.password=(null==(t=e.value)?void 0:t.password)||"",R.originPwd=e.value.password||"",e},handleEditError:function(e){var t,i;R.errorMsg=null==(i=null==(t=null==e?void 0:e.response)?void 0:t.data)?void 0:i.msg}});const D=()=>{x("update:open",!1)},O=async e=>{R.errorMsg="",e&&(await E(),await $())};return(e,t)=>{const i=Z,o=v,r=_,a=l("vxe-button"),s=ee;return c(),p(s,{title:`${e.$route.meta.title}${h(y)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:h(n),onAfterOpenChange:O,onClose:D},{footer:d((()=>[S("span",ye,k(h(R).errorMsg),1),u(a,{content:"取消",onClick:D}),u(a,{type:"submit",loading:h(P),status:"primary",content:"提交",onClick:h(A)},null,8,["loading","onClick"])])),default:d((()=>[u(r,{spinning:h(L)},{default:d((()=>[u(o,{ref_key:"formRef",ref:w,model:h(M).formState,rules:h(M).rules},{default:d((()=>[(c(!0),m(f,null,g(e.$utils.filter(h(M).title,(e=>e.edit_display)),(e=>{var t,n,o,r;return c(),m(f,{key:e.field},[""===e.field?(c(),p(i,{key:0,value:h(M).formState[e.field],"onUpdate:value":t=>h(M).formState[e.field]=t,title:e,"title-data":null==(n=null==(t=h(M))?void 0:t.title_data)?void 0:n[e.field]},null,8,["value","onUpdate:value","title","title-data"])):(c(),p(i,{key:1,value:h(M).formState[e.field],"onUpdate:value":t=>h(M).formState[e.field]=t,title:e,"title-data":null==(r=null==(o=h(M))?void 0:o.title_data)?void 0:r[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},[["__scopeId","data-v-57a0a09b"]]),we=S("span",{class:"ml-1"},"RDS列表",-1),Se={class:"ml-2"},ke=["onClick"],Ce=["onClick"],Te=["onClick"],Re={__name:"index",props:{instanceName:{type:[String,Number],default:""},type:{type:String,required:!0}},emits:["update:type","rdsSubPageOpen"],setup(n,{emit:o}){const r=n,g=o,b={account:2,database:3,table:4},v={account:"账号",database:"数据库",table:"表"},_=a(null),y=s({initColumn:[],initButton:[],initTitleData:[],tableOrder:{},subPageColumns:[],titleFieldSearch:[],defaultQueryCondition:[]}),{userEdit:T,userDel:M,formOpen:L,formType:P,formSid:E}=J(),$=x((()=>{for(let e of y.initColumn){let{field:t}=e;switch(t){case"rds_instance":e.slots={default:t},e.visible=!r.instanceName;break;case"username":case"row_count":case"data_size":case"index_size":e.slots={default:t};break;case"virtual_team_v3_id":e.showOverflow=!1}}return y.initColumn})),I=x((()=>{const e=["edit","add","del"];return y.initButton.reduce(((t,i)=>(e.includes(i.field)&&(t[i.field]=i),t)),{})})),N=x((()=>y.subPageColumns.filter((e=>"mysql_account"===y.accountType&&2===e.oriTitle.block||"postgresql_account"===y.accountType&&3===e.oriTitle.block||"sqlserver_account"===y.accountType&&4===e.oriTitle.block))));A((async()=>{const{button:e,columns:t,title_data:i,order:n,sub_page_columns:o,title_field_search:a}=await X.setColumn({layer:b[r.type],tableType:"server"});y.initColumn=t.value||[],y.initButton=e.value||[],y.initTitleData=i.value||[],y.tableOrder=n.value||{},y.subPageColumns=o||[],y.titleFieldSearch=a||{},await F()}));const F=async()=>{_.value&&(r.instanceName?y.defaultQueryCondition=[{field:"rds_instance__name",condition:"=",value:r.instanceName,field_name:"RDS实例名",disableClose:!0}]:await _.value.serverTableRef.commitProxy("query"))},H=({type:e,row:t})=>{T({type:e,sid:t.id})},B=({row:e})=>{M({sid:e.id,delApi:ie[r.type].del,loadData:F})},z=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},{subPageOpen:U,subPageRow:j,handleSubPageOpen:q}=e(),Y={fields:[{field:{account:"username",database:"name",table:"table_name"}[r.type],field_name:`${v[r.type]}名`,operator:"vague"}],placeholder:`支持${v[r.type]}名搜索`};return w((()=>r.instanceName),(e=>{e&&F()})),(e,n)=>{var o,a,s;const b=O,x=l("vxe-button"),w=l("SearchOutlined"),M=i,A=t;return c(),m(f,null,[u(M,{ref_key:"tableRef",ref:_,"table-column":h($),"auth-btn":h(I),order:h(y).tableOrder,"query-api":h(ie)[r.type].getList,"default-search-field":Y,"title-field-search":h(y).titleFieldSearch,"default-query-condition":h(y).defaultQueryCondition,onUserEdit:H,onUserAdd:n[1]||(n[1]=t=>h(T)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:B},{other_toolbar_buttons:d((()=>[r.instanceName?C("",!0):(c(),p(x,{key:0,onClick:n[0]||(n[0]=e=>g("update:type","rds"))},{default:d((()=>[u(b,{iconname:"icon-guanxixingshujuku"}),we])),_:1})),S("span",Se,"当前页面：RDS"+k(v[r.type]),1)])),rds_instance:d((({row:e})=>{var t;return[S("span",{class:"cursor-pointer text-primary",onClick:t=>g("rdsSubPageOpen",null==e?void 0:e.rds_instance)},k(null==(t=null==e?void 0:e.rds_instance)?void 0:t.name),9,ke),S("span",{class:"ml-1 cursor-pointer text-primary",onClick:t=>(e=>{y.defaultQueryCondition=[{field:"rds_instance__name",condition:"=",value:e.rds_instance.name,field_name:"RDS实例名"}]})(e)},[u(w)],8,Ce)]})),username:d((({row:e})=>[S("span",{class:"cursor-pointer text-primary",onClick:t=>(e=>{y.accountType=e.mysql_account?"mysql_account":e.postgresql_account?"postgresql_account":"sqlserver_account",q(e)})(e)},k(e.username),9,Te)])),row_count:d((({row:e})=>{return[R(k((t=e.row_count,t<1e4?t.toString():t<1e8?(t/1e4).toFixed(2)+"万":(t/1e8).toFixed(2)+"亿")),1)];var t})),data_size:d((({row:e})=>[R(k(z(e.data_size)),1)])),index_size:d((({row:e})=>[R(k(z(e.index_size)),1)])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search","default-query-condition"]),u(xe,{open:h(L),"onUpdate:open":n[2]||(n[2]=e=>D(L)?L.value=e:null),sid:h(E),"form-type":h(P),type:r.type,onEditSuccess:F},null,8,["open","sid","form-type","type"]),u(A,{open:h(U),"onUpdate:open":n[3]||(n[3]=e=>D(U)?U.value=e:null),title:`所属RDS实例：${null==(a=null==(o=h(j))?void 0:o.rds_instance)?void 0:a.name}`,"basic-config":{title:"账号信息",data:null==(s=h(j))?void 0:s[h(y).accountType],columns:h(N)},onClickEdit:n[4]||(n[4]=t=>H({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:h(j)}))},null,8,["open","title","basic-config"])],64)}}};var Me;Me={exports:{}},ace.define("ace/mode/sql_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],(function(e,t,i){var n=e("../lib/oop"),o=e("./text_highlight_rules").TextHighlightRules,r=function(){var e=this.createKeywordMapper({"support.function":"avg|count|first|last|max|min|sum|ucase|lcase|mid|len|round|rank|now|format|coalesce|ifnull|isnull|nvl",keyword:"select|insert|update|delete|from|where|and|or|group|by|order|limit|offset|having|as|case|when|then|else|end|type|left|right|join|on|outer|desc|asc|union|create|table|primary|key|if|foreign|not|references|default|null|inner|cross|natural|database|drop|grant|distinct|is|in|all|alter|any|array|at|authorization|between|both|cast|check|collate|column|commit|constraint|cube|current|current_date|current_time|current_timestamp|current_user|describe|escape|except|exists|external|extract|fetch|filter|for|full|function|global|grouping|intersect|interval|into|leading|like|local|no|of|only|out|overlaps|partition|position|range|revoke|rollback|rollup|row|rows|session_user|set|some|start|tablesample|time|to|trailing|truncate|unique|unknown|user|using|values|window|with","constant.language":"true|false","storage.type":"int|numeric|decimal|date|varchar|char|bigint|float|double|bit|binary|text|set|timestamp|money|real|number|integer|string"},"identifier",!0);this.$rules={start:[{token:"comment",regex:"--.*$"},{token:"comment",start:"/\\*",end:"\\*/"},{token:"string",regex:'".*?"'},{token:"string",regex:"'.*?'"},{token:"string",regex:"`.*?`"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:e,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\/|\\/\\/|%|<@>|@>|<@|&|\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\(]"},{token:"paren.rparen",regex:"[\\)]"},{token:"text",regex:"\\s+"}]},this.normalizeRules()};n.inherits(r,o),t.SqlHighlightRules=r})),ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],(function(e,t,i){var n=e("../../lib/oop"),o=e("../../range").Range,r=e("./fold_mode").FoldMode,a=t.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};n.inherits(a,r),function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/,this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/,this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/,this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,i){var n=e.getLine(i);if(this.singleLineBlockCommentRe.test(n)&&!this.startRegionRe.test(n)&&!this.tripleStarBlockCommentRe.test(n))return"";var o=this._getFoldWidgetBase(e,t,i);return!o&&this.startRegionRe.test(n)?"start":o},this.getFoldWidgetRange=function(e,t,i,n){var o,r=e.getLine(i);if(this.startRegionRe.test(r))return this.getCommentRegionBlock(e,r,i);if(o=r.match(this.foldingStartMarker)){var a=o.index;if(o[1])return this.openingBracketBlock(e,o[1],i,a);var s=e.getCommentFoldRange(i,a+o[0].length,1);return s&&!s.isMultiLine()&&(n?s=this.getSectionRange(e,i):"all"!=t&&(s=null)),s}return"markbegin"!==t&&(o=r.match(this.foldingStopMarker))?(a=o.index+o[0].length,o[1]?this.closingBracketBlock(e,o[1],i,a):e.getCommentFoldRange(i,a,-1)):void 0},this.getSectionRange=function(e,t){for(var i=e.getLine(t),n=i.search(/\S/),r=t,a=i.length,s=t+=1,l=e.getLength();++t<l;){var c=(i=e.getLine(t)).search(/\S/);if(-1!==c){if(n>c)break;var p=this.getFoldWidgetRange(e,"all",t);if(p){if(p.start.row<=r)break;if(p.isMultiLine())t=p.end.row;else if(n==c)break}s=t}}return new o(r,a,s,e.getLine(s).length)},this.getCommentRegionBlock=function(e,t,i){for(var n=t.search(/\s*$/),r=e.getLength(),a=i,s=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,l=1;++i<r;){t=e.getLine(i);var c=s.exec(t);if(c&&(c[1]?l--:l++,!l))break}if(i>a)return new o(a,n,i,t.length)}}.call(a.prototype)})),ace.define("ace/mode/folding/sql",["require","exports","module","ace/lib/oop","ace/mode/folding/cstyle"],(function(e,t,i){var n=e("../../lib/oop"),o=e("./cstyle").FoldMode,r=t.FoldMode=function(){};n.inherits(r,o),function(){}.call(r.prototype)})),ace.define("ace/mode/sql",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/sql_highlight_rules","ace/mode/folding/sql"],(function(e,t,i){var n=e("../lib/oop"),o=e("./text").Mode,r=e("./sql_highlight_rules").SqlHighlightRules,a=e("./folding/sql").FoldMode,s=function(){this.HighlightRules=r,this.foldingRules=new a,this.$behaviour=this.$defaultBehaviour};n.inherits(s,o),function(){this.lineCommentStart="--",this.blockComment={start:"/*",end:"*/"},this.$id="ace/mode/sql",this.snippetFileId="ace/snippets/sql"}.call(s.prototype),t.Mode=s})),ace.require(["ace/mode/sql"],(function(e){Me&&(Me.exports=e)}));!function(e){ace.define("ace/snippets",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/range_list","ace/keyboard/hash_handler","ace/tokenizer","ace/clipboard","ace/editor"],(function(e,t,i){var n=e("./lib/dom"),o=e("./lib/oop"),r=e("./lib/event_emitter").EventEmitter,a=e("./lib/lang"),s=e("./range").Range,l=e("./range_list").RangeList,c=e("./keyboard/hash_handler").HashHandler,p=e("./tokenizer").Tokenizer,d=e("./clipboard"),u={CURRENT_WORD:function(e){return e.session.getTextRange(e.session.getWordRange())},SELECTION:function(e,t,i){var n=e.session.getTextRange();return i?n.replace(/\n\r?([ \t]*\S)/g,"\n"+i+"$1"):n},CURRENT_LINE:function(e){return e.session.getLine(e.getCursorPosition().row)},PREV_LINE:function(e){return e.session.getLine(e.getCursorPosition().row-1)},LINE_INDEX:function(e){return e.getCursorPosition().row},LINE_NUMBER:function(e){return e.getCursorPosition().row+1},SOFT_TABS:function(e){return e.session.getUseSoftTabs()?"YES":"NO"},TAB_SIZE:function(e){return e.session.getTabSize()},CLIPBOARD:function(e){return d.getText&&d.getText()},FILENAME:function(e){return/[^/\\]*$/.exec(this.FILEPATH(e))[0]},FILENAME_BASE:function(e){return/[^/\\]*$/.exec(this.FILEPATH(e))[0].replace(/\.[^.]*$/,"")},DIRECTORY:function(e){return this.FILEPATH(e).replace(/[^/\\]*$/,"")},FILEPATH:function(e){return"/not implemented.txt"},WORKSPACE_NAME:function(){return"Unknown"},FULLNAME:function(){return"Unknown"},BLOCK_COMMENT_START:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.start||""},BLOCK_COMMENT_END:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.end||""},LINE_COMMENT:function(e){return(e.session.$mode||{}).lineCommentStart||""},CURRENT_YEAR:h.bind(null,{year:"numeric"}),CURRENT_YEAR_SHORT:h.bind(null,{year:"2-digit"}),CURRENT_MONTH:h.bind(null,{month:"numeric"}),CURRENT_MONTH_NAME:h.bind(null,{month:"long"}),CURRENT_MONTH_NAME_SHORT:h.bind(null,{month:"short"}),CURRENT_DATE:h.bind(null,{day:"2-digit"}),CURRENT_DAY_NAME:h.bind(null,{weekday:"long"}),CURRENT_DAY_NAME_SHORT:h.bind(null,{weekday:"short"}),CURRENT_HOUR:h.bind(null,{hour:"2-digit",hour12:!1}),CURRENT_MINUTE:h.bind(null,{minute:"2-digit"}),CURRENT_SECOND:h.bind(null,{second:"2-digit"})};function h(e){var t=(new Date).toLocaleString("en-us",e);return 1==t.length?"0"+t:t}u.SELECTED_TEXT=u.SELECTION;var m=function(){function e(){this.snippetMap={},this.snippetNameMap={},this.variables=u}return e.prototype.getTokenizer=function(){return e.$tokenizer||this.createTokenizer()},e.prototype.createTokenizer=function(){function t(e){return e=e.substr(1),/^\d+$/.test(e)?[{tabstopId:parseInt(e,10)}]:[{text:e}]}function i(e){return"(?:[^\\\\"+e+"]|\\\\.)"}var n={regex:"/("+i("/")+"+)/",onMatch:function(e,t,i){var n=i[0];return n.fmtString=!0,n.guard=e.slice(1,-1),n.flag="",""},next:"formatString"};return e.$tokenizer=new p({start:[{regex:/\\./,onMatch:function(e,t,i){var n=e[1];return("}"==n&&i.length||-1!="`$\\".indexOf(n))&&(e=n),[e]}},{regex:/}/,onMatch:function(e,t,i){return[i.length?i.shift():e]}},{regex:/\$(?:\d+|\w+)/,onMatch:t},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(e,i,n){var o=t(e.substr(1));return n.unshift(o[0]),o},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+i("\\|")+"*\\|",onMatch:function(e,t,i){var n=e.slice(1,-1).replace(/\\[,|\\]|,/g,(function(e){return 2==e.length?e[1]:"\0"})).split("\0").map((function(e){return{value:e}}));return i[0].choices=n,[n[0]]},next:"start"},n,{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:/:/,onMatch:function(e,t,i){return i.length&&i[0].expectElse?(i[0].expectElse=!1,i[0].ifEnd={elseEnd:i[0]},[i[0].ifEnd]):":"}},{regex:/\\./,onMatch:function(e,t,i){var n=e[1];return"}"==n&&i.length||-1!="`$\\".indexOf(n)?e=n:"n"==n?e="\n":"t"==n?e="\t":-1!="ulULE".indexOf(n)&&(e={changeCase:n,local:n>"a"}),[e]}},{regex:"/\\w*}",onMatch:function(e,t,i){var n=i.shift();return n&&(n.flag=e.slice(1,-1)),this.next=n&&n.tabstopId?"start":"",[n||e]},next:"start"},{regex:/\$(?:\d+|\w+)/,onMatch:function(e,t,i){return[{text:e.slice(1)}]}},{regex:/\${\w+/,onMatch:function(e,t,i){var n={text:e.slice(2)};return i.unshift(n),[n]},next:"formatStringVar"},{regex:/\n/,token:"newline",merge:!1},{regex:/}/,onMatch:function(e,t,i){var n=i.shift();return this.next=n&&n.tabstopId?"start":"",[n||e]},next:"start"}],formatStringVar:[{regex:/:\/\w+}/,onMatch:function(e,t,i){return i[0].formatFunction=e.slice(2,-1),[i.shift()]},next:"formatString"},n,{regex:/:[\?\-+]?/,onMatch:function(e,t,i){"+"==e[1]&&(i[0].ifEnd=i[0]),"?"==e[1]&&(i[0].expectElse=!0)},next:"formatString"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"formatString"}]}),e.$tokenizer},e.prototype.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map((function(e){return e.value||e}))},e.prototype.getVariableValue=function(e,t,i){if(/^\d+$/.test(t))return(this.variables.__||{})[t]||"";if(/^[A-Z]\d+$/.test(t))return(this.variables[t[0]+"__"]||{})[t.substr(1)]||"";if(t=t.replace(/^TM_/,""),!this.variables.hasOwnProperty(t))return"";var n=this.variables[t];return"function"==typeof n&&(n=this.variables[t](e,t,i)),null==n?"":n},e.prototype.tmStrFormat=function(e,t,i){if(!t.fmt)return e;var n=t.flag||"",o=t.guard;o=new RegExp(o,n.replace(/[^gim]/g,""));var r="string"==typeof t.fmt?this.tokenizeTmSnippet(t.fmt,"formatString"):t.fmt,a=this,s=e.replace(o,(function(){var e=a.variables.__;a.variables.__=[].slice.call(arguments);for(var t=a.resolveVariables(r,i),n="E",o=0;o<t.length;o++){var s=t[o];if("object"==typeof s)if(t[o]="",s.changeCase&&s.local){var l=t[o+1];l&&"string"==typeof l&&("u"==s.changeCase?t[o]=l[0].toUpperCase():t[o]=l[0].toLowerCase(),t[o+1]=l.substr(1))}else s.changeCase&&(n=s.changeCase);else"U"==n?t[o]=s.toUpperCase():"L"==n&&(t[o]=s.toLowerCase())}return a.variables.__=e,t.join("")}));return s},e.prototype.tmFormatFunction=function(e,t,i){return"upcase"==t.formatFunction?e.toUpperCase():"downcase"==t.formatFunction?e.toLowerCase():e},e.prototype.resolveVariables=function(e,t){for(var i=[],n="",o=!0,r=0;r<e.length;r++){var a=e[r];if("string"!=typeof a){if(a){if(o=!1,a.fmtString){var s=e.indexOf(a,r+1);-1==s&&(s=e.length),a.fmt=e.slice(r+1,s),r=s}if(a.text){var l=this.getVariableValue(t,a.text,n)+"";a.fmtString&&(l=this.tmStrFormat(l,a,t)),a.formatFunction&&(l=this.tmFormatFunction(l,a,t)),l&&!a.ifEnd?(i.push(l),c(a)):!l&&a.ifEnd&&c(a.ifEnd)}else a.elseEnd?c(a.elseEnd):(null!=a.tabstopId||null!=a.changeCase)&&i.push(a)}}else i.push(a),"\n"==a?(o=!0,n=""):o&&(n=/^\t*/.exec(a)[0],o=/\S/.test(a))}function c(t){var i=e.indexOf(t,r+1);-1!=i&&(r=i)}return i},e.prototype.getDisplayTextForSnippet=function(e,t){return f.call(this,e,t).text},e.prototype.insertSnippetForSelection=function(e,t,i){void 0===i&&(i={});var n=f.call(this,e,t,i),o=e.getSelectionRange(),r=e.session.replace(o,n.text),a=new g(e),s=e.inVirtualSelectionMode&&e.selection.index;a.addTabstops(n.tabstops,o.start,r,s)},e.prototype.insertSnippet=function(e,t,i){void 0===i&&(i={});var n=this;if(e.inVirtualSelectionMode)return n.insertSnippetForSelection(e,t,i);e.forEachSelection((function(){n.insertSnippetForSelection(e,t,i)}),null,{keepOrder:!0}),e.tabstopManager&&e.tabstopManager.tabNext()},e.prototype.$getScope=function(e){var t=e.session.$mode.$id||"";if("html"===(t=t.split("/").pop())||"php"===t){"php"!==t||e.session.$mode.inlinePhp||(t="html");var i=e.getCursorPosition(),n=e.session.getState(i.row);"object"==typeof n&&(n=n[0]),n.substring&&("js-"==n.substring(0,3)?t="javascript":"css-"==n.substring(0,4)?t="css":"php-"==n.substring(0,4)&&(t="php"))}return t},e.prototype.getActiveScopes=function(e){var t=this.$getScope(e),i=[t],n=this.snippetMap;return n[t]&&n[t].includeScopes&&i.push.apply(i,n[t].includeScopes),i.push("_"),i},e.prototype.expandWithTab=function(e,t){var i=this,n=e.forEachSelection((function(){return i.expandSnippetForSelection(e,t)}),null,{keepOrder:!0});return n&&e.tabstopManager&&e.tabstopManager.tabNext(),n},e.prototype.expandSnippetForSelection=function(e,t){var i,n=e.getCursorPosition(),o=e.session.getLine(n.row),r=o.substring(0,n.column),a=o.substr(n.column),s=this.snippetMap;return this.getActiveScopes(e).some((function(e){var t=s[e];return t&&(i=this.findMatchingSnippet(t,r,a)),!!i}),this),!!i&&(t&&t.dryRun||(e.session.doc.removeInLine(n.row,n.column-i.replaceBefore.length,n.column+i.replaceAfter.length),this.variables.M__=i.matchBefore,this.variables.T__=i.matchAfter,this.insertSnippetForSelection(e,i.content),this.variables.M__=this.variables.T__=null),!0)},e.prototype.findMatchingSnippet=function(e,t,i){for(var n=e.length;n--;){var o=e[n];if((!o.startRe||o.startRe.test(t))&&((!o.endRe||o.endRe.test(i))&&(o.startRe||o.endRe)))return o.matchBefore=o.startRe?o.startRe.exec(t):[""],o.matchAfter=o.endRe?o.endRe.exec(i):[""],o.replaceBefore=o.triggerRe?o.triggerRe.exec(t)[0]:"",o.replaceAfter=o.endTriggerRe?o.endTriggerRe.exec(i)[0]:"",o}},e.prototype.register=function(e,t){var i=this.snippetMap,n=this.snippetNameMap,o=this;function r(e){return e&&!/^\^?\(.*\)\$?$|^\\b$/.test(e)&&(e="(?:"+e+")"),e||""}function s(e,t,i){return e=r(e),t=r(t),i?(e=t+e)&&"$"!=e[e.length-1]&&(e+="$"):(e+=t)&&"^"!=e[0]&&(e="^"+e),new RegExp(e)}function l(e){e.scope||(e.scope=t||"_"),t=e.scope,i[t]||(i[t]=[],n[t]={});var r=n[t];if(e.name){var l=r[e.name];l&&o.unregister(l),r[e.name]=e}i[t].push(e),e.prefix&&(e.tabTrigger=e.prefix),!e.content&&e.body&&(e.content=Array.isArray(e.body)?e.body.join("\n"):e.body),e.tabTrigger&&!e.trigger&&(!e.guard&&/^\w/.test(e.tabTrigger)&&(e.guard="\\b"),e.trigger=a.escapeRegExp(e.tabTrigger)),(e.trigger||e.guard||e.endTrigger||e.endGuard)&&(e.startRe=s(e.trigger,e.guard,!0),e.triggerRe=new RegExp(e.trigger),e.endRe=s(e.endTrigger,e.endGuard,!0),e.endTriggerRe=new RegExp(e.endTrigger))}e||(e=[]),Array.isArray(e)?e.forEach(l):Object.keys(e).forEach((function(t){l(e[t])})),this._signal("registerSnippets",{scope:t})},e.prototype.unregister=function(e,t){var i=this.snippetMap,n=this.snippetNameMap;function o(e){var o=n[e.scope||t];if(o&&o[e.name]){delete o[e.name];var r=i[e.scope||t],a=r&&r.indexOf(e);a>=0&&r.splice(a,1)}}e.content?o(e):Array.isArray(e)&&e.forEach(o)},e.prototype.parseSnippetFile=function(e){e=e.replace(/\r/g,"");for(var t,i=[],n={},o=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;t=o.exec(e);){if(t[1])try{n=JSON.parse(t[1]),i.push(n)}catch(l){}if(t[4])n.content=t[4].replace(/^\t/gm,""),i.push(n),n={};else{var r=t[2],a=t[3];if("regex"==r){var s=/\/((?:[^\/\\]|\\.)*)|$/g;n.guard=s.exec(a)[1],n.trigger=s.exec(a)[1],n.endTrigger=s.exec(a)[1],n.endGuard=s.exec(a)[1]}else"snippet"==r?(n.tabTrigger=a.match(/^\S*/)[0],n.name||(n.name=a)):r&&(n[r]=a)}}return i},e.prototype.getSnippetByName=function(e,t){var i,n=this.snippetNameMap;return this.getActiveScopes(t).some((function(t){var o=n[t];return o&&(i=o[e]),!!i}),this),i},e}();o.implement(m.prototype,r);var f=function(e,t,i){void 0===i&&(i={});var n=e.getCursorPosition(),o=e.session.getLine(n.row),r=e.session.getTabString(),a=o.match(/^\s*/)[0];n.column<a.length&&(a=a.slice(0,n.column)),t=t.replace(/\r/g,"");var s=this.tokenizeTmSnippet(t);s=(s=this.resolveVariables(s,e)).map((function(e){return"\n"!=e||i.excludeExtraIndent?"string"==typeof e?e.replace(/\t/g,r):e:e+a}));var l=[];s.forEach((function(e,t){if("object"==typeof e){var i=e.tabstopId,n=l[i];if(n||((n=l[i]=[]).index=i,n.value="",n.parents={}),-1===n.indexOf(e)){e.choices&&!n.choices&&(n.choices=e.choices),n.push(e);var o=s.indexOf(e,t+1);if(-1!==o){var r=s.slice(t+1,o);r.some((function(e){return"object"==typeof e}))&&!n.value?n.value=r:!r.length||n.value&&"string"==typeof n.value||(n.value=r.join(""))}}}})),l.forEach((function(e){e.length=0}));var c={};function p(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];if("object"==typeof n){if(c[n.tabstopId])continue;n=t[e.lastIndexOf(n,i-1)]||{tabstopId:n.tabstopId}}t[i]=n}return t}for(var d=0;d<s.length;d++){var u=s[d];if("object"==typeof u){var h=u.tabstopId,m=l[h],f=s.indexOf(u,d+1);if(c[h])c[h]===u&&(delete c[h],Object.keys(c).forEach((function(e){m.parents[e]=!0})));else{c[h]=u;var g=m.value;"string"!=typeof g?g=p(g):u.fmt&&(g=this.tmStrFormat(g,u,e)),s.splice.apply(s,[d+1,Math.max(0,f-d)].concat(g,u)),-1===m.indexOf(u)&&m.push(u)}}}var b=0,v=0,_="";return s.forEach((function(e){if("string"==typeof e){var t=e.split("\n");t.length>1?(v=t[t.length-1].length,b+=t.length-1):v+=e.length,_+=e}else e&&(e.start?e.end={row:b,column:v}:e.start={row:b,column:v})})),{text:_,tabstops:l,tokens:s}},g=function(){function e(e){if(this.index=0,this.ranges=[],this.tabstops=[],e.tabstopManager)return e.tabstopManager;e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=a.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(e)}return e.prototype.attach=function(e){this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.session=e.session,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},e.prototype.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges.length=0,this.tabstops.length=0,this.selectedTabstop=null,this.editor.off("change",this.$onChange),this.editor.off("changeSelection",this.$onChangeSelection),this.editor.off("changeSession",this.$onChangeSession),this.editor.commands.off("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.session=null,this.editor=null},e.prototype.onChange=function(e){for(var t="r"==e.action[0],i=this.selectedTabstop||{},n=i.parents||{},o=this.tabstops.slice(),r=0;r<o.length;r++){var a=o[r],s=a==i||n[a.index];if(a.rangeList.$bias=s?0:1,"remove"==e.action&&a!==i){var l=a.parents&&a.parents[i.index],c=a.rangeList.pointIndex(e.start,l);c=c<0?-c-1:c+1;var p=a.rangeList.pointIndex(e.end,l);p=p<0?-p-1:p-1;for(var d=a.rangeList.ranges.slice(c,p),u=0;u<d.length;u++)this.removeRange(d[u])}a.rangeList.$onChange(e)}var h=this.session;this.$inChange||!t||1!=h.getLength()||h.getValue()||this.detach()},e.prototype.updateLinkedFields=function(){var e=this.selectedTabstop;if(e&&e.hasLinkedRanges&&e.firstNonLinked){this.$inChange=!0;for(var i=this.session,n=i.getTextRange(e.firstNonLinked),o=0;o<e.length;o++){var r=e[o];if(r.linked){var a=r.original,s=t.snippetManager.tmStrFormat(n,a,this.editor);i.replace(r,s)}}this.$inChange=!1}},e.prototype.onAfterExec=function(e){e.command&&!e.command.readOnly&&this.updateLinkedFields()},e.prototype.onChangeSelection=function(){if(this.editor){for(var e=this.editor.selection.lead,t=this.editor.selection.anchor,i=this.editor.selection.isEmpty(),n=0;n<this.ranges.length;n++)if(!this.ranges[n].linked){var o=this.ranges[n].contains(e.row,e.column),r=i||this.ranges[n].contains(t.row,t.column);if(o&&r)return}this.detach()}},e.prototype.onChangeSession=function(){this.detach()},e.prototype.tabNext=function(e){var t=this.tabstops.length,i=this.index+(e||1);(i=Math.min(Math.max(i,1),t))==t&&(i=0),this.selectTabstop(i),this.updateTabstopMarkers(),0===i&&this.detach()},e.prototype.selectTabstop=function(e){this.$openTabstops=null;var t=this.tabstops[this.index];if(t&&this.addTabstopMarkers(t),this.index=e,(t=this.tabstops[this.index])&&t.length){this.selectedTabstop=t;var i=t.firstNonLinked||t;if(t.choices&&(i.cursor=i.start),this.editor.inVirtualSelectionMode)this.editor.selection.fromOrientedRange(i);else{var n=this.editor.multiSelect;n.toSingleRange(i);for(var o=0;o<t.length;o++)t.hasLinkedRanges&&t[o].linked||n.addRange(t[o].clone(),!0)}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&&this.selectedTabstop.choices&&this.editor.execCommand("startAutocomplete",{matches:this.selectedTabstop.choices})}},e.prototype.addTabstops=function(e,t,i){var n=this.useLink||!this.editor.getOption("enableMultiselect");if(this.$openTabstops||(this.$openTabstops=[]),!e[0]){var o=s.fromPoints(i,i);v(o.start,t),v(o.end,t),e[0]=[o],e[0].index=0}var r=[this.index+1,0],a=this.ranges,c=this.snippetId=(this.snippetId||0)+1;e.forEach((function(e,i){var o=this.$openTabstops[i]||e;o.snippetId=c;for(var p=0;p<e.length;p++){var d=e[p],u=s.fromPoints(d.start,d.end||d.start);b(u.start,t),b(u.end,t),u.original=d,u.tabstop=o,a.push(u),o!=e?o.unshift(u):o[p]=u,d.fmtString||o.firstNonLinked&&n?(u.linked=!0,o.hasLinkedRanges=!0):o.firstNonLinked||(o.firstNonLinked=u)}o.firstNonLinked||(o.hasLinkedRanges=!1),o===e&&(r.push(o),this.$openTabstops[i]=o),this.addTabstopMarkers(o),o.rangeList=o.rangeList||new l,o.rangeList.$bias=0,o.rangeList.addList(o)}),this),r.length>2&&(this.tabstops.length&&r.push(r.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,r))},e.prototype.addTabstopMarkers=function(e){var t=this.session;e.forEach((function(e){e.markerId||(e.markerId=t.addMarker(e,"ace_snippet-marker","text"))}))},e.prototype.removeTabstopMarkers=function(e){var t=this.session;e.forEach((function(e){t.removeMarker(e.markerId),e.markerId=null}))},e.prototype.updateTabstopMarkers=function(){if(this.selectedTabstop){var e=this.selectedTabstop.snippetId;0===this.selectedTabstop.index&&e--,this.tabstops.forEach((function(t){t.snippetId===e?this.addTabstopMarkers(t):this.removeTabstopMarkers(t)}),this)}},e.prototype.removeRange=function(e){var t=e.tabstop.indexOf(e);-1!=t&&e.tabstop.splice(t,1),-1!=(t=this.ranges.indexOf(e))&&this.ranges.splice(t,1),-1!=(t=e.tabstop.rangeList.ranges.indexOf(e))&&e.tabstop.splice(t,1),this.session.removeMarker(e.markerId),e.tabstop.length||(-1!=(t=this.tabstops.indexOf(e.tabstop))&&this.tabstops.splice(t,1),this.tabstops.length||this.detach())},e}();g.prototype.keyboardHandler=new c,g.prototype.keyboardHandler.bindKeys({Tab:function(e){t.snippetManager&&t.snippetManager.expandWithTab(e)||(e.tabstopManager.tabNext(1),e.renderer.scrollCursorIntoView())},"Shift-Tab":function(e){e.tabstopManager.tabNext(-1),e.renderer.scrollCursorIntoView()},Esc:function(e){e.tabstopManager.detach()}});var b=function(e,t){0==e.row&&(e.column+=t.column),e.row+=t.row},v=function(e,t){e.row==t.row&&(e.column-=t.column),e.row-=t.row};n.importCssString("\n.ace_snippet-marker {\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    background: rgba(194, 193, 208, 0.09);\n    border: 1px dotted rgba(211, 208, 235, 0.62);\n    position: absolute;\n}","snippets.css",!1),t.snippetManager=new m;var _=e("./editor").Editor;(function(){this.insertSnippet=function(e,i){return t.snippetManager.insertSnippet(this,e,i)},this.expandSnippet=function(e){return t.snippetManager.expandWithTab(this,e)}}).call(_.prototype)})),ace.define("ace/autocomplete/popup",["require","exports","module","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom","ace/config","ace/lib/useragent"],(function(e,t,i){var n=e("../virtual_renderer").VirtualRenderer,o=e("../editor").Editor,r=e("../range").Range,a=e("../lib/event"),s=e("../lib/lang"),l=e("../lib/dom"),c=e("../config").nls,p=e("./../lib/useragent"),d=function(e){return"suggest-aria-id:".concat(e)},u=p.isSafari?"menu":"listbox",h=p.isSafari?"menuitem":"option",m=p.isSafari?"aria-current":"aria-selected",f=function(e){var t=new n(e);t.$maxLines=4;var i=new o(t);return i.setHighlightActiveLine(!1),i.setShowPrintMargin(!1),i.renderer.setShowGutter(!1),i.renderer.setHighlightGutterLine(!1),i.$mouseHandler.$focusTimeout=0,i.$highlightTagPending=!0,i},g=function(e){var t=l.createElement("div"),i=f(t);e&&e.appendChild(t),t.style.display="none",i.renderer.content.style.cursor="default",i.renderer.setStyle("ace_autocomplete"),i.renderer.$textLayer.element.setAttribute("role",u),i.renderer.$textLayer.element.setAttribute("aria-roledescription",c("autocomplete.popup.aria-roledescription","Autocomplete suggestions")),i.renderer.$textLayer.element.setAttribute("aria-label",c("autocomplete.popup.aria-label","Autocomplete suggestions")),i.renderer.textarea.setAttribute("aria-hidden","true"),i.setOption("displayIndentGuides",!1),i.setOption("dragDelay",150);var n,o=function(){};i.focus=o,i.$isFocused=!0,i.renderer.$cursorLayer.restartTimer=o,i.renderer.$cursorLayer.element.style.opacity="0",i.renderer.$maxLines=8,i.renderer.$keepTextAreaAtCursor=!1,i.setHighlightActiveLine(!1),i.session.highlight(""),i.session.$searchHighlight.clazz="ace_highlight-marker",i.on("mousedown",(function(e){var t=e.getDocumentPosition();i.selection.moveToPosition(t),g.start.row=g.end.row=t.row,e.stop()}));var p=new r(-1,0,-1,Infinity),g=new r(-1,0,-1,Infinity);g.id=i.session.addMarker(g,"ace_active-line","fullLine"),i.setSelectOnHover=function(e){e?p.id&&(i.session.removeMarker(p.id),p.id=null):p.id=i.session.addMarker(p,"ace_line-hover","fullLine")},i.setSelectOnHover(!1),i.on("mousemove",(function(e){if(n){if(n.x!=e.x||n.y!=e.y){(n=e).scrollTop=i.renderer.scrollTop,i.isMouseOver=!0;var t=n.getDocumentPosition().row;p.start.row!=t&&(p.id||i.setRow(t),v(t))}}else n=e})),i.renderer.on("beforeRender",(function(){if(n&&-1!=p.start.row){n.$pos=null;var e=n.getDocumentPosition().row;p.id||i.setRow(e),v(e,!0)}})),i.renderer.on("afterRender",(function(){for(var e=i.renderer.$textLayer,t=e.config.firstRow,n=e.config.lastRow;t<=n;t++){var o=e.element.childNodes[t-e.config.firstRow];o.setAttribute("role",h),o.setAttribute("aria-roledescription",c("autocomplete.popup.item.aria-roledescription","item")),o.setAttribute("aria-setsize",i.data.length),o.setAttribute("aria-describedby","doc-tooltip"),o.setAttribute("aria-posinset",t+1);var r=i.getData(t);if(r){var a="".concat(r.caption||r.value).concat(r.meta?", ".concat(r.meta):"");o.setAttribute("aria-label",a)}o.querySelectorAll(".ace_completion-highlight").forEach((function(e){e.setAttribute("role","mark")}))}})),i.renderer.on("afterRender",(function(){var e=i.getRow(),t=i.renderer.$textLayer,n=t.element.childNodes[e-t.config.firstRow],o=document.activeElement;if(n!==i.selectedNode&&i.selectedNode&&(l.removeCssClass(i.selectedNode,"ace_selected"),i.selectedNode.removeAttribute(m),i.selectedNode.removeAttribute("id")),o.removeAttribute("aria-activedescendant"),i.selectedNode=n,n){var r=d(e);l.addCssClass(n,"ace_selected"),n.id=r,t.element.setAttribute("aria-activedescendant",r),o.setAttribute("aria-activedescendant",r),n.setAttribute(m,"true")}}));var b=function(){v(-1)},v=function(e,t){e!==p.start.row&&(p.start.row=p.end.row=e,t||i.session._emit("changeBackMarker"),i._emit("changeHoverMarker"))};i.getHoveredRow=function(){return p.start.row},a.addListener(i.container,"mouseout",(function(){i.isMouseOver=!1,b()})),i.on("hide",b),i.on("changeSelection",b),i.session.doc.getLength=function(){return i.data.length},i.session.doc.getLine=function(e){var t=i.data[e];return"string"==typeof t?t:t&&t.value||""};var _=i.session.bgTokenizer;return _.$tokenizeRow=function(e){var t=i.data[e],n=[];if(!t)return n;"string"==typeof t&&(t={value:t});var o=t.caption||t.value||t.name;function r(e,i){e&&n.push({type:(t.className||"")+(i||""),value:e})}for(var a=o.toLowerCase(),s=(i.filterText||"").toLowerCase(),l=0,c=0,p=0;p<=s.length;p++)if(p!=c&&(t.matchMask&1<<p||p==s.length)){var d=s.slice(c,p);c=p;var u=a.indexOf(d,l);if(-1==u)continue;r(o.slice(l,u),""),l=u+d.length,r(o.slice(u,l),"completion-highlight")}return r(o.slice(l,o.length),""),n.push({type:"completion-spacer",value:" "}),t.meta&&n.push({type:"completion-meta",value:t.meta}),t.message&&n.push({type:"completion-message",value:t.message}),n},_.$updateOnChange=o,_.start=o,i.session.$computeWidth=function(){return this.screenWidth=0},i.isOpen=!1,i.isTopdown=!1,i.autoSelect=!0,i.filterText="",i.isMouseOver=!1,i.data=[],i.setData=function(e,t){i.filterText=t||"",i.setValue(s.stringRepeat("\n",e.length),-1),i.data=e||[],i.setRow(0)},i.getData=function(e){return i.data[e]},i.getRow=function(){return g.start.row},i.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length-1,e)),g.start.row!=e&&(i.selection.clearSelection(),g.start.row=g.end.row=e||0,i.session._emit("changeBackMarker"),i.moveCursorTo(e||0,0),i.isOpen&&i._signal("select"))},i.on("changeSelection",(function(){i.isOpen&&i.setRow(i.selection.lead.row),i.renderer.scrollCursorIntoView()})),i.hide=function(){this.container.style.display="none",i.anchorPos=null,i.anchor=null,i.isOpen&&(i.isOpen=!1,this._signal("hide"))},i.tryShow=function(e,t,o,r){if(!r&&i.isOpen&&i.anchorPos&&i.anchor&&i.anchorPos.top===e.top&&i.anchorPos.left===e.left&&i.anchor===o)return!0;var a=this.container,s=this.renderer.scrollBar.width||10,l=window.innerHeight-s,c=window.innerWidth-s,p=this.renderer,d=p.$maxLines*t*1.4,u={top:0,bottom:0,left:0},h=l-e.top-3*this.$borderSize-t,m=e.top-3*this.$borderSize;o||(o=m<=h||h>=d?"bottom":"top"),"top"===o?(u.bottom=e.top-this.$borderSize,u.top=u.bottom-d):"bottom"===o&&(u.top=e.top+t+this.$borderSize,u.bottom=u.top+d);var f=u.top>=0&&u.bottom<=l;if(!r&&!f)return!1;p.$maxPixelHeight=f?null:"top"===o?m:h,"top"===o?(a.style.top="",a.style.bottom=l+s-u.bottom+"px",i.isTopdown=!1):(a.style.top=u.top+"px",a.style.bottom="",i.isTopdown=!0),a.style.display="";var g=e.left;return g+a.offsetWidth>c&&(g=c-a.offsetWidth),a.style.left=g+"px",a.style.right="",i.isOpen||(i.isOpen=!0,this._signal("show"),n=null),i.anchorPos=e,i.anchor=o,!0},i.show=function(e,t,i){this.tryShow(e,t,i?"bottom":void 0,!0)},i.goTo=function(e){var t=this.getRow(),i=this.session.getLength()-1;switch(e){case"up":t=t<=0?i:t-1;break;case"down":t=t>=i?-1:t+1;break;case"start":t=0;break;case"end":t=i}this.setRow(t)},i.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},i.$imageSize=0,i.$borderSize=1,i};l.importCssString('\n.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\n    background-color: #CAD6FA;\n    z-index: 1;\n}\n.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\n    background-color: #3a674e;\n}\n.ace_editor.ace_autocomplete .ace_line-hover {\n    border: 1px solid #abbffe;\n    margin-top: -1px;\n    background: rgba(233,233,253,0.4);\n    position: absolute;\n    z-index: 2;\n}\n.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {\n    border: 1px solid rgba(109, 150, 13, 0.8);\n    background: rgba(58, 103, 78, 0.62);\n}\n.ace_completion-meta {\n    opacity: 0.5;\n    margin-left: 0.9em;\n}\n.ace_completion-message {\n    margin-left: 0.9em;\n    color: blue;\n}\n.ace_editor.ace_autocomplete .ace_completion-highlight{\n    color: #2d69c7;\n}\n.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{\n    color: #93ca12;\n}\n.ace_editor.ace_autocomplete {\n    width: 300px;\n    z-index: 200000;\n    border: 1px lightgray solid;\n    position: fixed;\n    box-shadow: 2px 3px 5px rgba(0,0,0,.2);\n    line-height: 1.4;\n    background: #fefefe;\n    color: #111;\n}\n.ace_dark.ace_editor.ace_autocomplete {\n    border: 1px #484747 solid;\n    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);\n    line-height: 1.4;\n    background: #25282c;\n    color: #c1c1c1;\n}\n.ace_autocomplete .ace_text-layer  {\n    width: calc(100% - 8px);\n}\n.ace_autocomplete .ace_line {\n    display: flex;\n    align-items: center;\n}\n.ace_autocomplete .ace_line > * {\n    min-width: 0;\n    flex: 0 0 auto;\n}\n.ace_autocomplete .ace_line .ace_ {\n    flex: 0 1 auto;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n.ace_autocomplete .ace_completion-spacer {\n    flex: 1;\n}\n.ace_autocomplete.ace_loading:after  {\n    content: "";\n    position: absolute;\n    top: 0px;\n    height: 2px;\n    width: 8%;\n    background: blue;\n    z-index: 100;\n    animation: ace_progress 3s infinite linear;\n    animation-delay: 300ms;\n    transform: translateX(-100%) scaleX(1);\n}\n@keyframes ace_progress {\n    0% { transform: translateX(-100%) scaleX(1) }\n    50% { transform: translateX(625%) scaleX(2) } \n    100% { transform: translateX(1500%) scaleX(3) } \n}\n@media (prefers-reduced-motion) {\n    .ace_autocomplete.ace_loading:after {\n        transform: translateX(625%) scaleX(2);\n        animation: none;\n     }\n}\n',"autocompletion.css",!1),t.AcePopup=g,t.$singleLineEditor=f,t.getAriaId=d})),ace.define("ace/autocomplete/inline_screenreader",["require","exports","module"],(function(e,t,i){var n=function(){function e(e){this.editor=e,this.screenReaderDiv=document.createElement("div"),this.screenReaderDiv.classList.add("ace_screenreader-only"),this.editor.container.appendChild(this.screenReaderDiv)}return e.prototype.setScreenReaderContent=function(e){for(!this.popup&&this.editor.completer&&this.editor.completer.popup&&(this.popup=this.editor.completer.popup,this.popup.renderer.on("afterRender",function(){var e=this.popup.getRow(),t=this.popup.renderer.$textLayer,i=t.element.childNodes[e-t.config.firstRow];if(i){for(var n="doc-tooltip ",o=0;o<this._lines.length;o++)n+="ace-inline-screenreader-line-".concat(o," ");i.setAttribute("aria-describedby",n)}}.bind(this)));this.screenReaderDiv.firstChild;)this.screenReaderDiv.removeChild(this.screenReaderDiv.firstChild);this._lines=e.split(/\r\n|\r|\n/);var t=this.createCodeBlock();this.screenReaderDiv.appendChild(t)},e.prototype.destroy=function(){this.screenReaderDiv.remove()},e.prototype.createCodeBlock=function(){var e=document.createElement("pre");e.setAttribute("id","ace-inline-screenreader");for(var t=0;t<this._lines.length;t++){var i=document.createElement("code");i.setAttribute("id","ace-inline-screenreader-line-".concat(t));var n=document.createTextNode(this._lines[t]);i.appendChild(n),e.appendChild(i)}return e},e}();t.AceInlineScreenReader=n})),ace.define("ace/autocomplete/inline",["require","exports","module","ace/snippets","ace/autocomplete/inline_screenreader"],(function(e,t,i){var n=e("../snippets").snippetManager,o=e("./inline_screenreader").AceInlineScreenReader,r=function(){function e(){this.editor=null}return e.prototype.show=function(e,t,i){if(i=i||"",e&&this.editor&&this.editor!==e&&(this.hide(),this.editor=null,this.inlineScreenReader=null),!e||!t)return!1;this.inlineScreenReader||(this.inlineScreenReader=new o(e));var r=t.snippet?n.getDisplayTextForSnippet(e,t.snippet):t.value;return!(t.hideInlinePreview||!r||!r.startsWith(i))&&(this.editor=e,this.inlineScreenReader.setScreenReaderContent(r),""===(r=r.slice(i.length))?e.removeGhostText():e.setGhostText(r),!0)},e.prototype.isOpen=function(){return!!this.editor&&!!this.editor.renderer.$ghostText},e.prototype.hide=function(){return!!this.editor&&(this.editor.removeGhostText(),!0)},e.prototype.destroy=function(){this.hide(),this.editor=null,this.inlineScreenReader&&(this.inlineScreenReader.destroy(),this.inlineScreenReader=null)},e}();t.AceInline=r})),ace.define("ace/autocomplete/util",["require","exports","module"],(function(e,t,i){t.parForEach=function(e,t,i){var n=0,o=e.length;0===o&&i();for(var r=0;r<o;r++)t(e[r],(function(e,t){++n===o&&i(e,t)}))};var n=/[a-zA-Z_0-9\$\-\u00A2-\u2000\u2070-\uFFFF]/;t.retrievePrecedingIdentifier=function(e,t,i){i=i||n;for(var o=[],r=t-1;r>=0&&i.test(e[r]);r--)o.push(e[r]);return o.reverse().join("")},t.retrieveFollowingIdentifier=function(e,t,i){i=i||n;for(var o=[],r=t;r<e.length&&i.test(e[r]);r++)o.push(e[r]);return o},t.getCompletionPrefix=function(e){var t,i=e.getCursorPosition(),n=e.session.getLine(i.row);return e.completers.forEach(function(e){e.identifierRegexps&&e.identifierRegexps.forEach(function(e){!t&&e&&(t=this.retrievePrecedingIdentifier(n,i.column,e))}.bind(this))}.bind(this)),t||this.retrievePrecedingIdentifier(n,i.column)},t.triggerAutocomplete=function(e,t){t=null==t?e.session.getPrecedingCharacter():t;return e.completers.some((function(e){if(e.triggerCharacters&&Array.isArray(e.triggerCharacters))return e.triggerCharacters.includes(t)}))}})),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/inline","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/lang","ace/lib/dom","ace/snippets","ace/config","ace/lib/event","ace/lib/scroll"],(function(e,t,i){var n=e("./keyboard/hash_handler").HashHandler,o=e("./autocomplete/popup").AcePopup,r=e("./autocomplete/inline").AceInline,a=e("./autocomplete/popup").getAriaId,s=e("./autocomplete/util"),l=e("./lib/lang"),c=e("./lib/dom"),p=e("./snippets").snippetManager,d=e("./config"),u=e("./lib/event"),h=e("./lib/scroll").preventParentScroll,m=function(e,t){t.completer&&t.completer.destroy()},f=function(){function e(){this.autoInsert=!1,this.autoSelect=!0,this.autoShown=!1,this.exactMatch=!1,this.inlineEnabled=!1,this.keyboardHandler=new n,this.keyboardHandler.bindKeys(this.commands),this.parentNode=null,this.setSelectOnHover=!1,this.hasSeen=new Set,this.showLoadingState=!1,this.stickySelectionDelay=500,this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.onLayoutChange=this.onLayoutChange.bind(this),this.changeTimer=l.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=l.delayedCall(this.updateDocTooltip.bind(this),50),this.popupTimer=l.delayedCall(this.$updatePopupPosition.bind(this),50),this.stickySelectionTimer=l.delayedCall(function(){this.stickySelection=!0}.bind(this),this.stickySelectionDelay),this.$firstOpenTimer=l.delayedCall(function(){var t=this.completionProvider&&this.completionProvider.initialPosition;this.autoShown||this.popup&&this.popup.isOpen||!t||0===this.editor.completers.length||(this.completions=new b(e.completionsForLoading),this.openPopup(this.editor,t.prefix,!1),this.popup.renderer.setStyle("ace_loading",!0))}.bind(this),this.stickySelectionDelay)}return Object.defineProperty(e,"completionsForLoading",{get:function(){return[{caption:d.nls("autocomplete.loading","Loading..."),value:""}]},enumerable:!1,configurable:!0}),e.prototype.$init=function(){return this.popup=new o(this.parentNode||document.body||document.documentElement),this.popup.on("click",function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.$onPopupShow.bind(this)),this.popup.on("hide",this.$onHidePopup.bind(this)),this.popup.on("select",this.$onPopupChange.bind(this)),u.addListener(this.popup.container,"mouseout",this.mouseOutListener.bind(this)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup.renderer.on("afterRender",this.$onPopupRender.bind(this)),this.popup},e.prototype.$initInline=function(){if(this.inlineEnabled&&!this.inlineRenderer)return this.inlineRenderer=new r,this.inlineRenderer},e.prototype.getPopup=function(){return this.popup||this.$init()},e.prototype.$onHidePopup=function(){this.inlineRenderer&&this.inlineRenderer.hide(),this.hideDocTooltip(),this.stickySelectionTimer.cancel(),this.popupTimer.cancel(),this.stickySelection=!1},e.prototype.$seen=function(e){!this.hasSeen.has(e)&&e&&e.completer&&e.completer.onSeen&&"function"==typeof e.completer.onSeen&&(e.completer.onSeen(this.editor,e),this.hasSeen.add(e))},e.prototype.$onPopupChange=function(e){if(this.inlineRenderer&&this.inlineEnabled){var t=e?null:this.popup.getData(this.popup.getRow());if(this.$updateGhostText(t),this.popup.isMouseOver&&this.setSelectOnHover)return void this.tooltipTimer.call(null,null);this.popupTimer.schedule(),this.tooltipTimer.schedule()}else this.popupTimer.call(null,null),this.tooltipTimer.call(null,null)},e.prototype.$updateGhostText=function(e){var t=this.base.row,i=this.base.column,n=this.editor.getCursorPosition().column,o=this.editor.session.getLine(t).slice(i,n);this.inlineRenderer.show(this.editor,e,o)?this.$seen(e):this.inlineRenderer.hide()},e.prototype.$onPopupRender=function(){var e=this.inlineRenderer&&this.inlineEnabled;if(this.completions&&this.completions.filtered&&this.completions.filtered.length>0)for(var t=this.popup.getFirstVisibleRow();t<=this.popup.getLastVisibleRow();t++){var i=this.popup.getData(t);!i||e&&!i.hideInlinePreview||this.$seen(i)}},e.prototype.$onPopupShow=function(e){this.$onPopupChange(e),this.stickySelection=!1,this.stickySelectionDelay>=0&&this.stickySelectionTimer.schedule(this.stickySelectionDelay)},e.prototype.observeLayoutChanges=function(){if(!this.$elements&&this.editor){window.addEventListener("resize",this.onLayoutChange,{passive:!0}),window.addEventListener("wheel",this.mousewheelListener);for(var e=this.editor.container.parentNode,t=[];e;)t.push(e),e.addEventListener("scroll",this.onLayoutChange,{passive:!0}),e=e.parentNode;this.$elements=t}},e.prototype.unObserveLayoutChanges=function(){var e=this;window.removeEventListener("resize",this.onLayoutChange,{passive:!0}),window.removeEventListener("wheel",this.mousewheelListener),this.$elements&&this.$elements.forEach((function(t){t.removeEventListener("scroll",e.onLayoutChange,{passive:!0})})),this.$elements=null},e.prototype.onLayoutChange=function(){if(!this.popup.isOpen)return this.unObserveLayoutChanges();this.$updatePopupPosition(),this.updateDocTooltip()},e.prototype.$updatePopupPosition=function(){var e=this.editor,t=e.renderer,i=t.layerConfig.lineHeight,n=t.$cursorLayer.getPixelPosition(this.base,!0);n.left-=this.popup.getTextLeftOffset();var o=e.container.getBoundingClientRect();n.top+=o.top-t.layerConfig.offset,n.left+=o.left-e.renderer.scrollLeft,n.left+=t.gutterWidth;var r={top:n.top,left:n.left};t.$ghostText&&t.$ghostTextWidget&&this.base.row===t.$ghostText.position.row&&(r.top+=t.$ghostTextWidget.el.offsetHeight);var a=e.container.getBoundingClientRect().bottom-i,s=a<r.top?{top:a,left:r.left}:r;this.popup.tryShow(s,i,"bottom")||this.popup.tryShow(n,i,"top")||this.popup.show(n,i)},e.prototype.openPopup=function(e,t,i){this.$firstOpenTimer.cancel(),this.popup||this.$init(),this.inlineEnabled&&!this.inlineRenderer&&this.$initInline(),this.popup.autoSelect=this.autoSelect,this.popup.setSelectOnHover(this.setSelectOnHover);var n,o=this.popup.getRow(),r=this.popup.data[o];this.popup.setData(this.completions.filtered,this.completions.filterText),this.editor.textInput.setAriaOptions&&this.editor.textInput.setAriaOptions({activeDescendant:a(this.popup.getRow()),inline:this.inlineEnabled}),e.keyBinding.addKeyboardHandler(this.keyboardHandler),this.stickySelection&&(n=this.popup.data.indexOf(r)),n&&-1!==n||(n=0),this.popup.setRow(this.autoSelect?n:-1),n===o&&r!==this.completions.filtered[n]&&this.$onPopupChange();var s=this.inlineRenderer&&this.inlineEnabled;if(n===o&&s){var l=this.popup.getData(this.popup.getRow());this.$updateGhostText(l)}i||(this.popup.setTheme(e.getTheme()),this.popup.setFontSize(e.getFontSize()),this.$updatePopupPosition(),this.tooltipNode&&this.updateDocTooltip()),this.changeTimer.cancel(),this.observeLayoutChanges()},e.prototype.detach=function(){this.editor&&(this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener)),this.$firstOpenTimer.cancel(),this.changeTimer.cancel(),this.hideDocTooltip(),this.completionProvider&&this.completionProvider.detach(),this.popup&&this.popup.isOpen&&this.popup.hide(),this.popup&&this.popup.renderer&&this.popup.renderer.off("afterRender",this.$onPopupRender),this.base&&this.base.detach(),this.activated=!1,this.completionProvider=this.completions=this.base=null,this.unObserveLayoutChanges()},e.prototype.changeListener=function(e){var t=this.editor.selection.lead;(t.row!=this.base.row||t.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},e.prototype.blurListener=function(e){var t=document.activeElement,i=this.editor.textInput.getElement(),n=e.relatedTarget&&this.tooltipNode&&this.tooltipNode.contains(e.relatedTarget),o=this.popup&&this.popup.container;t==i||t.parentNode==o||n||t==this.tooltipNode||e.relatedTarget==i||this.detach()},e.prototype.mousedownListener=function(e){this.detach()},e.prototype.mousewheelListener=function(e){this.popup&&!this.popup.isMouseOver&&this.detach()},e.prototype.mouseOutListener=function(e){this.popup.isOpen&&this.$updatePopupPosition()},e.prototype.goTo=function(e){this.popup.goTo(e)},e.prototype.insertMatch=function(e,t){if(e||(e=this.popup.getData(this.popup.getRow())),!e)return!1;if(""===e.value)return this.detach();var i=this.completions,n=this.getCompletionProvider().insertMatch(this.editor,e,i.filterText,t);return this.completions==i&&this.detach(),n},e.prototype.showPopup=function(e,t){this.editor&&this.detach(),this.activated=!0,this.editor=e,e.completer!=this&&(e.completer&&e.completer.detach(),e.completer=this),e.on("changeSelection",this.changeListener),e.on("blur",this.blurListener),e.on("mousedown",this.mousedownListener),e.on("mousewheel",this.mousewheelListener),this.updateCompletions(!1,t)},e.prototype.getCompletionProvider=function(e){return this.completionProvider||(this.completionProvider=new g(e)),this.completionProvider},e.prototype.gatherCompletions=function(e,t){return this.getCompletionProvider().gatherCompletions(e,t)},e.prototype.updateCompletions=function(t,i){if(t&&this.base&&this.completions){var n=this.editor.getCursorPosition();if((r=this.editor.session.getTextRange({start:this.base,end:n}))==this.completions.filterText)return;return this.completions.setFilter(r),this.completions.filtered.length?1!=this.completions.filtered.length||this.completions.filtered[0].value!=r||this.completions.filtered[0].snippet?void this.openPopup(this.editor,r,t):this.detach():this.detach()}if(i&&i.matches){n=this.editor.getSelectionRange().start;return this.base=this.editor.session.doc.createAnchor(n.row,n.column),this.base.$insertRight=!0,this.completions=new b(i.matches),this.getCompletionProvider().completions=this.completions,this.openPopup(this.editor,"",t)}var o=this.editor.getSession(),r=(n=this.editor.getCursorPosition(),s.getCompletionPrefix(this.editor));this.base=o.doc.createAnchor(n.row,n.column-r.length),this.base.$insertRight=!0;var a={exactMatch:this.exactMatch,ignoreCaption:this.ignoreCaption};this.getCompletionProvider({prefix:r,pos:n}).provideCompletions(this.editor,a,function(i,n,o){var r=n.filtered,a=s.getCompletionPrefix(this.editor);if(this.$firstOpenTimer.cancel(),o){if(!r.length){var l=!this.autoShown&&this.emptyMessage;if("function"==typeof l&&(l=this.emptyMessage(a)),l){var c=[{caption:l,value:""}];return this.completions=new b(c),this.openPopup(this.editor,a,t),this.popup.renderer.setStyle("ace_loading",!1),void this.popup.renderer.setStyle("ace_empty-message",!0)}return this.detach()}if(1==r.length&&r[0].value==a&&!r[0].snippet)return this.detach();if(this.autoInsert&&!this.autoShown&&1==r.length)return this.insertMatch(r[0])}this.completions=!o&&this.showLoadingState?new b(e.completionsForLoading.concat(r),n.filterText):n,this.openPopup(this.editor,a,t),this.popup.renderer.setStyle("ace_empty-message",!1),this.popup.renderer.setStyle("ace_loading",!o)}.bind(this)),!this.showLoadingState||this.autoShown||this.popup&&this.popup.isOpen||this.$firstOpenTimer.delay(this.stickySelectionDelay/2)},e.prototype.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},e.prototype.updateDocTooltip=function(){var e=this.popup,t=this.completions&&this.completions.filtered,i=t&&(t[e.getHoveredRow()]||t[e.getRow()]),n=null;if(!i||!this.editor||!this.popup.isOpen)return this.hideDocTooltip();for(var o=this.editor.completers.length,r=0;r<o;r++){var a=this.editor.completers[r];if(a.getDocTooltip&&i.completerId===a.id){n=a.getDocTooltip(i);break}}if(n||"string"==typeof i||(n=i),"string"==typeof n&&(n={docText:n}),!n||!n.docHTML&&!n.docText)return this.hideDocTooltip();this.showDocTooltip(n)},e.prototype.showDocTooltip=function(e){this.tooltipNode||(this.tooltipNode=c.createElement("div"),this.tooltipNode.style.margin="0",this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.style.overscrollBehavior="contain",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this),this.tooltipNode.id="doc-tooltip",this.tooltipNode.setAttribute("role","tooltip"),this.tooltipNode.addEventListener("wheel",h));var t=this.editor.renderer.theme;this.tooltipNode.className="ace_tooltip ace_doc-tooltip "+(t.isDark?"ace_dark ":"")+(t.cssClass||"");var i=this.tooltipNode;e.docHTML?i.innerHTML=e.docHTML:e.docText&&(i.textContent=e.docText),i.parentNode||this.popup.container.appendChild(this.tooltipNode);var n=this.popup,o=n.container.getBoundingClientRect(),r=400,a=300,s=n.renderer.scrollBar.width||10,l=o.left,p=window.innerWidth-o.right-s,d=n.isTopdown?o.top:window.innerHeight-s-o.bottom,u=[Math.min(p/r,1),Math.min(l/r,1),Math.min(d/a*.9)],m=Math.max.apply(Math,u),f=i.style;f.display="block",m==u[0]?(f.left=o.right+1+"px",f.right="",f.maxWidth=r*m+"px",f.top=o.top+"px",f.bottom="",f.maxHeight=Math.min(window.innerHeight-s-o.top,a)+"px"):m==u[1]?(f.right=window.innerWidth-o.left+"px",f.left="",f.maxWidth=r*m+"px",f.top=o.top+"px",f.bottom="",f.maxHeight=Math.min(window.innerHeight-s-o.top,a)+"px"):m==u[2]&&(f.left=window.innerWidth-o.left+"px",f.maxWidth=Math.min(r,window.innerWidth)+"px",n.isTopdown?(f.top=o.bottom+"px",f.left=o.left+"px",f.right="",f.bottom="",f.maxHeight=Math.min(window.innerHeight-s-o.bottom,a)+"px"):(f.top=n.container.offsetTop-i.offsetHeight+"px",f.left=o.left+"px",f.right="",f.bottom="",f.maxHeight=Math.min(n.container.offsetTop,a)+"px"))},e.prototype.hideDocTooltip=function(){if(this.tooltipTimer.cancel(),this.tooltipNode){var e=this.tooltipNode;this.editor.isFocused()||document.activeElement!=e||this.editor.focus(),this.tooltipNode=null,e.parentNode&&e.parentNode.removeChild(e)}},e.prototype.onTooltipClick=function(e){for(var t=e.target;t&&t!=this.tooltipNode;){if("A"==t.nodeName&&t.href){t.rel="noreferrer",t.target="_blank";break}t=t.parentNode}},e.prototype.destroy=function(){if(this.detach(),this.popup){this.popup.destroy();var e=this.popup.container;e&&e.parentNode&&e.parentNode.removeChild(e)}this.editor&&this.editor.completer==this&&(this.editor.off("destroy",m),this.editor.completer=null),this.inlineRenderer=this.popup=this.editor=null},e.for=function(t){return t.completer instanceof e||(t.completer&&(t.completer.destroy(),t.completer=null),d.get("sharedPopups")?(e.$sharedInstance||(e.$sharedInstance=new e),t.completer=e.$sharedInstance):(t.completer=new e,t.once("destroy",m))),t.completer},e}();f.prototype.commands={Up:function(e){e.completer.goTo("up")},Down:function(e){e.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(e){e.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(e){e.completer.goTo("end")},Esc:function(e){e.completer.detach()},Return:function(e){return e.completer.insertMatch()},"Shift-Return":function(e){e.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(e){var t=e.completer.insertMatch();if(t||e.tabstopManager)return t;e.completer.goTo("down")},Backspace:function(e){e.execCommand("backspace"),!s.getCompletionPrefix(e)&&e.completer&&e.completer.detach()},PageUp:function(e){e.completer.popup.gotoPageUp()},PageDown:function(e){e.completer.popup.gotoPageDown()}},f.startCommand={name:"startAutocomplete",exec:function(e,t){var i=f.for(e);i.autoInsert=!1,i.autoSelect=!0,i.autoShown=!1,i.showPopup(e,t),i.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var g=function(){function e(e){this.initialPosition=e,this.active=!0}return e.prototype.insertByIndex=function(e,t,i){return!(!this.completions||!this.completions.filtered)&&this.insertMatch(e,this.completions.filtered[t],i)},e.prototype.insertMatch=function(e,t,i){if(!t)return!1;if(e.startOperation({command:{name:"insertMatch"}}),t.completer&&t.completer.insertMatch)t.completer.insertMatch(e,t);else{if(!this.completions)return!1;var n=this.completions.filterText.length,o=0;if(t.range&&t.range.start.row===t.range.end.row&&(n-=this.initialPosition.prefix.length,n+=this.initialPosition.pos.column-t.range.start.column,o+=t.range.end.column-this.initialPosition.pos.column),n||o){var r;r=e.selection.getAllRanges?e.selection.getAllRanges():[e.getSelectionRange()];for(var a,s=0;a=r[s];s++)a.start.column-=n,a.end.column+=o,e.session.remove(a)}t.snippet?p.insertSnippet(e,t.snippet):this.$insertString(e,t),t.completer&&t.completer.onInsert&&"function"==typeof t.completer.onInsert&&t.completer.onInsert(e,t),t.command&&"startAutocomplete"===t.command&&e.execCommand(t.command)}return e.endOperation(),!0},e.prototype.$insertString=function(e,t){var i=t.value||t;e.execCommand("insertstring",i)},e.prototype.gatherCompletions=function(e,t){var i=e.getSession(),n=e.getCursorPosition(),o=s.getCompletionPrefix(e),r=[];this.completers=e.completers;var a=e.completers.length;return e.completers.forEach((function(l,c){l.getCompletions(e,i,n,o,(function(i,n){l.hideInlinePreview&&(n=n.map((function(e){return Object.assign(e,{hideInlinePreview:l.hideInlinePreview})}))),!i&&n&&(r=r.concat(n)),t(null,{prefix:s.getCompletionPrefix(e),matches:r,finished:0==--a})}))})),!0},e.prototype.provideCompletions=function(e,t,i){var n=function(e){var n=e.prefix,o=e.matches;this.completions=new b(o),t.exactMatch&&(this.completions.exactMatch=!0),t.ignoreCaption&&(this.completions.ignoreCaption=!0),this.completions.setFilter(n),(e.finished||this.completions.filtered.length)&&i(null,this.completions,e.finished)}.bind(this),o=!0,r=null;if(this.gatherCompletions(e,function(e,t){this.active&&(e&&(i(e,[],!0),this.detach()),0===t.prefix.indexOf(t.prefix)&&(o?r=t:n(t)))}.bind(this)),o=!1,r){var a=r;r=null,n(a)}},e.prototype.detach=function(){this.active=!1,this.completers&&this.completers.forEach((function(e){"function"==typeof e.cancel&&e.cancel()}))},e}(),b=function(){function e(e,t){this.all=e,this.filtered=e,this.filterText=t||"",this.exactMatch=!1,this.ignoreCaption=!1}return e.prototype.setFilter=function(e){if(e.length>this.filterText&&0===e.lastIndexOf(this.filterText,0))var t=this.filtered;else t=this.all;this.filterText=e,t=(t=this.filterCompletions(t,this.filterText)).sort((function(e,t){return t.exactMatch-e.exactMatch||t.$score-e.$score||(e.caption||e.value).localeCompare(t.caption||t.value)}));var i=null;t=t.filter((function(e){var t=e.snippet||e.caption||e.value;return t!==i&&(i=t,!0)})),this.filtered=t},e.prototype.filterCompletions=function(e,t){var i=[],n=t.toUpperCase(),o=t.toLowerCase();e:for(var r,a=0;r=e[a];a++)if(r.skipFilter)r.$score=r.score,i.push(r);else{var s=!this.ignoreCaption&&r.caption||r.value||r.snippet;if(s){var l,c,p=-1,d=0,u=0;if(this.exactMatch){if(t!==s.substr(0,t.length))continue e}else{var h=s.toLowerCase().indexOf(o);if(h>-1)u=h;else for(var m=0;m<t.length;m++){var f=s.indexOf(o[m],p+1),g=s.indexOf(n[m],p+1);if((l=f>=0&&(g<0||f<g)?f:g)<0)continue e;(c=l-p-1)>0&&(-1===p&&(u+=10),u+=c,d|=1<<m),p=l}}r.matchMask=d,r.exactMatch=u?0:1,r.$score=(r.score||0)-u,i.push(r)}}return i},e}();t.Autocomplete=f,t.CompletionProvider=g,t.FilteredList=b})),ace.define("ace/marker_group",["require","exports","module"],(function(e,t,i){var n=function(){function e(e,t){t&&(this.markerType=t.markerType),this.markers=[],this.session=e,e.addDynamicMarker(this)}return e.prototype.getMarkerAtPosition=function(e){return this.markers.find((function(t){return t.range.contains(e.row,e.column)}))},e.prototype.markersComparator=function(e,t){return e.range.start.row-t.range.start.row},e.prototype.setMarkers=function(e){this.markers=e.sort(this.markersComparator).slice(0,this.MAX_MARKERS),this.session._signal("changeBackMarker")},e.prototype.update=function(e,t,i,n){if(this.markers&&this.markers.length)for(var o,r=n.firstRow,a=n.lastRow,s=0,l=0,c=0;c<this.markers.length;c++){var p=this.markers[c];if(!(p.range.end.row<r)&&!(p.range.start.row>a||(p.range.start.row===l?s++:(l=p.range.start.row,s=0),s>200))){var d=p.range.clipRows(r,a);if(d.start.row!==d.end.row||d.start.column!==d.end.column){var u=d.toScreenRange(i);u.isEmpty()?(o=i.getNextFoldLine(d.end.row,o))&&o.end.row>d.end.row&&(r=o.end.row):"fullLine"===this.markerType?t.drawFullLineMarker(e,u,p.className,n):u.isMultiLine()?"line"===this.markerType?t.drawMultiLineMarker(e,u,p.className,n):t.drawTextMarker(e,u,p.className,n):t.drawSingleLineMarker(e,u,p.className+" ace_br15",n)}}}},e}();n.prototype.MAX_MARKERS=1e4,t.MarkerGroup=n})),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],(function(e,t,i){var n=e("../range").Range,o=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;function r(e,t){var i=function(e,t){return e.getTextRange(n.fromPoints({row:0,column:0},t)).split(o).length-1}(e,t),r=e.getValue().split(o),a=Object.create(null),s=r[i];return r.forEach((function(e,t){if(e&&e!==s){var n=Math.abs(i-t),o=r.length-n;a[e]?a[e]=Math.max(o,a[e]):a[e]=o}})),a}t.getCompletions=function(e,t,i,n,o){var a=r(t,i);o(null,Object.keys(a).map((function(e){return{caption:e,value:e,score:a[e],meta:"local"}})))}})),ace.define("ace/ext/language_tools",["require","exports","module","ace/snippets","ace/autocomplete","ace/config","ace/lib/lang","ace/autocomplete/util","ace/marker_group","ace/autocomplete/text_completer","ace/editor","ace/config"],(function(e,t,i){var n=e("../snippets").snippetManager,o=e("../autocomplete").Autocomplete,r=e("../config"),a=e("../lib/lang"),s=e("../autocomplete/util"),l=e("../marker_group").MarkerGroup,c=e("../autocomplete/text_completer"),p={getCompletions:function(e,t,i,n,o){if(t.$mode.completer)return t.$mode.completer.getCompletions(e,t,i,n,o);var r=e.session.getState(i.row),a=t.$mode.getCompletions(r,t,i,n);o(null,a=a.map((function(e){return e.completerId=p.id,e})))},id:"keywordCompleter"},d={getCompletions:function(e,t,i,o,r){var a=[],s=t.getTokenAt(i.row,i.column);s&&s.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?a.push("html-tag"):a=n.getActiveScopes(e);var l=n.snippetMap,c=[];a.forEach((function(e){for(var t=l[e]||[],i=t.length;i--;){var n=t[i],o=n.name||n.tabTrigger;o&&c.push({caption:o,snippet:n.content,meta:n.tabTrigger&&!n.name?n.tabTrigger+"⇥ ":"snippet",completerId:d.id})}}),this),r(null,c)},getDocTooltip:function(e){var t,i;e.snippet&&!e.docHTML&&(e.docHTML=["<b>",a.escapeHTML(e.caption),"</b>","<hr></hr>",a.escapeHTML((t=e.snippet,i={},t.replace(/\${(\d+)(:(.*?))?}/g,(function(e,t,n,o){return i[t]=o||""})).replace(/\$(\d+?)/g,(function(e,t){return i[t]}))))].join(""))},id:"snippetCompleter"},u=[d,c,p];t.setCompleters=function(e){u.length=0,e&&u.push.apply(u,e)},t.addCompleter=function(e){u.push(e)},t.textCompleter=c,t.keyWordCompleter=p,t.snippetCompleter=d;var h,m={name:"expandSnippet",exec:function(e){return n.expandWithTab(e)},bindKey:"Tab"},f=function(e,t){g(t.session.$mode)},g=function(e){"string"==typeof e&&(e=r.$modes[e]),e&&(n.files||(n.files={}),b(e.$id,e.snippetFileId),e.modes&&e.modes.forEach(g))},b=function(e,t){t&&e&&!n.files[e]&&(n.files[e]={},r.loadModule(t,(function(t){t&&(n.files[e]=t,!t.snippets&&t.snippetText&&(t.snippets=n.parseSnippetFile(t.snippetText)),n.register(t.snippets||[],t.scope),t.includeScopes&&(n.snippetMap[t.scope].includeScopes=t.includeScopes,t.includeScopes.forEach((function(e){g("ace/mode/"+e)}))))})))},v=function(e){var t=e.editor,i=t.completer&&t.completer.activated;if("backspace"===e.command.name)i&&!s.getCompletionPrefix(t)&&t.completer.detach();else if("insertstring"===e.command.name&&!i){h=e;var n=e.editor.$liveAutocompletionDelay;n?_.delay(n):y(e)}},_=a.delayedCall((function(){y(h)}),0),y=function(e){var t=e.editor,i=s.getCompletionPrefix(t),n=e.args,r=s.triggerAutocomplete(t,n);if(i&&i.length>=t.$liveAutocompletionThreshold||r){var a=o.for(t);a.autoShown=!0,a.showPopup(t)}},x=e("../editor").Editor;e("../config").defineOptions(x.prototype,"editor",{enableBasicAutocompletion:{set:function(e){e?(o.for(this),this.completers||(this.completers=Array.isArray(e)?e:u),this.commands.addCommand(o.startCommand)):this.commands.removeCommand(o.startCommand)},value:!1},enableLiveAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:u),this.commands.on("afterExec",v)):this.commands.off("afterExec",v)},value:!1},liveAutocompletionDelay:{initialValue:0},liveAutocompletionThreshold:{initialValue:0},enableSnippets:{set:function(e){e?(this.commands.addCommand(m),this.on("changeMode",f),f(0,this)):(this.commands.removeCommand(m),this.off("changeMode",f))},value:!1}}),t.MarkerGroup=l})),ace.require(["ace/ext/language_tools"],(function(t){e&&(e.exports=t)}))}({exports:{}});const Le={class:"search-box"},Pe={style:{"max-width":"calc(100% - 20px)"},class:"truncate inline-block"},Ee={class:"flex items-center gap-2 cursor-pointer"},$e={class:"text-primary"},Ae=(e=>(B("data-v-fb929623"),e=e(),z(),e))((()=>S("span",null," SQL 预览 ",-1))),De=y({__name:"log",props:{sid:{type:[String,Number],default:""}},setup(e){const t=e,i=a(null),n={slowLog:{title:"统计分析",block:2,api:ie.log.postLogStatisticsList},logDetail:{title:"日志明细",block:1,api:ie.log.postLogDetailList}},o=s({tableData:[],initColumn:[],initButton:[],initTitleData:[],activeKey:"slowLog",searchParams:{database:"",type:"",date:[I().subtract(1,"days"),I()]},showSQL:!1,sqlText:""}),r=x((()=>{for(let e of o.initColumn){let{field:i}=e;switch(i){case"query_sample":e.slots={default:i};break;case"rds_instance":e.slots={default:i},e.visible=!t.sid}}return o.initColumn.filter((e=>e.oriTitle.block===n[o.activeKey].block))})),p=x((()=>{var e;return[{label:"全部",value:""},...Object.entries((null==(e=o.initTitleData)?void 0:e.type)||{}).map((([e,t])=>({label:t,value:e})))]})),b=e=>I(e).add(8,"hour").format("YYYY-MM-DDTHH:mm:ss+0800");A((async()=>{const{button:e,columns:t,title_data:i,order:n,title_field_search:r}=await X.setColumn({layer:5,tableType:"server"});o.initColumn=t.value||[],o.initButton=e.value||[],o.initTitleData=i.value||[],o.tableOrder=n.value||{},o.titleFieldSearch=r||{},await R()}));const v=async e=>{if(!i.value||!o.searchParams.date.length)return;i.value.tableLoading=!0;const{api:t}=n[o.activeKey],r=i.value.vxeGridRef.pagerConfig,a={database:o.searchParams.database,type:o.searchParams.type,start_time:b(o.searchParams.date[0]),end_time:b(o.searchParams.date[1]),limit:r.pageSize};try{const i=await _(t,a,r,e);y(i,r)}finally{i.value.tableLoading=!1,i.value.commitRequest()}},_=async(e,i,n,r)=>{var a,s;const l={...i};return"logDetail"===o.activeKey?r&&(l.line_num="next"===r?null==(a=o.tableData[o.tableData.length-1])?void 0:a.line_num:null==(s=o.tableData[0])?void 0:s.line_num,n.currentPage+="next"===r?1:-1):l.offset=(n.currentPage-1)*n.pageSize,await e(t.sid,l)},y=(e,t)=>{var i,n;if("logDetail"===o.activeKey)o.tableData=[...Array((t.currentPage-1)*t.pageSize),...e.data.slow_log_list],t.total=e.data.slow_log_list.length,t.slots={left:"pagerLeft"},t.layouts=se.VXE_PAGER_LAYOUTS.slice(7,8);else{const r=(t.currentPage-1)*t.pageSize;o.tableData=[...Array(r),...e.data.slow_log_list,...Array((null==(i=e.data)?void 0:i.total_count)-r-e.data.slow_log_list.length)],t.total=null==(n=e.data)?void 0:n.total_count,t.layouts=se.VXE_PAGER_LAYOUTS,t.slots=null}},R=async()=>{let e=i.value.vxeGridRef.pagerConfig;e.pageSizes=[10,...se.VXE_PAGE_SIZES_SERVER],e.currentPage=1,e.pageSize=10,e.total=0,await v()},M=({pageSize:e,currentPage:t})=>{let n=i.value.vxeGridRef.pagerConfig;n.pageSize=e,n.currentPage=t,v()};w((()=>t.sid),(()=>{R()})),w((()=>o.activeKey),(()=>{o.searchParams={database:"",type:"",date:[I().subtract(1,"days"),I()]},R()}));const L={fontSize:13,showPrintMargin:!1,showLineNumbers:!0,tabSize:4,highlightActiveLine:!1,readOnly:!0};return(e,t)=>{const a=l("vxe-button"),s=F,b=ce,_=pe,y=l("SearchOutlined"),x=P,w=ae,E=de,$=H;return c(),m(f,null,[(c(),m(f,null,g(n,((e,t)=>u(a,{key:t,size:"small",onClick:e=>h(o).activeKey=t},{default:d((()=>[S("span",{class:T(["ml-1",{"text-primary":h(o).activeKey===t}])},k(e.title),3)])),_:2},1032,["onClick"]))),64)),u(w,{ref_key:"tableRef",ref:i,data:h(o).tableData,columns:h(r),"show-search":!1,"no-sort":!0,onPageChange:M,onPageSizeChange:M},{toolSearchPrefix:d((()=>[S("div",Le,[u(s,{value:h(o).searchParams.database,"onUpdate:value":t[0]||(t[0]=e=>h(o).searchParams.database=e),placeholder:"请输入数据库名称",onBlur:t[1]||(t[1]=e=>R(null)),onKeyup:t[2]||(t[2]=N((e=>R(null)),["enter"]))},null,8,["value"]),u(b,{value:h(o).searchParams.type,"onUpdate:value":t[3]||(t[3]=e=>h(o).searchParams.type=e),placeholder:"请选择类型",options:h(p),onChange:t[4]||(t[4]=e=>R(null))},null,8,["value","options"]),u(_,{value:h(o).searchParams.date,"onUpdate:value":t[5]||(t[5]=e=>h(o).searchParams.date=e),"show-time":"","allow-clear":!1,format:"YYYY/MM/DD HH:mm:ss",onChange:t[6]||(t[6]=e=>R(null))},null,8,["value"])])])),query_sample:d((({row:e})=>[S("span",Pe,k(null==e?void 0:e.query_sample),1),u(x,{class:"inline absolute top-1/2 -translate-y-1/2",copyable:{tooltip:!1,text:null==e?void 0:e.query_sample,onCopy:()=>{return t=null==e?void 0:e.query_sample,o.showSQL=!0,void(o.sqlText=(i=t)?i.replace(/\b(SELECT|FROM|WHERE|GROUP BY|ORDER BY|HAVING|JOIN|LEFT JOIN|RIGHT JOIN|INNER JOIN|UNION|INSERT INTO|UPDATE|DELETE FROM)\b/gi,"\n$1").replace(/\b(AND|OR)\b/gi,"\n  $1").replace(/,/g,",\n  ").trim():"");var t,i}}},{copyableIcon:d((()=>[u(y)])),_:2},1032,["copyable"])])),pagerLeft:d((()=>[S("div",Ee,[h(i).vxeGridRef.pagerConfig.currentPage>1?(c(),m("span",{key:0,onClick:t[7]||(t[7]=e=>v("prev"))}," 上一页 ")):C("",!0),S("span",$e,k(h(i).vxeGridRef.pagerConfig.currentPage),1),S("span",{onClick:t[8]||(t[8]=e=>v("next"))}," 下一页 ")])])),_:1},8,["data","columns"]),u($,{open:h(o).showSQL,"onUpdate:open":t[10]||(t[10]=e=>h(o).showSQL=e),width:"50%",centered:"",footer:null},{title:d((()=>[Ae,u(x,{class:"inline",copyable:{tooltip:!1,text:h(o).sqlText}},null,8,["copyable"])])),default:d((()=>[u(E),u(h(le),{value:h(o).sqlText,"onUpdate:value":t[9]||(t[9]=e=>h(o).sqlText=e),lang:"sql",theme:"github",style:{height:"500px"},options:L},null,8,["value"])])),_:1},8,["open"])],64)}}},[["__scopeId","data-v-fb929623"]]),Oe=[{label:"近30分钟",value:[I().add(-30,"m"),I()]},{label:"近1小时",value:[I().add(-1,"h"),I()]},{label:"近2小时",value:[I().add(-2,"h"),I()]},{label:"近3小时",value:[I().add(-2,"h"),I()]},{label:"近12小时",value:[I().add(-12,"h"),I()]},{label:"近24小时",value:[I().add(-24,"h"),I()]},{label:"近7天",value:[I().add(-7,"d"),I()]},{label:"近30天",value:[I().add(-30,"d"),I()]}],Ie=[{value:"300",label:"5分钟"},{value:"1200",label:"20分钟"},{value:"3600",label:"1小时"},{value:"14400",label:"4小时"},{value:"86400",label:"24小时"}],Ne=[{value:["average","1"],label:"原始值"},{value:"average",label:"平均值"},{value:"sum",label:"求和"},{value:"max",label:"最大值"},{value:"min",label:"最小值"}],Fe={rds001_cpu_util:{label:"CPU使用率",unit:"%",tooltip:"该指标用于统计测量对象的CPU使用率，以百分比为单位。"},rds002_mem_util:{label:"内存使用率",unit:"%",tooltip:"该指标用于统计测量对象的内存使用率，以百分比为单位。"},rds003_iops:{label:"IOPS",unit:"次/秒",tooltip:"该指标用于统计当前实例，单位时间内系统处理的I/O请求数量（平均值）。"},rds004_bytes_in:{label:"网络输入吞吐量",unit:"字节/秒",tooltip:"该指标用于统计平均每秒从测量对象的所有网络适配器输入的流量，以字节/秒为单位。"},rds005_bytes_out:{label:"网络输出吞吐量",unit:"字节/秒",tooltip:"该指标用于统计平均每秒从测量对象的所有网络适配器输出的流量，以字节/秒为单位。"},rds006_conn_count:{label:"数据库总连接数",unit:"个",tooltip:"该指标用于统计试图连接到MySQL服务器的总连接数，以个为单位。"},rds007_conn_active_count:{label:"当前活跃连接数",unit:"个",tooltip:"该指标用于统计非sleep状态的连接，以个为单位。"},rds008_qps:{label:"QPS",unit:"次/秒",tooltip:"该指标用于统计SQL语句查询次数，含存储过程，以次/秒为单位。"},rds009_tps:{label:"TPS",unit:"次/秒",tooltip:"该指标用于统计事务执行次数，含提交和回退的次数，以次/秒为单位。"},rds010_innodb_buf_usage:{label:"缓冲池利用率",unit:"比率",tooltip:"该指标用于统计空闲的页与InnoDB缓存中缓冲池页面总数的比例，以比率为单位。"},rds011_innodb_buf_hit:{label:"缓冲池命中率",unit:"比率",tooltip:"该指标用于统计读命中与读请求数比例，以比率为单位。"},rds012_innodb_buf_dirty:{label:"缓冲池脏块率",unit:"比率",tooltip:"该指标用于统计InnoDB缓存中脏数据与InnoDB缓存中使用的页比例，以比率为单位。"},rds013_innodb_reads:{label:"InnoDB读取吞吐量",unit:"字节/秒",tooltip:"该指标用于统计Innodb平均每秒读字节数，以字节/秒为单位。"},rds014_innodb_writes:{label:"InnoDB写入吞吐量",unit:"字节/秒",tooltip:"该指标用于统计Innodb平均每秒写字节数，以字节/秒为单位。"},rds015_innodb_read_count:{label:"InnoDB文件读取频率",unit:"次/秒",tooltip:"该指标用于统计Innodb平均每秒从文件中读的次数，以次/秒为单位。"},rds016_innodb_write_count:{label:"InnoDB文件写入频率",unit:"次/秒",tooltip:"该指标用于统计Innodb平均每秒向文件中写的次数，以次/秒为单位。"},rds017_innodb_log_write_req_count:{label:"InnoDB日志写请求频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒的日志写请求数，以次/秒为单位。"},rds018_innodb_log_write_count:{label:"InnoDB日志物理写频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒向日志文件的物理写次数，以次/秒为单位。"},rds019_innodb_log_fsync_count:{label:"InnoDB日志fsync()写频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒向日志文件完成的fsync()写数量，以次/秒为单位。"},rds020_temp_tbl_rate:{label:"临时表创建速率",unit:"个/秒",tooltip:"该指标用于统计每秒在硬盘上创建的临时表数量，以个/秒为单位。"},rds021_myisam_buf_usage:{label:"Key Buffer利用率",unit:"比率",tooltip:"该指标用于统计MyISAM Key buffer的利用率，以比率为单位。"},rds022_myisam_buf_write_hit:{label:"Key Buffer写命中率",unit:"比率",tooltip:"该指标用于统计MyISAM Key buffer写命中率，以比率为单位。"},rds023_myisam_buf_read_hit:{label:"Key Buffer读命中率",unit:"比率",tooltip:"该指标用于统计MyISAM Key buffer读命中率，以比率为单位。"},rds024_myisam_disk_write_count:{label:"MyISAM硬盘写入频率",unit:"次/秒",tooltip:"该指标用于统计向磁盘写入索引的次数，以次/秒为单位。"},rds025_myisam_disk_read_count:{label:"MyISAM硬盘读取频率",unit:"次/秒",tooltip:"该指标用于统计从磁盘读取索引的次数，以次/秒为单位。"},rds026_myisam_buf_write_count:{label:"MyISAM缓冲池写入频率",unit:"次/秒",tooltip:"该指标用于统计向缓冲池写入索引的请求次数，以次/秒为单位。"},rds027_myisam_buf_read_count:{label:"MyISAM缓冲池读取频率",unit:"次/秒",tooltip:"该指标用于统计从缓冲池读取索引的请求次数，以次/秒为单位。"},rds028_comdml_del_count:{label:"Delete语句执行频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒Delete语句执行次数，以次/秒为单位。"},rds029_comdml_ins_count:{label:"Insert语句执行频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒Insert语句执行次数，以次/秒为单位。"},rds030_comdml_ins_sel_count:{label:"Insert_Select语句执行频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒Insert_Select语句执行次数，以次/秒为单位。"},rds031_comdml_rep_count:{label:"Replace语句执行频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒Replace语句执行次数，以次/秒为单位。"},rds032_comdml_rep_sel_count:{label:"Replace_Selection语句执行频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒Replace_Selection语句执行次数，以次/秒为单位。"},rds033_comdml_sel_count:{label:"Select语句执行频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒Select语句执行次数。"},rds034_comdml_upd_count:{label:"Update语句执行频率",unit:"次/秒",tooltip:"该指标用于统计平均每秒Update语句执行次数，以次/秒为单位。"},rds035_innodb_del_row_count:{label:"行删除速率",unit:"行/秒",tooltip:"该指标用于统计平均每秒从InnoDB表删除的行数，以行/秒为单位。"},rds036_innodb_ins_row_count:{label:"行插入速率",unit:"行/秒",tooltip:"该指标用于统计平均每秒向InnoDB表插入的行数，以行/秒为单位。"},rds037_innodb_read_row_count:{label:"行读取速率",unit:"行/秒",tooltip:"该指标用于统计平均每秒从InnoDB表读取的行数，以行/秒为单位。"},rds038_innodb_upd_row_count:{label:"行更新速率",unit:"行/秒",tooltip:"该指标用于统计平均每秒向InnoDB表更新的行数，以行/秒为单位。"},rds039_disk_util:{label:"磁盘利用率",unit:"%",tooltip:"该指标用于统计测量对象的磁盘利用率，以百分比为单位。"},rds047_disk_total_size:{label:"磁盘总大小",unit:"GB",tooltip:"该指标用于统计测量对象的磁盘总大小。"},rds048_disk_used_size:{label:"磁盘使用量",unit:"GB",tooltip:"该指标用于统计测量对象的磁盘使用大小。"},rds049_disk_read_throughput:{label:"硬盘读吞吐量",unit:"MB/s",tooltip:"该指标用于统计每秒从硬盘读取的字节数。"},rds050_disk_write_throughput:{label:"硬盘写吞吐量",unit:"MB/s",tooltip:"该指标用于统计每秒写入硬盘的字节数。"},rds072_conn_usage:{label:"连接数使用率",unit:"%",tooltip:"该指标用于统计当前已用的MySQL连接数占总连接数的百分比。"},rds173_replication_delay_avg:{label:"平均复制时延",unit:"秒",tooltip:"该指标为备库或只读与主库的平均延迟，对应seconds_behind_master。取60秒时间段的平均值。"},rds073_replication_delay:{label:"实时复制时延",unit:"秒",tooltip:"该指标为备库或只读与主库的实时延迟，对应seconds_behind_master。该值为实时值。"},rds074_slow_queries:{label:"慢日志个数统计",unit:"个",tooltip:'该指标用于展示每分钟MySQL产生慢日志的数量。即SQL执行完毕后耗时超过"long_query_time"阈值，才会被统计到慢日志的个数。'},rds075_avg_disk_ms_per_read:{label:"硬盘读耗时",unit:"毫秒",tooltip:"该指标用于统计某段时间平均每次读取磁盘所耗时间。"},rds076_avg_disk_ms_per_write:{label:"硬盘写耗时",unit:"毫秒",tooltip:"该指标用于统计某段时间平均写入磁盘所耗时间。"},rds077_vma:{label:"VMA数量",unit:"个",tooltip:"监控RDS进程的虚拟内存区域大小，以个为单位。"},rds078_threads:{label:"进程中线程数量",unit:"个",tooltip:"监控RDS进程中的线程数量，以个为单位。"},rds079_vm_hwm:{label:"进程的物理内存占用峰值",unit:"KB",tooltip:"监控RDS进程的物理内存占用峰值，以KB为单位。"},rds080_vm_peak:{label:"进程的虚拟内存占用峰值",unit:"KB",tooltip:"监控RDS进程的虚拟内存占用峰值，以KB为单位。"},rds081_vm_ioutils:{label:"磁盘I/O处于非空闲状态的时间%",unit:"%",tooltip:"该参数表示磁盘设备的繁忙程度，表示有I/O（非空闲）的时间百分比。因磁盘有并行处理多个I/O请求的能力，即使该指标达到100%也不意味着设备饱和。"},rds082_semi_sync_tx_avg_wait_time:{label:"事务平均等待时间",unit:"微秒",tooltip:"监控半同步复制模式下平均等待时间，以微秒为单位。"},sys_swap_usage:{label:"swap利用率",unit:"%",tooltip:"该指标用于统计测量对象的swap利用率，以百分比为单位。"},rds_innodb_lock_waits:{label:"等待行锁事务数",unit:"个",tooltip:"该指标用于统计当前等待行锁的Innodb事务数，以个为单位。"},rds_bytes_recv_rate:{label:"数据库每秒接收字节",unit:"字节/秒",tooltip:"该指标用于统计数据库每秒接收字节，以字节/秒为单位。"},rds_bytes_sent_rate:{label:"数据库每秒发送字节",unit:"字节/秒",tooltip:"该指标用于统计数据库每秒发送字节，以字节/秒为单位。"},rds_innodb_pages_read_rate:{label:"innodb平均每秒读取的数据量",unit:"页/秒",tooltip:"该指标用于统计innodb平均每秒读取的数据量，以页/秒为单位。"},rds_innodb_pages_written_rate:{label:"innodb平均每秒写入的数据量",unit:"页/秒",tooltip:"该指标用于统计innodb平均每秒写入的数据量，以页/秒为单位。"},rds_innodb_os_log_written_rate:{label:"平均每秒写入redo log的大小",unit:"字节/秒",tooltip:"该指标用于统计平均每秒写入redo log的大小，以字节/秒为单位。"},rds_innodb_buffer_pool_read_requests_rate:{label:"innodb_buffer_pool每秒读请求次数",unit:"次/秒",tooltip:"该指标用于统计innodb_buffer_pool每秒读请求次数，以次/秒为单位。"},rds_innodb_buffer_pool_write_requests_rate:{label:"innodb_buffer_pool每秒写请求次数",unit:"次/秒",tooltip:"该指标用于统计innodb_buffer_pool每秒写请求次数，以次/秒为单位。"},rds_innodb_buffer_pool_pages_flushed_rate:{label:"innodb_buffer_pool每秒页面刷新数",unit:"次/秒",tooltip:"该指标用于统计innodb_buffer_pool每秒页面刷新数，以次/秒为单位。"},rds_innodb_log_waits_rate:{label:"因log buffer不足导致等待flush到磁盘次数",unit:"次/秒",tooltip:"该指标用于统计因log buffer不足导致等待flush到磁盘次数，以次/秒为单位。"},rds_created_tmp_tables_rate:{label:"每秒创建临时表数",unit:"个/秒",tooltip:"该指标用于统计每秒创建临时表数，以个/秒为单位。"},rds_wait_thread_count:{label:"等待线程数",unit:"个",tooltip:"该指标用于统计实例下全部等待线程数，以个为单位。"},rds_threadpool_waiting_threads:{label:"线程池中等待线程数",unit:"个",tooltip:"该指标用于统计当前线程池中等待的线程数，以个为单位。"},rds_innodb_row_lock_time_avg:{label:"历史行锁平均等待时间",unit:"毫秒",tooltip:"该指标用于统计innodb历史行锁平均等待时间。"},rds_innodb_row_lock_current_waits:{label:"当前行锁等待数",unit:"个",tooltip:"该指标用于统计innodb当前行锁等待数，以个为单位。"},rds_mdl_lock_count:{label:"MDL锁数量",unit:"个",tooltip:"该指标用于统计MDL锁数量，以个为单位。"},rds_buffer_pool_wait_free:{label:"缓冲池空闲页等待次数",unit:"次/秒",tooltip:"该指标用于统计InnoDB缓冲池空闲页等待次数。"},rds_conn_active_usage:{label:"活跃连接数使用率",unit:"%",tooltip:"该指标统计活跃连接数占最大连接数的百分比。"},rds_innodb_log_waits_count:{label:"日志等待次数",unit:"个",tooltip:"该指标用于统计日志等待次数，以个为单位。该值为累加值，出现一次累加1。"},rds_long_transaction:{label:"长事务指标",unit:"秒",tooltip:"该指标统计长事务耗时数据，以秒为单位。相关操作命令前后分别有BEGIN以及COMMIT命令才算作一个完整的长事务。"}},He={class:"chart-box"},Be="rds-metric-group",ze=y({__name:"metricChart",props:{sid:{type:[String,Number],default:""},metricName:{type:String,default:""},param:{type:Object,default:()=>({})}},setup(e){const t=e,i=a(null);let n=null;const o=s({chartData:[],isVisible:!1,analysis:{max:0,min:0,avg:0,sum:0}}),r=async()=>{const e=new IntersectionObserver((async r=>{r.forEach((async r=>{r.isIntersecting&&(o.isVisible=!0,await(async()=>{const{metrics:e}=await ie.monitor.postChartData(t.sid,t.param);o.chartData=e[0];const i=o.chartData.values.map((e=>e.value));i.length&&(o.analysis.max=Math.max(...i).toFixed(2),o.analysis.min=Math.min(...i).toFixed(2),o.analysis.sum=i.reduce(((e,t)=>e+t),0).toFixed(2),o.analysis.avg=(i.length?o.analysis.sum/i.length:0).toFixed(2))})(),(()=>{var e,r,a;n||(n=he(i.value),n.group=Be);const s=(null==(e=Fe[t.metricName])?void 0:e.unit)||o.chartData.unit||"",l=(null==(r=Fe[t.metricName])?void 0:r.label)||t.metricName,c=o.analysis,p=[{value:c.max,label:"最大值"},{value:c.min,label:"最小值"},{value:c.avg,label:"平均值"}],d=document.createElement("canvas").getContext("2d");d.font='bolder 14px "PingFang SC", "Microsoft YaHei", Arial';const u=p.map((e=>d.measureText(`${e.value} ${s}`).width)),h=p.map((e=>d.measureText(e.label).width)),m=u.map(((e,t)=>Math.max(e,h[t])));let f=0;const g=p.map(((e,t)=>{const i={type:"group",left:f,top:35,children:[{type:"text",style:{text:`${e.value} ${s}`,font:'bolder 15px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222"},tooltip:{show:!0,formatter:()=>['<div style="text-align: center">',`<div style="font-weight: bold; font-size: 15px; color: #222; margin-bottom: 4px">${e.value} ${s}</div>`,`<div style="font-size: 12px; color: #888">${e.label}</div>`,"</div>"].join(""),backgroundColor:"#fff",borderColor:"#e8e8e8",borderWidth:1,textStyle:{color:"#222",fontSize:12,fontFamily:'"PingFang SC", "Microsoft YaHei", Arial'},padding:[8,12],extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);"}},{type:"text",top:22,style:{text:e.label,font:'12px "PingFang SC", "Microsoft YaHei", Arial',fill:"#888"}}]};return f+=m[t]+20,i})),b=document.createElement("canvas").getContext("2d");b.font='600 16px "PingFang SC", "Microsoft YaHei", Arial';const v={title:{show:!1},tooltip:{trigger:"axis"},legend:{data:[l],bottom:0,icon:"path://M904 476H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"},grid:{left:40,right:20,top:120,bottom:55},graphic:[{type:"text",left:0,top:0,style:{text:l,font:'600 16px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222"}},{type:"group",left:b.measureText(l).width+8,top:0,children:[{type:"circle",shape:{cx:8,cy:8,r:7},style:{stroke:"#222",fill:"#fff",lineWidth:1}},{type:"text",left:5,top:3,style:{text:"?",x:8,y:9,font:'11px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222",textAlign:"center",textVerticalAlign:"middle"},tooltip:{show:!0,formatter:null==(a=Fe[t.metricName])?void 0:a.tooltip,backgroundColor:"#fff",borderColor:"#e8e8e8",borderWidth:1,textStyle:{color:"#222",fontSize:12,fontFamily:'"PingFang SC", "Microsoft YaHei", Arial'},extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);",position:function(e,t,i,n,o){let r=e[0]+16,a=e[1]-o.contentSize[1]/2;return r+o.contentSize[0]>o.viewSize[0]&&(r=o.viewSize[0]-o.contentSize[0]-10),a<0&&(a=10),a+o.contentSize[1]>o.viewSize[1]&&(a=o.viewSize[1]-o.contentSize[1]-10),[r,a]}}}],cursor:"pointer"},...g],xAxis:{type:"category",data:o.chartData.values.map((e=>{const t=I(e.date),i=I(o.chartData.values[0].date);return I(o.chartData.values[o.chartData.values.length-1].date).diff(i,"day")>0?t.format("YYYY/MM/DD\nHH:mm"):t.format("HH:mm")})),boundaryGap:!1},yAxis:{type:"value",name:s,nameLocation:"end",nameTextStyle:{fontSize:12,fontWeight:400,color:"black",padding:[0,5,0,0]},axisLabel:{formatter:"{value}",width:40,overflow:"break"}},series:[{name:l,type:"line",data:o.chartData.values.map((e=>e.value)),smooth:!0,symbol:"none",lineStyle:{width:2,color:"#3b82f6"},itemStyle:{color:"#3b82f6"},markPoint:{symbol:"triangle",symbolSize:10,data:[{type:"max",name:"最大值",symbolRotate:0,itemStyle:{color:"#3b82f6"},symbolOffset:[0,-8]},{type:"min",name:"最小值",symbolRotate:180,itemStyle:{color:"#3b82f6"},symbolOffset:[0,8]}],label:{show:!1}}}]};n.setOption(v)})(),e.unobserve(r.target))}))}),{threshold:.1});i.value&&e.observe(i.value)};return A((()=>{r(),setTimeout((()=>{ue(Be)}),300)})),U((()=>{n&&(n.dispose(),n=null)})),(e,t)=>{const n=_;return c(),p(n,{spinning:!h(o).isVisible},{default:d((()=>[S("div",He,[S("div",{ref_key:"chartRef",ref:i,class:"chart-content"},null,512)])])),_:1},8,["spinning"])}}},[["__scopeId","data-v-dc9d4398"]]),Ue={class:"search-box"},je={class:"ml-4"},qe={class:"metric-chart-box"},Ye=y({__name:"monitor",props:{sid:{type:[String,Number],default:""}},setup(e){const t=e,i=s({metricList:[],chartList:[],searchParams:{metrics:[],date:[I().add(-1,"h"),I()],filter:["average","1"]},refresh:!1,autoRefresh:!1,timer:null});A((async()=>{const{metrics:e}=await ie.monitor.postMetric(t.sid,{});i.metricList=e.map((e=>{var t;return{label:(null==(t=Fe[e.metric_name])?void 0:t.label)||e.metric_name,value:e.metric_name}}))}));const n=()=>{const e=i.searchParams.date[1].diff(i.searchParams.date[0],"day");let t=[...Ie],n=[...Ne];return e>10&&(t=t.filter((e=>"300"!==e.value)),n=n.filter((e=>"原始值"!==e.label))),e>20&&(t=t.filter((e=>"1200"!==e.value))),e>155&&(t=t.filter((e=>"3600"!==e.value))),t=t.filter((e=>e.value<=i.searchParams.date[1].diff(i.searchParams.date[0],"seconds"))),n.map((e=>({...e,children:"原始值"===e.label?null:t})))},o=()=>{i.refresh=!0,j((()=>{i.refresh=!1}))};return w((()=>[i.searchParams.metrics,i.searchParams.filter]),(()=>{o()}),{deep:!0}),w((()=>i.searchParams.date),(()=>{"原始值"===n()[0].label?i.searchParams.filter=["average","1"]:i.searchParams.filter=["average",n()[0].children[0].value],o()}),{deep:!0}),w((()=>i.autoRefresh),(e=>{e?i.timer=setInterval((()=>{o()}),3e4):clearInterval(i.timer)})),(e,r)=>{const a=ce,s=pe,b=me,v=l("RedoOutlined"),_=q,y=E,x=fe;return c(),m(f,null,[S("div",Ue,[u(a,{value:h(i).searchParams.metrics,"onUpdate:value":r[0]||(r[0]=e=>h(i).searchParams.metrics=e),placeholder:"指标名称",options:h(i).metricList,"dropdown-match-select-width":!1,mode:"multiple"},null,8,["value","options"]),u(s,{value:h(i).searchParams.date,"onUpdate:value":r[1]||(r[1]=e=>h(i).searchParams.date=e),"show-time":"","allow-clear":!1,presets:h(Oe),format:"YYYY/MM/DD HH:mm:ss"},null,8,["value","presets"]),u(b,{value:h(i).searchParams.filter,"onUpdate:value":r[2]||(r[2]=e=>h(i).searchParams.filter=e),options:n(),"allow-clear":!1},{displayRender:d((({labels:e})=>[R(k("1"===e[1]?"原始值":`${e[0]} / ${e[1]}`),1)])),_:1},8,["value","options"]),u(y,{title:"刷新"},{default:d((()=>[u(_,{onClick:o},{default:d((()=>[u(v)])),_:1})])),_:1}),S("div",je,[R(" 自动刷新： "),u(y,{title:"每30秒自动刷新"},{default:d((()=>[u(x,{checked:h(i).autoRefresh,"onUpdate:checked":r[3]||(r[3]=e=>h(i).autoRefresh=e)},null,8,["checked"])])),_:1})])]),S("div",qe,[(c(!0),m(f,null,g(h(i).metricList,(e=>{return c(),m(f,{key:e.value},[h(i).refresh||!h(i).searchParams.metrics.includes(e.value)&&h(i).searchParams.metrics.length?C("",!0):(c(),p(ze,{key:0,sid:t.sid,"metric-name":e.value,param:(n=e.value,{metrics:[n],start_time:i.searchParams.date[0],end_time:i.searchParams.date[1],filter:i.searchParams.filter[0],period:i.searchParams.filter[1]})},null,8,["sid","metric-name","param"]))],64);var n})),128))])],64)}}},[["__scopeId","data-v-3625fa00"]]),Ge={class:"table-section"},Ve={class:"ml-1"},We=["onClick"],Ke=["onClick"],Xe={class:"text-12"},Qe={class:"mb-2"},Ze={class:"truncate inline-block"},Je=(e=>(B("data-v-4c3716b5"),e=e(),z(),e))((()=>S("span",null,"CPU大小|内存大小|磁盘大小|磁盘类型",-1))),et={class:"flex items-center"},tt={class:"mr-2"},it={class:"mb-1"},nt={style:{display:"flex","align-items":"center"}},ot={key:0,class:"custom-tabs"},rt=y({__name:"index",setup(o){const r=a(null),b=s({initColumn:[],initButton:[],initTitleData:[],tableOrder:{},subPageColumns:[],titleFieldSearch:[],pageType:"rds"}),v=[{title:"账号",icon:"icon-shangxiayouguanxi",path:"rdsAccount",key:"account",isCustomTab:!0},{title:"数据库",icon:"icon-shujuku2",path:"rdsDatabase",key:"database",isCustomTab:!0},{title:"表",icon:"icon-shujukubiao",path:"rdsTable",key:"table",isCustomTab:!0}],{userEdit:_,userDel:y,formOpen:w,formType:M,formSid:L}=J(),$=x((()=>{for(let e of b.initColumn){let{field:t}=e;switch(t){case"id":case"name":case"huawei_rds_instance":case"aliyun_rds_instance":case"charge_type":e.slots={default:t};break;case"cpu":e.minWidth=320,e.showOverflow=!1,e.slots={default:t,header:"cpuHeader"};break;case"addresses":e.showOverflow=!1,e.minWidth=180,e.slots={default:t};break;case"status":case"virtual_teams":e.showOverflow=!1}}return b.initColumn})),I=x((()=>b.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),N=x((()=>[...v,{title:"慢日志",key:"log",isCustomTab:!0},{title:"监控",key:"monitor",isCustomTab:!0}].filter((e=>I.value[`${e.key}_permission`]))));A((async()=>{const{button:e,columns:t,order:i,title_data:n,sub_page_columns:o,title_field_search:r}=await X.setColumn({layer:1,tableType:"server"});b.initColumn=t.value||[],b.initButton=e.value||[],b.tableOrder=i.value||{},b.initTitleData=n.value||[],b.subPageColumns=o||[],b.titleFieldSearch=r.value||[],await F()}));const F=async()=>{r.value&&r.value.serverTableRef.commitProxy("query")},H=({type:e,row:t})=>{_({type:e,sid:t.id})},B=({row:e})=>{y({sid:e.id,delApi:te.del,loadData:F})},{subPageOpen:z,subPageRow:U,handleSubPageOpen:j}=e(),q=e=>{z.value=!0,U.value=e},Q=e=>/^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]+$/.test(e),Z={fields:[{field:"cloud_instance_id",field_name:"云实例ID",operator:"=",validate:Q},{field:"name",field_name:"名称",operator:"vague",validate:e=>!Q(e)}],placeholder:"支持云实例ID、名称快速搜索"};return(e,o)=>{var a,s;const y=O,x=l("vxe-button"),A=P,X=E,Q=l("vxe-tag"),J=K,ee=W,ie=n,ne=i,oe=t;return c(),m(f,null,[Y(S("div",Ge,[u(ne,{ref_key:"tableRef",ref:r,"table-column":h($),"auth-btn":h(I),order:h(b).tableOrder,"query-api":h(te).getList,"is-show-doc":!0,"is-show-sync":{show:!0,uri:"sync_rds_instance"},"default-search-field":Z,"title-field-search":h(b).titleFieldSearch,onUserEdit:H,onUserAdd:o[0]||(o[0]=t=>{h(_)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})}),onUserDel:B},{other_toolbar_buttons:d((()=>[(c(),m(f,null,g(v,(e=>(c(),m(f,{key:e.path},[h(I)[`${e.key}_permission`]?(c(),p(x,{key:0,onClick:t=>h(b).pageType=e.key},{default:d((()=>[u(y,{iconname:e.icon},null,8,["iconname"]),S("span",Ve,k(e.title),1)])),_:2},1032,["onClick"])):C("",!0)],64)))),64))])),id:d((({row:e})=>[u(X,{placement:"topLeft"},{title:d((()=>[u(A,{copyable:{tooltip:!1},class:"copy-text"},{default:d((()=>[R(k(e.cloud_instance_id),1)])),_:2},1024)])),default:d((()=>[S("span",{class:"cursor-pointer text-primary",onClick:t=>h(j)(e)},k(e.id),9,We)])),_:2},1024)])),name:d((({row:e})=>[S("span",{class:"cursor-pointer text-primary",onClick:t=>h(j)(e)},k(e.name),9,Ke)])),addresses:d((({row:e})=>[(c(!0),m(f,null,g(e.addresses,(e=>(c(),p(X,{key:e.id},{title:d((()=>[S("div",Xe,k(e.address)+":"+k(e.port),1)])),default:d((()=>[S("div",Qe,[u(Q,{class:"theme--primary",size:"small"},{default:d((()=>[S("span",Ze,k(e.address)+":"+k(e.port),1)])),_:2},1024)])])),_:2},1024)))),128))])),huawei_rds_instance:d((({row:e})=>[R(k(JSON.stringify(e.huawei_rds_instance,null,2)),1)])),aliyun_rds_instance:d((({row:e})=>[R(k(JSON.stringify(e.aliyun_rds_instance,null,2)),1)])),cpuHeader:d((()=>[Je])),cpu:d((({row:e})=>[S("div",null,k(e.cpu)+"vCPUs | "+k(Number(e.mem/1024).toFixed(1))+"GB ",1),S("div",et,[S("span",tt,k(e.volume_size)+"GB ("+k(e.volume_type)+")",1),u(J,{percentage:e.volume_used/e.volume_size},null,8,["percentage"])])])),status:d((({row:e})=>[S("div",it,k(e.engine)+" "+k(e.engine_version),1),u(Q,{class:T("运行中"==e.status?"theme--primary":"theme--error"),size:"small"},{default:d((()=>[R(k(e.status),1)])),_:2},1032,["class"])])),cloud_master_account_id:d((({row:e})=>{var t,i,n;return[S("div",nt,[u(ee,{type:e.cloud_source},null,8,["type"])]),R(" "+k((null==(n=null==(i=null==(t=h(b).initTitleData)?void 0:t.cloud_master_account_id)?void 0:i[e.cloud_master_account_id])?void 0:n.page_display)||""),1)]})),region_id:d((({row:e})=>{var t,i,n;return[S("div",null,k(null==e?void 0:e.zone_id),1),S("div",null,k((null==(t=h(b).initTitleData)?void 0:t.region_id)&&(null==(n=null==(i=h(b).initTitleData)?void 0:i.region_id)?void 0:n[null==e?void 0:e.region_id])||(null==e?void 0:e.region_id)),1)]})),charge_type:d((({row:e})=>[u(ie,{"charge-type":e.charge_type,"expired-time":e.expire_time},null,8,["charge-type","expired-time"])])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search"])],512),[[G,"rds"===h(b).pageType]]),u(ge,{open:h(w),"onUpdate:open":o[1]||(o[1]=e=>D(w)?w.value=e:null),sid:h(L),"form-type":h(M),onEditSuccess:F},null,8,["open","sid","form-type"]),u(oe,{open:h(z),"onUpdate:open":o[2]||(o[2]=e=>D(z)?z.value=e:null),width:"100%",title:null==(a=h(U))?void 0:a.name,"basic-config":{api:h(te).getDetail,sid:null==(s=h(U))?void 0:s.id,title:"实例信息",isCustomTab:!0},"custom-tabs":h(N),onClickEdit:o[3]||(o[3]=t=>H({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:h(U)}))},V({basic:d((({data:e})=>[u(_e,{data:e,columns:h(b).subPageColumns,"title-data":h(b).initTitleData},null,8,["data","columns","title-data"])])),_:2},[g(h(N),(e=>({name:e.key,fn:d((()=>{var t,i,n;return[h(z)?(c(),m("div",ot,["log"===e.key?(c(),p(De,{key:0,sid:null==(t=h(U))?void 0:t.id},null,8,["sid"])):"monitor"===e.key?(c(),p(Ye,{key:1,sid:null==(i=h(U))?void 0:i.id},null,8,["sid"])):(c(),p(Re,{key:2,"instance-name":null==(n=h(U))?void 0:n.name,type:e.key},null,8,["instance-name","type"]))])):C("",!0)]}))})))]),1032,["open","title","basic-config","custom-tabs"]),"rds"!==h(b).pageType?(c(),p(Re,{key:0,type:h(b).pageType,"onUpdate:type":o[4]||(o[4]=e=>h(b).pageType=e),onRdsSubPageOpen:q},null,8,["type"])):C("",!0)],64)}}},[["__scopeId","data-v-4c3716b5"]]);export{rt as default};
