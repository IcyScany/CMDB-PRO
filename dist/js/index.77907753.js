import{_ as e}from"./index.029351cd.js";import{s as t,_ as i}from"./subPage.2201bfd5.js";import{_ as l}from"./ServerTable.53881589.js";import{b5 as a,al as o,r as n,H as s,J as r,O as u,Q as d,U as p,W as c,c as m,$ as f,R as y,F as v,S as _,a8 as b,aN as g,q as w,Y as C,ah as k,X as x,x as D,ad as h,a3 as j,Z as T,a6 as S,aZ as O,v as R,aV as A,av as E}from"./index.872a2bd0.js";import{t as L}from"./tableRender.a6ff99b7.js";import{o as P,_ as F,u as B}from"./opsFormInit.3a4e1794.js";import{A as U}from"./cloudObs.41e947a0.js";import{_ as I}from"./index.7d980246.js";import"./index.64f8d8d4.js";import"./opsDescriptions.dfa169bd.js";import"./index.87ccdcd1.js";import"./index.fc9664cf.js";import"./index.a533313d.js";import"./index.2c670fa1.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.44a4e190.js";import"./index.65b2e021.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.48209b21.js";import"./opsTable.7b07fc7b.js";const M={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:a}},emits:["update:open","editSuccess"],setup(t,{emit:i}){const l=t,{open:a,sid:w,formType:C}=o(l),k=i,x=n(null),{putEdit:D,getDetail:h,postAdd:j}=U,T=s({userList:[]}),{formRenderContent:S,formDataLoading:O,confirmLoading:R,initForm:A,formDataInit:E,editSubmit:L}=P({formRef:x,TITLE_LAYER:1,formType:C,sid:w,emits:k,addApi:j,editApi:D,oneDataApi:h,customSubmitData:async function(e){return e},customEditData:function(){}});const B=()=>{k("update:open",!1)},I=async e=>{e&&(await A(),await E())};return r((async()=>{await(async()=>{const e=await U.getInfo.userList(w.value);T.userList=e.map((e=>({label:e,value:e})))})()})),(t,i)=>{const l=F,o=b,n=g,s=u("vxe-button"),r=e;return d(),p(r,{title:`${t.$route.meta.title}${f(C)===t.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:f(a),onAfterOpenChange:I,onClose:B},{footer:c((()=>[m(s,{content:"取消",onClick:B}),m(s,{type:"submit",loading:f(R),status:"primary",content:"提交",onClick:f(L)},null,8,["loading","onClick"])])),default:c((()=>[m(n,{spinning:f(O)},{default:c((()=>[m(o,{ref_key:"formRef",ref:x,model:f(S).formState,rules:f(S).rules},{default:c((()=>[(d(!0),y(v,null,_(t.$utils.filter(f(S).title,(e=>e.edit_display)),(e=>{var t,i,a,o;return d(),y(v,{key:e.field},["username"===e.field?(d(),p(l,{key:0,value:f(S).formState[e.field],"onUpdate:value":t=>f(S).formState[e.field]=t,title:e,"title-data":null==(i=null==(t=f(S))?void 0:t.title_data)?void 0:i[e.field],options:f(T).userList},null,8,["value","onUpdate:value","title","title-data","options"])):(d(),p(l,{key:1,value:f(S).formState[e.field],"onUpdate:value":t=>f(S).formState[e.field]=t,title:e,"title-data":null==(o=null==(a=f(S))?void 0:a.title_data)?void 0:o[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},$=x("span",{class:"text-18"},"·",-1),N={__name:"infoModal",props:{modalRow:{type:Object,default:()=>({})},columns:{type:Array,default:()=>[]},type:{type:String,default:""}},setup(e){const t=e,{modalRow:i}=o(t),l={policy:2,cors:3,lifecycle:4},a={STANDARD:"标准存储",WARM:"低频访问存储",COLD:"归档存储",DEEP_COLD:"深度归档存储(受限公测)"},u=n(null),m=s({data:[]}),b=w((()=>{const e=t.columns.filter((e=>e.oriTitle.block===l[t.type]));for(let t of e){let{field:e}=t;switch(e){case"Resource":case"Principal":case"expiration":case"transition":case"allowedOrigin":t.slots={default:e},t.showOverflow=!1}}return e})),g=async()=>{u.value.tableLoading=!0;const e=await U.getInfo[t.type](i.value.id);m.data=e.Statement||e,u.value.commitRequest(),u.value.tableLoading=!1};return r((()=>{g()})),(e,t)=>{const i=I;return d(),p(i,{ref_key:"tableRef",ref:u,data:f(m).data,columns:f(b),onRefresh:g},{Resource:c((({row:e})=>[(d(!0),y(v,null,_(e.Resource,(e=>(d(),y("div",{key:e},C(e),1)))),128))])),Principal:c((({row:e})=>[(d(!0),y(v,null,_(Object.values(e.Resource),(e=>(d(),y("div",{key:e},C(e),1)))),128))])),expiration:c((({row:e})=>{var t;return[k(C(null==(t=null==e?void 0:e.expiration)?void 0:t.days),1)]})),transition:c((({row:e})=>[(d(!0),y(v,null,_(null==e?void 0:e.transition,(e=>(d(),y("div",{key:e},[$,k(" 转换为"+C(a[e.storageClass])+": "+C(e.days)+"天 ",1)])))),128))])),allowedOrigin:c((({row:e})=>[(d(!0),y(v,null,_(null==e?void 0:e.allowedOrigin,(e=>(d(),y("div",{key:e},C(e),1)))),128))])),_:1},8,["data","columns"])}}},q={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:a}},emits:["update:open","editSuccess"],setup(t,{emit:i}){const l=t,{open:a,sid:s,formType:r}=o(l),w=i,C=n(null),{formRenderContent:k,formDataLoading:x,confirmLoading:D,initForm:h,formDataInit:j,editSubmit:T}=P({formRef:C,editTitleLayer:2,formType:r,sid:s,emits:w,oneDataApi:U.getAppDetail,editApi:U.putAppEdit,customSubmitData:async function(e){return e},customEditData:function(){}});const S=()=>{w("update:open",!1)},O=async e=>{e&&(await h(),await j())};return(t,i)=>{const l=F,o=b,n=g,s=u("vxe-button"),w=e;return d(),p(w,{title:"应用"+(f(r)===t.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"),open:f(a),onAfterOpenChange:O,onClose:S},{footer:c((()=>[m(s,{content:"取消",onClick:S}),m(s,{type:"submit",loading:f(D),status:"primary",content:"提交",onClick:f(T)},null,8,["loading","onClick"])])),default:c((()=>[m(n,{spinning:f(x)},{default:c((()=>[m(o,{ref_key:"formRef",ref:C,model:f(k).formState,rules:f(k).rules},{default:c((()=>[(d(!0),y(v,null,_(t.$utils.filter(f(k).title,(e=>e.edit_display)),(e=>{var t,i,a,o;return d(),y(v,{key:e.field},[""===e.field?(d(),p(l,{key:0,value:f(k).formState[e.field],"onUpdate:value":t=>f(k).formState[e.field]=t,title:e,"title-data":null==(i=null==(t=f(k))?void 0:t.title_data)?void 0:i[e.field]},null,8,["value","onUpdate:value","title","title-data"])):(d(),p(l,{key:1,value:f(k).formState[e.field],"onUpdate:value":t=>f(k).formState[e.field]=t,title:e,"title-data":null==(o=null==(a=f(k))?void 0:a.title_data)?void 0:o[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},z={__name:"table",props:{sid:{type:[String,Number],default:""}},setup(e){const t=e,i=n(null),l=s({initColumn:[],initButton:[],initTitleData:[]}),{userEdit:a,formOpen:o,formType:u,formSid:p}=B(),c=w((()=>{for(let e of l.initColumn){let{field:t}=e;switch(t){case"":e.slots={default:t};break;case"virtual_team_v3_id":e.showOverflow=!1}}return l.initColumn})),_=w((()=>{const e=["edit","add","del"];return l.initButton.reduce(((t,i)=>(e.includes(i.field)&&(t[i.field]=i),t)),{})}));r((async()=>{const{button:e,columns:t,title_data:i}=await L.setColumn({layer:2});l.initColumn=t.value||[],l.initButton=e.value||[],l.initTitleData=i.value||[]}));const b=async()=>{i.value&&await i.value.commitRequest()},g=({type:e,row:t})=>{a({type:e,sid:t.id})};return D((()=>t.sid),(()=>{b()})),(e,l)=>{const a=I;return d(),y(v,null,[m(a,{ref_key:"tableRef",ref:i,columns:f(c),"auth-btn":f(_),"request-config":{api:f(U).getInfo.app,params:t.sid,immediate:!0},"switch-click-status-config":{api:f(U).putAppEdit},onUserEdit:g},null,8,["columns","auth-btn","request-config","switch-click-status-config"]),m(q,{open:f(o),"onUpdate:open":l[0]||(l[0]=e=>h(o)?o.value=e:null),sid:f(p),"form-type":f(u),onEditSuccess:b},null,8,["open","sid","form-type"])],64)}}},Y={key:0},G=["onClick"],W=["onClick"],H={style:{display:"flex","align-items":"center"}},K={class:"mb-1"},Z={class:"truncate inline-block"},J=["onClick"],Q={class:"mb-2"},V={class:"truncate inline-block"},X={class:"custom-tabs"},ee=j({__name:"index",setup(a){const o=n(null),b=s({initColumn:[],initButton:[],initTitleData:[],tableOrder:{},subPageColumns:[],titleFieldSearch:[],hasAppList:[],modalConfig:{open:!1,row:{},columns:[],type:""}}),{userEdit:g,userDel:D,formOpen:j,formType:P,formSid:F}=B(),{subPageOpen:I,subPageRow:$,handleSubPageOpen:q}=t(),ee=w((()=>{for(let e of b.initColumn){let{field:t}=e;switch(t){case"id":case"epid":case"size":case"object_number":case"policy":case"cors":case"domain":case"region_id":case"lifecycle":case"cloud_master_account_id":e.slots={default:t},e.showOverflow=!1;break;case"bucket":e.slots={default:t};break;case"virtual_team_v3_id":e.showOverflow=!1}}return b.initColumn})),te=w((()=>{const e=["edit","add","del"];return b.initButton.reduce(((t,i)=>(e.includes(i.field)&&(t[i.field]=i),t)),{})}));r((async()=>{const{button:e,columns:t,title_data:i,order:l,sub_page_columns:a,title_field_search:n}=await L.setColumn({layer:1});b.initColumn=t.value.filter((e=>1==e.oriTitle.block))||[],b.modalConfig.columns=t.value.filter((e=>1!=e.oriTitle.block))||[],b.initButton=e.value||[],b.initTitleData=i.value||[],b.tableOrder=l.value||{},b.subPageColumns=a||[],b.titleFieldSearch=n.value||[],o.value.gridOption.proxyConfig.ajax.querySuccess=({response:e})=>{b.hasAppList=null==e?void 0:e.app_list},await ie()}));const ie=async()=>{o.value&&await o.value.serverTableRef.commitProxy("query")},le=({type:e,row:t})=>{g({type:e,sid:t.id})},ae=({row:e})=>{D({sid:e.id,delApi:U.del,loadData:ie})},oe=(e,t)=>{b.modalConfig.open=!0,b.modalConfig.row=e,b.modalConfig.type=t},ne=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]},se=e=>e<1e4?e.toString():e<1e8?e/1e4+"万":e/1e8+"亿";return(t,a)=>{var n,s,r,w;const D=O,L=u("SearchOutlined"),B=R,re=A,ue=u("vxe-tag"),de=E,pe=l,ce=i,me=e;return d(),y(v,null,[m(pe,{ref_key:"tableRef",ref:o,"table-column":f(ee),"auth-btn":f(te),order:f(b).tableOrder,"query-api":f(U).getList,"title-field-search":f(b).titleFieldSearch,onUserEdit:le,onUserAdd:a[0]||(a[0]=e=>f(g)({type:t.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:ae},{id:c((({row:e})=>[m(B,{placement:"topLeft","overlay-style":{maxWidth:"400px"}},{title:c((()=>[m(D,{copyable:{tooltip:!1},class:"tooltip-text"},{default:c((()=>[k(C(e.epid),1)])),_:2},1024),f(b).hasAppList.includes(e.id)?(d(),y("div",Y,[k(" 应用列表"),m(L)])):T("",!0)])),default:c((()=>[x("div",{class:"cursor-pointer text-primary",onClick:t=>f(q)(e)},[k(C(e.id)+" ",1),f(b).hasAppList.includes(e.id)?(d(),p(L,{key:0})):T("",!0)],8,G)])),_:2},1024)])),bucket:c((({row:e})=>[x("span",{class:"cursor-pointer text-primary",onClick:t=>f(q)(e)},C(e.bucket),9,W)])),cloud_master_account_id:c((({row:e})=>{var t,i,l;return[x("div",H,[m(re,{type:e.cloud_source},null,8,["type"])]),k(" "+C((null==(l=null==(i=null==(t=f(b).initTitleData)?void 0:t.cloud_master_account_id)?void 0:i[e.cloud_master_account_id])?void 0:l.page_display)||""),1)]})),domain:c((({row:e})=>[(d(!0),y(v,null,_(e.domain,(e=>(d(),p(B,{key:e,title:e},{default:c((()=>[x("div",K,[m(ue,{class:"theme--primary",size:"small"},{default:c((()=>[x("span",Z,C(e),1)])),_:2},1024)])])),_:2},1032,["title"])))),128))])),policy:c((({row:e})=>[x("span",{class:S(["cursor-pointer","私有桶"===e.policy?"text-primary":"text-warning"]),onClick:t=>oe(e,"policy")},C(e.policy),11,J)])),cors:c((({row:e})=>[m(de,{size:"small",type:"link",onClick:t=>oe(e,"cors")},{default:c((()=>[k(" 查看 ")])),_:2},1032,["onClick"])])),lifecycle:c((({row:e})=>[m(de,{size:"small",type:"link",onClick:t=>oe(e,"lifecycle")},{default:c((()=>[k(" 查看 ")])),_:2},1032,["onClick"])])),region_id:c((({row:e})=>{var t,i;return[k(C((null==(i=null==(t=f(b).initTitleData)?void 0:t.region_id)?void 0:i[e.region_id])||e.region_id),1)]})),epid:c((({row:e})=>{var t,i;return[k(C((null==(i=null==(t=f(b).initTitleData)?void 0:t.epid)?void 0:i[e.epid])||e.epid),1)]})),size:c((({row:e})=>[k(C(ne(e.size)),1)])),object_number:c((({row:e})=>[k(C(se(e.object_number)),1)])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search"]),m(M,{open:f(j),"onUpdate:open":a[1]||(a[1]=e=>h(j)?j.value=e:null),sid:f(F),"form-type":f(P),onEditSuccess:ie},null,8,["open","sid","form-type"]),m(ce,{open:f(I),"onUpdate:open":a[2]||(a[2]=e=>h(I)?I.value=e:null),title:null==(n=f($))?void 0:n.bucket,"basic-config":{columns:f(b).subPageColumns,api:f(U).getDetail,sid:null==(s=f($))?void 0:s.id},"custom-tabs":[{title:"应用列表",key:"app",isCustomTab:!0}],onClickEdit:a[3]||(a[3]=e=>le({type:t.$CONFIG.FORM_TYPE.EDIT_TYPE,row:f($)}))},{cloud_master_account_id:c((({row:e})=>{var t,i,l;return[k(C((null==(l=null==(i=null==(t=f(b).initTitleData)?void 0:t.cloud_master_account_id)?void 0:i[e.cloud_master_account_id])?void 0:l.page_display)||""),1)]})),domain:c((({row:e})=>[(d(!0),y(v,null,_(e.domain,(e=>(d(),p(B,{key:e,title:e},{default:c((()=>[x("div",Q,[m(ue,{class:"theme--primary",size:"small"},{default:c((()=>[x("span",V,C(e),1)])),_:2},1024)])])),_:2},1032,["title"])))),128))])),app:c((()=>{var e;return[x("div",X,[m(z,{sid:null==(e=f($))?void 0:e.id},null,8,["sid"])])]})),size:c((({row:e})=>[k(C(ne(e.size)),1)])),object_number:c((({row:e})=>[k(C(se(e.object_number)),1)])),_:1},8,["open","title","basic-config"]),m(me,{open:f(b).modalConfig.open,"onUpdate:open":a[4]||(a[4]=e=>f(b).modalConfig.open=e),title:`${null==(r=f(b).initColumn.find((e=>e.field===f(b).modalConfig.type)))?void 0:r.title} - ${null==(w=f(b).modalConfig.row)?void 0:w.bucket}`},{default:c((()=>[f(b).modalConfig.open?(d(),p(N,{key:0,"modal-row":f(b).modalConfig.row,columns:f(b).modalConfig.columns,type:f(b).modalConfig.type},null,8,["modal-row","columns","type"])):T("",!0)])),_:1},8,["open","title"])],64)}}},[["__scopeId","data-v-779ab7a1"]]);export{ee as default};
