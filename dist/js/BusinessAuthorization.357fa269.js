import{a3 as e,r as l,J as t,aR as i,O as n,Q as a,U as u,W as d,X as c,c as o,$ as s,ad as k,R as y,S as v,ah as r,Y as f,F as m,a6 as p,C as h,D as _,Z as b,ak as $,aN as x,aY as C,a9 as g,aa as j}from"./index.872a2bd0.js";import{s as A}from"./successModal.c280f18f.js";import"./index.6e2fd079.js";import{R as w,_ as O}from"./Group.b415afa6.js";import{C as R}from"./index.fe8e77ef.js";import"./RadioButton.534ff50d.js";import"./Checkbox.ddee6d58.js";const z={class:"part-box"},B={class:"part-content-box"},D={class:"part-box"},S={class:"part-content-box"},U={class:"m1-content-box"},Y=["onClick"],E={class:"m2-content-box"},F={class:"layer-box"},G=(e=>(g("data-v-9e241401"),e=e(),j(),e))((()=>c("b",{class:"text-error bold-class-btn"},"B",-1))),I="manage/business/authorization/",J=e({__name:"BusinessAuthorization",setup(e){let g=l({}),j=l(!1),J=l(null),M=l({});const N={menu:[],title:[],layer:[]};let Q=l(N),W=l(!1),X=l(!1);function Z(e){Q.value=N,W.value=!0,i.get(`${I}list/${e.target.value}`).then((e=>{Q.value=(null==e?void 0:e.data)?e.data:N,Q.value.layer=[],W.value=!1})).catch((()=>{W.value=!1}))}function q({key:e,type:l,checked:t}){let i=Q.value[l].indexOf(e);t||-1===i||Q.value[l].splice(i,1),-1!==i||!0!==t&&void 0!==t||Q.value[l].push(e)}function H({key:e,level1:l,level2:t,type:i,layer:n,title:a,button:u,num:d,idx:c}){var o,s,k,y,v,r,f,m,p,h,_,b,$,x,C,j;if(q({key:e,type:i}),-1===Q.value[i].indexOf(e)){if("layer"===i){for(let e of a)q({key:e.sid,type:"title",checked:!1});for(let e of u)q({key:e.sid,type:"title",checked:!1})}if("menu"===i&&2===d){let e=null==(v=null==(y=null==(k=null==(s=null==(o=g.value)?void 0:o.menus)?void 0:s[c])?void 0:k.menus)?void 0:y[t])?void 0:v.title_button;if(e)for(let i in e){let{title:n,button:a}=e[i];q({key:`${l}_${t}_${i}`,type:"layer",checked:!1});for(let e of n)q({key:e.sid,type:"title",checked:!1});for(let e of a)q({key:e.sid,type:"title",checked:!1})}}if("menu"===i&&1===d){let e=null==(m=null==(f=null==(r=g.value)?void 0:r.menus)?void 0:f[c])?void 0:m.menus;if(e)for(let t in e){q({key:1*t,type:"menu",checked:!1});let{title_button:i}=e[t];if(i)for(let e in i){let{title:n,button:a}=i[e];q({key:`${l}_${1*t}_${e}`,type:"layer",checked:!1});for(let e of n)q({key:e.sid,type:"title",checked:!1});for(let e of a)q({key:e.sid,type:"title",checked:!1})}}}}else{if("title"===i&&(q({key:l,type:"menu",checked:!0}),q({key:t,type:"menu",checked:!0}),q({key:`${l}_${t}_${n}`,type:"layer",checked:!0})),"layer"===i){q({key:l,type:"menu",checked:!0}),q({key:t,type:"menu",checked:!0});for(let e of a)q({key:e.sid,type:"title",checked:!0});for(let e of u)q({key:e.sid,type:"title",checked:!0})}if("menu"===i&&2===d){let e=null==($=null==(b=null==(_=null==(h=null==(p=g.value)?void 0:p.menus)?void 0:h[c])?void 0:_.menus)?void 0:b[t])?void 0:$.title_button;if(q({key:l,type:"menu",checked:!0}),e)for(let i in e){let{title:n,button:a}=e[i];q({key:`${l}_${t}_${i}`,type:"layer",checked:!0});for(let e of n)q({key:e.sid,type:"title",checked:!0});for(let e of a)q({key:e.sid,type:"title",checked:!0})}}if("menu"===i&&1===d){let e=null==(j=null==(C=null==(x=g.value)?void 0:x.menus)?void 0:C[c])?void 0:j.menus;if(e)for(let t in e){q({key:1*t,type:"menu",checked:!0});let{title_button:i}=e[t];if(i)for(let e in i){let{title:n,button:a}=i[e];q({key:`${l}_${1*t}_${e}`,type:"layer",checked:!0});for(let e of n)q({key:e.sid,type:"title",checked:!0});for(let e of a)q({key:e.sid,type:"title",checked:!0})}}}}}t((async()=>{await async function(){j.value=!0,W.value=!1,X.value=!1,g.value={},i.get(`${I}list`).then((e=>{g.value=(null==e?void 0:e.data)?e.data:{},j.value=!1})).catch((()=>{j.value=!1}))}()}));let K=l({checkAll:!1,indeterminate:!1});function L(){K.value.checkAll=!K.value.checkAll,function(e){var l;let t=null==(l=g.value)?void 0:l.menus;if(t)for(let i of t){let{sid:l,menus:t}=i;q({key:l,type:"menu",checked:e});for(let i in t){q({key:1*i,type:"menu",checked:e});let{title_button:n}=t[i];if(n)for(let t in n){let{title:a,button:u}=n[t];q({key:`${l}_${1*i}_${t}`,type:"layer",checked:e});for(let l of a)q({key:l.sid,type:"title",checked:e});for(let l of u)q({key:l.sid,type:"title",checked:e})}}}}(K.value.checkAll)}function P(){J.value&&(X.value=!0,W.value=!0,i.put(`${I}${J.value}`,{title_sid:Q.value.title,menu_sid:Q.value.menu}).then((e=>{W.value=!1,X.value=!1,A({title:null==e?void 0:e.msg})})).catch((()=>{W.value=!1,X.value=!1})))}return(e,l)=>{const t=n("vxe-button"),i=w,A=O,I=$,N=R,q=n("vxe-tag"),T=x,V=C;return a(),u(V,{loading:s(j)},{default:d((()=>{var e;return[c("div",z,[o(t,{status:"primary",content:"业态",disabled:""}),c("div",B,[Object.keys(s(g)).length&&(null==(e=s(g))?void 0:e.business)?(a(),u(A,{key:0,value:s(J),"onUpdate:value":l[0]||(l[0]=e=>k(J)?J.value=e:J=e),onChange:Z},{default:d((()=>{var e;return[(a(!0),y(m,null,v(null==(e=s(g))?void 0:e.business,(({business:e},l)=>(a(),u(i,{key:l,value:l},{default:d((()=>[r(f(e),1)])),_:2},1032,["value"])))),128))]})),_:1},8,["value"])):(a(),u(I,{key:1},{description:d((()=>[r(" 无业态数据 ")])),_:1}))])]),c("div",D,[o(N,{checked:s(K).checkAll,indeterminate:s(K).indeterminate,onClick:L},{default:d((()=>[r(" 全选 ")])),_:1},8,["checked","indeterminate"]),c("div",S,[o(T,{spinning:s(W)},{default:d((()=>{var e,l;return[Object.keys(s(g)).length&&(null==(e=s(g))?void 0:e.menus)?(a(!0),y(m,{key:0},v(null==(l=s(g))?void 0:l.menus,((e,l)=>(a(),y(m,{key:e.sid},[o(N,{checked:s(Q).menu.includes(e.sid),onClick:t=>H({key:e.sid,type:"menu",num:1,idx:l,level1:e.sid})},{default:d((()=>[c("h3",null,f(null==e?void 0:e.menu_name),1)])),_:2},1032,["checked","onClick"]),c("div",U,[(a(!0),y(m,null,v(e.menus,((t,i)=>(a(),y(m,{key:i},[c("div",null,[c("i",{class:p([s(M)[i]?"vxe-icon-arrow-down":"vxe-icon-arrow-up","m2-expand-icon","text-info"]),onClick:e=>s(M)[i]=!s(M)[i]},null,10,Y),o(N,{checked:s(Q).menu.includes(1*i),onClick:t=>H({key:1*i,type:"menu",level1:e.sid,level2:i,num:2,idx:l})},{default:d((()=>[c("h4",null,[o(q,{class:"theme--primary"},{default:d((()=>[r(f(null==t?void 0:t.menu_name),1)])),_:2},1024)])])),_:2},1032,["checked","onClick"])]),h(c("div",E,[(null==t?void 0:t.title_button)?(a(!0),y(m,{key:0},v(null==t?void 0:t.title_button,(({title:t,button:n},k)=>(a(),y(m,{key:`${e.sid}_${i}_${k}`},[o(N,{checked:s(Q).layer.includes(`${e.sid}_${i}_${k}`),onClick:a=>H({key:`${e.sid}_${i}_${k}`,level1:e.sid,level2:1*i,layer:k,idx:l,title:t,button:n,type:"layer"})},{default:d((()=>[r(" 层号: "+f(k),1)])),_:2},1032,["checked","onClick"]),c("div",F,[(a(!0),y(m,null,v(t,(t=>(a(),u(N,{key:null==t?void 0:t.sid,checked:s(Q).title.includes(t.sid),onClick:n=>H({key:t.sid,level1:e.sid,level2:1*i,layer:k,idx:l,type:"title"})},{default:d((()=>[r(f(t.field_name),1)])),_:2},1032,["checked","onClick"])))),128)),(a(!0),y(m,null,v(n,(t=>(a(),u(N,{key:t.sid,checked:s(Q).title.includes(t.sid),onClick:n=>H({key:t.sid,level1:e.sid,level2:1*i,layer:k,idx:l,type:"title"})},{default:d((()=>[G,r(" "+f(t.field_name),1)])),_:2},1032,["checked","onClick"])))),128))])],64)))),128)):b("",!0)],512),[[_,s(M)[i]]])],64)))),128))])],64)))),128)):(a(),u(I,{key:1},{description:d((()=>[r(" 无菜单数据 ")])),_:1}))]})),_:1},8,["spinning"])])]),s(J)?(a(),u(t,{key:0,loading:s(X),status:"primary",size:"default",content:"Submit",class:"submit-btn",onClick:P},null,8,["loading"])):b("",!0)]})),_:1},8,["loading"])}}},[["__scopeId","data-v-9e241401"]]);export{J as default};
