import{a3 as e,r as t,H as a,J as o,I as i,Q as s,R as r,X as n,F as l,S as c,a6 as u,am as d,$ as p,Y as v,Z as b,c as _,W as m,U as y,ah as g,ai as f,aV as h,v as w,aY as x,a9 as j,aa as k}from"./index.872a2bd0.js";import{A as z}from"./cloudObs.41e947a0.js";import{i as D}from"./index.165d9fa7.js";import{_ as O}from"./index.fc9664cf.js";const $={class:"overview-container"},L={class:"summary-box"},A=["onClick"],B={class:"summary-title"},M=["src"],C=(e=>(j("data-v-1e506eed"),e=e(),k(),e))((()=>n("div",{class:"summary-border"},null,-1))),T={class:"desc-box"},E={class:"desc-title"},R={class:"desc-list"},F={class:"desc-label truncate"},P={class:"desc-value"},I={key:0},J={style:{color:"#888"}},S={key:1},Y=e({__name:"index",setup(e){const j=t(null);let k=null;const Y=t(null);let Z=null;const G=a({overviewData:{},regionList:[]}),H={total:{label:"总数",color:"#4fb050",icon:"kvstore.png",pointer:!0,name:"cloudObsPage"},policy:{label:"策略分布",color:"#e88250"}},K={region_id:{label:"区域分布"},az_redundancy:{label:"AZ冗余"},storage_class:{label:"存储类型"}},N=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]},Q=e=>e<1e4?e.toString():e<1e8?e/1e4+"万":e/1e8+"亿",U=()=>{k&&k.resize(),Z&&Z.resize()};return o((async()=>{await(async()=>{const e=await z.getOverview({group_by_fields:[["environment"],["region_id"],["policy"],["az_redundancy"],["storage_class"]],object_number_top_n:10,size_top_n:10});G.overviewData.total=[{total:"总数",count:e.count}],e.group_by.forEach((e=>{let t=e.fields[0],a=e.items.sort(((e,t)=>t.count-e.count));G.overviewData[t]=a})),G.overviewData.object_number_top_n=e.object_number_top_n,G.overviewData.size_top_n=e.size_top_n})(),await(async()=>{let e=G.overviewData;e.policy.forEach((e=>{e.policy=e.policy||"其他"})),G.regionList=await f.getCloudRegionList(),e.region_id.forEach((e=>{var t;e.region_id=(null==(t=G.regionList)?void 0:t[e.region_id])||e.region_id}))})(),i((()=>{(()=>{if(!G.overviewData.object_number_top_n)return;const e=[...G.overviewData.object_number_top_n].reverse(),t={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){var t;const a=e[0].data.dataObj||{};return`\n                    <b>${a.bucket}</b><br/>\n                    区域：${(null==(t=G.regionList)?void 0:t[a.region_id])||a.region_id}<br/>\n                    对象数量：${Q(a.object_number)}\n                `}},grid:{left:150,right:100,bottom:20,top:20},xAxis:{type:"value",name:"对象数量"},yAxis:{type:"category",data:e.map((e=>e.bucket)),axisLabel:{interval:0}},series:[{type:"bar",data:e.map((e=>({value:e.object_number,dataObj:e}))),color:"#3c79bf",label:{show:!0,position:"right",formatter:function(e){const t=e.data.dataObj;return`${Q(t.object_number)}`}}}]};k||(k=D(j.value)),k.setOption(t),setTimeout((()=>{k&&k.resize()}),0)})(),(()=>{if(!G.overviewData.size_top_n)return;const e=[...G.overviewData.size_top_n].reverse(),t={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){var t;const a=e[0].data.dataObj||{};return`\n                    <b>${a.bucket}</b><br/>\n                    区域：${(null==(t=G.regionList)?void 0:t[a.region_id])||a.region_id}<br/>\n                    容量：${N(a.size)}\n                `}},grid:{left:150,right:100,bottom:20,top:20},xAxis:{type:"value",name:"容量"},yAxis:{type:"category",data:e.map((e=>e.bucket)),axisLabel:{interval:0}},series:[{type:"bar",data:e.map((e=>({value:e.size,dataObj:e}))),color:"#3c79bf",label:{show:!0,position:"right",formatter:function(e){const t=e.data.dataObj;return`${N(t.size)}`}}}]};Z||(Z=D(Y.value)),Z.setOption(t),setTimeout((()=>{Z&&Z.resize()}),0)})(),window.addEventListener("resize",U)}))})),(e,t)=>{const a=h,o=w,i=O,f=x;return s(),r("div",$,[n("div",L,[(s(),r(l,null,c(H,((t,a)=>n("div",{key:a,class:u(["summary-item",{"cursor-pointer":t.pointer}]),style:d({"--summary-color":t.color}),onClick:a=>t.pointer?e.$router.push({name:t.name}):null},[(s(!0),r(l,null,c(p(G).overviewData[a],((e,o)=>(s(),r(l,{key:o},[n("div",null,[n("div",{class:"summary-value",style:d({"font-size":"total"===a?"32px":""})},v(e.count),5),n("div",B,v(e[a]),1)]),t.icon?(s(),r("img",{key:0,class:"summary-icon",src:`/images/${t.icon}`},null,8,M)):b("",!0),C],64)))),128))],14,A))),64))]),_(f,{title:"资源分布"},{default:m((()=>[n("div",T,[(s(),r(l,null,c(K,((e,t)=>{var d;return n("div",{key:t,class:"desc-card"},[n("div",E,v(e.label),1),n("div",R,[(s(!0),r(l,null,c(null==(d=p(G).overviewData)?void 0:d[t],(d=>(s(),r("div",{key:d.label,class:u({"two-col":"spec_code"===t})},[_(o,{title:d[t]},{default:m((()=>[n("span",F,[!e.icon||"cloud_source"===t&&"自建"===d.cloud_source?b("",!0):(s(),y(a,{key:0,type:d.cloud_source,style:{width:"22px"}},null,8,["type"])),g(" "+v(d[t])+"： ",1)])])),_:2},1032,["title"]),n("span",P,[d.other_data?(s(),r("span",I,[_(i,{placement:"right"},{content:m((()=>[(s(!0),r(l,null,c(d.other_data,((o,i)=>(s(),r("div",{key:i},[n("span",J,[e.icon?(s(),y(a,{key:0,type:o.cloud_source,style:{width:"22px"}},null,8,["type"])):b("",!0),g(" "+v(o[t])+": ",1)]),g(" "+v(o.count),1)])))),128))])),default:m((()=>[n("span",null,v(d.count),1)])),_:2},1024)])):(s(),r("span",S,v(d.count),1))])],2)))),128))])])})),64))])])),_:1}),_(f,{title:"对象数量Top10"},{default:m((()=>[n("div",{ref_key:"objNumberChartRef",ref:j,style:{width:"100%",height:"400px","margin-bottom":"24px"}},null,512)])),_:1}),_(f,{title:"容量Top10"},{default:m((()=>[n("div",{ref_key:"sizeChartRef",ref:Y,style:{width:"100%",height:"400px","margin-bottom":"24px"}},null,512)])),_:1})])}}},[["__scopeId","data-v-1e506eed"]]);export{Y as default};
