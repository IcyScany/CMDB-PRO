import{s as t,_ as e}from"./subPage.2201bfd5.js";import{_ as a}from"./ServerTable.53881589.js";import{b5 as l,al as s,r as i,O as n,Q as o,U as d,W as r,c as u,$ as c,R as p,F as m,S as f,a8 as _,aN as v,Z as y,X as h,Y as w,an as b,am as g,ao as x,v as k,aY as j,a3 as C,H as S,a6 as D,ah as T,a9 as O,aa as A,q as I,J as E,I as F,ad as P,a0 as R,aV as z}from"./index.872a2bd0.js";import{t as N}from"./tableRender.a6ff99b7.js";import{o as B,_ as U,u as $}from"./opsFormInit.3a4e1794.js";import{_ as L}from"./index.029351cd.js";import{A as W}from"./cloudCdnApi.85d2724e.js";import{_ as Y}from"./Title.f705c4e3.js";import{D as H,_ as q}from"./index.a533313d.js";import{_ as G}from"./index.9846e408.js";import{_ as M}from"./index.65b2e021.js";import"./opsDescriptions.dfa169bd.js";import"./index.87ccdcd1.js";import"./index.fc9664cf.js";import"./index.2c670fa1.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./alertLevel.8dae0e72.js";import"./index.44a4e190.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.48209b21.js";import"./index.64f8d8d4.js";const J={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:l}},emits:["update:open","editSuccess"],setup(t,{emit:e}){const a=t,{open:l,sid:y,formType:h}=s(a),w=e,b=i(null),{putEdit:g,getDetail:x,postAdd:k}=W,{formRenderContent:j,formDataLoading:C,confirmLoading:S,initForm:D,formDataInit:T,editSubmit:O}=B({formRef:b,TITLE_LAYER:1,formType:h,sid:y,emits:w,addApi:k,editApi:g,oneDataApi:x,customSubmitData:async function(t){return t},customEditData:function(){}});const A=()=>{w("update:open",!1)},I=async t=>{t&&(await D(),await T())};return(t,e)=>{const a=U,s=_,i=v,y=n("vxe-button"),w=L;return o(),d(w,{title:`${t.$route.meta.title}${c(h)===t.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:c(l),onAfterOpenChange:I,onClose:A},{footer:r((()=>[u(y,{content:"取消",onClick:A}),u(y,{type:"submit",loading:c(S),status:"primary",content:"提交",onClick:c(O)},null,8,["loading","onClick"])])),default:r((()=>[u(i,{spinning:c(C)},{default:r((()=>[u(s,{ref_key:"formRef",ref:b,model:c(j).formState,rules:c(j).rules},{default:r((()=>[(o(!0),p(m,null,f(t.$utils.filter(c(j).title,(t=>t.edit_display)),(t=>{var e,l,s,i;return o(),p(m,{key:t.field},[""===t.field?(o(),d(a,{key:0,value:c(j).formState[t.field],"onUpdate:value":e=>c(j).formState[t.field]=e,title:t,"title-data":null==(l=null==(e=c(j))?void 0:e.title_data)?void 0:l[t.field]},null,8,["value","onUpdate:value","title","title-data"])):(o(),d(a,{key:1,value:c(j).formState[t.field],"onUpdate:value":e=>c(j).formState[t.field]=e,title:t,"title-data":null==(i=null==(s=c(j))?void 0:s.title_data)?void 0:i[t.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},K={key:0,class:"flex items-center justify-center mt-5 text-primary"},Q=h("span",null,"下一跳",-1),V={class:"ml-4"},X={class:"truncate",style:{"max-width":"fit-content"}},Z={__name:"descCard",props:{descData:{type:Object,default:()=>({})},descFields:{type:Object,default:()=>({})},slots:{type:Array,default:()=>[]},customItem:{type:String,default:""},title:{type:String,default:""},arrow:{type:Boolean,default:!1},customSpan:{type:Object,default:()=>({})},cardStyle:{type:Object,default:()=>({})}},setup(t){const e=t,{descData:a,descFields:l}=s(e),i={label:{fontWeight:500},content:{display:"inline-block",paddingRight:"30px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},n={maxWidth:"500px",fontSize:"12px"};return(e,s)=>{const _=x,v=Y,C=k,S=H,D=q,T=j;return o(),p(m,null,[t.arrow?(o(),p("div",K,[u(_,{iconname:"icon-a-DownArrow",style:{"font-size":"50px"}}),Q])):y("",!0),u(v,{level:4},{default:r((()=>[h("span",V,w(t.title),1)])),_:1}),u(T,{style:g(t.cardStyle)},{default:r((()=>[u(D,{"label-style":i.label,"content-style":i.content},{default:r((()=>[(o(!0),p(m,null,f(c(l),((l,s)=>{var i;return o(),d(S,{key:s,label:l,span:(null==(i=t.customSpan)?void 0:i[s])||1},{default:r((()=>[t.slots.includes(s)?b(e.$slots,s,{key:0}):(o(),d(C,{key:1,title:c(a)[s],"overlay-style":n},{default:r((()=>[h("div",X,w(c(a)[s]),1)])),_:2},1032,["title"]))])),_:2},1032,["label","span"])})),128)),t.customItem?b(e.$slots,t.customItem,{key:0}):y("",!0)])),_:3},8,["label-style","content-style"])])),_:3},8,["style"])],64)}}},tt={key:0,style:{margin:"50px 0"}},et={class:"ml-4 text-primary"},at={key:0},lt={key:1},st={key:0},it=(t=>(O("data-v-45154588"),t=t(),A(),t))((()=>h("span",null,"没有查询到回源信息",-1))),nt={key:2},ot={key:3},dt={class:"truncate"},rt={key:1,class:"text-left"},ut=C({__name:"sourceList",props:{open:{type:Boolean,default:!1},initTitleData:{type:Object,default:()=>({})},rowData:{type:Object,default:()=>({})}},emits:["update:open"],setup(t,{emit:e}){const a=t,{open:l,initTitleData:_,rowData:v}=s(a),b=e,g=i(!1),x=S({type:"",data:{cdn:{},source:[],waf:[],nat:[]}}),j=S({cdn:{title:"CDN基本信息",fields:{cloud_type:"云类型",domain_id:"云数据ID",domain_name:"域名",domain_status:"加速域名状态",business_type:"业务类型",cname:"CNAME",https_status:"HTTPS状态",description:"备注"}},source:{title:"当前回源信息",fields:{origin_type:"源站类型",ip_or_domain:"源站地址",active_standby:"优先级",http_port:"HTTP端口",https_port:"HTTPS端口",description:"备注"}},waf:{title:"WAF信息",fields:{cloud_type:"云类型",hostname:"域名",access_status:"接入状态",access_code:"CNAME",description:"备注"}},nat:{title:"NAT信息",fields:{description:"备注"},addressFields:{public_ip:"外网IP",public_port:"外网端口",arrow:"",internal_ip:"内网IP",internal_port:"内网端口",status:"状态"}}}),C={label:{fontWeight:500},content:{display:"inline-block",paddingRight:"30px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},O={maxWidth:"500px",fontSize:"12px"},A=async()=>{var t,e;if(!l.value)return x.type="",void(x.data={cdn:{},source:[],waf:[],nat:[]});g.value=!0;const a=await W.getNextHop(v.value.id);x.type=null==(e=null==(t=v.value.sources)?void 0:t[0])?void 0:e.origin_type,x.data.cdn=v.value,x.data.source=v.value.sources,"ipaddr"===x.type&&a.length&&(x.data.nat=[a]),"domain"===x.type&&v.value.sources.forEach((t=>{var e,l,s,i,n;let o=t.ip_or_domain;Object.keys((null==(e=a[o])?void 0:e.data)||{}).length&&x.data.waf.push(null==(l=a[o])?void 0:l.data),(null==(i=null==(s=a[o])?void 0:s.nat)?void 0:i.length)&&x.data.nat.push(null==(n=a[o])?void 0:n.nat)})),g.value=!1},I=()=>{b("update:open",!1)};return(t,e)=>{const a=G,s=Y,i=n("vxe-tag"),v=n("vxe-icon"),b=M,S=k,E=n("ArrowRightOutlined"),F=H,P=q,R=L;return o(),d(R,{open:c(l),title:"源站配置信息",width:"70%",loading:c(g),onClose:I,onAfterOpenChange:A},{default:r((()=>[(o(!0),p(m,null,f(c(x).data.waf.length||1,((t,e)=>{var l,n,g,k,A,I,R;return o(),p("div",{key:e},[c(x).data.waf.length>1?(o(),p(m,{key:0},[e?(o(),p("div",tt,[u(a,{style:{"background-color":"var(--warning-color)",margin:"2px 0"}}),u(a,{style:{"background-color":"var(--warning-color)",margin:"2px 0"}})])):y("",!0),u(s,{level:3},{default:r((()=>[h("span",et,"源站信息"+w(e+1),1)])),_:2},1024)],64)):y("",!0),u(Z,{"desc-data":c(x).data.cdn,"desc-fields":c(j).cdn.fields,slots:["https_status","domain_status"],title:"CDN基本信息","card-style":{borderColor:"var(--primary-color)"}},{https_status:r((()=>{var t;return[u(i,{class:D(0!==(null==(t=c(x).data.cdn)?void 0:t.https_status)?"theme--primary":"theme--error"),size:"small"},{default:r((()=>{var t;return[T(w(0!==(null==(t=c(x).data.cdn)?void 0:t.https_status)?"已开启":"未启用"),1)]})),_:1},8,["class"])]})),domain_status:r((()=>{var t;return[u(i,{class:D("已开启"===(null==(t=c(x).data.cdn)?void 0:t.domain_status)?"theme--primary":"theme--error"),size:"small"},{default:r((()=>{var t;return[T(w(null==(t=c(x).data.cdn)?void 0:t.domain_status),1)]})),_:1},8,["class"])]})),_:1},8,["desc-data","desc-fields"]),"obs_bucket"===c(x).type||["ipaddr","domain"].includes(c(x).type)&&!(null==(l=c(x).data.waf)?void 0:l.length)&&!(null==(n=c(x).data.nat)?void 0:n.length)?(o(),p(m,{key:1},[u(Z,{"desc-data":null==(g=c(x).data.source)?void 0:g[0],"desc-fields":c(j).source.fields,slots:["active_standby","origin_type"],title:"当前回源信息",arrow:!0},{active_standby:r((()=>{var t,e;return[1==(null==(e=null==(t=c(x).data.source)?void 0:t[0])?void 0:e.active_standby)?(o(),p("span",at,"主源站")):(o(),p("span",lt,"备源站"))]})),origin_type:r((()=>[h("span",null,w(c(_)[c(x).type]||c(x).type),1)])),_:1},8,["desc-data","desc-fields"]),"obs_bucket"!==c(x).type?(o(),p("div",st,[u(b,{type:"warning","show-icon":"",class:"alert-message"},{icon:r((()=>[u(v,{name:"warning-triangle-fill","class-name":"alert-message-icon"})])),description:r((()=>[it])),_:1})])):y("",!0)],64)):y("",!0),(null==(k=c(x).data.waf)?void 0:k[e])?(o(),p("div",nt,[u(Z,{"desc-data":null==(A=c(x).data.waf)?void 0:A[e],"desc-fields":c(j).waf.fields,slots:["access_status"],title:"WAF信息",arrow:!0},{access_status:r((()=>{var t,a;return[u(i,{class:D(1==(null==(a=null==(t=c(x).data.waf)?void 0:t[e])?void 0:a.access_status)?"theme--primary":"theme--error"),size:"small"},{default:r((()=>{var t,a;return[T(w(1==(null==(a=null==(t=c(x).data.waf)?void 0:t[e])?void 0:a.access_status)?"接入":"未接入"),1)]})),_:2},1032,["class"])]})),_:2},1032,["desc-data","desc-fields"])])):y("",!0),(null==(I=c(x).data.nat)?void 0:I[e])?(o(),p("div",ot,[u(Z,{"desc-data":null==(R=c(x).data.nat)?void 0:R[e],"desc-fields":c(j).nat.fields,slots:["description"],title:"NAT信息",arrow:!0,"custom-item":"customItem","custom-span":{description:3}},{description:r((()=>{var t,a;return[u(S,{title:null==(a=null==(t=c(x).data.nat)?void 0:t[e])?void 0:a.reduce(((t,e)=>t+e.description+"; "),""),"overlay-style":O},{default:r((()=>{var t,a;return[h("div",dt,w(null==(a=null==(t=c(x).data.nat)?void 0:t[e])?void 0:a.reduce(((t,e)=>t+e.description+"; "),"")),1)]})),_:2},1032,["title"])]})),customItem:r((()=>{var t;return[(o(!0),p(m,null,f(null==(t=c(x).data.nat)?void 0:t[e],((t,e)=>(o(),d(F,{key:e,span:3},{default:r((()=>[u(P,{column:19,"label-style":C.label,"content-style":C.content},{default:r((()=>[(o(!0),p(m,null,f(c(j).nat.addressFields,((e,a)=>(o(),d(F,{key:a,label:e,span:"arrow"===a?1:["public_port","internal_port","status"].includes(a)?2:3,style:{paddingBottom:0}},{default:r((()=>[u(S,{title:null==t?void 0:t[a],"overlay-style":O},{default:r((()=>["status"===a?(o(),d(i,{key:0,class:D("可用"==(null==t?void 0:t[a])?"theme--primary":"theme--error"),size:"small"},{default:r((()=>[T(w(null==t?void 0:t[a]),1)])),_:2},1032,["class"])):"arrow"===a?(o(),p("div",rt,[u(E,{style:{fontSize:"20px"}})])):(o(),p(m,{key:2},[T(w(null==t?void 0:t[a]),1)],64))])),_:2},1032,["title"])])),_:2},1032,["label","span"])))),128))])),_:2},1032,["label-style","content-style"])])),_:2},1024)))),128))]})),_:2},1032,["desc-data","desc-fields"])])):y("",!0)])})),128))])),_:1},8,["open","loading"])}}},[["__scopeId","data-v-45154588"]]),ct={class:"text-12"},pt=["onClick"],mt=["onClick"],ft={style:{display:"flex","align-items":"center"}},_t={__name:"index",setup(l){const s=i(null),d=S({initColumn:[],initButton:[],initTitleData:{},tableOrder:{},showSourcesOpen:!1,rowData:{},subPageColumns:[],titleFieldSearch:[]}),{userEdit:f,formOpen:_,formType:v,formSid:y}=$(),b=I((()=>{const t=["sources","https_status","domain_name","id","domain_status","cname"];return d.initColumn.map((e=>t.includes(e.field)?{...e,slots:{default:e.field}}:"virtual_team_v3_id"===e.field?{...e,showOverflow:!1}:e))})),g=I((()=>{const t=["edit"];return d.initButton.reduce(((e,a)=>(t.includes(a.field)&&(e[a.field]=a),e)),{})}));E((async()=>{const{button:t,columns:e,title_data:a,order:l,sub_page_columns:s,title_field_search:i}=await N.setColumn({layer:1});d.initColumn=e.value||[],d.initButton=t.value||[],d.initTitleData=a.value||{},d.tableOrder=l.value?l.value:{},d.subPageColumns=s||[],d.titleFieldSearch=i.value||[],await F(),await x()}));const x=async()=>{var t;(null==(t=s.value)?void 0:t.serverTableRef)&&s.value.serverTableRef.commitProxy("query")},j=({type:t,row:e})=>{f({type:t,sid:e.id})},C=t=>{d.showSourcesOpen=!0,d.rowData=R.clone(t,!0)},{subPageOpen:O,subPageRow:A,handleSubPageOpen:B}=t();return(t,l)=>{var i,f,S;const I=n("vxe-button"),E=n("vxe-tag"),F=k,R=z,N=a,U=e;return o(),p(m,null,[u(N,{ref_key:"tableRef",ref:s,"table-column":c(b),"auth-btn":c(g),"query-api":c(W).postList,order:c(d).tableOrder,"filter-config":{remote:!1,showIcon:!0},"title-field-search":c(d).titleFieldSearch,onUserEdit:j},{sources:r((({row:t})=>[u(I,{mode:"text",status:"primary",content:"查看源站",onClick:e=>C(t)},null,8,["onClick"])])),https_status:r((({row:t})=>[u(E,{class:D(0!==t.https_status?"theme--primary":"theme--error"),size:"small"},{default:r((()=>[T(w(0!==t.https_status?"已开启":"未启用"),1)])),_:2},1032,["class"])])),id:r((({row:t})=>[u(F,{placement:"topLeft"},{title:r((()=>[h("span",ct," 云数据ID："+w(t.domain_id),1)])),default:r((()=>[h("span",{class:"cursor-pointer text-primary",onClick:e=>c(B)(t)},w(t.id),9,pt)])),_:2},1024)])),cname:r((({row:t})=>[h("span",{class:"cursor-pointer text-primary",onClick:e=>c(B)(t)},w(t.cname),9,mt)])),domain_name:r((({row:t})=>[T(w(t.domain_name),1)])),domain_status:r((({row:t})=>[u(E,{class:D("已开启"===t.domain_status?"theme--primary":"theme--error"),size:"small"},{default:r((()=>[T(w(t.domain_status),1)])),_:2},1032,["class"])])),cloud_master_account_id:r((({row:t})=>{var e,a,l;return[h("div",ft,[u(R,{type:null==t?void 0:t.cloud_source},null,8,["type"])]),T(" "+w((null==(l=null==(a=null==(e=c(d).initTitleData)?void 0:e.cloud_master_account_id)?void 0:a[t.cloud_master_account_id])?void 0:l.page_display)||""),1)]})),_:1},8,["table-column","auth-btn","query-api","order","title-field-search"]),u(J,{open:c(_),"onUpdate:open":l[0]||(l[0]=t=>P(_)?_.value=t:null),sid:c(y),"form-type":c(v),onEditSuccess:x},null,8,["open","sid","form-type"]),u(ut,{open:c(d).showSourcesOpen,"onUpdate:open":l[1]||(l[1]=t=>c(d).showSourcesOpen=t),"row-data":c(d).rowData,"init-title-data":null==(i=c(d).initTitleData)?void 0:i.sources},null,8,["open","row-data","init-title-data"]),u(U,{open:c(O),"onUpdate:open":l[2]||(l[2]=t=>P(O)?O.value=t:null),title:null==(f=c(A))?void 0:f.cname,"basic-config":{columns:c(d).subPageColumns,api:c(W).getDetail,sid:null==(S=c(A))?void 0:S.id},onClickEdit:l[3]||(l[3]=e=>j({type:t.$CONFIG.FORM_TYPE.EDIT_TYPE,row:c(A)}))},{https_status:r((({row:t})=>[u(E,{class:D(0!==t.https_status?"theme--primary":"theme--error"),size:"small"},{default:r((()=>[T(w(0!==t.https_status?"已开启":"未启用"),1)])),_:2},1032,["class"])])),domain_name:r((({row:t})=>[T(w(t.domain_name),1)])),domain_status:r((({row:t})=>[u(E,{class:D("已开启"===t.domain_status?"theme--primary":"theme--error"),size:"small"},{default:r((()=>[T(w(t.domain_status),1)])),_:2},1032,["class"])])),sources:r((({row:t})=>[u(I,{mode:"text",status:"primary",content:"查看源站",onClick:e=>C(t)},null,8,["onClick"])])),cloud_master_account_id:r((({row:t})=>{var e,a,l;return[T(w((null==(l=null==(a=null==(e=c(d).initTitleData)?void 0:e.cloud_master_account_id)?void 0:a[t.cloud_master_account_id])?void 0:l.page_display)||""),1)]})),_:1},8,["open","title","basic-config"])],64)}}};export{_t as default};
