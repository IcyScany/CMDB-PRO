import{s as e,_ as t}from"./subPage.2201bfd5.js";import{_ as o}from"./ServerTable.53881589.js";import{_ as l}from"./index.1e532bb2.js";import{_ as a}from"./index.de966786.js";import{b5 as n,al as i,r as s,H as r,O as u,Q as d,U as m,W as c,c as p,$ as _,R as g,F as b,S as f,aT as v,a8 as y,aN as h,a3 as k,q as x,x as C,X as w,Y as S,Z as T,a6 as D,ah as P,aU as M,dB as O,v as j,aY as z,J as B,ad as I,ao as $,dC as F,ap as A,I as R,av as E,C as V,D as N,ag as Y,aZ as U,aV as G}from"./index.872a2bd0.js";import{t as W}from"./tableRender.a6ff99b7.js";import{o as H,_ as q,u as L}from"./opsFormInit.3a4e1794.js";import{_ as Q}from"./index.029351cd.js";import{A as Z,a as J}from"./mongodb.041b3b58.js";import{a as K}from"./opsDescriptions.dfa169bd.js";import{d as X}from"./opsTable.7b07fc7b.js";import{_ as ee}from"./Title.f705c4e3.js";import{i as te}from"./index.165d9fa7.js";import{_ as oe}from"./index.44a4e190.js";import{R as le}from"./dayjs.c124633a.js";import{_ as ae}from"./index.8338e1f7.js";import{_ as ne}from"./index.48209b21.js";import"./index.2c670fa1.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.fc9664cf.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.65b2e021.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.64f8d8d4.js";import"./index.87ccdcd1.js";import"./index.a533313d.js";import"./useMaxLevel.bba6798c.js";const ie={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:n}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const o=e,{open:l,sid:a,formType:n}=i(o),k=t,x=s(null),{putEdit:C,getDetail:w,postAdd:S}=Z,T=r({originPwd:""}),{formRenderContent:D,formDataLoading:P,confirmLoading:M,initForm:O,formDataInit:j,editSubmit:z}=H({formRef:x,TITLE_LAYER:1,formType:n,sid:a,emits:k,addApi:S,editApi:C,oneDataApi:w,customSubmitData:async function(e){e.password!==T.originPwd?e.password=await v(e.password):delete e.password;return e},customEditData:function(e){var t;return e.value.password=(null==(t=e.value)?void 0:t.password)||"",T.originPwd=e.value.password||"",e}});const B=()=>{k("update:open",!1)},I=async e=>{e&&(await O(),await j())};return(e,t)=>{const o=q,a=y,i=h,s=u("vxe-button"),r=Q;return d(),m(r,{title:`${e.$route.meta.title}${_(n)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:_(l),onAfterOpenChange:I,onClose:B},{footer:c((()=>[p(s,{content:"取消",onClick:B}),p(s,{type:"submit",loading:_(M),status:"primary",content:"提交",onClick:_(z)},null,8,["loading","onClick"])])),default:c((()=>[p(i,{spinning:_(P)},{default:c((()=>[p(a,{ref_key:"formRef",ref:x,model:_(D).formState,rules:_(D).rules},{default:c((()=>[(d(!0),g(b,null,f(e.$utils.filter(_(D).title,(e=>e.edit_display)),(e=>{var t,l,a,n;return d(),g(b,{key:e.field},[""===e.field?(d(),m(o,{key:0,value:_(D).formState[e.field],"onUpdate:value":t=>_(D).formState[e.field]=t,title:e,"title-data":null==(l=null==(t=_(D))?void 0:t.title_data)?void 0:l[e.field]},null,8,["value","onUpdate:value","title","title-data"])):(d(),m(o,{key:1,value:_(D).formState[e.field],"onUpdate:value":t=>_(D).formState[e.field]=t,title:e,"title-data":null==(n=null==(a=_(D))?void 0:a.title_data)?void 0:n[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},se={class:"ml-4"},re={class:"text-12"},ue={class:"truncate inline-block"},de={key:2},me={class:"mb-2",style:{color:"#868686"}},ce={key:0},pe={class:"mx-4 text-15 font-[700]"},_e={key:1,class:"inline-flex items-center gap-1"},ge={class:"mx-2"},be={class:"text-12"},fe={class:"truncate inline-block"},ve=k({__name:"basicTab",props:{data:{type:Object,default:()=>({})},columns:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>({})}},setup(e){const t=e,o=[{title:"基础信息",block:1,columns:[]},{title:"规格配置",block:2,columns:[]},{title:"连接信息",block:3,columns:[]},{title:"网络信息",block:4,columns:[]},{title:"付费信息",block:5,columns:[]},{title:"节点信息",block:6,columns:[]}],n=x((()=>{var e;return{...t.data,...null==(e=t.data)?void 0:e.cloud_specific}})),i=x((()=>({id:"mongodbNodes",...X,maxHeight:"500px",columns:t.columns.filter((e=>{var t;if(10===(null==(t=null==e?void 0:e.oriTitle)?void 0:t.block))return"addresses"===e.field&&(e.slots={default:e.field}),"status"===e.field&&(e.slots={default:e.field}),e}))}))),s=x((()=>{var e,t;let o=(null==(e=n.value)?void 0:e.node_groups)||[];if("Sharding"===(null==(t=n.value)?void 0:t.deployment_mode)){let e=["mongos","config","shard"];o=o.sort(((t,o)=>e.indexOf(t.type)-e.indexOf(o.type)))}return o}));return C((()=>t.data),(()=>{o.forEach((e=>{e.columns=t.columns.filter((t=>{var o,l;if(10!==(null==(o=null==t?void 0:t.oriTitle)?void 0:o.block)){let o=Object.keys(n.value);return(null==(l=null==t?void 0:t.oriTitle)?void 0:l.block)===e.block&&o.includes(null==t?void 0:t.field)}}))}))})),(t,r)=>{const v=ee,y=O,h=u("vxe-tag"),k=j,x=a,C=K,B=l,I=u("vxe-grid"),$=z;return d(),g(b,null,f(o,(t=>w("div",{key:t.title,class:"mb-4"},[p(v,{level:5},{default:c((()=>[w("span",se,S(t.title),1)])),_:2},1024),p($,{style:{borderColor:"#cccccc"}},{default:c((()=>[0===t.columns.length?(d(),m(y,{key:0})):T("",!0),"节点信息"!==t.title?(d(),m(C,{key:1,data:_(n),columns:t.columns,column:2,"label-style":{width:"200px",marginRight:"10px",color:"#868686"},size:"small"},{status:c((({row:e})=>[p(h,{class:D("运行中"==e.status?"theme--primary":"theme--error"),size:"small"},{default:c((()=>[P(S(e.status),1)])),_:2},1032,["class"])])),cloud_master_account_id:c((({row:t})=>{var o,l,a;return[P(S((null==(a=null==(l=null==(o=e.titleData)?void 0:o.cloud_master_account_id)?void 0:l[t.cloud_master_account_id])?void 0:a.page_display)||""),1)]})),node_groups:c((({row:e})=>[(d(!0),g(b,null,f(e.node_groups,((e,t)=>(d(),g(b,{key:t},[(d(!0),g(b,null,f(e.nodes,((e,t)=>(d(),g(b,{key:t},[(d(!0),g(b,null,f(e.addresses,((e,t)=>(d(),g("div",{key:t,class:"mb-2"},[p(k,null,{title:c((()=>[w("div",re,S(e.address)+S(e.port?`:${e.port}`:""),1)])),default:c((()=>[p(h,{class:"theme--primary",size:"small"},{default:c((()=>[w("span",ue,S(e.address)+S(e.port?`:${e.port}`:""),1)])),_:2},1024)])),_:2},1024)])))),128))],64)))),128))],64)))),128))])),expire_time:c((({row:e})=>[p(x,{"expired-time":e.expire_time,"sub-page":!0},null,8,["expired-time"])])),_:2},1032,["data","columns"])):(d(),g("div",de,[(d(!0),g(b,null,f(_(s),((e,t)=>{var o;return d(),g("div",{key:t,class:"nodes-table"},[w("div",me,["Sharding"===(null==(o=_(n))?void 0:o.deployment_mode)?(d(),g("span",ce,[w("span",pe,S(e.name||e.type),1)])):T("",!0),e.volume_size?(d(),g("span",_e,[w("span",ge,"磁盘大小："+S(e.volume_size)+"GB",1),p(k,null,{title:c((()=>[w("div",be,"磁盘使用量："+S(e.volume_used)+"GB",1)])),default:c((()=>[p(B,{percentage:e.volume_used/e.volume_size},null,8,["percentage"])])),_:2},1024)])):T("",!0)]),p(I,M({data:e.nodes,ref_for:!0},_(i)),{addresses:c((({row:e})=>[(d(!0),g(b,null,f(e.addresses,((e,t)=>(d(),m(h,{key:t,class:"theme--primary",size:"small"},{default:c((()=>[w("span",fe,S(e.address)+S(e.port?`:${e.port}`:""),1)])),_:2},1024)))),128))])),status:c((({row:e})=>[p(h,{class:D("运行中"==e.status?"theme--primary":"theme--error"),size:"small"},{default:c((()=>[P(S(e.status),1)])),_:2},1032,["class"])])),_:2},1040,["data"])])})),128))]))])),_:2},1024)]))),64)}}},[["__scopeId","data-v-82d125e6"]]),ye={class:"text-error error-msg"},he=k({__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:n},type:{type:String,default:"account"}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const o=e,{open:l,sid:a,formType:n}=i(o),k=t,x=s(null),{putEdit:C,getDetail:T}=J[o.type],D=r({originPwd:"",errorMsg:""}),{formRenderContent:P,formDataLoading:M,confirmLoading:O,initForm:j,formDataInit:z,editSubmit:B}=H({formRef:x,editTitleLayer:{account:2,database:3,collection:4}[o.type],formType:n,sid:a,emits:k,editApi:C,oneDataApi:T,customSubmitData:async function(e){"account"===o.type&&(e.password!==D.originPwd?e.password=await v(e.password):delete e.password);return e},customEditData:function(e){var t;return e.value.password=(null==(t=e.value)?void 0:t.password)||"",D.originPwd=e.value.password||"",e},handleEditError:function(e){var t,o;D.errorMsg=null==(o=null==(t=null==e?void 0:e.response)?void 0:t.data)?void 0:o.msg}});const I=()=>{k("update:open",!1)},$=async e=>{D.errorMsg="",e&&(await j(),await z())};return(e,t)=>{const o=q,a=y,i=h,s=u("vxe-button"),r=Q;return d(),m(r,{title:`${e.$route.meta.title}${_(n)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:_(l),onAfterOpenChange:$,onClose:I},{footer:c((()=>[w("span",ye,S(_(D).errorMsg),1),p(s,{content:"取消",onClick:I}),p(s,{type:"submit",loading:_(O),status:"primary",content:"提交",onClick:_(B)},null,8,["loading","onClick"])])),default:c((()=>[p(i,{spinning:_(M)},{default:c((()=>[p(a,{ref_key:"formRef",ref:x,model:_(P).formState,rules:_(P).rules},{default:c((()=>[(d(!0),g(b,null,f(e.$utils.filter(_(P).title,(e=>e.edit_display)),(e=>{var t,l,a,n;return d(),g(b,{key:e.field},[""===e.field?(d(),m(o,{key:0,value:_(P).formState[e.field],"onUpdate:value":t=>_(P).formState[e.field]=t,title:e,"title-data":null==(l=null==(t=_(P))?void 0:t.title_data)?void 0:l[e.field]},null,8,["value","onUpdate:value","title","title-data"])):(d(),m(o,{key:1,value:_(P).formState[e.field],"onUpdate:value":t=>_(P).formState[e.field]=t,title:e,"title-data":null==(n=null==(a=_(P))?void 0:a.title_data)?void 0:n[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},[["__scopeId","data-v-b1818383"]]),ke=w("span",{class:"ml-1"},"MongoDB列表",-1),xe={class:"ml-2"},Ce=["onClick"],we=["onClick"],Se={__name:"index",props:{instanceName:{type:[String,Number],default:""},type:{type:String,required:!0}},emits:["update:type","mongodbSubPageOpen"],setup(e,{emit:t}){const l=e,a=t,n={account:2,database:3,collection:4},i={account:"MongoDB账号",database:"MongoDB数据库",collection:"MongoDB集合"},v=s(null),y=r({initColumn:[],initButton:[],initTitleData:[],tableOrder:{},subPageColumns:[],titleFieldSearch:[],defaultQueryCondition:[]}),{userEdit:h,userDel:k,formOpen:D,formType:M,formSid:O}=L(),j=x((()=>{for(let e of y.initColumn){let{field:t}=e;switch(t){case"shards":case"size_on_disk":e.slots={default:t},e.showOverflow=!1;break;case"mongodb_instance":e.slots={default:t},e.visible=!l.instanceName;break;case"virtual_team_v3_id":e.showOverflow=!1}}return y.initColumn})),z=x((()=>{const e=["edit","add","del"];return y.initButton.reduce(((t,o)=>(e.includes(o.field)&&(t[o.field]=o),t)),{})}));B((async()=>{const{button:e,columns:t,title_data:o,order:a,sub_page_columns:i,title_field_search:s}=await W.setColumn({layer:n[l.type],tableType:"server"});y.initColumn=t.value||[],y.initButton=e.value||[],y.initTitleData=o.value||[],y.tableOrder=a.value||{},y.subPageColumns=i||[],y.titleFieldSearch=s||{},await F()}));const F=async()=>{v.value&&(l.instanceName?y.defaultQueryCondition=[{field:"mongodb_instance__name",condition:"=",field_name:"MongoDB实例名",value:l.instanceName,disableClose:!0}]:await v.value.serverTableRef.commitProxy("query"))},A=({type:e,row:t})=>{h({type:e,sid:t.id})},R=({row:e})=>{k({sid:e.id,delApi:J[l.type].del,loadData:F})},E=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},V={fields:[{field:{account:"username",database:"name",collection:"collection_name"}[l.type],field_name:`${i[l.type]}名`,operator:"vague"}],placeholder:`支持${i[l.type]}名搜索`};return C((()=>l.instanceName),(e=>{e&&F()})),(e,t)=>{const n=$,s=u("vxe-button"),r=u("SearchOutlined"),k=o;return d(),g(b,null,[p(k,{ref_key:"tableRef",ref:v,"table-column":_(j),"auth-btn":_(z),order:_(y).tableOrder,"query-api":_(J)[l.type].getList,"default-search-field":V,"title-field-search":_(y).titleFieldSearch,"default-query-condition":_(y).defaultQueryCondition,onUserEdit:A,onUserAdd:t[1]||(t[1]=t=>_(h)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:R},{other_toolbar_buttons:c((()=>[l.instanceName?T("",!0):(d(),m(s,{key:0,onClick:t[0]||(t[0]=e=>a("update:type","mongodb"))},{default:c((()=>[p(n,{iconname:"icon-mongoDB"}),ke])),_:1})),w("span",xe,"当前页面："+S(i[l.type]),1)])),mongodb_instance:c((({row:e})=>{var t;return[w("span",{class:"cursor-pointer text-primary",onClick:t=>a("mongodbSubPageOpen",null==e?void 0:e.mongodb_instance)},S(null==(t=null==e?void 0:e.mongodb_instance)?void 0:t.name),9,Ce),w("span",{class:"ml-1 cursor-pointer text-primary",onClick:t=>(e=>{y.defaultQueryCondition=[{field:"mongodb_instance__name",condition:"=",value:e.mongodb_instance.name,field_name:"MongoDB实例名"}]})(e)},[p(r)],8,we)]})),shards:c((({row:e})=>[(d(!0),g(b,null,f(e.shards,((e,t)=>(d(),g("span",{key:t},[w("div",null,S(t)+": "+S(E(e)),1)])))),128))])),size_on_disk:c((({row:e})=>[P(S(E(e.size_on_disk)),1)])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search","default-query-condition"]),p(he,{open:_(D),"onUpdate:open":t[2]||(t[2]=e=>I(D)?D.value=e:null),sid:_(O),"form-type":_(M),type:l.type,onEditSuccess:F},null,8,["open","sid","form-type","type"])],64)}}},Te=[{label:"近30分钟",value:[F().add(-30,"m"),F()]},{label:"近1小时",value:[F().add(-1,"h"),F()]},{label:"近2小时",value:[F().add(-2,"h"),F()]},{label:"近3小时",value:[F().add(-2,"h"),F()]},{label:"近12小时",value:[F().add(-12,"h"),F()]},{label:"近24小时",value:[F().add(-24,"h"),F()]},{label:"近7天",value:[F().add(-7,"d"),F()]},{label:"近30天",value:[F().add(-30,"d"),F()]}],De=[{value:"300",label:"5分钟"},{value:"1200",label:"20分钟"},{value:"3600",label:"1小时"},{value:"14400",label:"4小时"},{value:"86400",label:"24小时"}],Pe=[{value:["average","1"],label:"原始值"},{value:"average",label:"平均值"},{value:"sum",label:"求和"},{value:"max",label:"最大值"},{value:"min",label:"最小值"}],Me={mongo001_command_ps:{label:"command执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒command语句在节点上执行次数。"},mongo002_delete_ps:{label:"delete语句执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒delete语句在节点上执行次数。"},mongo003_insert_ps:{label:"insert语句执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒insert语句在节点上执行次数。"},mongo004_query_ps:{label:"query语句执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒query语句在节点上执行次数。"},mongo005_update_ps:{label:"update语句执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒update语句在节点上执行次数。"},mongo006_getmore_ps:{label:"getmore语句执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒getmore语句在节点上执行次数。"},mongo007_chunk_num1:{label:"分片一的chunk数",unit:"Count",tooltip:"该指标用于统计分片一的chunk个数。"},mongo007_chunk_num2:{label:"分片二的chunk数",unit:"Count",tooltip:"该指标用于统计分片二的chunk个数。"},mongo007_chunk_num3:{label:"分片三的chunk数",unit:"Count",tooltip:"该指标用于统计分片三的chunk个数。"},mongo007_chunk_num4:{label:"分片四的chunk数",unit:"Count",tooltip:"该指标用于统计分片四的chunk个数。"},mongo007_chunk_num5:{label:"分片五的chunk数",unit:"Count",tooltip:"该指标用于统计分片五的chunk个数。"},mongo007_chunk_num6:{label:"分片六的chunk数",unit:"Count",tooltip:"该指标用于统计分片六的chunk个数。"},mongo007_chunk_num7:{label:"分片七的chunk数",unit:"Count",tooltip:"该指标用于统计分片七的chunk个数。"},mongo007_chunk_num8:{label:"分片八的chunk数",unit:"Count",tooltip:"该指标用于统计分片八的chunk个数。"},mongo007_chunk_num9:{label:"分片九的chunk数",unit:"Count",tooltip:"该指标用于统计分片九的chunk个数。"},mongo007_chunk_num10:{label:"分片十的chunk数",unit:"Count",tooltip:"该指标用于统计分片十的chunk个数。"},mongo007_chunk_num11:{label:"分片十一的chunk数",unit:"Count",tooltip:"该指标用于统计分片十一的chunk个数。"},mongo007_chunk_num12:{label:"分片十二的chunk数",unit:"Count",tooltip:"该指标用于统计分片十二的chunk个数。"},mongo008_connections:{label:"实例当前活动连接数",unit:"Count",tooltip:"该指标用于统计试图连接到DDS实例的总连接数。"},mongo009_migFail_num:{label:"过去一天块迁移的失败次数",unit:"Count",tooltip:"该指标用于统计过去一天中块迁移失败的次数。"},mongo007_connections:{label:"当前活动连接数",unit:"Count",tooltip:"该指标用于统计试图连接到DDS实例节点的总连接数。"},mongo007_connections_usage:{label:"当前活动连接数百分比",unit:"%",tooltip:"该指标用于统计试图连接到实例节点的连接数占可用连接数百分比。"},mongo008_mem_resident:{label:"驻留内存",unit:"MB",tooltip:"该指标用于统计当前驻留内存的大小。"},mongo009_mem_virtual:{label:"虚拟内存",unit:"MB",tooltip:"该指标用于统计当前虚拟内存的大小。"},mongo010_regular_asserts_ps:{label:"常规断言频率",unit:"Count/s",tooltip:"该指标用于统计常规断言频率。"},mongo011_warning_asserts_ps:{label:"警告频率",unit:"Count/s",tooltip:"该指标用于统计警告频率。"},mongo012_msg_asserts_ps:{label:"消息断言频率",unit:"Count/s",tooltip:"该指标用于统计消息断言频率。"},mongo013_user_asserts_ps:{label:"用户断言频率",unit:"Count/s",tooltip:"该指标用于统计用户断言频率。"},mongo014_queues_total:{label:"等待锁的操作数",unit:"Count",tooltip:"该指标用于统计当前等待锁的操作数。"},mongo015_queues_readers:{label:"等待读锁的操作数",unit:"Count",tooltip:"该指标用于统计当前等待读锁的操作数。"},mongo016_queues_writers:{label:"等待写锁的操作数",unit:"Count",tooltip:"该指标用于统计当前等待写锁的操作数。"},mongo017_page_faults:{label:"缺页错误数",unit:"Count",tooltip:"该指标用于统计当前节点上的缺页错误数。"},mongo018_porfling_num:{label:"慢查询数",unit:"Count",tooltip:"该指标用于统计当前节点上的前5分钟到当前时间点的慢查询总数。"},mongo019_cursors_open:{label:"当前维护游标数",unit:"Count",tooltip:"该指标用于统计当前节点上的维护游标数。"},mongo020_cursors_timeOut:{label:"服务超时游标数",unit:"Count",tooltip:"该指标用于统计当前节点上的服务超时游标数。"},mongo021_wt_cahe_usage:{label:"内存中数据量（WiredTiger引擎）",unit:"MB",tooltip:"该指标用于统计当前内存中数据量（WiredTiger引擎）。"},mongo022_wt_cahe_dirty:{label:"内存中脏数据量（WiredTiger引擎）",unit:"MB",tooltip:"该指标用于统计当前内存中脏数据量（WiredTiger引擎）。"},mongo023_wInto_wtCache:{label:"写入WiredTiger内存的频率",unit:"byte/s",tooltip:"该指标用于统计当前内存中写入频率（WiredTiger引擎）。"},mongo024_wFrom_wtCache:{label:"从WiredTiger内存写入磁盘频率",unit:"byte/s",tooltip:"该指标用于统计当前内存写入磁盘频率（WiredTiger引擎）。"},mongo025_repl_oplog_win:{label:"主节点的Oplog中可用时间",unit:"h",tooltip:"该指标用于统计当前实例下的主节点的Oplog中可用时间。"},mongo025_repl_headroom:{label:"主备Oplog重叠时长",unit:"s",tooltip:"该指标用于统计实例下的主节点和Secondary节点之间Oplog重叠时长。"},mongo026_repl_lag:{label:"主备延时",unit:"s",tooltip:"该指标用于统计实例下的主节点和Secondary节点之间的复制延时。"},mongo027_repl_command_ps:{label:"备节点复制的command执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒Secondary节点复制的command语句执行次数。"},mongo028_repl_update_ps:{label:"备节点复制的update语句执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒Secondary节点复制的update语句执行次数。"},mongo029_repl_delete_ps:{label:"备节点复制的delete语句执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒Secondary节点复制的delete语句执行次数。"},mongo030_repl_insert_ps:{label:"备节点复制的insert语句执行频率",unit:"Count/s",tooltip:"该指标用于统计平均每秒Secondary节点复制的insert语句执行次数。"},mongo031_cpu_usage:{label:"CPU使用率",unit:"%",tooltip:"该指标用于统计测量对象的CPU利用率。"},mongo032_mem_usage:{label:"内存使用率",unit:"%",tooltip:"该指标用于统计测量对象的内存利用率。"},mongo033_bytes_out:{label:"网络输出吞吐量",unit:"byte/s",tooltip:"该指标用于统计平均每秒从测量对象的所有网络适配器输出的流量。"},mongo034_bytes_in:{label:"网络输入吞吐量",unit:"byte/s",tooltip:"该指标用于统计平均每秒从测量对象的所有网络适配器输入的流量。"},mongo035_disk_usage:{label:"磁盘利用率",unit:"%",tooltip:"该指标用于统计测量对象的磁盘利用率。"},mongo036_iops:{label:"IOPS",unit:"Count/s",tooltip:"该指标用于统计当前实例节点，单位时间内系统处理的I/O请求数量（平均值）。"},mongo037_read_throughput:{label:"硬盘读吞吐量",unit:"byte/s",tooltip:"硬盘平均每秒读字节数。"},mongo038_write_throughput:{label:"硬盘写吞吐量",unit:"byte/s",tooltip:"硬盘平均每秒写字节数。"},mongo039_avg_disk_sec_per_read:{label:"硬盘读耗时",unit:"s",tooltip:"该指标用于统计某段时间平均每次读取硬盘所耗时间。"},mongo040_avg_disk_sec_per_write:{label:"硬盘写耗时",unit:"s",tooltip:"该指标用于统计某段时间平均每次写入硬盘所耗时间。"},mongo042_disk_total_size:{label:"磁盘总大小",unit:"GB",tooltip:"该指标用于统计测量对象的磁盘总大小。"},mongo043_disk_used_size:{label:"磁盘使用量",unit:"GB",tooltip:"该指标用于统计测量对象的磁盘已使用总大小。"},mongo044_swap_usage:{label:"SWAP利用率",unit:"%",tooltip:"交换内存SWAP使用率百分数。"},mongo050_top_total_time:{label:"集合花费的总时间",unit:"ms",tooltip:"Mongotop-total time指标，集合操作花费的时间总和。"},mongo051_top_read_time:{label:"集合读花费的总时间",unit:"ms",tooltip:"Mongotop-read time指标，集合读操作花费的时间总和。"},mongo052_top_write_time:{label:"集合写花费的总时间",unit:"ms",tooltip:"Mongotop-write time指标，集合写操作花费的时间总和。"},mongo053_wt_flushes_status:{label:"周期Checkpoint的触发次数",unit:"times",tooltip:"WiredTiger一个轮询间隔期间checkpoint的触发次数，记录周期内发生的次数。"},mongo054_wt_cache_used_percent:{label:"Wiredtiger使用中的缓存百分比",unit:"%",tooltip:"Wiredtiger使用中的缓存大小百分数。"},mongo055_wt_cache_dirty_percent:{label:"Wiredtiger脏数据的缓存百分比",unit:"%",tooltip:"Wiredtiger脏数据的缓存大小百分数。"},mongo070_rocks_active_memtable:{label:"memtable中的数据大小",unit:"Byte",tooltip:"采集当前活动memtable中的数据大小。"},mongo071_rocks_oplogcf_active_memtable:{label:"oplogcf上memtable中的数据大小",unit:"Byte",tooltip:"采集当前用于oplogcf上活动memtable中的数据大小。"},mongo072_rocks_all_memtable:{label:"memtable和immutable-mem中的总数据大小",unit:"Byte",tooltip:"采集当前memtable和immutable-mem中的总数据大小。"},mongo073_rocks_oplogcf_all_memtable:{label:"oplogcf上memtable和immutable-mem中的总数据大小",unit:"Byte",tooltip:"采集当前用于oplogcf上memtable和immutable-mem中的总数据大小。"},mongo074_rocks_snapshots:{label:"未释放的snapshot的数量",unit:"Count",tooltip:"采集当前未释放的snapshot的数量。"},mongo075_rocks_oplogcf_snapshots:{label:"oplogcf上未释放的snapshot的数量",unit:"Count",tooltip:"采集当前oplogcf上未释放的snapshot的数量。"},mongo076_rocks_live_versions:{label:"活动的版本数量",unit:"Count",tooltip:"采集当前活动的版本数量。"},mongo077_rocks_oplogcf_live_versions:{label:"oplogcf上活动的版本数量",unit:"Count",tooltip:"采集当前oplogcf上活动的版本数量。"},mongo078_rocks_block_cache:{label:"驻留在blockcache中的数据大小",unit:"Byte",tooltip:"采集当前驻留在blockcache中的数据大小。"},mongo079_rocks_background_errors:{label:"后台累积错误数量",unit:"Count",tooltip:"采集记录后台累积错误数量。"},mongo080_rocks_oplogcf_background_errors:{label:"oplogcf上后台累积错误数量",unit:"Count",tooltip:"采集记录oplogcf上后台累积错误数量。"},mongo081_rocks_conflict_bytes_usage:{label:"事务写写冲突处理缓冲区使用率",unit:"%",tooltip:"采集事务写中写冲突处理缓冲区使用率。"},mongo082_rocks_uncommitted_keys:{label:"未提交的key的数量",unit:"Count",tooltip:"采集当前未提交的key的数量。"},mongo083_rocks_committed_keys:{label:"提交的key的数量",unit:"Count",tooltip:"采集当前已提交的key的数量。"},mongo084_rocks_alive_txn:{label:"活跃事务链表的长度",unit:"Count",tooltip:"采集记录活跃事务链表的长度。"},mongo085_rocks_read_queue:{label:"读队列的长度",unit:"Count",tooltip:"采集当前读队列的长度。"},mongo086_rocks_commit_queue:{label:"提交队列的长度",unit:"Count",tooltip:"采集当前提交队列的长度。"},mongo087_rocks_ct_write_out:{label:"已使用并发写事务数",unit:"Count",tooltip:"采集当前已使用并发写事务数。"},mongo088_rocks_ct_write_available:{label:"剩余可用并发写事务数",unit:"Count",tooltip:"采集当前剩余可用并发写事务数。"},mongo089_rocks_ct_read_out:{label:"已使用并发读事务数",unit:"Count",tooltip:"采集当前已使用并发读事务数。"},mongo090_rocks_ct_read_available:{label:"剩余可用并发读事务数",unit:"Count",tooltip:"采集当前剩余可用并发读事务数。"},mongo091_active_session_count:{label:"周期活跃会话数",unit:"Count",tooltip:"该指标用于统计自上次刷新周期以来Mongo实例在内存中缓存的所有活跃本地会话的数目。"},mongo092_rx_errors:{label:"接收报文错误率",unit:"%",tooltip:"该指标用于统计监控周期内接收报文中错误报文数量与全部接收报文比值。"},mongo093_rx_dropped:{label:"接收报文丢包率",unit:"%",tooltip:"该指标用于监控周期内统计接收报文中丢失报文数量与全部接收报文比值。"},mongo094_tx_errors:{label:"发送报文错误率",unit:"%",tooltip:"该指标用于监控周期内统计发送报文中错误报文数量与全部发送报文比值。"},mongo095_tx_dropped:{label:"发送报文丢包率",unit:"%",tooltip:"该指标用于监控周期内统计发送报文中丢失报文数量与全部发送报文比值。"},mongo096_retrans_segs:{label:"重传包数目",unit:"Counts",tooltip:"该指标用于监控周期内统计重传包数目。"},mongo097_retrans_rate:{label:"重传比例",unit:"%",tooltip:"该指标用于监控周期内统计重传包比例。"},mongo098_out_rsts_nums:{label:"发送RST数目",unit:"Counts",tooltip:"该指标用于监控周期内统计RST数目。"},mongo099_read_time_average:{label:"读命令耗时平均值",unit:"ms",tooltip:"该指标为单个节点的读命令耗时平均值。"},mongo100_read_time_p99:{label:"读命令p99耗时",unit:"ms",tooltip:"该指标为单个节点的读命令p99耗时。"},mongo101_read_time_p999:{label:"读命令p999耗时",unit:"ms",tooltip:"该指标为单个节点的读命令p999耗时。"},mongo102_write_time_average:{label:"写命令耗时平均值",unit:"ms",tooltip:"该指标为单个节点的写命令耗时平均值。"},mongo103_write_time_p99:{label:"写命令p99耗时",unit:"ms",tooltip:"该指标为单个节点的写命令p99耗时。"},mongo104_write_time_p999:{label:"写命令p999耗时",unit:"ms",tooltip:"该指标为单个节点的写命令p999耗时。"},mongo105_command_time_average:{label:"command耗时平均值",unit:"ms",tooltip:"该指标为单个节点的节点command的耗时平均值。"},mongo106_command_time_p99:{label:"command p99耗时",unit:"ms",tooltip:"该指标为单个节点的command耗时p99耗时。"},mongo107_command_time_p999:{label:"command p999耗时",unit:"ms",tooltip:"该指标为单个节点的command耗时p999耗时。"},mongo108_txn_time_average:{label:"事务耗时平均值",unit:"ms",tooltip:"该指标为单个节点的节点事务耗时平均值。"},mongo109_txn_time_p99:{label:"事务p99耗时",unit:"ms",tooltip:"该指标为单个节点的事务p99耗时。"},mongo110_txn_time_p999:{label:"事务p999耗时",unit:"ms",tooltip:"该指标为单个节点的事务p999耗时。"}},Oe={class:"chart-box"},je=k({__name:"metricChart",props:{param:{type:Object,default:()=>({})},nodeGroup:{type:Object,default:()=>({})}},setup(e){const t=e,o=s(null);let l=null;const a=r({chartData:[],isVisible:!1,analysis:{max:0,min:0,avg:0,sum:0}}),n=async()=>{const e=new IntersectionObserver((async n=>{n.forEach((async n=>{n.isIntersecting&&(a.isVisible=!0,await(async()=>{const{metrics:e}=await J.monitor.postChartData(t.param);if(a.chartData=e,e[0]&&e[0].values){const t=e[0].values.map((e=>e.value));t.length&&(a.analysis.max=Math.max(...t).toFixed(2),a.analysis.min=Math.min(...t).toFixed(2),a.analysis.sum=t.reduce(((e,t)=>e+t),0).toFixed(2),a.analysis.avg=(t.length?a.analysis.sum/t.length:0).toFixed(2))}})(),(()=>{var e,n,i,s,r,u,d,m,c;l||(l=te(o.value),l.group="mongodb-metric-group");const p=(null==(e=a.chartData[0])?void 0:e.values.map((e=>{const t=F(e.date),o=F(a.chartData[0].values[0].date);return F(a.chartData[0].values[a.chartData[0].values.length-1].date).diff(o,"day")>0?t.format("YYYY/MM/DD\nHH:mm"):t.format("HH:mm")})))||[],_=["#3b82f6","#03CAC3","#7A5AF7","#f59e42","#10b981"],g=a.chartData.map(((e,o)=>{var l,a,n,i,s;const r=null==(n=null==(a=null==(l=t.nodeGroup)?void 0:l.nodes)?void 0:a.find((t=>{var o;return t.cloud_node_id===(null==(o=e.dimensions[1])?void 0:o.value)})))?void 0:n.name,u=r?`${r} - ${(null==(i=Me[e.metric_name])?void 0:i.label)||e.metric_name}`:(null==(s=Me[e.metric_name])?void 0:s.label)||e.metric_name||`line${o+1}`,d=_[o%_.length];return{name:u,type:"line",data:e.values.map((e=>e.value)),smooth:!0,symbol:"none",lineStyle:{width:2,color:d},itemStyle:{color:d},markPoint:{symbolSize:10,data:[{type:"max",name:"最大值",symbol:"triangle",symbolRotate:0,itemStyle:{color:d},symbolOffset:[0,-8]},{type:"min",name:"最小值",symbol:"triangle",symbolRotate:180,itemStyle:{color:d},symbolOffset:[0,8]}],label:{show:!1}}}})),b=g.map((e=>e.name)),f=(null==(i=Me[null==(n=a.chartData[0])?void 0:n.metric_name])?void 0:i.unit)||(null==(s=a.chartData[0])?void 0:s.unit)||"",v=(null==(u=Me[null==(r=a.chartData[0])?void 0:r.metric_name])?void 0:u.label)||(null==(d=a.chartData[0])?void 0:d.metric_name),y=a.analysis,h=[{value:y.max,label:"最大值"},{value:y.min,label:"最小值"},{value:y.avg,label:"平均值"}],k=document.createElement("canvas").getContext("2d");k.font='bolder 14px "PingFang SC", "Microsoft YaHei", Arial';const x=h.map((e=>k.measureText(`${e.value} ${f}`).width)),C=h.map((e=>k.measureText(e.label).width)),w=x.map(((e,t)=>Math.max(e,C[t])));let S=0,T=[],D=1===a.chartData.length;D&&(T=h.map(((e,t)=>{const o={type:"group",left:S,top:35,children:[{type:"text",style:{text:`${e.value} ${f}`,font:'bolder 15px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222"},tooltip:{show:!0,formatter:()=>['<div style="text-align: center;">',`<div style="font-weight: bold; font-size: 15px; color: #222; margin-bottom: 4px">${e.value} ${f}</div>`,`<div style="font-size: 12px; color: #888">${e.label}</div>`,"</div>"].join(""),backgroundColor:"#fff",borderColor:"#e8e8e8",borderWidth:1,textStyle:{color:"#222",fontSize:12,fontFamily:'"PingFang SC", "Microsoft YaHei", Arial'},padding:[8,12],extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);"}},{type:"text",top:22,style:{text:e.label,font:'12px "PingFang SC", "Microsoft YaHei", Arial',fill:"#888"}}]};return S+=w[t]+20,o})));const P=document.createElement("canvas").getContext("2d");P.font='600 16px "PingFang SC", "Microsoft YaHei", Arial';const M={title:{show:!1},tooltip:{trigger:"axis",backgroundColor:"#fff",borderColor:"#e5e7eb",borderWidth:1,textStyle:{color:"#222",fontSize:12},padding:[12,16],extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);",formatter:function(e){let t=`<div style="font-size:13px;font-weight:500;margin-bottom:6px;">${e[0].axisValueLabel||e[0].axisValue}</div>`;return t+="<table>",e.forEach((e=>{let o=e.seriesName.split(" - ")[0],l=e.seriesName.split(" - ")[1]||"",a=o.length>50?o.slice(0,50)+"...":o;t+="<tr>",t+=`<td><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:${e.color};margin-right:6px;"></span></td>`,t+=`<td style="max-width:180px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="${o}">${a} - ${l}</td>`,t+=`<td style="padding-left:16px;font-weight:600;">${e.value} ${f}</td>`,t+="</tr>"})),t+="</table>",t},position:function(e,t,l,a,n){var i,s;const r=e[0]+((null==(i=o.value)?void 0:i.getBoundingClientRect().left)||0),u=e[1]+((null==(s=o.value)?void 0:s.getBoundingClientRect().top)||0);let d=e[0]+16,m=e[1]+16;const c=window.innerWidth,p=window.innerHeight;return r+n.contentSize[0]>c&&(d=e[0]-n.contentSize[0]/2-16),u+n.contentSize[1]>p&&(m=e[1]-n.contentSize[1]/2-26),[d,m]}},legend:{data:b,bottom:0,icon:"path://M120 476H720c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z",type:"scroll",orient:"horizontal",pageButtonItemGap:8,pageButtonGap:8,pageIconColor:"#888",pageIconInactiveColor:"#ccc",pageIconSize:16,pageTextStyle:{color:"#888"},tooltip:{show:!0}},grid:{left:40,right:20,top:D?120:60,bottom:55},graphic:[{type:"text",left:0,top:0,style:{text:v,font:'600 16px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222"}},{type:"group",left:P.measureText(v).width+8,top:0,children:[{type:"circle",shape:{cx:8,cy:8,r:7},style:{stroke:"#222",fill:"#fff",lineWidth:1}},{type:"text",left:5,top:3,style:{text:"?",x:8,y:9,font:'11px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222",textAlign:"center",textVerticalAlign:"middle"},tooltip:{show:!0,formatter:null==(c=Me[null==(m=a.chartData[0])?void 0:m.metric_name])?void 0:c.tooltip,backgroundColor:"#fff",borderColor:"#e8e8e8",borderWidth:1,textStyle:{color:"#222",fontSize:12,fontFamily:'"PingFang SC", "Microsoft YaHei", Arial'},extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);",position:function(e,t,l,a,n){var i,s;const r=e[0]+((null==(i=o.value)?void 0:i.getBoundingClientRect().left)||0),u=e[1]+((null==(s=o.value)?void 0:s.getBoundingClientRect().top)||0);let d=r-n.contentSize[0]/2,m=u-n.contentSize[1]-16;const c=window.innerWidth,p=window.innerHeight;return m<0&&(m=u+16),d<0&&(d=10),d+n.contentSize[0]>c&&(d=c-n.contentSize[0]-10),m+n.contentSize[1]>p&&(m=p-n.contentSize[1]-10),[d,m]}}}],cursor:"pointer"},...T],xAxis:{type:"category",data:p,boundaryGap:!1},yAxis:{type:"value",name:f,nameLocation:"end",nameTextStyle:{fontSize:12,fontWeight:400,color:"black",padding:[0,5,0,0]},axisLabel:{formatter:"{value}",width:40,overflow:"break"}},series:g};l.setOption(M)})(),e.unobserve(n.target))}))}),{threshold:.1});o.value&&e.observe(o.value)};return B((()=>{n()})),A((()=>{l&&(l.dispose(),l=null)})),(e,t)=>{const l=h;return d(),m(l,{spinning:!_(a).isVisible},{default:c((()=>[w("div",Oe,[w("div",{ref_key:"chartRef",ref:o,class:"chart-content"},null,512)])])),_:1},8,["spinning"])}}},[["__scopeId","data-v-fdc58bde"]]),ze={class:"select-box"},Be=["onClick"],Ie={key:0,class:"select-box"},$e={key:1,class:"select-box"},Fe={key:1,class:"select-box"},Ae=["onClick"],Re={class:"node-info"},Ee={class:"search-box"},Ve={class:"ml-4"},Ne={class:"metric-chart-box"},Ye=k({__name:"monitor",props:{sid:{type:[String,Number],default:""},rowData:{type:Object,default:()=>({})}},setup(e){const t=e,o={roles:["全部","Primary","Secondary","Hidden"],groupType:{"实例级指标":"实例级指标",mongos:"mongos节点",shard:"shard节点",config:"config节点"},hiddenFields:{"实例级指标":["mongosId","shardName","role"],mongos:["role","shardName"],shard:["mongosId"],config:["mongosId","shardName"]}},l=r({refresh:!1,autoRefresh:!1,timer:null,nodeMetrics:{},searchParams:{metrics:[],date:[F().add(-1,"h"),F()],filter:["average","1"]},selectedValue:{groupType:"实例级指标",mongosId:"全部",shardName:"",role:"全部"}});B((async()=>{v()}));const a=x((()=>{var e,t;const o=[{label:"全部",value:"全部"}];return null==(t=null==(e=s.value.nodeGroup)?void 0:e.nodes)||t.forEach((e=>{o.push({label:e.name,value:e.cloud_node_id})})),o})),n=x((()=>t.rowData.node_groups.filter((e=>"shard"===e.type)).map((e=>({label:e.name,value:e.name}))))),i=x((()=>{var e;if("Sharding"===(null==(e=t.rowData)?void 0:e.deployment_mode)&&"实例级指标"===l.selectedValue.groupType)return l.nodeMetrics.instance;const o=s.value.node.cloud_node_id;if(o)return l.nodeMetrics[o]||[];let a=[];for(let t of s.value.nodeGroup.nodes||[])for(let e of l.nodeMetrics[t.cloud_node_id]||[])a.find((t=>t.value===e.value))||a.push(e);return a})),s=x((()=>{const{deployment_mode:e,node_groups:o}=t.rowData;let a,n;return"ReplicaSet"===e?(a=o[0],n=null==a?void 0:a.nodes.find((e=>e.role===l.selectedValue.role))):"Sharding"===e&&(a=o.find((e=>"shard"===l.selectedValue.groupType?e.name===l.selectedValue.shardName:e.type===l.selectedValue.groupType)),n="mongos"===l.selectedValue.groupType?null==a?void 0:a.nodes.find((e=>e.cloud_node_id===l.selectedValue.mongosId)):null==a?void 0:a.nodes.find((e=>e.role===l.selectedValue.role))),{nodeGroup:a||{},node:n||{}}})),v=async()=>{const e=t.rowData.node_groups.reduce(((e,t)=>[...e,...t.nodes]),[]);for(const a of e){const{metrics:e}=await J.monitor.postMetric(t.sid,{cloud_node_id:a.cloud_node_id});l.nodeMetrics[a.cloud_node_id]=e.map((e=>{var t;return{label:(null==(t=Me[e.metric_name])?void 0:t.label)||e.metric_name,value:e.metric_name}}))}const{metrics:o}=await J.monitor.postMetric(t.sid);l.nodeMetrics.instance=o.map((e=>{var t;return{label:(null==(t=Me[e.metric_name])?void 0:t.label)||e.metric_name,value:e.metric_name}}))},y=e=>{var o,a;const{deployment_mode:n,cloud_instance_id:i}=t.rowData,r=[];return"ReplicaSet"===n?s.value.nodeGroup.nodes.forEach((t=>{"全部"!==l.selectedValue.role&&s.value.node.role!==t.role||r.push({metric_name:e,dimensions:[{name:"mongodb_instance_id",value:i},{name:"mongodb_node_id",value:t.cloud_node_id}]})})):"Sharding"===n&&("实例级指标"===l.selectedValue.groupType?r.push({metric_name:e,dimensions:[{name:"mongodb_instance_id",value:i}]}):null==(a=null==(o=s.value.nodeGroup)?void 0:o.nodes)||a.forEach((t=>{"全部"!==l.selectedValue.mongosId&&s.value.node.cloud_node_id!==t.cloud_node_id||"全部"!==l.selectedValue.role&&s.value.node.role!==t.role||r.push({metric_name:e,dimensions:[{name:"mongodb_instance_id",value:i},{name:"mongodb_node_id",value:t.cloud_node_id}]})}))),{start_time:l.searchParams.date[0],end_time:l.searchParams.date[1],filter:l.searchParams.filter[0],period:l.searchParams.filter[1],metrics:r}},h=()=>{const e=l.searchParams.date[1].diff(l.searchParams.date[0],"day");let t=[...De],o=[...Pe];return e>10&&(t=t.filter((e=>"300"!==e.value)),o=o.filter((e=>"原始值"!==e.label))),e>20&&(t=t.filter((e=>"1200"!==e.value))),e>155&&(t=t.filter((e=>"3600"!==e.value))),t=t.filter((e=>e.value<=l.searchParams.date[1].diff(l.searchParams.date[0],"seconds"))),o.map((e=>({...e,children:"原始值"===e.label?null:t})))},k=()=>{l.refresh=!0,R((()=>{l.refresh=!1}))},M=(e,o)=>{var a;l.selectedValue[e]=o,"groupType"===e?(l.selectedValue.mongosId="全部",l.selectedValue.role="全部",l.selectedValue.shardName=(null==(a=t.rowData.node_groups.find((e=>"shard"===e.type)))?void 0:a.name)||""):"mongosId"===e&&(l.selectedValue.role="全部"),l.searchParams.metrics=[],l.searchParams.date=[F().add(-1,"h"),F()],l.searchParams.filter=["average","1"],k()},O=e=>{var t;return!(null==(t=o.hiddenFields[l.selectedValue.groupType])?void 0:t.includes(e))};return C((()=>l.searchParams.date),(()=>{const e=h();l.searchParams.filter="原始值"===e[0].label?["average","1"]:["average",e[0].children[0].value],k()}),{deep:!0}),C((()=>l.autoRefresh),(e=>{e?l.timer=setInterval(k,3e4):clearInterval(l.timer)})),(t,r)=>{var v,x;const C=oe,z=le,B=ae,I=u("RedoOutlined"),$=E,F=j,A=ne;return d(),g(b,null,["Sharding"===(null==(v=e.rowData)?void 0:v.deployment_mode)?(d(),g(b,{key:0},[w("div",ze,[(d(!0),g(b,null,f(o.groupType,((e,t)=>(d(),g("span",{key:t,class:D({"box-item-selected":_(l).selectedValue.groupType===t}),onClick:e=>M("groupType",t)},S(e),11,Be)))),128))]),O("mongosId")?(d(),g("div",Ie,[P(" dds mongos节点 "),p(C,{value:_(l).selectedValue.mongosId,"onUpdate:value":r[0]||(r[0]=e=>_(l).selectedValue.mongosId=e),options:_(a),onChange:r[1]||(r[1]=e=>M("mongosId",e))},null,8,["value","options"])])):T("",!0),O("shardName")?(d(),g("div",$e,[P(" shard节点 "),p(C,{value:_(l).selectedValue.shardName,"onUpdate:value":r[2]||(r[2]=e=>_(l).selectedValue.shardName=e),options:_(n),"default-active-first-option":!0,onChange:r[3]||(r[3]=e=>M("shardName",e))},null,8,["value","options"])])):T("",!0)],64)):T("",!0),O("role")||"ReplicaSet"===(null==(x=e.rowData)?void 0:x.deployment_mode)?(d(),g("div",Fe,[(d(!0),g(b,null,f(o.roles,(e=>(d(),g("span",{key:e,class:D({"box-item-selected":_(l).selectedValue.role===e}),onClick:t=>M("role",e)},S(e),11,Ae)))),128))])):T("",!0),w("div",Re,[P(" 节点名称 "),w("span",null,S(_(s).node.name||"--"),1),P(" 节点ID "),w("span",null,S(_(s).node.cloud_node_id||"--"),1),P(" 运行状态 "),w("span",{class:D({"text-primary":"运行中"===_(s).node.status})},S(_(s).node.status||"--"),3)]),w("div",Ee,[p(C,{value:_(l).searchParams.metrics,"onUpdate:value":r[4]||(r[4]=e=>_(l).searchParams.metrics=e),placeholder:"指标名称",options:_(i),"dropdown-match-select-width":!1,mode:"multiple",onChange:k},null,8,["value","options"]),p(z,{value:_(l).searchParams.date,"onUpdate:value":r[5]||(r[5]=e=>_(l).searchParams.date=e),"show-time":"","allow-clear":!1,presets:_(Te),format:"YYYY/MM/DD HH:mm:ss"},null,8,["value","presets"]),p(B,{value:_(l).searchParams.filter,"onUpdate:value":r[6]||(r[6]=e=>_(l).searchParams.filter=e),options:h(),"allow-clear":!1,onChange:k},{displayRender:c((({labels:e})=>[P(S("1"===e[1]?"原始值":`${e[0]} / ${e[1]}`),1)])),_:1},8,["value","options"]),p(F,{title:"刷新"},{default:c((()=>[p($,{onClick:k},{default:c((()=>[p(I)])),_:1})])),_:1}),w("div",Ve,[P(" 自动刷新： "),p(F,{title:"每30秒自动刷新"},{default:c((()=>[p(A,{checked:_(l).autoRefresh,"onUpdate:checked":r[7]||(r[7]=e=>_(l).autoRefresh=e)},null,8,["checked"])])),_:1})])]),w("div",Ne,[(d(!0),g(b,null,f(_(i),(e=>(d(),g(b,{key:e.value},[_(l).refresh||!_(l).searchParams.metrics.includes(e.value)&&_(l).searchParams.metrics.length?T("",!0):(d(),m(je,{key:0,param:y(e.value),"node-group":_(s).nodeGroup},null,8,["param","node-group"]))],64)))),128))])],64)}}},[["__scopeId","data-v-d128d42a"]]),Ue={class:"table-section"},Ge={class:"ml-1"},We=["onClick"],He=["onClick"],qe={class:"text-12"},Le={class:"mb-2"},Qe={class:"truncate inline-block"},Ze={style:{display:"flex","align-items":"center"}},Je={key:0,class:"flex items-center"},Ke={class:"mr-2"},Xe={class:"text-12"},et={key:0,class:"custom-tabs"},tt=k({__name:"index",setup(n){const i=s(null),v=r({initColumn:[],initButton:[],initTitleData:[],tableOrder:{},subPageColumns:[],titleFieldSearch:[],pageType:"mongodb"}),y=[{title:"账号",icon:"icon-shangxiayouguanxi",path:"mongodbAccount",key:"account",isCustomTab:!0},{title:"数据库",icon:"icon-shujuku2",path:"mongodbDatabase",key:"database",isCustomTab:!0},{title:"集合",icon:"icon-shujukubiao",path:"mongodbCollection",key:"collection",isCustomTab:!0}],{userEdit:h,userDel:k,formOpen:C,formType:M,formSid:O}=L(),z=x((()=>{for(let e of v.initColumn){let{field:t}=e;switch(t){case"node_groups":case"volume_size":e.minWidth=180,e.showOverflow=!1,e.slots={default:t};break;case"status":case"engine":case"id":case"name":case"charge_type":e.slots={default:t};break;case"virtual_teams":e.showOverflow=!1}}return v.initColumn})),F=x((()=>v.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),A=x((()=>[...y,{title:"监控",key:"monitor",isCustomTab:!0}].filter((e=>F.value[`${e.key}_permission`]))));B((async()=>{const{button:e,columns:t,title_data:o,order:l,sub_page_columns:a,title_field_search:n}=await W.setColumn({layer:1,tableType:"server"});v.initColumn=t.value||[],v.initButton=e.value||[],v.initTitleData=o.value||[],v.tableOrder=l.value||{},v.subPageColumns=a||[],v.titleFieldSearch=n.value||[],await R()}));const R=async()=>{i.value&&await i.value.serverTableRef.commitProxy("query")},E=({type:e,row:t})=>{h({type:e,sid:t.id})},H=({row:e})=>{k({sid:e.id,delApi:Z.del,loadData:R})},{subPageOpen:q,subPageRow:Q,handleSubPageOpen:J}=e(),K=e=>{q.value=!0,Q.value=e},X=e=>/^(?=.*[a-zA-Z])(?=.*[0-9])[a-zA-Z0-9]+$/.test(e),ee={fields:[{field:"cloud_instance_id",field_name:"云实例ID",operator:"=",validate:X},{field:"name",field_name:"名称",operator:"vague",validate:e=>!X(e)}],placeholder:"支持云实例ID、名称快速搜索"};return(e,n)=>{var s,r;const k=$,x=u("vxe-button"),B=U,W=j,L=u("vxe-tag"),X=G,te=a,oe=l,le=o,ae=t;return d(),g(b,null,[V(w("div",Ue,[p(le,{ref_key:"tableRef",ref:i,"table-column":_(z),"auth-btn":_(F),order:_(v).tableOrder,"query-api":_(Z).getList,"is-show-doc":!0,"is-show-sync":{show:!0,uri:"sync_mongodb_instance"},"default-search-field":ee,"title-field-search":_(v).titleFieldSearch,onUserEdit:E,onUserAdd:n[0]||(n[0]=t=>_(h)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:H},{other_toolbar_buttons:c((()=>[(d(),g(b,null,f(y,(e=>(d(),g(b,{key:e.path},[_(F)[`${e.key}_permission`]?(d(),m(x,{key:0,onClick:t=>_(v).pageType=e.key},{default:c((()=>[p(k,{iconname:e.icon},null,8,["iconname"]),w("span",Ge,S(e.title),1)])),_:2},1032,["onClick"])):T("",!0)],64)))),64))])),id:c((({row:e})=>[p(W,{placement:"topLeft"},{title:c((()=>[p(B,{copyable:{tooltip:!1},class:"copy-text"},{default:c((()=>[P(S(e.cloud_instance_id),1)])),_:2},1024)])),default:c((()=>[w("span",{class:"cursor-pointer text-primary",onClick:t=>_(J)(e)},S(e.id),9,We)])),_:2},1024)])),name:c((({row:e})=>[w("span",{class:"cursor-pointer text-primary",onClick:t=>_(J)(e)},S(e.name),9,He)])),region_id:c((({row:e})=>{var t,o,l;return[w("div",null,S(null==e?void 0:e.zone_id),1),w("div",null,S((null==(t=_(v).initTitleData)?void 0:t.region_id)&&(null==(l=null==(o=_(v).initTitleData)?void 0:o.region_id)?void 0:l[null==e?void 0:e.region_id])||(null==e?void 0:e.region_id)),1)]})),node_groups:c((({row:e})=>[(d(!0),g(b,null,f(e.node_groups,((e,t)=>(d(),g(b,{key:t},[(d(!0),g(b,null,f(e.nodes,((e,t)=>(d(),g(b,{key:t},[(d(!0),g(b,null,f(e.addresses,((e,t)=>(d(),m(W,{key:t},{title:c((()=>[w("div",qe,S(e.address)+S(e.port?`:${e.port}`:""),1)])),default:c((()=>[w("div",Le,[p(L,{class:"theme--primary",size:"small"},{default:c((()=>[w("span",Qe,S(e.address)+S(e.port?`:${e.port}`:""),1)])),_:2},1024)])])),_:2},1024)))),128))],64)))),128))],64)))),128))])),status:c((({row:e})=>[p(L,{class:D("运行中"==e.status?"theme--primary":"theme--error"),size:"small"},{default:c((()=>[P(S(e.status),1)])),_:2},1032,["class"])])),engine:c((({row:e})=>[w("span",null,S(e.engine)+" "+S(e.engine_version),1)])),cloud_master_account_id:c((({row:e})=>{var t,o,l;return[w("div",Ze,[p(X,{type:null==e?void 0:e.cloud_source},null,8,["type"])]),P(" "+S((null==(l=null==(o=null==(t=_(v).initTitleData)?void 0:t.cloud_master_account_id)?void 0:o[e.cloud_master_account_id])?void 0:l.page_display)||""),1)]})),charge_type:c((({row:e})=>[p(te,{"charge-type":e.charge_type,"expired-time":e.expire_time},null,8,["charge-type","expired-time"])])),volume_size:c((({row:e})=>[e.volume_size?(d(),g("div",Je,[w("span",Ke,S(e.volume_size)+"GB",1),p(W,null,{title:c((()=>[w("div",Xe,"磁盘使用量："+S(e.volume_used)+"GB",1)])),default:c((()=>[p(oe,{percentage:e.volume_used/e.volume_size},null,8,["percentage"])])),_:2},1024)])):T("",!0)])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search"])],512),[[N,"mongodb"===_(v).pageType]]),p(ie,{open:_(C),"onUpdate:open":n[1]||(n[1]=e=>I(C)?C.value=e:null),sid:_(O),"form-type":_(M),onEditSuccess:R},null,8,["open","sid","form-type"]),p(ae,{open:_(q),"onUpdate:open":n[2]||(n[2]=e=>I(q)?q.value=e:null),width:"100%",title:null==(s=_(Q))?void 0:s.name,"basic-config":{api:_(Z).getDetail,title:"实例信息",isCustomTab:!0,sid:null==(r=_(Q))?void 0:r.id},"custom-tabs":_(A),onClickEdit:n[3]||(n[3]=t=>E({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:_(Q)}))},Y({basic:c((({data:e})=>[p(ve,{data:e,columns:_(v).subPageColumns,"title-data":_(v).initTitleData},null,8,["data","columns","title-data"])])),_:2},[f(_(A),(e=>({name:e.key,fn:c((()=>{var t,o;return[_(q)?(d(),g("div",et,["monitor"===e.key?(d(),m(Ye,{key:0,sid:null==(t=_(Q))?void 0:t.id,"row-data":_(Q)},null,8,["sid","row-data"])):(d(),m(Se,{key:1,"instance-name":null==(o=_(Q))?void 0:o.name,type:e.key},null,8,["instance-name","type"]))])):T("",!0)]}))})))]),1032,["open","title","basic-config","custom-tabs"]),"mongodb"!==_(v).pageType?(d(),m(Se,{key:0,type:_(v).pageType,"onUpdate:type":n[4]||(n[4]=e=>_(v).pageType=e),onMongodbSubPageOpen:K},null,8,["type"])):T("",!0)],64)}}},[["__scopeId","data-v-891a4d3d"]]);export{tt as default};
