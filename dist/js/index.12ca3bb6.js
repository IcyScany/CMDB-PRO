import{a3 as e,al as t,H as l,J as a,z as i,Q as o,R as n,X as r,F as u,S as s,a6 as d,$ as c,Y as v,am as p,an as m,U as f,e7 as _,Z as y,a0 as g,a9 as b,aa as w,aR as h,a5 as k,q as C,c as x,W as S,ah as $,aw as T,ax as D,aY as O,ak as R,au as j,r as E,O as A,a8 as P,aN as L,ad as U,C as F,D as N,av as B,I,ac as q}from"./index.872a2bd0.js";import{R as M}from"./ResourceChart.c8c8e96e.js";import{_ as Y}from"./index.e3d002e2.js";import{_ as G}from"./ServerTable.53881589.js";import{t as z}from"./tableRender.a6ff99b7.js";import{o as H,_ as Q,u as V,b as W}from"./opsFormInit.3a4e1794.js";import{_ as J}from"./index.029351cd.js";import{_ as K}from"./index.5101deeb.js";import{V as X}from"./index.8820ea9e.js";import"./mode-json.c2c3c146.js";import"./theme-github.7758cee8.js";import{_ as Z,T as ee}from"./index.0ff804f5.js";import{_ as te}from"./index.65b2e021.js";import{s as le,_ as ae}from"./subPage.2201bfd5.js";import{_ as ie}from"./index.90e0ec19.js";import{_ as oe}from"./index.7d980246.js";import"./index.6e2fd079.js";import{R as ne,_ as re}from"./Group.b415afa6.js";import{m as ue}from"./index.2c670fa1.js";import{_ as se}from"./index.b88bef3e.js";import"./index.165d9fa7.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.fc9664cf.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.44a4e190.js";import"./index.48209b21.js";import"./index.64f8d8d4.js";import"./opsDescriptions.dfa169bd.js";import"./index.87ccdcd1.js";import"./index.a533313d.js";import"./opsTable.7b07fc7b.js";import"./RadioButton.534ff50d.js";const de={class:"view-switcher"},ce=["onClick","on:customChange"],ve=[(e=>(b("data-v-8c4a3048"),e=e(),w(),e))((()=>r("path",{d:"M0,120 Q200,50 400,120",stroke:"currentColor","stroke-width":"8",fill:"currentColor"},null,-1)))],pe=e({__name:"index",props:{tabType:{type:Array,default:()=>[{label:"总览",value:"overview",is_change_bg:!0}]}},emits:["update:type"],setup(e,{expose:b,emit:w}){let h=e,{tabType:k}=t(h);const C=l({viewType:k.value[0].value});let x=w;const S=()=>{let e=g.pluck(k.value,"value").indexOf(C.viewType);const t=document.querySelector(`.view-btn-${e}`);if(t){const e=document.querySelector(".view-switcher").getBoundingClientRect(),l=t.getBoundingClientRect();return(l.left+l.right-60)/2-e.left}},$=e=>{C.viewType=e.value,(null==e?void 0:e.is_change_bg)?(null==e?void 0:e.is_change_bg)&&T("rgb(246 247 250)"):T("white"),x("update:type",C.viewType)},T=e=>{const t=document.querySelector(".main-content");t&&t.style.setProperty("background-color",e)};return a((()=>{var e;(null==(e=k.value)?void 0:e[0].is_change_bg)&&T("rgb(246 247 250)"),x("update:type",C.viewType)})),i((()=>{T("white")})),b({handleClick:$}),(e,t)=>(o(),n(u,null,[r("div",de,[(o(!0),n(u,null,s(c(k),((e,t)=>(o(),n("span",{key:e.value,class:d(["view-btn",[c(C).viewType===e.value?"view-selected":"",`view-btn-${t}`]]),onClick:t=>$(e),"on:customChange":t=>$(e)},v(e.label),43,ce)))),128)),(o(),n("svg",{class:"view-switcher-line text-primary",width:"60",height:"15",viewBox:"0 0 400 120",style:p({left:S()+"px"})},ve,4))]),(o(!0),n(u,null,s(c(k),(t=>(o(),n(u,null,[c(C).viewType===t.value?m(e.$slots,t.value,{key:0,title:t.label},(()=>[(o(),f(_(t.value)))]),!0):y("",!0)],64)))),256))],64))}},[["__scopeId","data-v-8c4a3048"]]);let{HEADER_CONFIG:me}=k;const fe="alert/",_e={getOverview:()=>h.get(`${fe}show/overview`,{showLoading:!0}),info:{postList:e=>h.post(`${fe}info/list`,e),putAck:(e,t)=>h.put(`${fe}info/edit/${e}`,t),getHistorySegment:({alert_sid:e})=>h.get(`${fe}info/history-segment/${e}`,{showLoading:!0,...me}),getSourceData:({log_sid:e})=>h.get(`${fe}info/source-data/${e}`,{showLoading:!0,...me})},group:{postList:e=>h.post(`${fe}group/list`,e),postAdd:e=>h.post(`${fe}group/add`,e),putEdit:(e,t)=>h.put(`${fe}group/edit/${e}`,t),delete:e=>h.delete(`${fe}group/delete/${e}`),getDetail:e=>h.get(`${fe}group/list/${e}`)},level:{getList:(e=null)=>h.get(`${fe}level/list${e?`/${e}`:""}`),postAdd:e=>h.post(`${fe}level/add`,e),putEdit:(e,t)=>h.put(`${fe}level/edit/${e}`,t),delete:e=>h.delete(`${fe}level/delete/${e}`)}},ye={key:0,class:"overview-container"},ge={class:"summary-box"},be=["onClick"],we={class:"summary-value text-[26px]"},he={class:"summary-title"},ke={class:"summary-icon"},Ce=["src"],xe=(e=>(b("data-v-56a7cda3"),e=e(),w(),e))((()=>r("div",{class:"summary-border"},null,-1))),Se={class:"flex flex-col items-center shadow p-6 bg-white rounded-xl"},$e={class:"flex flex-col items-center justify-center"},Te={class:"text-xl text-black",style:{color:"#000"}},De=e({__name:"OverView",emits:["customChange"],setup(e,{emit:t}){let{getOverview:i}=_e;const d=l({overview:{top:[{label:"告警总数",value:"alert_total_number",img:"/images/alert-info.png",border_color:"primary",summary_color:"#4fb050"},{label:"告警分组",value:"alert_group_number",img:"/images/alert-group.png",border_color:"primary",summary_color:"#3c79bf"},{label:"告警等级",value:"alert_level_number",img:"/images/alert-level.png",border_color:"primary",summary_color:"#4fb050"}],middle:[{label:"P0",value:"P0"},{label:"P1",value:"P1"},{label:"P2",value:"P2"},{label:"P3",value:"P3"}]},overview_data:{}});a((async()=>{try{let e=await i();d.overview_data=e}catch(e){}}));let m=t;const _=C((()=>{var e;const t=(null==(e=d.overview_data)?void 0:e.alert_trend)||{},l=t.info_trend||[],a=t.source_trend||[],i=[],o=new Date;for(let d=29;d>=0;d--){const e=new Date(o);e.setDate(o.getDate()-d),i.push(e.toISOString().slice(0,10))}const n=Object.fromEntries(l.map((e=>[e.date,e.count]))),r=Object.fromEntries(a.map((e=>[e.date,e.count]))),u=i.map((e=>n[e]||0)),s=i.map((e=>r[e]||0));return{tooltip:{trigger:"axis"},legend:{data:["收到的告警","发送的告警"]},xAxis:{type:"category",data:i},yAxis:{type:"value"},series:[{name:"收到的告警",type:"line",data:s,smooth:!0},{name:"发送的告警",type:"line",data:u,smooth:!0}]}})),y=C((()=>{var e;const t=null==(e=null==d?void 0:d.overview_data)?void 0:e.alert_trend;if(!t)return!1;const l=t.info_trend||[],a=t.source_trend||[];return l.length>0||a.length>0}));return(e,t)=>{const l=Y,a=T,i=D,g=O,b=R;return c(d).overview_data?(o(),n("div",ye,[r("div",ge,[(o(!0),n(u,null,s(c(d).overview.top,(e=>{var t,l;return o(),n("div",{key:e.value,class:"summary-item",style:p({"--summary-color":e.summary_color})},[r("div",{class:"summary-data cursor-pointer",onClick:t=>c(m)("customChange",e)},[r("div",we,v((null==(l=null==(t=c(d))?void 0:t.overview_data)?void 0:l[e.value])||0),1),r("div",he,v(e.label),1)],8,be),r("div",ke,[r("img",{style:{width:"100%",height:"100%"},src:e.img},null,8,Ce)]),xe],4)})),128))]),x(g,{title:"等级信息"},{default:S((()=>[x(i,{gutter:16,class:"mb-5"},{default:S((()=>[(o(!0),n(u,null,s(c(d).overview.middle,(t=>(o(),f(a,{key:t.value,span:Number(24/c(d).overview.middle.length).toFixed(0)},{default:S((()=>{var a,i,o;return[r("div",Se,[x(l,{type:"circle",percent:100,width:120,"stroke-color":null==(o=null==(i=null==(a=e.$CONFIG)?void 0:a.ALERT_LEVEL_COLOR)?void 0:i[t.value])?void 0:o.color,"stroke-width":8},{format:S((()=>{var l,a,i,o,n,u,s;return[r("div",$e,[r("span",{style:p({color:`var(--alert-level-${t.value})`,fontWeight:"bold",fontSize:"2rem"})},v(t.label),5),r("span",Te,v((null==(a=null==(l=c(d))?void 0:l.overview_data)?void 0:a.alert_number)&&(null==(s=null==(u=null==(n=e.$utils.groupBy(null==(o=null==(i=c(d))?void 0:i.overview_data)?void 0:o.alert_number,"alert_level"))?void 0:n[t.value])?void 0:u[0])?void 0:s.count)||0),1)])]})),_:2},1032,["stroke-color"])])]})),_:2},1032,["span"])))),128))])),_:1})])),_:1}),x(g,{title:"告警趋势"},{default:S((()=>[c(y)?(o(),f(M,{key:0,id:"trendChart",options:c(_),style:{width:"100%",height:"400px"}},null,8,["options"])):(o(),f(b,{key:1,description:"暂无数据"},{title:S((()=>[$("暂无数据")])),_:1}))])),_:1})])):(o(),f(b,{key:1,description:"暂无数据"},{title:S((()=>[$(" 暂无数据 ")])),_:1}))}}},[["__scopeId","data-v-56a7cda3"]]),Oe={__name:"AlertLevelRender",props:{level:{type:String,default:""}},setup:e=>(t,l)=>{var a,i,n;const r=j;return o(),f(r,{color:null==(n=null==(i=null==(a=t.$CONFIG)?void 0:a.ALERT_LEVEL_COLOR)?void 0:i[e.level.toUpperCase()])?void 0:n.color},{default:S((()=>[$(v(e.level),1)])),_:1},8,["color"])}},Re={class:"flex"},je=r("span",{class:"text-[16px]"},"源数据",-1),Ee={key:1},Ae={key:1},Pe={__name:"showSegment",props:{open:{type:Boolean,default:!1},row:{type:Object,default:()=>({})},type:{type:String,default:""},titleData:{type:Object,default:()=>({})}},emits:["update:open"],setup(e,{emit:a}){let{info:i}=_e;const d=e,{open:p,row:m,type:_,titleData:g}=t(d),b=a,w={fontSize:13,showPrintMargin:!1,showLineNumbers:!0,tabSize:4,highlightActiveLine:!0,readOnly:!0};let h=l({data:null,msg:""});const k=async e=>{if(e){h.data=null,h.msg="",("segment"===_.value?i.getHistorySegment({alert_sid:m.value.id}):i.getSourceData({log_sid:m.value.log_sid})).then((e=>{h.data="source"===_.value?JSON.stringify(null==e?void 0:e.data,null,2):e})).catch((e=>{var t,l;h.msg=(null==(l=null==(t=null==e?void 0:e.response)?void 0:t.data)?void 0:l.msg)||"获取日志失败"}))}else h.data=null,h.msg=""},C=()=>{b("update:open",!1)};return(e,t)=>{const l=K,a=Z,i=ee,d=te,b=R,x=J;return o(),f(x,{open:c(p),onAfterOpenChange:k,onClose:C},{title:S((()=>{var t;return[r("div",Re,[$(v(`${e.$route.meta.title} - 告警清单NO.${null==(t=c(m))?void 0:t.id} -`)+" ",1),"source"===c(_)?(o(),f(l,{key:0,content:c(h).data},{custom_title:S((()=>[je])),_:1},8,["content"])):y("",!0),"segment"===c(_)?(o(),n("span",Ee,"历史节段信息")):y("",!0)])]})),default:S((()=>{var e;return[(null==(e=c(h))?void 0:e.data)&&"segment"===c(_)?(o(),f(i,{key:0,reverse:!0},{default:S((()=>{var e;return[(o(!0),n(u,null,s(null==(e=c(h).data)?void 0:e.data,(e=>(o(),f(a,{key:e.id},{default:S((()=>{var t,l;return[r("p",null,v(e.create_time)+" ("+v(e.id)+") ",1),r("p",null,"当前状态: "+v(e.status?`(${e.status})${(null==(l=null==(t=c(g))?void 0:t.curr_segment)?void 0:l[e.status])||""}`:""),1),r("p",null,"动作："+v(e.msg),1),r("p",null,"告警时间： "+v(e.alert_time),1)]})),_:2},1024)))),128))]})),_:1})):"source"===c(_)&&c(h).data?(o(),f(c(X),{key:1,value:c(h).data,"onUpdate:value":t[0]||(t[0]=e=>c(h).data=e),lang:"json",theme:"github",style:{height:"100%"},options:w},null,8,["value"])):(o(),f(b,{key:2},{description:S((()=>[c(h).msg?(o(),f(d,{key:0,type:"error","show-icon":!0,message:c(h).msg},null,8,["message"])):(o(),n("span",Ae,"暂无数据"))])),_:1}))]})),_:1},8,["open"])}}},Le={__name:"ListAck",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open","editSuccess"],setup(e,{emit:l}){let{info:a}=_e;const i=e,{open:r,sid:d,formType:v}=t(i),p=l;let m=E(null);const{putAck:_}=a;let{formRenderContent:y,formDataLoading:g,confirmLoading:b,initForm:w,formDataInit:h,editSubmit:k}=H({formRef:m,editTitleLayer:1,formType:v,sid:d,emits:p,editApi:_,customSubmitData:async e=>e,customEditData:()=>{}});const C=()=>{p("update:open",!1)},$=async e=>{e&&(await w(),await h())};return(e,t)=>{const l=Q,a=P,i=L,d=A("vxe-button"),p=J;return o(),f(p,{title:`${e.$route.meta.title} - 告警 ${c(v)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"ACK"}`,open:c(r),onAfterOpenChange:$,onClose:C},{footer:S((()=>[x(d,{content:"取消",onClick:C}),x(d,{type:"submit",loading:c(b),status:"primary",content:"提交",onClick:c(k)},null,8,["loading","onClick"])])),default:S((()=>[x(i,{spinning:c(g)},{default:S((()=>[x(a,{ref_key:"formRef",ref:m,model:c(y).formState,rules:c(y).rules},{default:S((()=>[(o(!0),n(u,null,s(e.$utils.filter(c(y).title,(e=>e.edit_display)),(e=>{var t,a;return o(),f(l,{key:e.field,value:c(y).formState[e.field],"onUpdate:value":t=>c(y).formState[e.field]=t,title:e,"title-data":null==(a=null==(t=c(y))?void 0:t.title_data)?void 0:a[e.field]},null,8,["value","onUpdate:value","title","title-data"])})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},Ue=e=>(b("data-v-1da8ae3c"),e=e(),w(),e),Fe=Ue((()=>r("b",null,[$("告警状态"),r("i",{class:"vxe-icon-funnel"})],-1))),Ne={class:"flex flex-col"},Be=Ue((()=>r("br",null,null,-1))),Ie={class:"flex items-center flex-col"},qe=Ue((()=>r("br",null,null,-1))),Me=e({__name:"List",setup(e){let{info:t}=_e;const i=E(null),d=l({initColumn:[],subPageColumns:[],initButton:[],initTitleData:[],tableOrder:{},titleFieldSearch:[],defaultQueryCondition:[{field:"alert_status",value:0,condition:"=",field_name:"告警状态"}]});let p=E(0);const m=C((()=>{for(let e of d.initColumn){let{field:t}=e;switch(t){case"virtual_team_v3_id":e.showOverflow=!1;break;case"alert_status":e.align="center";break;case"curr_segment":case"source":e.showOverflow=!1,e.slots={default:t}}}return d.initColumn})),_=C((()=>d.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{})));a((async()=>{const{button:e,columns:t,title_data:l,order:a,title_field_search:i,sub_page_columns:o}=await z.setColumn({layer:1});d.initColumn=t.value||[],d.initButton=e.value||[],d.initTitleData=l.value||{},d.tableOrder=a.value||{},d.titleFieldSearch=i.value||[],d.subPageColumns=o||[],p.value=0,await g()}));const g=async()=>{var e,t;i.value&&(await void(d.defaultQueryCondition=[{field:"alert_status",value:p.value,condition:"=",field_name:"告警状态",disableClose:!0}]),await i.value.serverTableRef.commitProxy("query"),(null==(e=i.value)?void 0:e.queryCondition)&&(null==(t=i.value)?void 0:t.queryCondition.find((e=>"alert_status"===e.field)))||(p.value=null))},{userEdit:b,formOpen:w,formType:h,formSid:k}=V();let T=E(!1),D=E({}),O=E("");const R=(e,t)=>{T.value=!0,D.value=e,O.value=t};return(e,l)=>{const a=B,C=A("vxe-button"),E=Oe,P=j,L=G;return o(),n(u,null,[x(L,{ref_key:"tableRef",ref:i,"table-column":c(m),"auth-btn":c(_),order:c(d).tableOrder,"query-api":c(t).postList,"title-field-search":c(d).titleFieldSearch,"default-query-condition":c(d).defaultQueryCondition,"show-env-search":{app_name:"alert_info"}},{envSuffix:S((()=>{var e,t;return[(null==(e=c(d).initTitleData)?void 0:e.alert_status)?(o(),n(u,{key:0},[Fe,(o(!0),n(u,null,s(null==(t=c(d).initTitleData)?void 0:t.alert_status,(({label:e,value:t})=>(o(),f(a,{key:t,danger:0===t,type:"primary",class:"mr-2",ghost:c(p)!==t,size:"small",onClick:e=>{U(p)?p.value=t:p=t,g()}},{default:S((()=>[$(v(e),1)])),_:2},1032,["danger","ghost","onClick"])))),128))],64)):y("",!0)]})),other_operation:S((({row:t})=>{var l,a;return[(null==(a=null==(l=c(_))?void 0:l.alert_ack)?void 0:a.page_display)&&1!==(null==t?void 0:t.alert_status)?(o(),f(C,{key:0,status:"primary",onClick:l=>(async({type:e,row:t})=>{b({type:e,sid:t.id})})({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:t})},{default:S((()=>{var e,t;return[$(v(null==(t=null==(e=c(_))?void 0:e.alert_ack)?void 0:t.field_name),1)]})),_:2},1032,["onClick"])):y("",!0)]})),alert_status:S((({row:e})=>[r("div",Ne,[x(E,{level:null==e?void 0:e.alert_level,class:"w-[50px]",style:{"margin-bottom":"3px","text-align":"center"}},null,8,["level"]),x(P,{color:(null==e?void 0:e.alert_status)?"green":"red",class:"w-[50px]"},{default:S((()=>{var t,l,a,i;return[$(v((null==(t=c(d).initTitleData)?void 0:t.alert_status)&&(null==(i=null==(a=null==(l=c(d).initTitleData)?void 0:l.alert_status)?void 0:a.find((t=>t.value===(null==e?void 0:e.alert_status))))?void 0:i.label)||(null==e?void 0:e.alert_status)),1)]})),_:2},1032,["color"])])])),recovery_time:S((({row:e})=>{var t,l;return[$(v(null==(t=null==e?void 0:e.alert_time)?void 0:t.time)+" "+v(null==(l=null==e?void 0:e.recovery_time)?void 0:l.time),1)]})),curr_segment:S((({row:e})=>{var t,l,a,i,o,n;return[$(v((null==(l=null==(t=c(d).initTitleData)?void 0:t.curr_segment)?void 0:l[null==e?void 0:e.curr_segment])||(null==e?void 0:e.curr_segment))+" ",1),Be,F(x(C,{content:null==(i=null==(a=c(_))?void 0:a.alert_history_segment)?void 0:i.field_name,status:"primary",mode:"text",onClick:t=>R(e,"segment")},null,8,["content","onClick"]),[[N,null==(n=null==(o=c(_))?void 0:o.alert_history_segment)?void 0:n.page_display]])]})),source:S((({row:e})=>{var t,l,a,i;return[r("div",Ie,[$(v(null==e?void 0:e.source)+" ",1),qe,F(x(C,{content:null==(l=null==(t=c(_))?void 0:t.alert_source_data)?void 0:l.field_name,status:"primary",mode:"text",onClick:t=>R(e,"source")},null,8,["content","onClick"]),[[N,null==(i=null==(a=c(_))?void 0:a.alert_source_data)?void 0:i.page_display]])])]})),_:1},8,["table-column","auth-btn","order","query-api","title-field-search","default-query-condition"]),x(Le,{open:c(w),"onUpdate:open":l[0]||(l[0]=e=>U(w)?w.value=e:null),sid:c(k),"form-type":c(h),onEditSuccess:g},null,8,["open","sid","form-type"]),x(Pe,{open:c(T),"onUpdate:open":l[1]||(l[1]=e=>U(T)?T.value=e:T=e),row:c(D),type:c(O),"title-data":c(d).initTitleData},null,8,["open","row","type","title-data"])],64)}}},[["__scopeId","data-v-1da8ae3c"]]),Ye={__name:"GroupEdit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open","editSuccess"],setup(e,{emit:l}){let{group:a}=_e;const i=e,{open:r,sid:d,formType:v}=t(i),p=l;let m=E(null);const{postAdd:_,getDetail:y,putEdit:g}=a;let{formRenderContent:b,formDataLoading:w,confirmLoading:h,initForm:k,formDataInit:C,editSubmit:$}=H({formRef:m,editTitleLayer:2,formType:v,sid:d,emits:p,addApi:_,editApi:g,oneDataApi:y,customSubmitData:async e=>{for(let t in e)e[t]=""===e[t]?null:e[t];return e},customEditData:()=>{}});const T=()=>{p("update:open",!1)},D=async e=>{e&&(await k(),await C())};return(e,t)=>{const l=ie,a=Q,i=P,d=L,p=A("vxe-button"),_=J;return o(),f(_,{title:`${e.$route.meta.title}- 告警分组 ${c(v)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:c(r),onAfterOpenChange:D,onClose:T},{footer:S((()=>[x(p,{content:"取消",onClick:T}),x(p,{type:"submit",loading:c(h),status:"primary",content:"提交",onClick:c($)},null,8,["loading","onClick"])])),default:S((()=>[x(d,{spinning:c(w)},{default:S((()=>[x(i,{ref_key:"formRef",ref:m,model:c(b).formState,rules:c(b).rules},{default:S((()=>[(o(!0),n(u,null,s(e.$utils.filter(c(b).title,(e=>e.edit_display)),(e=>{var t,i,r,s;return o(),n(u,{key:e.field},[["classify_keyword","extra_notifier"].includes(e.field)?(o(),f(a,{key:0,title:e,"title-data":null==(i=null==(t=c(b))?void 0:t.title_data)?void 0:i[e.field]},{default:S((()=>[x(l,{tags:c(b).formState[e.field],"onUpdate:tags":t=>c(b).formState[e.field]=t,editable:!!e.edit_change},null,8,["tags","onUpdate:tags","editable"])])),_:2},1032,["title","title-data"])):(o(),f(a,{key:1,value:c(b).formState[e.field],"onUpdate:value":t=>c(b).formState[e.field]=t,title:e,"title-data":null==(s=null==(r=c(b))?void 0:r.title_data)?void 0:s[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},Ge={style:{flex:"auto","min-height":"0"}},ze=["onClick"],He={__name:"Group",setup(e){let{group:t}=_e;const{userDel:i,userEdit:u,formOpen:s,formType:d,formSid:p}=V(),m=E(null),f=l({initColumn:[],subPageColumns:[],initButton:[],initTitleData:[],tableOrder:{},titleFieldSearch:[]}),_=C((()=>{for(let e of f.initColumn){let{field:t}=e;switch(t){case"id":case"notify_status":e.slots={default:t};break;case"virtual_teams":e.showOverflow=!1}}return f.initColumn})),y=C((()=>f.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{})));a((async()=>{const{button:e,columns:t,title_data:l,order:a,title_field_search:i,sub_page_columns:o}=await z.setColumn({layer:2});f.initColumn=t.value||[],f.initButton=e.value||[],f.initTitleData=l.value||[],f.tableOrder=a.value||{},f.titleFieldSearch=i.value||[],f.subPageColumns=o||[],await g()}));const g=async()=>{m.value&&(await m.value.serverTableRef.commitProxy("query"),I((()=>{var e,t,l,a;(null==(e=m.value)?void 0:e.serverTableRef)&&(null==(a=null==(l=null==(t=m.value)?void 0:t.serverTableRef)?void 0:l.recalculate)||a.call(l,!0))})))},{subPageOpen:b,subPageRow:w,handleSubPageOpen:h}=le(),k=({type:e,row:t})=>{u({type:e,sid:t.id})},T=({row:e})=>{i({delApi:t.delete,sid:e.id,loadData:g})};return(e,l)=>{var a,i;const C=G,D=ae;return o(),n("div",Ge,[x(C,{ref_key:"tableRef",ref:m,"table-column":c(_),"auth-btn":c(y),order:c(f).tableOrder,"query-api":c(t).postList,"title-field-search":c(f).titleFieldSearch,"switch-click-status-config":{api:c(t).putEdit,field:"notify_status"},onUserEdit:k,onUserAdd:l[0]||(l[0]=t=>c(u)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:T},{id:S((({row:e})=>[r("span",{class:"cursor-pointer text-primary",onClick:t=>c(h)(e)},v(e.id),9,ze)])),notify_status:S((({row:e})=>{var t,l;return[$(v((null==(l=null==(t=c(f).initTitleData)?void 0:t.notify_status.find((t=>t.value===(null==e?void 0:e.notify_status))))?void 0:l.label)||(null==e?void 0:e.notify_status)),1)]})),_:1},8,["table-column","auth-btn","order","query-api","title-field-search","switch-click-status-config"]),x(D,{open:c(b),"onUpdate:open":l[1]||(l[1]=e=>U(b)?b.value=e:null),"row-data":c(w),title:`${null==(a=c(w))?void 0:a.classify_name}-告警分组信息`,"basic-config":{api:c(t).getDetail,sid:null==(i=c(w))?void 0:i.id,columns:c(f).subPageColumns}},null,8,["open","row-data","title","basic-config"]),x(Ye,{open:c(s),"onUpdate:open":l[2]||(l[2]=e=>U(s)?s.value=e:null),sid:c(p),"form-type":c(d),onEditSuccess:g},null,8,["open","sid","form-type"])])}}},Qe={__name:"LevelEdit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number},tableAllData:{type:Array,default:()=>[]}},emits:["update:open","editSuccess"],setup(e,{emit:a}){let{level:i}=_e;const r=e,{open:d,sid:p,formType:m,tableAllData:_}=t(r),g=a;let b=E(null);const{postAdd:w,getList:h,putEdit:k}=i;let C=l({noticeType:[]});const T={P0:1,P1:2,P2:3,P3:4};let{formRenderContent:D,formDataLoading:O,confirmLoading:R,initForm:j,formDataInit:U,editSubmit:F}=H({formRef:b,editTitleLayer:3,formType:m,sid:p,emits:g,addApi:w,editApi:k,oneDataApi:h,customSubmitData:async e=>e,customEditData:()=>{}});const N=()=>{g("update:open",!1)},B=async e=>{e&&(await j(),await U())},I=e=>{D.value.formState.notice_type=T[e.target.value]};return(e,t)=>{const l=W,a=Q,i=ne,r=re,g=P,w=L,h=A("vxe-button"),k=J;return o(),f(k,{title:`${e.$route.meta.title}-  告警等级 ${c(m)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":`NO.${c(p)} 编辑`}`,open:c(d),onAfterOpenChange:B,onClose:N},{footer:S((()=>[x(h,{content:"取消",onClick:N}),x(h,{type:"submit",loading:c(R),status:"primary",content:"提交",onClick:c(F)},null,8,["loading","onClick"])])),default:S((()=>[x(w,{spinning:c(O)},{default:S((()=>[x(g,{ref_key:"formRef",ref:b,model:c(D).formState,rules:c(D).rules},{default:S((()=>[(o(!0),n(u,null,s(e.$utils.filter(c(D).title,(e=>e.edit_display)),(t=>{var d,p,m,g,b,w,h;return o(),n(u,{key:t.field},["alert_source"===t.field?(o(),f(a,{key:0,value:c(D).formState[t.field],"onUpdate:value":e=>c(D).formState[t.field]=e,title:t,"title-data":null==(p=null==(d=c(D))?void 0:d.title_data)?void 0:p[t.field]},{default:S((()=>[x(l,{value:c(D).formState[t.field],"onUpdate:value":e=>c(D).formState[t.field]=e,options:e.$utils.uniq(c(_),"alert_source").map((e=>({value:e.alert_source,label:e.alert_source})))},null,8,["value","onUpdate:value","options"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"notice_type"===t.field?(o(),n(u,{key:1},[(null==(m=c(D).formState)?void 0:m.alert_level)?(o(),f(a,{key:0,title:t,"title-data":null==(b=null==(g=c(D))?void 0:g.title_data)?void 0:b[t.field]},{default:S((()=>[x(r,{value:c(D).formState[t.field],"onUpdate:value":e=>c(D).formState[t.field]=e,disabled:!t.edit_change,name:t.field},{default:S((()=>{var e,l;return[(o(!0),n(u,null,s(null==(l=null==(e=c(D))?void 0:e.title_data)?void 0:l[t.field].filter((e=>e.value===T[c(D).formState.alert_level])),(e=>(o(),f(i,{key:e.value,value:e.value},{default:S((()=>[$(v(e.label),1)])),_:2},1032,["value"])))),128))]})),_:2},1032,["value","onUpdate:value","disabled","name"])])),_:2},1032,["title","title-data"])):y("",!0)],64)):"alert_level"===t.field?(o(),f(a,{key:2,value:c(D).formState[t.field],"onUpdate:value":e=>c(D).formState[t.field]=e,title:t,"title-data":c(C).noticeType,onChange:I},null,8,["value","onUpdate:value","title","title-data"])):(o(),f(a,{key:3,value:c(D).formState[t.field],"onUpdate:value":e=>c(D).formState[t.field]=e,title:t,"title-data":null==(h=null==(w=c(D))?void 0:w.title_data)?void 0:h[t.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},Ve=["onClick"],We={__name:"Level",setup(e){const t=E(null),{level:i}=_e,s=l({initColumn:[],initButton:[],initTitleData:[]}),{userDel:d,userEdit:p,formOpen:m,formType:f,formSid:_}=V(),y=C((()=>{for(let e of s.initColumn){let{field:t}=e;switch(t){case"virtual_team_v3_id":e.showOverflow=!1;break;case"notice_type":case"alert_level":case"id":e.slots={default:t}}}return s.initColumn})),g=C((()=>{const e=["edit","add","delete"];return s.initButton.reduce(((t,l)=>(e.includes(l.field)&&(t["delete"===l.field?"del":l.field]=l),t)),{})}));a((async()=>{const{button:e,columns:t,title_data:l}=await z.setColumn({layer:3});s.initColumn=t.value||[],s.initButton=e.value||[],s.initTitleData=l.value||[],b()}));const b=async()=>{t.value&&await t.value.commitRequest()},w=({type:e,row:t})=>{p({type:e,sid:t.id})},h=e=>{d({delApi:i.delete,sid:e.id,loadData:b})},{subPageOpen:k,subPageRow:T,handleSubPageOpen:D}=le();return(e,l)=>{var a,d,C;const O=Oe,R=oe,j=ae;return o(),n(u,null,[x(R,{ref_key:"tableRef",ref:t,columns:c(y),"auth-btn":c(g),"request-config":{api:c(i).getList,immediate:!1},"switch-click-status-config":{api:c(i).putEdit},onUserEdit:w,onUserAdd:l[0]||(l[0]=t=>c(p)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:h},{id:S((({row:e})=>[r("span",{class:"cursor-pointer text-primary",onClick:t=>c(D)(e)},v(e.id),9,Ve)])),notice_type:S((({row:e})=>{var t,l;return[$(v((null==(l=null==(t=c(s).initTitleData)?void 0:t.notice_type.find((t=>t.value===(null==e?void 0:e.notice_type))))?void 0:l.label)||(null==e?void 0:e.notice_type)),1)]})),alert_level:S((({row:e})=>[x(O,{level:null==e?void 0:e.alert_level},null,8,["level"])])),_:1},8,["columns","auth-btn","request-config","switch-click-status-config"]),x(Qe,{open:c(m),"onUpdate:open":l[1]||(l[1]=e=>U(m)?m.value=e:null),sid:c(_),"table-all-data":(null==(a=c(t))?void 0:a.tableAllData)||[],"form-type":c(f),onEditSuccess:b},null,8,["open","sid","table-all-data","form-type"]),x(j,{open:c(k),"onUpdate:open":l[2]||(l[2]=e=>U(k)?k.value=e:null),"row-data":c(T),title:`NO.${null==(d=c(T))?void 0:d.id}告警等级信息`,"basic-config":{api:c(i).getList,sid:null==(C=c(T))?void 0:C.id,columns:c(s).subPageColumns}},{notice_type:S((({row:e})=>{var t,l;return[$(v((null==(l=null==(t=c(s).initTitleData)?void 0:t.notice_type.find((t=>t.value===(null==e?void 0:e.notice_type))))?void 0:l.label)||(null==e?void 0:e.notice_type)),1)]})),alert_level:S((({row:e})=>[x(O,{level:null==e?void 0:e.alert_level},null,8,["level"])])),_:1},8,["open","row-data","title","basic-config"])],64)}}},Je={class:"doc-renderer"},Ke={class:"doc-body"},Xe={key:0,class:"loading-container"},Ze=(e=>(b("data-v-7b86c8cf"),e=e(),w(),e))((()=>r("p",{class:"loading-text"},"正在加载文档...",-1))),et={key:1,class:"error-container"},tt=["innerHTML"],lt=e({__name:"DocRenderer",props:{customFileMd:{type:Object,default:()=>({})},title:{type:String,default:"帮助文档"}},setup(e){let t=e;const l=q(),i=E(""),u=E(!0),s=E(!1),d=()=>{var e,a,i,o;const{mainRoute:n,subRoute:r}=(()=>{const e=l.path.split("/").filter((e=>e&&"page"!==e));return{mainRoute:e[0],subRoute:e.slice(1).join("/")}})(),u=`${window.location.protocol}//10.199.20.46:8091/opscenter-cloud-manage-docs/${(null==(e=null==t?void 0:t.customFileMd)?void 0:e.prefix)?null==(a=null==t?void 0:t.customFileMd)?void 0:a.prefix:n}/`;return{baseUrl:u,docUrl:(null==(i=null==t?void 0:t.customFileMd)?void 0:i.name)?`${u}${null==(o=null==t?void 0:t.customFileMd)?void 0:o.name}`:`${u}${r}_docs.md`}},v=async()=>{try{u.value=!0,s.value=!1;const{docUrl:e}=d(),t=await fetch(e);if(!t.ok)throw new Error("文档加载失败");const l=await t.text();i.value=ue((e=>{const{baseUrl:t}=d();return e.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,((e,l,a)=>a.startsWith("http://")||a.startsWith("https://")?e:`![${l}](${t}${a})`))})(l))}catch(e){i.value="文档加载失败，请稍后重试",s.value=!0}finally{u.value=!1}};return a((()=>{v()})),(e,t)=>{const l=L,a=B,d=se;return o(),n("div",Je,[r("div",Ke,[c(u)?(o(),n("div",Xe,[x(l,{size:"large"}),Ze])):c(s)?(o(),n("div",et,[x(d,{status:"error",title:"文档加载失败","sub-title":"请检查网络连接或稍后重试"},{extra:S((()=>[x(a,{type:"primary",onClick:v},{default:S((()=>[$("重新加载")])),_:1})])),_:1})])):(o(),n("div",{key:2,class:"doc-content markdown-body",innerHTML:c(i)},null,8,tt))])])}}},[["__scopeId","data-v-7b86c8cf"]]),at={__name:"index",setup(e){const t=[{label:"总览",value:"overview"},{label:"告警清单",value:"alert_total_number"},{label:"告警分组",value:"alert_group_number"},{label:"告警等级",value:"alert_level_number"},{label:"告警接入",value:"alert_access"}];let l=E(null);const a=e=>{I((()=>{var t,a;l.value&&(null==(a=null==(t=l.value)?void 0:t.handleClick)||a.call(t,e))}))};return(e,i)=>{const n=pe;return o(),f(n,{ref_key:"tabRef",ref:l,"tab-type":t},{overview:S((()=>[x(De,{onCustomChange:a})])),alert_total_number:S((()=>[x(Me)])),alert_group_number:S((()=>[x(He)])),alert_level_number:S((()=>[x(We)])),alert_access:S((()=>[x(lt,{"custom-file-md":{prefix:"alert",name:"alert_receive_docs.md"}})])),_:1},512)}}};export{at as default};
