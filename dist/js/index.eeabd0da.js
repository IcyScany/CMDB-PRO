import{s as e,_ as s}from"./subPage.2201bfd5.js";import{_ as a}from"./ServerTable.53881589.js";import{t}from"./tableRender.a6ff99b7.js";import{f as i}from"./feishuToJira.c0a6bcc9.js";import{r,H as l,q as u,J as n,I as o,O as d,Q as c,R as m,c as _,W as f,X as p,Y as h,$ as j,U as b,ah as v,a6 as x,Z as y,ad as g}from"./index.872a2bd0.js";import{_ as w}from"./index.fc9664cf.js";import"./index.029351cd.js";import"./index.64f8d8d4.js";import"./opsDescriptions.dfa169bd.js";import"./index.87ccdcd1.js";import"./index.a533313d.js";import"./index.2c670fa1.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";const k={style:{flex:"auto","min-height":"0"}},C=["onClick"],P=["href"],U={class:"text-primary"},R={key:1},T=["href"],z={class:"text-primary"},O={key:1},S={__name:"index",setup(S){let{postList:q,getDetail:B}=i;const D=r(null),F=l({initColumn:[],subPageColumns:[],initButton:[],initTitleData:[],tableOrder:{},titleFieldSearch:[],jiraUrl:""}),$=u((()=>{for(let e of F.initColumn){let{field:s}=e;switch(s){case"id":case"feishu_status":case"status":case"description":case"jira_issue_id":e.slots={default:s}}}return F.initColumn})),H=u((()=>F.initButton.reduce(((e,s)=>(e[s.field]=s,e)),{})));n((async()=>{const{button:e,columns:s,title_data:a,order:i,title_field_search:r,sub_page_columns:l}=await t.setColumn({layer:1});F.initColumn=s.value||[],F.initButton=e.value||[],F.initTitleData=a.value||[],F.tableOrder=i.value||{},F.titleFieldSearch=r.value||[],F.subPageColumns=l||[],F.jiraUrl="",await J()}));const J=async()=>{D.value&&(await D.value.serverTableRef.commitProxy("query"),o((()=>{var e,s,a,t;(null==(e=D.value)?void 0:e.serverTableRef)&&(null==(t=null==(a=null==(s=D.value)?void 0:s.serverTableRef)?void 0:a.recalculate)||t.call(a,!0))})))},L={fields:[{field:"feishu_serial_number",field_name:"飞书审批单编号",operator:"=",validate:e=>{const s=String(e).trim();return/^[-+]?(\d+(\.\d*)?|\.\d+)$/.test(s)}},{field:"feishu_approval_name",field_name:"飞书审批单名称",operator:"vague"}],placeholder:"支持飞书审批单编号、飞书审批单名称搜索"},{subPageOpen:Q,subPageRow:A,handleSubPageOpen:E}=e(),G=({response:e})=>{F.jiraUrl=(null==e?void 0:e.jira_url)||""};return(e,t)=>{var i,r;const l=d("vxe-tag"),u=d("vxe-button"),n=w,o=a,S=s;return c(),m("div",k,[_(o,{ref_key:"tableRef",ref:D,"table-column":j($),"auth-btn":j(H),order:j(F).tableOrder,"query-api":j(q),"default-search-field":L,"title-field-search":j(F).titleFieldSearch,onProxyQueryAllResult:G},{id:f((({row:e})=>[p("span",{class:"cursor-pointer text-primary",onClick:s=>j(E)(e)},h(e.id),9,C)])),feishu_status:f((({row:e})=>[e.feishu_status?(c(),b(l,{key:0,class:x("通过"==e.feishu_status?"theme--success":"theme--warning"),size:"small"},{default:f((()=>[v(h(e.feishu_status),1)])),_:2},1032,["class"])):y("",!0)])),status:f((({row:e})=>[e.status?(c(),b(l,{key:0,class:x("同步成功"==e.status?"theme--success":"theme--warning"),size:"small"},{default:f((()=>[v(h(e.status),1)])),_:2},1032,["class"])):y("",!0)])),jira_issue_id:f((({row:e})=>[j(F).jiraUrl&&e.jira_issue_id?(c(),m("a",{key:0,href:j(F).jiraUrl+e.jira_issue_id,target:"_blank"},[p("span",U,h(e.jira_issue_id),1)],8,P)):(c(),m("span",R,h(e.jira_issue_id),1))])),description:f((({row:e})=>[e.description?(c(),b(n,{key:0,placement:"left"},{content:f((()=>[v(h(e.description),1)])),title:f((()=>[v(" 错误信息 ")])),default:f((()=>[_(u,{status:"error",size:"small"},{default:f((()=>[v("错误信息")])),_:1})])),_:2},1024)):y("",!0)])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search"]),_(S,{open:j(Q),"onUpdate:open":t[0]||(t[0]=e=>g(Q)?Q.value=e:null),"row-data":j(A),title:`${null==(i=j(A))?void 0:i.feishu_serial_number}-飞书审批单信息`,"basic-config":{api:j(B),sid:null==(r=j(A))?void 0:r.id,columns:j(F).subPageColumns}},{feishu_status:f((({row:e})=>[e.feishu_status?(c(),b(l,{key:0,class:x("通过"==e.feishu_status?"theme--success":"theme--warning"),size:"small"},{default:f((()=>[v(h(e.feishu_status),1)])),_:2},1032,["class"])):y("",!0)])),status:f((({row:e})=>[e.status?(c(),b(l,{key:0,class:x("同步成功"==e.status?"theme--success":"theme--warning"),size:"small"},{default:f((()=>[v(h(e.status),1)])),_:2},1032,["class"])):y("",!0)])),jira_issue_id:f((({row:e})=>[j(F).jiraUrl&&e.jira_issue_id?(c(),m("a",{key:0,href:j(F).jiraUrl+e.jira_issue_id,target:"_blank",class:"text-primary"},[p("span",z,h(e.jira_issue_id),1)],8,T)):(c(),m("span",O,h(e.jira_issue_id),1))])),_:1},8,["open","row-data","title","basic-config"])])}}};export{S as default};
