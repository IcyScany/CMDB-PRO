import{s as t,_ as e}from"./subPage.2201bfd5.js";import{_ as a}from"./ServerTable.53881589.js";import{a as l,_ as i}from"./opsDescriptions.dfa169bd.js";import{_ as o}from"./index.de966786.js";import{b5 as n,al as r,r as s,O as u,Q as d,U as p,W as c,c as m,$ as _,R as T,F as v,S as b,a8 as f,aN as P,a3 as C,Z as h,ah as g,Y as y,X as H,dB as x,aY as S,H as w,q as X,v as U,J as I,x as D,dC as k,ap as Q,I as L,av as B,a9 as j,aa as R,ad as E,aV as O}from"./index.872a2bd0.js";import{t as A}from"./tableRender.a6ff99b7.js";import{o as F,_ as Y,u as M}from"./opsFormInit.3a4e1794.js";import{_ as z}from"./index.029351cd.js";import{A as G}from"./loadBalancer.722baad3.js";import{_ as $}from"./index.7d980246.js";import{c as W,i as N}from"./index.165d9fa7.js";import{R as V}from"./dayjs.c124633a.js";import{_ as q}from"./index.8338e1f7.js";import{_ as J}from"./index.44a4e190.js";import{_ as Z}from"./index.48209b21.js";import"./index.2c670fa1.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.fc9664cf.js";import"./index.9846e408.js";import"./index.87ccdcd1.js";import"./index.a533313d.js";import"./alertLevel.8dae0e72.js";import"./index.65b2e021.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.64f8d8d4.js";import"./opsTable.7b07fc7b.js";import"./useMaxLevel.bba6798c.js";const K={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:n}},emits:["update:open","editSuccess"],setup(t,{emit:e}){const a=t,{open:l,sid:i,formType:o}=r(a),n=e,C=s(null),{putEdit:h,getDetail:g,postAdd:y}=G,{formRenderContent:H,formDataLoading:x,confirmLoading:S,initForm:w,formDataInit:X,editSubmit:U}=F({formRef:C,TITLE_LAYER:1,formType:o,sid:i,emits:n,addApi:y,editApi:h,oneDataApi:g,customSubmitData:async function(t){return t},customEditData:function(){}});const I=()=>{n("update:open",!1)},D=async t=>{t&&(await w(),await X())};return(t,e)=>{const a=Y,i=f,n=P,r=u("vxe-button"),s=z;return d(),p(s,{title:`${t.$route.meta.title}${_(o)===t.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:_(l),onAfterOpenChange:D,onClose:I},{footer:c((()=>[m(r,{content:"取消",onClick:I}),m(r,{type:"submit",loading:_(S),status:"primary",content:"提交",onClick:_(U)},null,8,["loading","onClick"])])),default:c((()=>[m(n,{spinning:_(x)},{default:c((()=>[m(i,{ref_key:"formRef",ref:C,model:_(H).formState,rules:_(H).rules},{default:c((()=>[(d(!0),T(v,null,b(t.$utils.filter(_(H).title,(t=>t.edit_display)),(t=>{var e,l,i,o;return d(),T(v,{key:t.field},[""===t.field?(d(),p(a,{key:0,value:_(H).formState[t.field],"onUpdate:value":e=>_(H).formState[t.field]=e,title:t,"title-data":null==(l=null==(e=_(H))?void 0:e.title_data)?void 0:l[t.field]},null,8,["value","onUpdate:value","title","title-data"])):(d(),p(a,{key:1,value:_(H).formState[t.field],"onUpdate:value":e=>_(H).formState[t.field]=e,title:t,"title-data":null==(o=null==(i=_(H))?void 0:i.title_data)?void 0:o[t.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},tt={class:"text-primary"},et=C({__name:"basicTab",props:{data:{type:Object,default:()=>({})},columns:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>({})}},setup(t){const e=t;return(a,i)=>{const n=x,r=o,s=l,u=S;return d(),p(u,{style:{marginBottom:"20px"}},{default:c((()=>[0===t.data.length?(d(),p(n,{key:0})):h("",!0),m(s,{data:t.data,columns:e.columns.filter((t=>{var e;return 1===(null==(e=null==t?void 0:t.oriTitle)?void 0:e.block)})),column:2,"label-style":{width:"200px",marginRight:"10px",color:"#868686"},size:"small"},{cloud_master_account_id:c((({row:e})=>{var a,l,i;return[g(y((null==(i=null==(l=null==(a=t.titleData)?void 0:a.cloud_master_account_id)?void 0:l[e.cloud_master_account_id])?void 0:i.page_display)||""),1)]})),region_id:c((({row:e})=>{var a,l,i;return[H("div",null,y((null==(a=t.titleData)?void 0:a.region_id)&&(null==(i=null==(l=t.titleData)?void 0:l.region_id)?void 0:i[null==e?void 0:e.region_id])||(null==e?void 0:e.region_id)),1)]})),zone_id:c((({row:t})=>{var e;return[H("div",null,y(null==(e=null==t?void 0:t.zone_id)?void 0:e.join(",")),1)]})),charge_type:c((({row:t})=>[m(r,{"charge-type":t.charge_type,"expired-time":t.expire_time,"sub-page":!0},null,8,["charge-type","expired-time"])])),addresses:c((({row:t})=>[(d(!0),T(v,null,b(t.addresses,(t=>(d(),T("div",{key:t.id,class:"truncate"},y(t.address)+" ("+y(t.type)+" "+y(t.scope)+")",1)))),128))])),listeners:c((({row:t})=>[(d(!0),T(v,null,b(t.listeners,(t=>(d(),T("div",{key:t.id,class:"truncate"},[H("span",tt,y(t.name),1),H("span",null," ("+y(t.protocol)+"/"+y(t.protocol_port)+")",1)])))),128))])),enterprise_project_id:c((({row:e})=>{var a,l;return[g(y((null==(l=null==(a=t.titleData)?void 0:a.enterprise_project_id)?void 0:l[e.enterprise_project_id])||""),1)]})),edition:c((({row:e})=>{var a,l;return[g(y((null==(l=null==(a=t.titleData)?void 0:a.edition)?void 0:l[e.edition])||e.edition),1)]})),charge_mode:c((({row:e})=>{var a,l;return[g(y((null==(l=null==(a=t.titleData)?void 0:a.charge_mode)?void 0:l[e.charge_mode])||e.charge_mode),1)]})),modification_protection_status:c((({row:e})=>{var a,l;return[g(y((null==(l=null==(a=t.titleData)?void 0:a.modification_protection_status)?void 0:l[e.modification_protection_status])||e.modification_protection_status),1)]})),deletion_protection_status:c((({row:e})=>{var a,l;return[g(y((null==(l=null==(a=t.titleData)?void 0:a.deletion_protection_status)?void 0:l[e.deletion_protection_status])||e.deletion_protection_status),1)]})),_:1},8,["data","columns"])])),_:1})}}},[["__scopeId","data-v-a37ad17f"]]),at={__name:"ipGroup",props:{open:Boolean,initColumn:Array,ipgroupData:Array,initTitleData:Object},emits:["update:open"],setup(t,{emit:e}){const a=t,i=e,o=s(null),n=2,r=w({data:[]}),u=X((()=>{let t=a.initColumn.filter((t=>t.oriTitle.block===n&&["address","description"].includes(t.field)));for(let e of t){let{field:t}=e;if(""===t)e.slots={default:t}}return t})),T=X((()=>a.initColumn.filter((t=>t.oriTitle.block===n&&!["address","description"].includes(t.field))))),v=async t=>{r.data=t&&a.ipgroupData.map((t=>t.addresses)).flat()||[],o.value.commitRequest()};return(e,n)=>{const s=l,b=$,f=z;return d(),p(f,{open:t.open,title:"IP组",width:"60%",onClose:n[0]||(n[0]=t=>i("update:open",!1)),onAfterOpenChange:v},{default:c((()=>[m(s,{data:a.ipgroupData[0]||{},columns:_(T),column:2},{enterprise_project_id:c((({row:t})=>{var e,l;return[g(y(null==(l=null==(e=a.initTitleData)?void 0:e.enterprise_project_id)?void 0:l[t.source_data.enterprise_project_id]),1)]})),created_at:c((({row:t})=>[g(y(t.source_data.created_at),1)])),description2:c((({row:t})=>[g(y(t.description),1)])),_:1},8,["data","columns"]),m(b,{ref_key:"tableRef",ref:o,data:_(r).data||[],columns:_(u)},null,8,["data","columns"])])),_:1},8,["open"])}}},lt={class:"truncate text-primary"},it={class:"truncate"},ot={class:"truncate"},nt={class:"truncate"},rt={class:"truncate"},st={class:"truncate"},ut={__name:"serverGroup",props:{open:Boolean,initColumn:Array,groupData:Array},emits:["update:open"],setup(t,{emit:e}){const a=t,l=e,i=s(null),o=3,n=w({data:[]}),r=X((()=>{let t=a.initColumn.filter((t=>t.oriTitle.block===o));for(let e of t){let{field:t}=e;switch(t){case"listeners":case"members":case"load_balancers":case"health_check_config":e.slots={default:t},e.showOverflow=!1}}return t})),u=async t=>{n.data=t&&a.groupData||[],i.value.commitRequest()};return(e,a)=>{const o=U,s=$,f=z;return d(),p(f,{open:t.open,title:"后端服务器组",width:"60%",onClose:a[0]||(a[0]=t=>l("update:open",!1)),onAfterOpenChange:u},{default:c((()=>[m(s,{ref_key:"tableRef",ref:i,data:_(n).data||[],columns:_(r)},{id:c((({row:t})=>[H("div",lt,y(t.name),1),H("div",it,y(t.id),1)])),listeners:c((({row:t})=>[(d(!0),T(v,null,b(t.listeners,(t=>(d(),p(o,{key:t.id,title:t.id},{default:c((()=>[H("div",ot,y(t.id),1)])),_:2},1032,["title"])))),128))])),members:c((({row:t})=>[(d(!0),T(v,null,b(t.members,(t=>(d(),p(o,{key:t.id,title:t.id},{default:c((()=>[H("div",nt,y(t.id),1)])),_:2},1032,["title"])))),128))])),load_balancers:c((({row:t})=>[(d(!0),T(v,null,b(t.load_balancers,(t=>(d(),p(o,{key:t.id,title:t.id},{default:c((()=>[H("div",rt,y(t.id),1)])),_:2},1032,["title"])))),128))])),health_check_config:c((({row:t})=>[(d(!0),T(v,null,b(t.health_check_config,(t=>(d(),p(o,{key:t.id,class:"truncate"},{default:c((()=>[H("div",st,y(t.id),1)])),_:2},1024)))),128))])),_:1},8,["data","columns"])])),_:1},8,["open"])}}},dt={class:"truncate"},pt={key:0},ct={key:1},mt={class:"text-primary"},_t=["onClick"],Tt=["onClick"],vt={__name:"index",props:{sid:{type:[String,Number],default:""},rowData:{type:Object,default:()=>({})}},setup(t){const e=t,a=s(null),l=w({tableData:[],initColumn:[],initButton:[],initTitleData:[],ipgroupOpen:!1,serverGroupOpen:!1,serverGroupData:[],ipgroupData:[],serverGroupRowId:""}),i=X((()=>{let t=l.initColumn.filter((t=>1===t.oriTitle.block))||[];for(let e of t){let{field:t}=e;switch(t){case"ipgroup":case"server_group_id":e.slots={default:t},e.showOverflow=!1}}return t}));return I((async()=>{const{button:t,columns:e,title_data:a,order:i,title_field_search:o}=await A.setColumn({layer:2,tableType:"client"});l.initColumn=e.value||[],l.initButton=t.value||[],l.initTitleData=a.value||[],l.tableOrder=i.value||{},l.titleFieldSearch=o||{}})),D((()=>e.sid),(async()=>{e.sid&&(await(async()=>{const t=await G.getListeners(e.sid);l.tableData=(null==t?void 0:t.listeners)||[],await a.value.commitRequest()})(),await(async()=>{var t;const a=await G.getServerGroup(e.sid,null==(t=e.rowData)?void 0:t.cloud_instance_id);l.serverGroupData=(null==a?void 0:a.server_groups)||[]})(),await(async()=>{var t,a,i,o;let n=[];for(let e of l.tableData)(null==(a=null==(t=null==e?void 0:e.source_data)?void 0:t.ipgroup)?void 0:a.ipgroup_id)&&n.push(null==(o=null==(i=null==e?void 0:e.source_data)?void 0:i.ipgroup)?void 0:o.ipgroup_id);const r=await G.getIpgroup(e.sid,n);l.ipgroupData=(null==r?void 0:r.ip_groups)||[]})())}),{immediate:!0}),(t,e)=>{const o=$;return d(),T(v,null,[m(o,{ref_key:"tableRef",ref:a,data:_(l).tableData,columns:_(i)},{id:c((({row:t})=>[H("div",null,y(t.name),1),H("div",dt,y(t.id),1)])),ipgroup:c((({row:t})=>{var e,a,i,o;return[(null==(e=null==t?void 0:t.source_data)?void 0:e.ipgroup)?(d(),T("div",ct,[H("span",null,["white"===(null==(a=null==t?void 0:t.source_data)?void 0:a.ipgroup.type)?(d(),T(v,{key:0},[g("白名单-允许 ")],64)):(d(),T(v,{key:1},[g("黑名单-禁止 ")],64))]),H("span",null,[H("span",mt,y(null==(i=_(l).ipgroupData.find((e=>{var a,l;return e.id===(null==(l=null==(a=null==t?void 0:t.source_data)?void 0:a.ipgroup)?void 0:l.ipgroup_id)})))?void 0:i.name),1),g(" 访问服务器 ")]),H("span",null,[(null==(o=null==t?void 0:t.source_data)?void 0:o.ipgroup.enable_ipgroup)?(d(),T(v,{key:0},[g("(已生效)")],64)):(d(),T(v,{key:1},[g("(未生效)")],64))]),H("div",{class:"text-primary cursor-pointer",onClick:t=>{l.ipgroupOpen=!0}}," IP组列表 ",8,_t)])):(d(),T("div",pt," 允许所有IP访问 "))]})),server_group_id:c((({row:t})=>{var e;return[g(y(null==(e=_(l).serverGroupData.find((e=>e.id===(null==t?void 0:t.server_group_id[0]))))?void 0:e.name)+" ",1),H("div",{class:"text-primary cursor-pointer",onClick:e=>(t=>{l.serverGroupRowId=t.server_group_id[0],l.serverGroupOpen=!0})(t)}," 后端服务器 ",8,Tt)]})),_:1},8,["data","columns"]),m(at,{open:_(l).ipgroupOpen,"onUpdate:open":e[0]||(e[0]=t=>_(l).ipgroupOpen=t),"init-column":_(l).initColumn,"ipgroup-data":_(l).ipgroupData,"init-title-data":_(l).initTitleData},null,8,["open","init-column","ipgroup-data","init-title-data"]),m(ut,{open:_(l).serverGroupOpen,"onUpdate:open":e[1]||(e[1]=t=>_(l).serverGroupOpen=t),"init-column":_(l).initColumn,"group-data":_(l).serverGroupData.filter((t=>t.id===_(l).serverGroupRowId))},null,8,["open","init-column","group-data"])],64)}}},bt=[{label:"近30分钟",value:[k().add(-30,"m"),k()]},{label:"近1小时",value:[k().add(-1,"h"),k()]},{label:"近2小时",value:[k().add(-2,"h"),k()]},{label:"近3小时",value:[k().add(-2,"h"),k()]},{label:"近12小时",value:[k().add(-12,"h"),k()]},{label:"近24小时",value:[k().add(-24,"h"),k()]},{label:"近7天",value:[k().add(-7,"d"),k()]},{label:"近30天",value:[k().add(-30,"d"),k()]}],ft=[{value:"300",label:"5分钟"},{value:"1200",label:"20分钟"},{value:"3600",label:"1小时"},{value:"14400",label:"4小时"},{value:"86400",label:"24小时"}],Pt=[{value:["average","1"],label:"原始值"},{value:"average",label:"平均值"},{value:"sum",label:"求和"},{value:"max",label:"最大值"},{value:"min",label:"最小值"}],Ct=[{value:"lbaas_instance_id",label:"负载均衡器"},{value:"lbaas_listener_id",label:"监听器"},{value:"lbaas_pool_id",label:"后端服务器"}],ht={dropped_connections:{label:"丢弃连接数",unit:"Count/s",tooltip:"测量对象每秒丢弃连接的个数。"},dropped_packets:{label:"丢弃数据包",unit:"Count/s",tooltip:"测量对象每秒丢弃数据报文的个数。"},dropped_traffic:{label:"丢弃网络带宽",unit:"bit/s",tooltip:"测量对象丢弃网络带宽。"},elb_http_2xx:{label:"负载均衡响应状态码(2XX)",unit:"Count/s",tooltip:"负载均衡每秒返回2XX响应状态码的个数。 负载均衡每秒返回2XX响应状态码的个数。"},elb_http_3xx:{label:"负载均衡响应状态码(3XX)",unit:"Count/s",tooltip:"负载均衡每秒返回3XX响应状态码的个数。 负载均衡每秒返回3XX响应状态码的个数。"},elb_http_400:{label:"负载均衡响应状态码400",unit:"Count/s",tooltip:"负载均衡每秒返回400响应状态码的个数。 负载均衡每秒返回400响应状态码的个数。"},elb_http_404:{label:"负载均衡响应状态码404",unit:"Count/s",tooltip:"负载均衡每秒返回404响应状态码的个数。 负载均衡每秒返回404响应状态码的个数。"},elb_http_408:{label:"负载均衡响应状态码408",unit:"Count/s",tooltip:"负载均衡每秒返回408响应状态码的个数。 负载均衡每秒返回408响应状态码的个数。"},elb_http_499:{label:"负载均衡响应状态码499",unit:"Count/s",tooltip:"负载均衡每秒返回499响应状态码的个数。 负载均衡每秒返回499响应状态码的个数。"},elb_http_4xx:{label:"负载均衡响应状态码(4XX)",unit:"Count/s",tooltip:"负载均衡每秒返回4XX响应状态码的个数。 负载均衡每秒返回4XX响应状态码的个数。"},elb_http_502:{label:"负载均衡响应状态码502",unit:"Count/s",tooltip:"负载均衡每秒返回502响应状态码的个数。 负载均衡每秒返回502响应状态码的个数。"},elb_http_503:{label:"负载均衡响应状态码503",unit:"Count/s",tooltip:"负载均衡每秒返回503响应状态码的个数。 负载均衡每秒返回503响应状态码的个数。"},elb_http_504:{label:"负载均衡响应状态码504",unit:"Count/s",tooltip:"负载均衡每秒返回504响应状态码的个数。 负载均衡每秒返回504响应状态码的个数。"},elb_http_5xx:{label:"负载均衡响应状态码(5XX)",unit:"Count/s",tooltip:"负载均衡每秒返回5XX响应状态码的个数。 负载均衡每秒返回5XX响应状态码的个数。"},ipgroup_blocked_packets:{label:"黑白名单每秒阻断数据报文的个数",unit:"Count/s",tooltip:"每秒黑白名单阻断流入测量对象数据报文的个数。 每秒黑白名单阻断流入测量对象数据报文的个数。"},ipgroup_blocked_traffic:{label:"黑白名单阻断的网络带宽",unit:"bit/s",tooltip:"黑白名单阻断流入测量对象的网络带宽。 黑白名单阻断流入测量对象的网络带宽。"},l4_con_usage:{label:"4层并发连接使用率",unit:"%",tooltip:"4层的ELB实例并发连接数使用率。 4层的ELB实例并发连接数使用率。"},l4_in_bps_usage:{label:"4层入带宽使用率",unit:"%",tooltip:"4层的ELB实例入带宽使用率。 注意： 若入带宽使用率达到100%，说明已经超出ELB规格所提供的性能保障，您的业务可以继续使用更高带宽，但对于带宽超出的部分，ELB无法承诺服务可用性指标。 4层的ELB实例入带宽使用率。 注意： 若入带宽使用率达到100%，说明已经超出ELB规格所提供的性能保障，您的业务可以继续使用更高带宽，但对于带宽超出的部分，ELB无法承诺服务可用性指标。"},l4_ncps_usage:{label:"4层新建连接数使用率",unit:"%",tooltip:"4层的ELB实例新建连接数使用率。 4层的ELB实例新建连接数使用率。"},l4_out_bps_usage:{label:"4层出带宽使用率",unit:"%",tooltip:"4层的ELB实例出带宽使用率。 注意： 若出带宽使用率达到100%，说明已经超出ELB规格所提供的性能保障，您的业务可以继续使用更高带宽，但对于带宽超出的部分，ELB无法承诺服务可用性指标。 4层的ELB实例出带宽使用率。 注意： 若出带宽使用率达到100%，说明已经超出ELB规格所提供的性能保障，您的业务可以继续使用更高带宽，但对于带宽超出的部分，ELB无法承诺服务可用性指标。"},l7_2xx_ratio:{label:"七层2XX请求占比",unit:"%",tooltip:"七层2XX响应状态码的个数占比。 七层2XX响应状态码的个数占比。"},l7_4xx_ratio:{label:"七层4XX请求占比",unit:"%",tooltip:"七层4XX响应状态码的个数占比。 七层4XX响应状态码的个数占比。"},l7_5xx_ratio:{label:"七层5XX请求占比",unit:"%",tooltip:"七层5XX响应状态码的个数占比。 七层5XX响应状态码的个数占比。"},l7_con_usage:{label:"7层并发连接使用率",unit:"%",tooltip:"7层的ELB实例并发连接数使用率。 7层的ELB实例并发连接数使用率。"},l7_in_bps_usage:{label:"7层入带宽使用率",unit:"%",tooltip:"7层的ELB实例入带宽使用率。 注意： 若入带宽使用率达到100%，说明已经超出ELB规格所提供的性能保障，您的业务可以继续使用更高带宽，但对于带宽超出的部分，ELB无法承诺服务可用性指标。 7层的ELB实例入带宽使用率。 注意： 若入带宽使用率达到100%，说明已经超出ELB规格所提供的性能保障，您的业务可以继续使用更高带宽，但对于带宽超出的部分，ELB无法承诺服务可用性指标。"},l7_ncps_usage:{label:"7层新建连接数使用率",unit:"%",tooltip:"7层的ELB实例新建连接数使用率。 7层的ELB实例新建连接数使用率。"},l7_out_bps_usage:{label:"7层出带宽使用率",unit:"%",tooltip:"7层的ELB实例出带宽使用率。 注意： 若出带宽使用率达到100%，说明已经超出ELB规格所提供的性能保障，您的业务可以继续使用更高带宽，但对于带宽超出的部分，ELB无法承诺服务可用性指标。 7层的ELB实例出带宽使用率。 注意： 若出带宽使用率达到100%，说明已经超出ELB规格所提供的性能保障，您的业务可以继续使用更高带宽，但对于带宽超出的部分，ELB无法承诺服务可用性指标。"},l7_qps_usage:{label:"7层查询速率使用率",unit:"%",tooltip:"7层的ELB实例查询速率使用率。"},l7_upstream_101:{label:"7层后端响应状态码101",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层101响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回101响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回101响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_400:{label:"7层后端响应状态码400",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层400响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回400响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回400响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_403:{label:"7层后端响应状态码403",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层403响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回403响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回403响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_404:{label:"7层后端响应状态码404",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层404响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回404响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回404响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_500:{label:"7层后端响应状态码500",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层500响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回500响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回500响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_501:{label:"7层后端响应状态码501",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层501响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回501响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回501状态响应码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_502:{label:"7层后端响应状态码502",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层502响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回502响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回502状态响应码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_503:{label:"7层后端响应状态码503",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层503响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回503响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回503响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_504:{label:"7层后端响应状态码504",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层504响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回504响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回504状态响应码的个数。 支持协议：HTTP/HTTPS/QUIC"},l7_upstream_other_status:{label:"7层后端响应状态码（Others）",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层后端其他响应状态码的个数。 不包含：101、2XX、3XX、400、403、404、500、501、502、503、504。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回7层后端其他响应状态码的个数。 不包含：101、2XX、3XX、400、403、404、500、501、502、503、504。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回7层后端其他响应状态码的个数。 不包含：101、2XX、3XX、400、403、404、500、501、502、503、504。 支持协议：HTTP/HTTPS/QUIC"},m10_l7_http_other_status:{label:"7层协议响应状态码(Others)",unit:"Count/s",tooltip:"测量对象每秒返回7层其他响应状态码的个数。 不包含：2XX、3XX、404、499、502。 支持协议：HTTP/HTTPS/QUIC 测量对象每秒返回7层其他响应状态码的个数。 不包含：2XX、3XX、404、499、502。 支持协议：HTTP/HTTPS/QUIC"},m11_l7_http_404:{label:"7层协议响应状态码404",unit:"Count/s",tooltip:"测量对象每秒返回7层404响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},m12_l7_http_499:{label:"7层协议响应状态码499",unit:"Count/s",tooltip:"测量对象每秒返回7层499响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},m13_l7_http_502:{label:"7层协议响应状态码502",unit:"Count/s",tooltip:"测量对象每秒返回7层502响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},m14_l7_rt:{label:"7层协议RT平均值",unit:"ms",tooltip:"测量对象7层平均响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象收到客户端请求开始，到测量对象将所有响应返回给客户端为止。  说明： websocket场景下RT平均值可能会非常大，此时该指标无法作为时延指标参考。 测量对象7层平均响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象收到客户端请求开始，到测量对象将所有响应返回给客户端为止。  说明： websocket场景下RT平均值可能会非常大，此时该指标无法作为时延指标参考。"},m15_l7_upstream_4xx:{label:"7层后端响应状态码(4XX)",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层4XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回7层4XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回7层4XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},m16_l7_upstream_5xx:{label:"7层后端响应状态码(5XX)",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层5XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回7层5XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回7层5XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},m17_l7_upstream_rt:{label:"7层后端的RT平均值",unit:"ms",tooltip:"测量对象7层后端平均响应时间。 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。 支持协议：HTTP/HTTPS/QUIC  说明： websocket场景下RT平均值可能会非常大，此时该指标无法作为时延指标参考。 测量对象7层后端平均响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。  说明： websocket场景下RT平均值可能会非常大，此时该指标无法作为时延指标参考。 测量对象7层后端平均响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。  说明： websocket场景下RT平均值可能会非常大，此时该指标无法作为时延指标参考。"},m18_l7_upstream_2xx:{label:"7层后端响应状态码(2XX)",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层2XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回2XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回2XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},m19_l7_upstream_3xx:{label:"7层后端响应状态码(3XX)",unit:"Count/s",tooltip:"测量对象的后端服务器每秒返回7层3XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回3XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC 测量对象的后端服务器每秒返回3XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},m1_cps:{label:"并发连接数",unit:"Count",tooltip:"在四层负载均衡器中，指从测量对象到后端服务器建立的所有TCP和UDP连接的个数。 在七层负载均衡器中，指从客户端到ELB建立的所有TCP连接的个数。 在四层负载均衡器中，指从测量对象到后端服务器建立的所有TCP和UDP连接的个数。 在七层负载均衡器中，指从客户端到ELB建立的所有TCP连接的个数。 在四层负载均衡器中，指从测量对象到后端服务器建立的所有TCP和UDP连接的数量。 在七层负载均衡器中，指从客户端到ELB建立的所有TCP连接的数量。"},m1a_l7_upstream_rt_max:{label:"7层后端的RT最大值",unit:"ms",tooltip:"测量对象7层后端最大响应时间。 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。 支持协议：HTTP/HTTPS/QUIC 测量对象7层后端最大响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。 测量对象7层后端最大响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。"},m1b_l7_upstream_rt_min:{label:"7层后端的RT最小值",unit:"ms",tooltip:"测量对象7层后端最小响应时间。 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。 支持协议：HTTP/HTTPS/QUIC 测量对象7层后端最小响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。 测量对象7层后端最小响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象将请求转发给后端服务器开始，到测量对象收到后端服务器返回响应为止。"},m1c_l7_rt_max:{label:"7层协议的RT最大值",unit:"ms",tooltip:"测量对象7层最大响应时间。 从测量对象收到客户端请求开始，到测量对象将所有响应返回给客户端为止。 支持协议：HTTP/HTTPS/QUIC 测量对象7层最大响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象收到客户端请求开始，到测量对象将所有响应返回给客户端为止。"},m1d_l7_rt_min:{label:"7层协议的RT最小值",unit:"ms",tooltip:"测量对象7层最小响应时间。 从测量对象收到客户端请求开始，到测量对象将所有响应返回给客户端为止。 支持协议：HTTP/HTTPS/QUIC 测量对象7层最小响应时间。 支持协议：HTTP/HTTPS/QUIC 从测量对象收到客户端请求开始，到测量对象将所有响应返回给客户端为止。"},m1e_server_rps:{label:"后端服务器每秒重置报文个数",unit:"Count/s",tooltip:"测量后端服务器每秒发送至客户端的重置（RST）报文个数。重置报文由后端服务器生成，然后由负载均衡器转发。 支持协议：TCP 测量后端服务器每秒发送至客户端的重置（RST）报文个数。重置报文由后端服务器生成，然后由负载均衡器转发。 支持的协议：TCP 测量后端服务器每秒发送至客户端的重置（RST）报文个数。重置报文由后端服务器生成，然后由负载均衡器转发。 支持协议：TCP"},m1f_lvs_rps:{label:"负载均衡器每秒重置报文个数",unit:"Count/s",tooltip:"测量负载均衡器每秒生成的重置（RST）报文个数。 支持协议：TCP 测量负载均衡器每秒生成的重置（RST）报文个数。 支持的协议：TCP 测量负载均衡器每秒生成的重置（RST）报文的个数。 支持协议：TCP"},m21_client_rps:{label:"客户端每秒重置报文个数",unit:"Count/s",tooltip:"测量客户端每秒发送至后端服务器的重置（RST）报文个数。重置报文由客户端生成，然后由负载均衡器转发。 支持协议：TCP 测量客户端每秒发送至后端服务器的重置（RST）报文个数。重置数据包由客户端生成，然后由负载均衡器转发。 支持的协议：TCP 测量客户端每秒发送至后端服务器的重置（RST）报文个数。重置报文由客户端生成，然后由负载均衡器转发。 支持协议：TCP"},m22_in_bandwidth:{label:"入网带宽",unit:"bit/s",tooltip:"测量对象入网带宽。 测量对象入网带宽。"},m23_out_bandwidth:{label:"出网带宽",unit:"bit/s",tooltip:"测量对象出网带宽。 测量对象出网带宽。"},m24_l7_req_Bps:{label:"7层请求带宽",unit:"bit/s",tooltip:"测量对象后端服务器的七层请求接收带宽。  说明： 当监听器开启HTTP/2时，该指标无法作为参考。"},m25_l7_resp_Bps:{label:"7层响应带宽",unit:"bit/s",tooltip:"测量对象后端服务器的七层响应发送带宽。  说明： 当监听器开启HTTP/2时，该指标无法作为参考。"},m26_in_bandwidth_ipv6:{label:"IPv6入网带宽",unit:"bit/s",tooltip:"流入测量对象的IPv6网络带宽。 流入测量对象的IPv6网络带宽。"},m27_out_bandwidth_ipv6:{label:"IPv6出网带宽",unit:"bit/s",tooltip:"流出测量对象的IPv6网络带宽。 流出测量对象的IPv6网络带宽。"},m2_act_conn:{label:"活跃连接数",unit:"Count",tooltip:"从测量对象到后端服务器建立的活跃TCP和UDP连接的个数。 Windows和Linux服务器都可以使用如下命令查看。 netstat -an 从测量对象到后端服务器建立的活跃TCP和UDP连接的数量。 Windows和Linux服务器都可以使用如下命令查看。 netstat -an 从测量对象到后端服务器建立的活跃TCP和UDP连接的个数。 Windows和Linux服务器都可以使用如下命令查看。 netstat -an"},m3_inact_conn:{label:"非活跃连接数",unit:"Count",tooltip:"从测量对象到后端服务器建立的非活跃TCP和UDP连接的个数。 Windows和Linux服务器都可以使用如下命令查看。 netstat -an 从测量对象到后端服务器建立的所有非活跃TCP和UDP连接的数量。 Windows和Linux服务器都可以使用如下命令查看。 netstat -an 从测量对象到后端服务器建立的非活跃TCP和UDP连接的个数。 Windows和Linux服务器都可以使用如下命令查看。 netstat -an"},m4_ncps:{label:"新建连接数",unit:"Count/s",tooltip:"从客户端到测量对象每秒新建立的连接数。 从客户端到测量对象每秒新建立的连接数。 从客户端到测量对象每秒新建立的连接数。"},m5_in_pps:{label:"流入数据包数",unit:"Count/s",tooltip:"测量对象每秒接收到数据包的个数。 测量对象每秒接收到数据包的个数。 测量对象每秒接收到数据包的个数。"},m6_out_pps:{label:"流出数据包数",unit:"Count/s",tooltip:"测量对象每秒发出数据包的个数。 测量对象每秒发出数据包的个数。 测量对象每秒发出数据包的个数。"},m7_in_Bps:{label:"网络流入速率",unit:"Byte/s",tooltip:"从外部访问测量对象的网络速率。 从外部访问测量对象的网络速率。 从外部访问测量对象的网络速率。"},m8_out_Bps:{label:"网络流出速率",unit:"Byte/s",tooltip:"测量对象访问外部的网络速率。 测量对象访问外部的网络速率。 测量对象访问外部的网络速率。"},m9_abnormal_servers:{label:"异常主机数",unit:"Count",tooltip:"测量对象中健康检查异常的后端服务器个数。 测量对象中健康检查异常的后端服务器个数。 测量对象中健康检查异常的后端服务器个数。"},ma_normal_servers:{label:"正常主机数",unit:"Count",tooltip:"测量对象中健康检查正常的后端服务器个数。 测量对象中健康检查正常的后端服务器个数。 测量对象中健康检查正常的后端服务器个数。"},mb_l7_qps:{label:"7层查询速率",unit:"Count/s",tooltip:"测量对象7层查询速率。 支持协议：HTTP/HTTPS/QUIC 测量对象7层查询速率。 支持协议：HTTP/HTTPS/QUIC 测量对象7层查询速率。 支持协议：HTTP/HTTPS/QUIC"},mc_l7_http_2xx:{label:"7层协议响应状态码（2XX）",unit:"Count/s",tooltip:"测量对象每秒返回7层2XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},md_l7_http_3xx:{label:"7层协议响应状态码（3XX）",unit:"Count/s",tooltip:"测量对象每秒返回7层3XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},me_l7_http_4xx:{label:"7层协议响应状态码（4XX）",unit:"Count/s",tooltip:"测量对象每秒返回7层4XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},mf_l7_http_5xx:{label:"7层协议响应状态码（5XX）",unit:"Count/s",tooltip:"测量对象每秒返回7层5XX系列响应状态码的个数。 支持协议：HTTP/HTTPS/QUIC"},mirror_in_packets:{label:"入方向流量镜像的报文速率",unit:"Count/s",tooltip:"测量对象入方向流量镜像的报文速率。 测量对象入方向流量镜像的报文速率。"},mirror_in_traffic:{label:"入方向流量镜像的带宽",unit:"bit/s",tooltip:"测量对象入方向流量镜像的带宽。 测量对象入方向流量镜像的带宽。"},mirror_out_packets:{label:"出方向流量镜像的报文速率",unit:"Count/s",tooltip:"测量对象出方向流量镜像的报文速率。 测量对象出方向流量镜像的报文速率。"},mirror_out_traffic:{label:"出方向流量镜像的带宽",unit:"bit/s",tooltip:"测量对象出方向流量镜像的带宽。 测量对象出方向流量镜像的带宽。"}},gt={class:"chart-box"},yt="rds-metric-group",Ht=C({__name:"metricChart",props:{sid:{type:[String,Number],default:""},metricName:{type:String,default:""},param:{type:Object,default:()=>({})}},setup(t){const e=t,a=s(null);let l=null;const i=w({chartData:[],isVisible:!1,analysis:{max:0,min:0,avg:0,sum:0}}),o=async()=>{const t=new IntersectionObserver((async o=>{o.forEach((async o=>{o.isIntersecting&&(i.isVisible=!0,await(async()=>{const{metrics:t}=await G.getMetricValue(e.param);i.chartData=t[0];const a=i.chartData.values.map((t=>t.value));a.length&&(i.analysis.max=Math.max(...a).toFixed(2),i.analysis.min=Math.min(...a).toFixed(2),i.analysis.sum=a.reduce(((t,e)=>t+e),0).toFixed(2),i.analysis.avg=(a.length?i.analysis.sum/a.length:0).toFixed(2))})(),(()=>{var t,o,n;if(!a.value)return;l||(l=N(a.value),l.group=yt);const r=(null==(t=ht[e.metricName])?void 0:t.unit)||i.chartData.unit||"",s=(null==(o=ht[e.metricName])?void 0:o.label)||e.metricName,u=i.analysis,d=[{value:u.max,label:"最大值"},{value:u.min,label:"最小值"},{value:u.avg,label:"平均值"}],p=document.createElement("canvas").getContext("2d");p.font='bolder 14px "PingFang SC", "Microsoft YaHei", Arial';const c=d.map((t=>p.measureText(`${t.value} ${r}`).width)),m=d.map((t=>p.measureText(t.label).width)),_=c.map(((t,e)=>Math.max(t,m[e])));let T=0;const v=d.map(((t,e)=>{const a={type:"group",left:T,top:35,children:[{type:"text",style:{text:`${t.value} ${r}`,font:'bolder 15px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222"},tooltip:{show:!0,formatter:()=>['<div style="text-align: center">',`<div style="font-weight: bold; font-size: 15px; color: #222; margin-bottom: 4px">${t.value} ${r}</div>`,`<div style="font-size: 12px; color: #888">${t.label}</div>`,"</div>"].join(""),backgroundColor:"#fff",borderColor:"#e8e8e8",borderWidth:1,textStyle:{color:"#222",fontSize:12,fontFamily:'"PingFang SC", "Microsoft YaHei", Arial'},padding:[8,12],extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);"}},{type:"text",top:22,style:{text:t.label,font:'12px "PingFang SC", "Microsoft YaHei", Arial',fill:"#888"}}]};return T+=_[e]+20,a})),b=document.createElement("canvas").getContext("2d");b.font='600 16px "PingFang SC", "Microsoft YaHei", Arial';const f={title:{show:!1},tooltip:{trigger:"axis"},legend:{data:[s],bottom:0,icon:"path://M904 476H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"},grid:{left:40,right:20,top:120,bottom:55},graphic:[{type:"text",left:0,top:0,style:{text:s,font:'600 16px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222"}},{type:"group",left:b.measureText(s).width+8,top:0,children:[{type:"circle",shape:{cx:8,cy:8,r:7},style:{stroke:"#222",fill:"#fff",lineWidth:1}},{type:"text",left:5,top:3,style:{text:"?",x:8,y:9,font:'11px "PingFang SC", "Microsoft YaHei", Arial',fill:"#222",textAlign:"center",textVerticalAlign:"middle"},tooltip:{show:!0,formatter:null==(n=ht[e.metricName])?void 0:n.tooltip,backgroundColor:"#fff",borderColor:"#e8e8e8",borderWidth:1,textStyle:{color:"#222",fontSize:12,fontFamily:'"PingFang SC", "Microsoft YaHei", Arial'},extraCssText:"box-shadow: 0 2px 8px rgba(0,0,0,0.15);",position:function(t,e,a,l,i){let o=t[0]+16,n=t[1]-i.contentSize[1]/2;return o+i.contentSize[0]>i.viewSize[0]&&(o=i.viewSize[0]-i.contentSize[0]-10),n<0&&(n=10),n+i.contentSize[1]>i.viewSize[1]&&(n=i.viewSize[1]-i.contentSize[1]-10),[o,n]}}}],cursor:"pointer"},...v],xAxis:{type:"category",data:i.chartData.values.map((t=>{const e=k(t.date),a=k(i.chartData.values[0].date);return k(i.chartData.values[i.chartData.values.length-1].date).diff(a,"day")>0?e.format("YYYY/MM/DD\nHH:mm"):e.format("HH:mm")})),boundaryGap:!1},yAxis:{type:"value",name:r,nameLocation:"end",nameTextStyle:{fontSize:12,fontWeight:400,color:"black",padding:[0,5,0,0]},axisLabel:{formatter:"{value}",width:40,overflow:"break"}},series:[{name:s,type:"line",data:i.chartData.values.map((t=>t.value)),smooth:!0,symbol:"none",lineStyle:{width:2,color:"#3b82f6"},itemStyle:{color:"#3b82f6"},markPoint:{symbol:"triangle",symbolSize:10,data:[{type:"max",name:"最大值",symbolRotate:0,itemStyle:{color:"#3b82f6"},symbolOffset:[0,-8]},{type:"min",name:"最小值",symbolRotate:180,itemStyle:{color:"#3b82f6"},symbolOffset:[0,8]}],label:{show:!1}}}]};l.setOption(f)})(),t.unobserve(o.target))}))}),{threshold:.1});a.value&&t.observe(a.value)};return I((()=>{o(),setTimeout((()=>{W(yt)}),300)})),Q((()=>{l&&(l.dispose(),l=null)})),(t,e)=>{const l=P;return d(),p(l,{spinning:!_(i).isVisible},{default:c((()=>[H("div",gt,[H("div",{ref_key:"chartRef",ref:a,class:"chart-content"},null,512)])])),_:1},8,["spinning"])}}},[["__scopeId","data-v-d72fe1fd"]]),xt={class:"search-box mb-4"},St=(t=>(j("data-v-60bcfe6a"),t=t(),R(),t))((()=>H("span",null,"监控粒度",-1))),wt={class:"search-box"},Xt={class:"ml-4"},Ut={class:"metric-chart-box"},It=C({__name:"index",props:{row:{type:Object,default:()=>{}}},setup(t){const e=t,a=w({metricList:[],chartList:[],dimensionsType:"lbaas_instance_id",dimensionsValue:"",searchParams:{metrics:[],date:[k().add(-1,"h"),k()],filter:["average","1"]},refresh:!1,autoRefresh:!1,timer:null}),l=X((()=>{let t=[{name:"lbaas_instance_id",value:e.row.cloud_instance_id}];return"lbaas_instance_id"!==a.dimensionsType&&t.push({name:a.dimensionsType,value:a.dimensionsValue}),t})),i=X((()=>"lbaas_listener_id"===a.dimensionsType?e.row.listeners.map((t=>({label:t.name,value:t.id}))):"lbaas_pool_id"===a.dimensionsType?e.row.server_groups.map((t=>({label:t.id,value:t.id}))):void 0));I((async()=>{o()}));const o=async()=>{a.refresh=!0;const{metrics:t}=await G.getMetric(e.row.id,l.value);a.metricList=t.map((t=>{var e;return{label:(null==(e=ht[t.metric_name])?void 0:e.label)||t.metric_name,value:t.metric_name}})),a.refresh=!1},n=async()=>{"lbaas_instance_id"!==a.dimensionsType&&(a.dimensionsValue=i.value[0].value),a.searchParams.metrics=[],a.searchParams.filter=["average","1"],a.searchParams.date=[k().add(-1,"h"),k()],await o()},r=()=>{const t=a.searchParams.date[1].diff(a.searchParams.date[0],"day");let e=[...ft],l=[...Pt];return t>10&&(e=e.filter((t=>"300"!==t.value)),l=l.filter((t=>"原始值"!==t.label))),t>20&&(e=e.filter((t=>"1200"!==t.value))),t>155&&(e=e.filter((t=>"3600"!==t.value))),e=e.filter((t=>t.value<=a.searchParams.date[1].diff(a.searchParams.date[0],"seconds"))),l.map((t=>({...t,children:"原始值"===t.label?null:e})))},s=()=>{a.refresh=!0,L((()=>{a.refresh=!1}))};return D((()=>[a.searchParams.metrics,a.searchParams.filter]),(()=>{s()}),{deep:!0}),D((()=>a.searchParams.date),(()=>{"原始值"===r()[0].label?a.searchParams.filter=["average","1"]:a.searchParams.filter=["average",r()[0].children[0].value],s()}),{deep:!0}),D((()=>a.autoRefresh),(t=>{t?a.timer=setInterval((()=>{s()}),3e4):clearInterval(a.timer)})),D((()=>e.row),(async()=>{var t;(null==(t=e.row)?void 0:t.id)&&await o()})),(t,f)=>{const P=J,C=V,x=q,S=u("RedoOutlined"),w=B,X=U,I=Z;return d(),T(v,null,[H("div",xt,[St,m(P,{value:_(a).dimensionsType,"onUpdate:value":f[0]||(f[0]=t=>_(a).dimensionsType=t),options:_(Ct),onChange:n},null,8,["value","options"]),"lbaas_instance_id"!==_(a).dimensionsType?(d(),p(P,{key:0,value:_(a).dimensionsValue,"onUpdate:value":f[1]||(f[1]=t=>_(a).dimensionsValue=t),options:_(i),onChange:o},null,8,["value","options"])):h("",!0)]),H("div",wt,[m(P,{value:_(a).searchParams.metrics,"onUpdate:value":f[2]||(f[2]=t=>_(a).searchParams.metrics=t),placeholder:"指标名称",options:_(a).metricList,"dropdown-match-select-width":!1,mode:"multiple"},null,8,["value","options"]),m(C,{value:_(a).searchParams.date,"onUpdate:value":f[3]||(f[3]=t=>_(a).searchParams.date=t),"show-time":"","allow-clear":!1,presets:_(bt),format:"YYYY/MM/DD HH:mm:ss"},null,8,["value","presets"]),m(x,{value:_(a).searchParams.filter,"onUpdate:value":f[4]||(f[4]=t=>_(a).searchParams.filter=t),options:r(),"allow-clear":!1},{displayRender:c((({labels:t})=>[g(y("1"===t[1]?"原始值":`${t[0]} / ${t[1]}`),1)])),_:1},8,["value","options"]),m(X,{title:"刷新"},{default:c((()=>[m(w,{onClick:s},{default:c((()=>[m(S)])),_:1})])),_:1}),H("div",Xt,[g(" 自动刷新： "),m(X,{title:"每30秒自动刷新"},{default:c((()=>[m(I,{checked:_(a).autoRefresh,"onUpdate:checked":f[5]||(f[5]=t=>_(a).autoRefresh=t)},null,8,["checked"])])),_:1})])]),H("div",Ut,[(d(!0),T(v,null,b(_(a).metricList,(t=>{return d(),T(v,{key:t.value},[_(a).refresh||!_(a).searchParams.metrics.includes(t.value)&&_(a).searchParams.metrics.length?h("",!0):(d(),p(Ht,{key:0,sid:e.row.id,"metric-name":t.value,param:(i=t,{metrics:[{metric_name:i.value,dimensions:l.value}],start_time:a.searchParams.date[0],end_time:a.searchParams.date[1],filter:a.searchParams.filter[0],period:a.searchParams.filter[1]})},null,8,["sid","metric-name","param"]))],64);var i})),128))])],64)}}},[["__scopeId","data-v-60bcfe6a"]]),Dt=["onClick"],kt={style:{display:"flex","align-items":"center"}},Qt=["onClick"],Lt={class:"truncate"},Bt={class:"truncate"},jt={class:"truncate text-primary"},Rt={class:"truncate"},Et={class:"text-primary"},Ot={class:"custom-tabs"},At=C({__name:"index",setup(l){const n=s(null),r=w({initColumn:[],initButton:[],initTitleData:[],tableOrder:{},titleFieldSearch:[],subPageColumns:[],subPageTabList:[{key:"listeners",title:"监听器",isCustomTab:!0},{key:"monitor",title:"监控",isCustomTab:!0}]}),{userEdit:u,userDel:f,formOpen:P,formType:C,formSid:x}=M(),S=X((()=>{for(let t of r.initColumn){let{field:e}=t;switch(e){case"id":case"edition":case"spec_code":case"charge_mode":case"charge_type":case"enterprise_project_id":case"modification_protection_status":case"deletion_protection_status":t.slots={default:e};break;case"addresses":case"listeners":t.slots={default:e},t.minWidth=200,t.showOverflow=!1}}return r.initColumn})),D=X((()=>r.initButton.reduce(((t,e)=>(t[e.field]=e,t)),{})));I((async()=>{const{button:t,columns:e,title_data:a,order:l,title_field_search:i,sub_page_columns:o}=await A.setColumn({layer:1});r.initColumn=e.value||[],r.initButton=t.value||[],r.initTitleData=a.value||[],r.tableOrder=l.value||{},r.titleFieldSearch=i.value||[],r.subPageColumns=o||[],await k()}));const k=async()=>{n.value&&await n.value.serverTableRef.commitProxy("query")},Q=({type:t,row:e})=>{u({type:t,sid:e.id})},L=({row:t})=>{f({sid:t.id,delApi:G.del,loadData:k})},{subPageOpen:B,subPageRow:j,handleSubPageOpen:R}=t();return(t,l)=>{var s,f;const w=O,X=U,I=o,A=i,F=a,Y=e;return d(),T(v,null,[m(F,{ref_key:"tableRef",ref:n,"table-column":_(S),"auth-btn":_(D),order:_(r).tableOrder,"query-api":_(G).postList,"title-field-search":_(r).titleFieldSearch,onUserEdit:Q,onUserAdd:l[0]||(l[0]=e=>_(u)({type:t.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:L},{id:c((({row:t})=>[H("div",{class:"text-primary cursor-pointer",onClick:e=>_(R)(t)},y(t.id),9,Dt)])),cloud_master_account_id:c((({row:t})=>{var e,a,l;return[H("div",kt,[m(w,{type:t.cloud_source},null,8,["type"])]),g(" "+y((null==(l=null==(a=null==(e=_(r).initTitleData)?void 0:e.cloud_master_account_id)?void 0:a[t.cloud_master_account_id])?void 0:l.page_display)||""),1)]})),region_id:c((({row:t})=>{var e,a,l;return[(d(!0),T(v,null,b(null==t?void 0:t.zone_id,((t,e)=>(d(),T("div",{key:e},y(t),1)))),128)),H("div",null,y((null==(e=_(r).initTitleData)?void 0:e.region_id)&&(null==(l=null==(a=_(r).initTitleData)?void 0:a.region_id)?void 0:l[null==t?void 0:t.region_id])||(null==t?void 0:t.region_id)),1)]})),cloud_instance_id:c((({row:t})=>[m(X,{title:t.name},{default:c((()=>[H("div",{class:"truncate text-primary cursor-pointer",onClick:e=>_(R)(t)},y(t.name),9,Qt)])),_:2},1032,["title"]),m(X,{title:t.cloud_instance_id},{default:c((()=>[H("div",Lt,y(t.cloud_instance_id),1)])),_:2},1032,["title"])])),charge_type:c((({row:t})=>[m(I,{"charge-type":t.charge_type,"expired-time":t.expire_time},null,8,["charge-type","expired-time"])])),addresses:c((({row:t})=>[(d(!0),T(v,null,b(t.addresses,(t=>(d(),p(X,{key:t.id,title:t.address},{default:c((()=>[H("div",Bt,y(t.address)+" ("+y(t.type)+" "+y(t.scope)+")",1)])),_:2},1032,["title"])))),128)),H("div",jt,[m(A,{"obj-type":"hw_vpc",uuid:t.vpc_id},null,8,["uuid"])])])),listeners:c((({row:t})=>[(d(!0),T(v,null,b(t.listeners,(t=>(d(),p(X,{key:t.id,title:t.name},{default:c((()=>[H("div",Rt,[H("span",Et,y(t.name),1),H("span",null," ("+y(t.protocol)+"/"+y(t.protocol_port)+")",1)])])),_:2},1032,["title"])))),128))])),enterprise_project_id:c((({row:t})=>{var e,a;return[g(y((null==(a=null==(e=_(r).initTitleData)?void 0:e.enterprise_project_id)?void 0:a[t.enterprise_project_id])||""),1)]})),edition:c((({row:t})=>{var e,a;return[g(y((null==(a=null==(e=_(r).initTitleData)?void 0:e.edition)?void 0:a[t.edition])||t.edition),1)]})),charge_mode:c((({row:t})=>{var e,a;return[g(y((null==(a=null==(e=_(r).initTitleData)?void 0:e.charge_mode)?void 0:a[t.charge_mode])||t.charge_mode),1)]})),modification_protection_status:c((({row:t})=>{var e,a;return[g(y((null==(a=null==(e=_(r).initTitleData)?void 0:e.modification_protection_status)?void 0:a[t.modification_protection_status])||t.modification_protection_status),1)]})),deletion_protection_status:c((({row:t})=>{var e,a;return[g(y((null==(a=null==(e=_(r).initTitleData)?void 0:e.deletion_protection_status)?void 0:a[t.deletion_protection_status])||t.deletion_protection_status),1)]})),spec_code:c((({row:t})=>[m(X,{"overlay-style":{maxWidth:"none"}},{title:c((()=>[H("div",null,"最大并发连接数："+y(t.spec_info.info.connection)+"TCP/"+y(t.spec_info.info.connection)+"UDP",1),H("div",null,"新建连接数（CPS）："+y(t.spec_info.info.cps)+"TCP/"+y(t.spec_info.info.cps)+"UDP",1),H("div",null,"带宽（Mbits/s）："+y(t.spec_info.info.bandwidth),1),H("div",null,"LCUs："+y(t.spec_info.info.lcu),1)])),default:c((()=>{var e,a;return[g(" "+y((null==(a=null==(e=_(r).initTitleData)?void 0:e.spec_code)?void 0:a[t.spec_code])||t.spec_code),1)]})),_:2},1024)])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search"]),m(K,{open:_(P),"onUpdate:open":l[1]||(l[1]=t=>E(P)?P.value=t:null),sid:_(x),"form-type":_(C),onEditSuccess:k},null,8,["open","sid","form-type"]),m(Y,{open:_(B),"onUpdate:open":l[2]||(l[2]=t=>E(B)?B.value=t:null),width:"100%",title:null==(s=_(j))?void 0:s.name,"basic-config":{api:_(G).getDetail,sid:null==(f=_(j))?void 0:f.id,isCustomTab:!0},"custom-tabs":_(r).subPageTabList},{basic:c((({data:t})=>[m(et,{data:t,columns:_(r).subPageColumns,"title-data":_(r).initTitleData},null,8,["data","columns","title-data"])])),listeners:c((({data:t})=>[H("div",Ot,[m(vt,{sid:t.id,"row-data":t},null,8,["sid","row-data"])])])),monitor:c((({data:t})=>[_(D).monitor_permission?(d(),p(It,{key:0,row:t},null,8,["row"])):h("",!0)])),_:1},8,["open","title","basic-config","custom-tabs"])],64)}}},[["__scopeId","data-v-c143bf13"]]);export{At as default};
