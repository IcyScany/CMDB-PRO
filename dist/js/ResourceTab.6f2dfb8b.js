import{aR as e,a3 as t,al as l,i as a,r as s,J as i,z as o,a0 as n,x as r,Q as c,R as u,X as d,F as v,S as p,Y as m,$ as h,am as g,a6 as y,ah as b,c as f,C as _,D as x,I as k,a9 as S,aa as w,q as C,O as B,W as z,ad as D,U as $,Z as q,v as I,p as E,ef as j,ai as L,a_ as O,a$ as R}from"./index.872a2bd0.js";import{g as M,i as W}from"./index.165d9fa7.js";import{_ as A}from"./index.e3d002e2.js";import{R as T}from"./ResourceChart.c8c8e96e.js";import{_ as G}from"./RadioButton.534ff50d.js";import{_ as U}from"./Group.b415afa6.js";import{S as P,_ as F}from"./index.44a4e190.js";import"./Checkbox.ddee6d58.js";const Q={postMessage:t=>e.post("dashboards/resource/display",t,{showLoading:!0})},H=e=>(S("data-v-90233539"),e=e(),w(),e),K={class:"resource-display"},J=H((()=>d("h3",{class:"page-title"},"服务器",-1))),N={class:"charts-container"},X=H((()=>d("h3",{class:"multi-chart-title ml-2"},"资源分布",-1))),Y={class:"multi-chart-row resource-part-box"},Z=["id"],V={class:"chart-title"},ee={class:"charts-container"},te=H((()=>d("h3",{class:"multi-chart-title ml-2"},"计费方式",-1))),le={class:"multi-chart-row"},ae=["id"],se={class:"chart-title"},ie={class:"charts-container"},oe=H((()=>d("h3",{class:"multi-chart-title ml-2"},"资源汇总",-1))),ne={class:"multi-chart-row"},re={class:"resource-cards"},ce={class:"card-content"},ue={class:"card-title"},de={class:"card-value"},ve={class:"card-unit"},pe={class:"chart-title"},me={class:"database-section"},he=H((()=>d("h3",{class:"page-title"},"数据库",-1))),ge={class:"db-charts-container"},ye=H((()=>d("h3",{class:"multi-chart-title ml-2"},"实例数",-1))),be={class:"multi-chart-row"},fe=["id"],_e={class:"chart-title"},xe={class:"charts-container"},ke=H((()=>d("h3",{class:"multi-chart-title ml-2"},"容量统计",-1))),Se={class:"multi-chart-row"},we={class:"capacity-items"},Ce={class:"capacity-item"},Be=H((()=>d("span",{class:"capacity-label"},"MySQL",-1))),ze={class:"capacity-value"},De={class:"capacity-item"},$e=H((()=>d("span",{class:"capacity-label"},"Redis",-1))),qe={class:"capacity-value"},Ie={class:"capacity-item"},Ee=H((()=>d("span",{class:"capacity-label"},"MongoDB",-1))),je={class:"capacity-value"},Le={class:"chart-title"},Oe={class:"resource-remind mt-4"},Re=H((()=>d("h3",{class:"page-title"},"资源即将到期提醒",-1))),Me={class:"multi-chart-row"},We=["id"],Ae={class:"chart-title"},Te=t({__name:"ResourceDetail",props:{resourceData:{type:Array,required:!0}},setup(e){let t=e,{resourceData:S}=l(t),w={regionChartInstance:null,chargeTypeChartInstance:null,dbInstanceChartInstance:null,expiringChartInstance:null};const C=a("cloudRegionList");let B=a("selectedBusinesses");const z=s("chart"),D=(e,{title:t="",center:l=["52%","80%"],legendConfig:a={},labelConfig:s={},totalConfig:i={left:"center",top:"40%",textStyle:{fontSize:14,fontWeight:"bold"}}}={})=>{const o=e.reduce(((e,t)=>e+t.value),0);return{tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"horizontal",left:0,bottom:0,itemWidth:10,itemHeight:10,textStyle:{fontSize:12,color:"#666"},...a},title:{text:t,left:"center",bottom:0,textStyle:{fontSize:16,fontWeight:"bold",color:"#333"}},series:[{name:t,type:"pie",radius:["40%","70%"],center:l,avoidLabelOverlap:!0,top:0,right:20,bottom:100,left:0,itemStyle:{borderRadius:4,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:"{b}: {c}\n{d}%",...s},labelLine:{show:!0,length:15,length2:10,smooth:!0,lineStyle:{width:1,type:"solid"}},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},data:e}],graphic:{elements:[{type:"group",left:i.left,top:i.top,children:[{type:"text",style:{text:"总计",textAlign:"center",fill:"#333",fontSize:14,fontWeight:"normal"},left:"center",top:-10},{type:"text",style:{text:o.toString(),textAlign:"center",fill:"#333",fontSize:20,fontWeight:"bold"},left:"center",top:10}]}]}}},$=(e,t=1024)=>e>=t?{value:(e/t).toFixed(2),unit:"TB"}:{value:e,unit:"GB"};let q=s([]);const I=e=>e&&!e.isDisposed(),E=e=>{const t=document.querySelector(".main-content");t&&t.style.setProperty("background-color",e)};i((async()=>{z.value="chart",E("rgb(246 247 250)"),q.value=[],await(async()=>{try{k((()=>{L(),O(),R(),T()}))}catch(e){}})(),window.addEventListener("resize",j)})),o((()=>{window.removeEventListener("resize",j),E("white")}));const j=n.debounce((()=>{try{I(w.regionChartInstance)&&w.regionChartInstance.resize(),I(w.chargeTypeChartInstance)&&w.chargeTypeChartInstance.resize(),I(w.dbInstanceChartInstance)&&w.dbInstanceChartInstance.resize(),I(w.expiringChartInstance)&&w.expiringChartInstance.resize()}catch(e){}}),300),L=()=>{S.value.forEach(((e,t)=>{var l;const a=`regionChart_${t}`;let s=M(document.getElementById(a));s||(s=W(document.getElementById(a)));const i=(e=>{if(!e)return{data:[],totalCount:0};let t=0;const l=[];return Object.entries(e).forEach((([e,a])=>{Object.entries(a).forEach((([a,s])=>{t+=s;const i=C.value[e]||e+"-";l.push({name:`${i}${a.slice(a.indexOf(e)-1).toUpperCase()}区`,value:s,itemStyle:{opacity:.7}})}))})),{data:l,totalCount:t}})(null==(l=e.server)?void 0:l.region),o=D(i.data,{title:""});s&&s.setOption(o,!0)}))},O=()=>{S.value.forEach(((e,t)=>{var l;const a=`chargeTypeChart_${t}`;let s=M(document.getElementById(a));s||(s=W(document.getElementById(a)));const i=(null==(l=e.server)?void 0:l.charge_type)||{},o=Object.entries(i).map((([e,t])=>({name:e,value:t}))),n=D(o,{title:""});s&&s.setOption(n,!0)}))},R=()=>{S.value.forEach(((e,t)=>{const l=`dbInstanceChart_${t}`;let a=M(document.getElementById(l));a||(a=W(document.getElementById(l)));const s={title:{text:"",left:"center",bottom:0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"15%",top:"3%",containLabel:!0},xAxis:{type:"category",data:["MySQL","Redis","MongoDB"],axisLabel:{interval:0}},yAxis:{type:"value",name:"实例数量",position:"left"},series:[{name:"实例数量",type:"bar",data:[e.mysql["cn-east-3"]||0,e.redis["cn-east-3"]||0,e.mongoDB["cn-east-3"]||0],itemStyle:{color:e=>["#1890ff","#52c41a","#722ed1"][e.dataIndex]},barWidth:"20%",label:{show:!0,position:"insideTop",formatter:e=>e.value,distance:0}}]};a.setOption(s,!0)}))},T=()=>{S.value.forEach(((e,t)=>{var l,a,s,i;const o=`expiringChart_${t}`;let n=M(document.getElementById(o));n||(n=W(document.getElementById(o)));const r={title:{text:"",left:"center",top:0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:["服务器","MySQL","Redis","MongoDB"],axisLabel:{interval:0}},yAxis:{type:"value",name:"数量"},series:[{name:"即将到期数量",type:"bar",data:[(null==(l=e.server)?void 0:l.expiring_soon_number)||0,(null==(a=e.mysql)?void 0:a.expiring_soon_number)||0,(null==(s=e.redis)?void 0:s.expiring_soon_number)||0,(null==(i=e.mongoDB)?void 0:i.expiring_soon_number)||0],itemStyle:{color:e=>["#ff4d4f","#ff7a45","#ffa940","#ffec3d"][e.dataIndex]},barWidth:"40%",label:{show:!0,position:"top"}}]};n.setOption(r,!0)}))},G=()=>{k((()=>{L(),O(),R(),T()}))};return i((()=>{G()})),r((()=>B.value),(()=>{G()})),(e,t)=>{const l=A;return c(),u(v,null,[d("div",K,[J,d("div",N,[X,d("div",Y,[(c(!0),u(v,null,p(h(S),((e,t)=>(c(),u("div",{key:e.business,class:"multi-chart-item"},[d("div",{id:`regionChart_${t}`,class:"chart"},null,8,Z),d("div",V,m(e.business),1)])))),128))])]),d("div",ee,[te,d("div",le,[(c(!0),u(v,null,p(h(S),((e,t)=>(c(),u("div",{key:e.business,class:"multi-chart-item"},[d("div",{id:`chargeTypeChart_${t}`,class:"chart"},null,8,ae),d("div",se,m(e.business),1)])))),128))])]),d("div",ie,[oe,d("div",ne,[(c(!0),u(v,null,p(h(S),(e=>{var t,l,a,s,i,o;return c(),u("div",{key:e.business,class:"multi-chart-item"},[d("div",re,[(c(!0),u(v,null,p([{title:"CPU",value:null==(l=null==(t=e.server)?void 0:t.physical_resources)?void 0:l.total_cpu,unit:"核",icon:"cpu",color:"#1890ff"},{title:"内存",icon:"memory",color:"#52c41a",...$(null==(s=null==(a=e.server)?void 0:a.physical_resources)?void 0:s.total_ram)},{title:"硬盘",icon:"disk",color:"#722ed1",...$(null==(o=null==(i=e.server)?void 0:i.physical_resources)?void 0:o.total_disk)}],(e=>(c(),u("div",{key:e.title,class:"resource-card",style:g({borderColor:e.color})},[d("div",{class:"card-icon",style:g({backgroundColor:e.color})},[d("i",{class:y("icon-"+e.icon)},null,2)],4),d("div",ce,[d("div",ue,m(e.title),1),d("div",de,[b(m(e.value),1),d("span",ve,m(e.unit),1)])])],4)))),128))]),d("div",pe,m(e.business),1)])})),128))])])]),d("div",me,[he,d("div",ge,[ye,d("div",be,[(c(!0),u(v,null,p(h(S),((e,t)=>(c(),u("div",{key:e.business,class:"multi-chart-item"},[d("div",{id:`dbInstanceChart_${t}`,class:"chart"},null,8,fe),d("div",_e,m(e.business),1)])))),128))])]),d("div",xe,[ke,d("div",Se,[(c(!0),u(v,null,p(h(S),(e=>{var t,a,s,i,o,n;return c(),u("div",{key:e.business,class:"multi-chart-item"},[d("div",we,[d("div",Ce,[Be,f(l,{percent:(null==(t=e.mysql)?void 0:t.total_disk)?Math.round(e.mysql.total_disk/100*100):0,"stroke-color":"#1890ff","show-info":!1,size:"small",class:"capacity-progress"},null,8,["percent"]),d("span",ze,m((null==(a=e.mysql)?void 0:a.total_disk)||0)+"GB",1)]),d("div",De,[$e,f(l,{percent:(null==(s=e.redis)?void 0:s.total_mem)?Math.round(e.redis.total_mem/1024/100*100):0,"stroke-color":"#52c41a","show-info":!1,size:"small",class:"capacity-progress"},null,8,["percent"]),d("span",qe,m(((null==(i=e.redis)?void 0:i.total_mem)||0)/1024)+"GB",1)]),d("div",Ie,[Ee,f(l,{percent:(null==(o=e.mongoDB)?void 0:o.total_disk)?Math.round(e.mongoDB.total_disk/100*100):0,"stroke-color":"#722ed1","show-info":!1,size:"small",class:"capacity-progress"},null,8,["percent"]),d("span",je,m((null==(n=e.mongoDB)?void 0:n.total_disk)||0)+"GB",1)])]),d("div",Le,m(e.business),1)])})),128))])])]),_(d("div",Oe,[Re,d("div",Me,[(c(!0),u(v,null,p(h(S),((e,t)=>(c(),u("div",{key:e.business,class:"multi-chart-item"},[d("div",{id:`expiringChart_${t}`,class:"chart"},null,8,We),d("div",Ae,m(e.business),1)])))),128))])],512),[[x,h(S).length<2]])],64)}}},[["__scopeId","data-v-90233539"]]),Ge={class:"card-content"},Ue={class:"card-title"},Pe={class:"card-value"},Fe={class:"card-unit"},Qe=t({__name:"ResourceCard",props:{title:{type:String,required:!0},value:{type:[Number,String],required:!0},unit:{type:String,required:!0},icon:{type:String,required:!0},color:{type:String,required:!0}},setup:e=>(t,l)=>(c(),u("div",{class:"resource-card",style:g({borderColor:e.color})},[d("div",{class:"card-icon",style:g({backgroundColor:e.color})},[d("i",{class:y("icon-"+e.icon)},null,2)],4),d("div",Ge,[d("div",Ue,m(e.title),1),d("div",Pe,[b(m(e.value),1),d("span",Fe,m(e.unit),1)])])],4))},[["__scopeId","data-v-be38bd32"]]),He=(e,t)=>{if(!e)return[];const l=[];return Object.entries(e).forEach((([e,a])=>{Object.entries(a).forEach((([a,s])=>{const i=t[e]||e;l.push({region:i,zone:a.slice(a.indexOf(e)-1).toUpperCase(),count:s})}))})),l.sort(((e,t)=>t.count-e.count))},Ke=e=>{if(!e)return 0;let t=0;return Object.values(e).forEach((e=>{Object.values(e).forEach((e=>{t+=e}))})),t},Je=(e,t)=>t?Math.round(e/t*100):0,Ne=e=>(S("data-v-c49236f5"),e=e(),w(),e),Xe={class:"resource-display"},Ye=Ne((()=>d("h3",{class:"page-title"}," 服务器 ",-1))),Ze={class:"charts-container"},Ve={class:"chart-box"},et={class:"chart-header"},tt={class:"display-mode-switch"},lt=Ne((()=>d("i",{class:"icon-chart"},null,-1))),at=Ne((()=>d("i",{class:"icon-table"},null,-1))),st={class:"chart-wrapper"},it={key:1,class:"region-table mt-10"},ot={class:"chart-box"},nt={class:"chart-header"},rt={class:"display-mode-switch"},ct=Ne((()=>d("i",{class:"icon-chart"},null,-1))),ut=Ne((()=>d("i",{class:"icon-table"},null,-1))),dt={class:"chart-wrapper"},vt={key:1,class:"charge-type-table mt-10"},pt={class:"chart-box resource-summary"},mt={class:"resource-cards"},ht={class:"database-section"},gt=Ne((()=>d("h3",{class:"page-title"}," 数据库 ",-1))),yt={class:"db-charts-container"},bt={class:"chart-box"},ft={class:"chart-wrapper"},_t={class:"chart-box capacity-box"},xt={class:"capacity-wrapper"},kt={class:"capacity-items"},St={class:"capacity-item"},wt={class:"capacity-content"},Ct=Ne((()=>d("span",{class:"capacity-label"},"MySQL",-1))),Bt={class:"stacked-progress"},zt=["title"],Dt={class:"capacity-value"},$t={class:"capacity-item"},qt={class:"capacity-content"},It=Ne((()=>d("span",{class:"capacity-label"},"Redis",-1))),Et={class:"stacked-progress"},jt=["title"],Lt={class:"capacity-value"},Ot={class:"capacity-item"},Rt={class:"capacity-content"},Mt=Ne((()=>d("span",{class:"capacity-label"},"MongoDB",-1))),Wt={class:"stacked-progress"},At=["title"],Tt={class:"capacity-value"},Gt=Ne((()=>d("h4",{class:"capacity-title"},"总容量统计",-1))),Ut={class:"resource-remind mt-4"},Pt=Ne((()=>d("h3",{class:"page-title"},"资源即将到期提醒",-1))),Ft={class:"chart-box"},Qt={class:"chart-wrapper"},Ht=t({__name:"ResourceSummary",props:{resourceData:{type:Object,required:!0},type:{type:String,default:""}},setup(e){let t=e,{resourceData:n}=l(t);const r=a("selectedBusinesses"),y=a("cloudRegionList"),k=a("pageResourceData"),S=s("chart"),w=s("chart"),E=(e,{title:t="",center:l=["50%","50%"],legendConfig:a={},labelConfig:s={},totalConfig:i={left:"center",top:"center",textStyle:{fontSize:14,fontWeight:"bold"}}}={})=>{const o=e.reduce(((e,t)=>e+t.value),0);return{tooltip:{trigger:"item",position:function(e,t,l,a,s){const i=e[0];return i>s.viewSize[0]/2?[i-s.contentSize[0]-10,e[1]]:[i+10,e[1]]},formatter:"{b}: {c} ({d}%)",axisPointer:{show:!0,type:"shadow",z:100}},legend:{itemWidth:10,itemHeight:10,textStyle:{fontSize:12,color:"#666"},...a},title:{text:(null==t?void 0:t.text)||t,left:"center",bottom:0,textStyle:{fontSize:16,fontWeight:"bold",color:"#333"}},series:[{name:(null==t?void 0:t.text)||t,type:"pie",radius:["40%","70%"],center:l,avoidLabelOverlap:!0,top:0,right:0,bottom:"10%",itemStyle:{borderRadius:4,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:"{b}: {c}\n{d}%",...s},labelLine:{show:!0,length:15,length2:10,smooth:!0,lineStyle:{width:1,type:"solid"}},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},data:e}],graphic:{elements:[{type:"group",left:i.left,top:"40%",children:[{type:"text",style:{text:"总计",textAlign:"center",fill:"#333",fontSize:14,fontWeight:"normal"},left:"center",top:-10},{type:"text",style:{text:o.toString(),textAlign:"center",fill:"#333",fontSize:20,fontWeight:"bold"},left:"center",top:10}]}]}}},j=(e,t=1024)=>e>=t?{value:(e/t).toFixed(2),unit:"TB"}:{value:e,unit:"GB"},L=C((()=>{var e,t;if(!(null==(t=null==(e=n.value)?void 0:e.server)?void 0:t.physical_resources))return[];const{total_cpu:l,total_ram:a,total_disk:s}=n.value.server.physical_resources,i=j(a),o=j(s);return[{title:"CPU",value:l,unit:"核",icon:"cpu",color:"#1890ff"},{title:"内存",value:i.value,unit:i.unit,icon:"memory",color:"#52c41a"},{title:"硬盘",value:o.value,unit:o.unit,icon:"disk",color:"#722ed1"}]})),O=s([]),R=e=>{var t;const l=((e,t)=>{if(!e)return{data:[],totalCount:0};let l=0;const a=[];return Object.entries(e).forEach((([e,s])=>{Object.entries(s).forEach((([s,i])=>{l+=i;const o=t[e]||e+"-";a.push({name:`${o}${s.slice(s.indexOf(e)-1).toUpperCase()}区`,real_value:s,value:i,itemStyle:{opacity:.7}})}))})),{data:a,totalCount:l}})(null==(t=null==e?void 0:e.server)?void 0:t.region,y.value);let a=l.data;return E(a,{title:{text:"资源分布",subtext:r.value.includes("all")?"":r.value,subtextStyle:{fontSize:12,color:"#666"}},center:["50%","50%"],legendConfig:{orient:"horizontal",left:0,bottom:"10%",rich:{name:{width:100,overflow:"truncate"}},formatter:function(e){return e}},labelConfig:{position:"outside",formatter:"{b}: {d}%",fontSize:12,lineHeight:15,align:"center"}})},M=e=>{var t;const l=(null==(t=null==e?void 0:e.server)?void 0:t.charge_type)||{},a=Object.entries(l).map((([e,t])=>({name:e,value:t})));return E(a,{title:{text:"计费方式",subtext:r.value.includes("all")?"":r.value,subtextStyle:{fontSize:12,color:"#666"}},legendConfig:{orient:"horizontal",left:0,bottom:"10%",rich:{name:{width:100,overflow:"truncate"}},formatter:function(e){return e}},labelConfig:{position:"outside",formatter:"{b}: {c}\n{d}%",fontSize:12,lineHeight:15,align:"center"}})},W=()=>{const e=k.value,t=e.map((e=>{var t,l,a,s,i,o;const n=(null==(t=e.mysql)?void 0:t["cn-east-3"])||0,r=(null==(l=e.redis)?void 0:l["cn-east-3"])||0,c=(null==(a=e.mongoDB)?void 0:a["cn-east-3"])||0;return{name:e.business,type:"bar",stack:"total",data:[{value:n,expiring_soon:(null==(s=e.mysql)?void 0:s.expiring_soon_number)||0},{value:r,expiring_soon:(null==(i=e.redis)?void 0:i.expiring_soon_number)||0},{value:c,expiring_soon:(null==(o=e.mongoDB)?void 0:o.expiring_soon_number)||0}],emphasis:{focus:"series"}}}));return{title:{text:"实例数",subtext:r.value.includes("all")?"":r.value,subtextStyle:{fontSize:12,color:"#666"},left:"center",bottom:0,textStyle:{fontSize:16,fontWeight:"bold",color:"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},position:function(e,t,l,a,s){const i=e[0];return i>s.viewSize[0]/2?[i-s.contentSize[0]-10,e[1]]:[i+10,e[1]]},formatter:function(e){let t=`${e[0].name}<br/>`;const l=e.reduce(((e,t)=>e+t.value),0);return t+=`总计: ${l}<br/><br/>`,e.forEach((e=>{t+=`${e.seriesName}: ${e.value}<br/>`})),t}},legend:{data:e.map((e=>e.business)),type:"scroll",orient:"vertical",right:10,top:20,bottom:20},label:{show:!0,position:"insideTop",formatter:e=>e.value?e.value:"",distance:0},grid:{left:"3%",right:"15%",bottom:"15%",top:"15%",containLabel:!0},xAxis:{type:"category",data:["MySQL","Redis","MongoDB"],axisLabel:{interval:0}},yAxis:{type:"value",name:"实例数量",position:"left"},series:t,color:["#1890ff","#52c41a","#722ed1","#fa8c16","#f5222d","#13c2c2","#eb2f96","#faad14","#a0d911","#2f54eb"]}},A=e=>{var t,l,a,s;return{title:{text:"即将到期资源数(小于14天)",subtext:r.value.includes("all")?"":r.value.join(","),subtextStyle:{fontSize:12,color:"#666"},left:"center",top:0,textStyle:{fontSize:16,fontWeight:"bold",color:"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},position:function(e,t,l,a,s){const i=e[0];return i>s.viewSize[0]/2?[i-s.contentSize[0]-10,e[1]]:[i+10,e[1]]},formatter:function(e){const t=e[0];if(r.value.includes("all")){const e=O.value.map((e=>{var l,a,s,i;let o=0;return"服务器"===t.name?o=(null==(l=e.server)?void 0:l.expiring_soon_number)||0:"MySQL"===t.name?o=(null==(a=e.mysql)?void 0:a.expiring_soon_number)||0:"Redis"===t.name?o=(null==(s=e.redis)?void 0:s.expiring_soon_number)||0:"MongoDB"===t.name&&(o=(null==(i=e.mongoDB)?void 0:i.expiring_soon_number)||0),`${e.business}: ${o}`})).join("<br/>");return`${t.name}<br/>总计: ${t.value}<br/><br/>各业态数据:<br/>${e}`}return`${t.name}<br/>数量: ${t.value}`}},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:["服务器","MySQL","Redis","MongoDB"],axisLabel:{interval:0}},yAxis:{type:"value",name:"数量"},series:[{name:"即将到期数量",type:"bar",data:[(null==(t=null==e?void 0:e.server)?void 0:t.expiring_soon_number)||0,(null==(l=null==e?void 0:e.mysql)?void 0:l.expiring_soon_number)||0,(null==(a=null==e?void 0:e.redis)?void 0:a.expiring_soon_number)||0,(null==(s=null==e?void 0:e.mongoDB)?void 0:s.expiring_soon_number)||0],itemStyle:{color:function(e){return["#ff4d4f","#ff7a45","#ffa940","#ffec3d"][e.dataIndex]}},barWidth:"40%",label:{show:!0,position:"top"}}]}},P=e=>{const t=document.querySelector(".main-content");t&&t.style.setProperty("background-color",e)};i((async()=>{S.value="chart",P("rgb(246 247 250)")})),o((()=>{P("white")}));const F=C((()=>{var e,t,l;if(!n.value)return 0;const a=(null==(e=n.value.mysql)?void 0:e.total_disk)||0,s=((null==(t=n.value.redis)?void 0:t.total_mem)||0)/1024,i=(null==(l=n.value.mongoDB)?void 0:l.total_disk)||0;return Math.max(a,s,i)})),Q=e=>{S.value=e.target.value},H=e=>{const t=["#1890ff","#52c41a","#722ed1","#fa8c16","#f5222d","#13c2c2","#eb2f96","#faad14","#a0d911","#2f54eb"];return t[e%t.length]},K=e=>{w.value=e.target.value},J=e=>{if(!e)return[];const t=k.value,l=new Set;return t.forEach((e=>{var t;Object.keys((null==(t=e.server)?void 0:t.charge_type)||{}).forEach((e=>{l.add(e)}))})),Array.from(l).map((e=>{const l={charge_type:e,business:"",number:"",total:0};return t.forEach((t=>{var a,s;const i=(null==(s=null==(a=t.server)?void 0:a.charge_type)?void 0:s[e])||0;l[t.business]=i,l.business+=`${t.business} \n`,l.number+=`${i}\n`,l.total+=i})),l}))},N=()=>{const e=[{title:"计费方式",field:"charge_type",key:"charge_type",fixed:"left"},{title:"业态",field:"business",key:"business",fixed:"left"},{title:"数量",field:"number",key:"number",align:"center",sorter:(e,t)=>e.total-t.total}];return e.push({title:"总计",field:"total",key:"total",fixed:"right",width:120,align:"center",sorter:(e,t)=>e.total-t.total}),e};return(e,t)=>{var l,a,s,i,o,r,C,E,O,P,X,Y,Z,V;const ee=G,te=U,le=B("vxe-grid"),ae=I;return c(),u("div",Xe,[Ye,d("div",Ze,[d("div",Ve,[d("div",et,[d("div",tt,[f(te,{value:h(S),"onUpdate:value":t[0]||(t[0]=e=>D(S)?S.value=e:null),"button-style":"solid",onChange:Q},{default:z((()=>[f(ee,{value:"chart"},{icon:z((()=>[lt])),default:z((()=>[b(" 图表 ")])),_:1}),f(ee,{value:"table"},{icon:z((()=>[at])),default:z((()=>[b(" 表格 ")])),_:1})])),_:1},8,["value"])])]),d("div",st,["chart"===h(S)?(c(),$(T,{key:0,id:"regionChart",options:R(h(n))},null,8,["options"])):q("",!0),"table"===h(S)?(c(),u("div",it,[f(le,{data:h(He)(null==(a=null==(l=h(n))?void 0:l.server)?void 0:a.region,h(y)),columns:[{title:"区域",field:"region",key:"region"},{title:"可用区",field:"zone",key:"zone"},{title:"数量",field:"count",key:"count",sorter:(e,t)=>e.count-t.count}],"show-footer":"",pagination:!1,"footer-data":[{region:"总计",count:h(Ke)(null==(i=null==(s=h(n))?void 0:s.server)?void 0:i.region)}],size:"small"},null,8,["data","columns","footer-data"])])):q("",!0)])]),d("div",ot,[d("div",nt,[d("div",rt,[f(te,{value:h(w),"onUpdate:value":t[1]||(t[1]=e=>D(w)?w.value=e:null),"button-style":"solid",onChange:K},{default:z((()=>[f(ee,{value:"chart"},{icon:z((()=>[ct])),default:z((()=>[b(" 图表 ")])),_:1}),f(ee,{value:"table"},{icon:z((()=>[ut])),default:z((()=>[b(" 表格 ")])),_:1})])),_:1},8,["value"])])]),d("div",dt,["chart"===h(w)?(c(),$(T,{key:0,id:"chargeTypeChart",options:M(h(n))},null,8,["options"])):q("",!0),"table"===h(w)?(c(),u("div",vt,[f(le,{data:J(h(n)),columns:N(),width:"100%",pagination:!1,size:"small","scroll-y":{enabled:!0}},null,8,["data","columns"])])):q("",!0)])]),d("div",pt,[d("div",mt,[(c(!0),u(v,null,p(h(L),(e=>(c(),$(Qe,{key:e.title,title:e.title,value:e.value,unit:e.unit,color:e.color,icon:e.icon},null,8,["title","value","unit","color","icon"])))),128))])])]),d("div",ht,[gt,d("div",yt,[d("div",bt,[d("div",ft,[f(T,{id:"dbInstanceChart111",options:W(h(n))},null,8,["options"])])]),d("div",_t,[d("div",xt,[d("div",kt,[d("div",St,[d("div",wt,[Ct,f(ae,null,{title:z((()=>{var e,t,l,a;return[d("div",null,[d("div",null,"总计: "+m(j((null==(t=null==(e=h(n))?void 0:e.mysql)?void 0:t.total_disk)||0).value)+m(j((null==(a=null==(l=h(n))?void 0:l.mysql)?void 0:a.total_disk)||0).unit),1),(c(!0),u(v,null,p(h(k),(e=>{var t,l;return c(),u("div",{key:e.business},m(e.business)+": "+m(j((null==(t=e.mysql)?void 0:t.total_disk)||0).value)+m(j((null==(l=e.mysql)?void 0:l.total_disk)||0).unit),1)})),128))])]})),default:z((()=>[d("div",Bt,[(c(!0),u(v,null,p(h(k),((e,t)=>{var l,a,s;return c(),u("div",{key:e.business,class:"progress-segment",style:g({width:`${h(Je)((null==(l=e.mysql)?void 0:l.total_disk)||0,h(F))}%`,backgroundColor:H(t)}),title:`${e.business}: ${j((null==(a=e.mysql)?void 0:a.total_disk)||0).value}${j((null==(s=e.mysql)?void 0:s.total_disk)||0).unit}`},null,12,zt)})),128))])])),_:1}),d("span",Dt,m(j((null==(r=null==(o=h(n))?void 0:o.mysql)?void 0:r.total_disk)||0).value)+m(j((null==(E=null==(C=h(n))?void 0:C.mysql)?void 0:E.total_disk)||0).unit),1)])]),d("div",$t,[d("div",qt,[It,f(ae,null,{title:z((()=>{var e,t;return[d("div",null,[d("div",null,"总计: "+m((((null==(t=null==(e=h(n))?void 0:e.redis)?void 0:t.total_mem)||0)/1024).toFixed(2))+"GB",1),(c(!0),u(v,null,p(h(k),(e=>{var t;return c(),u("div",{key:e.business},m(e.business)+": "+m((((null==(t=e.redis)?void 0:t.total_mem)||0)/1024).toFixed(2))+"GB ",1)})),128))])]})),default:z((()=>[d("div",Et,[(c(!0),u(v,null,p(h(k),((e,t)=>{var l,a;return c(),u("div",{key:e.business,class:"progress-segment",style:g({width:`${h(Je)(((null==(l=e.redis)?void 0:l.total_mem)||0)/1024,h(F))}%`,backgroundColor:H(t)}),title:`${e.business}: ${(((null==(a=e.redis)?void 0:a.total_mem)||0)/1024).toFixed(2)}GB`},null,12,jt)})),128))])])),_:1}),d("span",Lt,m((((null==(P=null==(O=h(n))?void 0:O.redis)?void 0:P.total_mem)||0)/1024).toFixed(2))+"GB",1)])]),d("div",Ot,[d("div",Rt,[Mt,f(ae,null,{title:z((()=>{var e,t,l,a;return[d("div",null,[d("div",null,"总计: "+m(j((null==(t=null==(e=h(n))?void 0:e.mongoDB)?void 0:t.total_disk)||0).value)+m(j((null==(a=null==(l=h(n))?void 0:l.mongoDB)?void 0:a.total_disk)||0).unit),1),(c(!0),u(v,null,p(h(k),(e=>{var t,l;return c(),u("div",{key:e.business},m(e.business)+": "+m(j((null==(t=e.mongoDB)?void 0:t.total_disk)||0).value)+m(j((null==(l=e.mongoDB)?void 0:l.total_disk)||0).unit),1)})),128))])]})),default:z((()=>[d("div",Wt,[(c(!0),u(v,null,p(h(k),((e,t)=>{var l,a,s;return c(),u("div",{key:e.business,class:"progress-segment",style:g({width:`${h(Je)((null==(l=e.mongoDB)?void 0:l.total_disk)||0,h(F))}%`,backgroundColor:H(t)}),title:`${e.business}: ${j((null==(a=e.mongoDB)?void 0:a.total_disk)||0).value}${j((null==(s=e.mongoDB)?void 0:s.total_disk)||0).unit}`},null,12,At)})),128))])])),_:1}),d("span",Tt,m(j((null==(Y=null==(X=h(n))?void 0:X.mongoDB)?void 0:Y.total_disk)||0).value)+m(j((null==(V=null==(Z=h(n))?void 0:Z.mongoDB)?void 0:V.total_disk)||0).unit),1)])])]),Gt])])])]),_(d("div",Ut,[Pt,d("div",Ft,[d("div",Qt,[f(T,{id:"expiringChart",options:A(h(n))},null,8,["options"])])])],512),[[x,h(k).length<2]])])}}},[["__scopeId","data-v-c49236f5"]]),Kt={class:"resource-tab"},Jt={style:{display:"flex","align-items":"center",gap:"8px"}},Nt=(e=>(S("data-v-b03a58e9"),e=e(),w(),e))((()=>d("div",null,[d("p",null,"业态搜索说明："),d("p",null,"1. 选择需要查看的业态，支持多选。"),d("p",null,"2. 选择“全部业态”将显示所有业态的数据。"),d("p",null,"3. 支持搜索，输入业态名称即可搜索。"),d("p",null,"4. 当有全部业态时，选择其他业态，将自动去除全部业态。"),d("p",null,"5. 当没有选择业态时，将默认选择全部业态。")],-1))),Xt=t({__name:"ResourceTab",setup(e){let{getCloudRegionList:t}=L;const l=s("summary"),a=s([]),o=s(["all"]),n=s([]);let r=s({});const g=C((()=>o.value.includes("all")?a.value:a.value.filter((e=>o.value.includes(e.business))))),y=C((()=>(e=>{if(!Array.isArray(e)||0===e.length)return null;const t={server:{region:{},charge_type:{},physical_resources:{total_cpu:0,total_ram:0,total_disk:0},expiring_soon_number:0},mysql:{expiring_soon_number:0,total_disk:0,"cn-east-3":0},redis:{expiring_soon_number:0,total_mem:0,"cn-east-3":0},mongoDB:{expiring_soon_number:0,total_disk:0,"cn-east-3":0}};return e.forEach((e=>{e.server&&(Object.entries(e.server.region||{}).forEach((([e,l])=>{t.server.region[e]||(t.server.region[e]={}),Object.entries(l).forEach((([l,a])=>{t.server.region[e][l]=(t.server.region[e][l]||0)+a}))})),Object.entries(e.server.charge_type||{}).forEach((([e,l])=>{t.server.charge_type[e]=(t.server.charge_type[e]||0)+l})),e.server.physical_resources&&(t.server.physical_resources.total_cpu+=e.server.physical_resources.total_cpu||0,t.server.physical_resources.total_ram+=e.server.physical_resources.total_ram||0,t.server.physical_resources.total_disk+=e.server.physical_resources.total_disk||0),t.server.expiring_soon_number+=e.server.expiring_soon_number||0),e.mysql&&(t.mysql.expiring_soon_number+=e.mysql.expiring_soon_number||0,t.mysql.total_disk+=e.mysql.total_disk||0,t.mysql["cn-east-3"]+=e.mysql["cn-east-3"]||0),e.redis&&(t.redis.expiring_soon_number+=e.redis.expiring_soon_number||0,t.redis.total_mem+=e.redis.total_mem||0,t.redis["cn-east-3"]+=e.redis["cn-east-3"]||0),e.mongoDB&&(t.mongoDB.expiring_soon_number+=e.mongoDB.expiring_soon_number||0,t.mongoDB.total_disk+=e.mongoDB.total_disk||0,t.mongoDB["cn-east-3"]+=e.mongoDB["cn-east-3"]||0)})),t})(g.value))),_=e=>{o.value=e,e.indexOf("all")>-1?e.length>1?o.value=e.filter((e=>"all"!==e)):o.value=["all"]:0===e.length?o.value=["all"]:o.value=e};return i((async()=>{try{const e=await Q.postMessage({business_id:[],virtual_team_v3_id:null});a.value=e,n.value=e.map((e=>({business:e.business}))),r.value=await t()}catch(e){}})),E("resourceData",C((()=>a.value.length>1&&"summary"===l.value?y:a))),E("selectedBusinesses",o),E("cloudRegionList",r),E("pageResourceData",a),(e,t)=>{var s;const i=P,r=F,x=I,k=O,S=R;return c(),u("div",Kt,[h(a).length>1?(c(),$(S,{key:0,activeKey:h(l),"onUpdate:activeKey":t[1]||(t[1]=e=>D(l)?l.value=e:null),"destroy-inactive-tab-pane":""},{rightExtra:z((()=>[d("div",Jt,[f(r,{value:h(o),"onUpdate:value":t[0]||(t[0]=e=>D(o)?o.value=e:null),style:{"min-width":"400px"},placeholder:"请选择业态",mode:"multiple","allow-clear":"","show-search":"","option-filter-prop":"label",onChange:_},{default:z((()=>[f(i,{value:"all",label:"全部业态"},{default:z((()=>[b("全部业态")])),_:1}),(c(!0),u(v,null,p(h(n),(e=>(c(),$(i,{key:e.business,value:e.business,label:e.business},{default:z((()=>[b(m(e.business),1)])),_:2},1032,["value","label"])))),128))])),_:1},8,["value"]),f(x,{placement:"bottom"},{title:z((()=>[Nt])),default:z((()=>[f(h(j),{style:{"font-size":"16px",color:"#1890ff",cursor:"help"}})])),_:1})])])),default:z((()=>[f(k,{key:"summary",tab:"汇总视图"},{default:z((()=>[f(Ht,{"resource-data":h(y)},null,8,["resource-data"])])),_:1}),f(k,{key:"detail",tab:"详细视图"},{default:z((()=>[f(Te,{"resource-data":h(g)},null,8,["resource-data"])])),_:1})])),_:1},8,["activeKey"])):(c(),$(Ht,{key:1,"resource-data":(null==(s=h(a))?void 0:s[0])||{},type:"one"},null,8,["resource-data"]))])}}},[["__scopeId","data-v-b03a58e9"]]);export{Xt as default};
