import{a3 as e,H as a,r as t,J as o,I as s,z as i,Q as n,R as l,X as r,F as c,S as u,a6 as d,am as _,$ as v,Y as m,Z as p,c as g,W as y,U as b,ah as f,ai as h,aV as w,v as x,aY as k,a9 as D,aa as $}from"./index.872a2bd0.js";import{A as j}from"./rdsApi.1fa29748.js";import{i as z}from"./index.165d9fa7.js";import{_ as E}from"./index.fc9664cf.js";const O={class:"overview-container"},A={class:"summary-box"},C=["onClick"],L={class:"summary-title"},R=["src"],T=(e=>(D("data-v-688fa0bb"),e=e(),$(),e))((()=>r("div",{class:"summary-border"},null,-1))),B={class:"desc-box"},G={class:"desc-title"},I={class:"desc-list"},J={class:"desc-label truncate"},S={class:"desc-value"},Y={key:0},F={style:{color:"#888"}},H={key:1},P=e({__name:"index",emits:["update:viewType"],setup(e,{emit:D}){const $=D,P=a({overviewData:{}}),Q=t(null);let U=null;const V={total:{label:"数据库总数",color:"#4fb050",icon:"kvstore.png",pointer:!0},status:{label:"状态分布",color:"#e88250"},expire_time:{label:"即将过期",color:"#3c79bf"},charge_type:{label:"付费类型",color:"#4fb050"}},W={cloud_source:{label:"云来源分布",icon:!0},region_id:{label:"区域分布",icon:!0},environment:{label:"环境分布"},spec_code:{label:"规格分布"},engine:{label:"引擎分布"}},X=e=>e.sort(((e,a)=>a.count-e.count)),Z=()=>{U&&U.resize()};return o((async()=>{await(async()=>{const e=await j.getOverview({expire_days:[10,30],group_by_fields:[["environment"],["charge_type"],["status"],["region_id","cloud_source"],["spec_code"],["cloud_source"],["engine","engine_version"]],volume_usage_rate_top_n:10,mem_usage_rate_top_n:10});P.overviewData.total=[{total:"数据库总数",count:e.count}],P.overviewData.expire_time=[],e.expire_soon.forEach((e=>{P.overviewData.expire_time.push({expire_time:`即将过期(小于${e.days}天)`,count:e.instances.length})})),e.group_by.forEach((e=>{let a=e.fields[0];P.overviewData[a]=e.items})),P.overviewData.volume_usage_rate_top_n=e.volume_usage_rate_top_n})(),await(async()=>{let e=P.overviewData;Object.entries(e).forEach((([e,a])=>{a.forEach((a=>{a[e]||(a[e]="其他")}))}));const a=await h.getCloudRegionList();e.region_id.forEach((e=>{e.region_id=(null==a?void 0:a[e.region_id])||e.region_id}));let t=X(e.region_id);t.length>5&&(e.region_id=t.slice(0,4),e.region_id.push({region_id:"其他",count:t.slice(4).reduce(((e,a)=>e+a.count),0),other_data:t.slice(4)}));let o=X(e.spec_code);o.length>10&&(e.spec_code=o.slice(0,9),e.spec_code.push({spec_code:"其他",count:o.slice(9).reduce(((e,a)=>e+a.count),0),other_data:o.slice(9)}));let s=X(e.engine);e.engine=s.map((e=>({engine:e.engine+" "+e.engine_version,count:e.count})))})(),s((()=>{(()=>{if(!P.overviewData.volume_usage_rate_top_n)return;const e=[...P.overviewData.volume_usage_rate_top_n].sort(((e,a)=>e.volume_usage_rate-a.volume_usage_rate)),a={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){const a=e[0].data.dataObj||{};return`\n                    <b>${a.name}</b><br/>\n                    环境：${a.environment}<br/>\n                    总容量：${a.volume_size} GB<br/>\n                    已用容量：${a.volume_used} GB<br/>\n                    使用率：${a.volume_usage_rate}%\n                `}},grid:{left:150,right:100,bottom:20,top:20},xAxis:{type:"value",name:"使用率(%)",min:0,max:100},yAxis:{type:"category",data:e.map((e=>e.name)),axisLabel:{interval:0}},series:[{type:"bar",data:e.map((e=>({value:e.volume_usage_rate,dataObj:e}))),color:"#3c79bf",label:{show:!0,position:"right",formatter:function(e){const a=e.data.dataObj;return`${a.volume_usage_rate}%  (${a.volume_used}/${a.volume_size}GB)`}}}]};U||(U=z(Q.value)),U.setOption(a),setTimeout((()=>{U&&U.resize()}),0)})(),window.addEventListener("resize",Z)}))})),i((()=>{window.removeEventListener("resize",Z)})),(e,a)=>{const t=w,o=x,s=E,i=k;return n(),l("div",O,[r("div",A,[(n(),l(c,null,u(V,((e,a)=>r("div",{key:a,class:d(["summary-item",{"cursor-pointer":e.pointer}]),style:_({"--summary-color":e.color}),onClick:a=>e.pointer?$("update:viewType","RDS"):null},[(n(!0),l(c,null,u(v(P).overviewData[a],((t,o)=>(n(),l(c,{key:o},[r("div",null,[r("div",{class:"summary-value",style:_({"font-size":"total"===a?"32px":""})},m(t.count),5),r("div",L,m(t[a]),1)]),e.icon?(n(),l("img",{key:0,class:"summary-icon",src:`/images/${e.icon}`},null,8,R)):p("",!0),T],64)))),128))],14,C))),64))]),g(i,{title:"资源分布"},{default:y((()=>[r("div",B,[(n(),l(c,null,u(W,((e,a)=>{var i;return r("div",{key:a,class:"desc-card"},[r("div",G,m(e.label),1),r("div",I,[(n(!0),l(c,null,u(null==(i=v(P).overviewData)?void 0:i[a],(i=>(n(),l("div",{key:i.label,class:d({"two-col":"spec_code"===a})},[g(o,{title:i[a]},{default:y((()=>[r("span",J,[!e.icon||"cloud_source"===a&&"自建"===i.cloud_source?p("",!0):(n(),b(t,{key:0,type:i.cloud_source,style:{width:"22px"}},null,8,["type"])),f(" "+m(i[a])+"： ",1)])])),_:2},1032,["title"]),r("span",S,[i.other_data?(n(),l("span",Y,[g(s,{placement:"right"},{content:y((()=>[(n(!0),l(c,null,u(i.other_data,((o,s)=>(n(),l("div",{key:s},[r("span",F,[e.icon?(n(),b(t,{key:0,type:o.cloud_source,style:{width:"22px"}},null,8,["type"])):p("",!0),f(" "+m(o[a])+": ",1)]),f(" "+m(o.count),1)])))),128))])),default:y((()=>[r("span",null,m(i.count),1)])),_:2},1024)])):(n(),l("span",H,m(i.count),1))])],2)))),128))])])})),64))])])),_:1}),g(i,{title:"磁盘使用率Top10"},{default:y((()=>[r("div",{ref_key:"volumeChartRef",ref:Q,style:{width:"100%",height:"400px","margin-bottom":"24px"}},null,512)])),_:1})])}}},[["__scopeId","data-v-688fa0bb"]]);export{P as default};
