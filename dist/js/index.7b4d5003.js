import{_ as e,d as a,b2 as l,r as t,u as s,b3 as n,c as i,aF as u,g as o,b4 as d,aR as r,a5 as c,H as v,ai as _,b0 as p,ac as m,N as g,q as f,a3 as y,i as b,a0 as h,x as w,J as C,Q as k,U as x,ag as T,$ as O,W as S,C as $,X as E,D as V,aU as U,aN as F,O as A,ah as D,R as j,F as P,S as N,Z as B,a6 as I,Y as L,a7 as M,aj as R,a8 as Y,av as K,p as G,ad as q,b1 as z,aS as H,a_ as W,a$ as X,aY as Z,ay as J,v as Q,aZ as ee,ak as ae,a9 as le,aa as te}from"./index.872a2bd0.js";import{v as se,a as ne}from"./alertLevel.8dae0e72.js";import{a as ie,_ as ue}from"./index.029351cd.js";import{_ as oe,s as de}from"./index.44a4e190.js";import{_ as re}from"./index.65b2e021.js";import{_ as ce}from"./index.87ccdcd1.js";import{_ as ve}from"./Group.b415afa6.js";import"./index.64f8d8d4.js";import"./Checkbox.ddee6d58.js";const _e=()=>null;_e.isSelectOption=!0,_e.displayName="AAutoCompleteOption";const pe=_e,me=()=>null;me.isSelectOptGroup=!0,me.displayName="AAutoCompleteOptGroup";const ge=me;const fe=a({compatConfig:{MODE:3},name:"AAutoComplete",inheritAttrs:!1,props:e(e({},u(de(),["loading","mode","optionLabelProp","labelInValue"])),{dataSource:Array,dropdownMenuStyle:{type:Object,default:void 0},dropdownMatchSelectWidth:{type:[Number,Boolean],default:!0},prefixCls:String,showSearch:{type:Boolean,default:void 0},transitionName:String,choiceTransitionName:{type:String,default:"zoom"},autofocus:{type:Boolean,default:void 0},backfill:{type:Boolean,default:void 0},filterOption:{type:[Boolean,Function],default:!1},defaultActiveFirstOption:{type:Boolean,default:!0},status:String}),slots:Object,setup(a,r){let{slots:c,attrs:v,expose:_}=r;l(),l(),l(!a.dropdownClassName);const p=t(),m=()=>{var e;const a=d(null===(e=c.default)||void 0===e?void 0:e.call(c));return a.length?a[0]:void 0};_({focus:()=>{var e;null===(e=p.value)||void 0===e||e.focus()},blur:()=>{var e;null===(e=p.value)||void 0===e||e.blur()}});const{prefixCls:g}=s("select",a);return()=>{var l,t,s;const{size:d,dataSource:r,notFoundContent:_=(null===(l=c.notFoundContent)||void 0===l?void 0:l.call(c))}=a;let f;const{class:y}=v,b={[y]:!!y,[`${g.value}-lg`]:"large"===d,[`${g.value}-sm`]:"small"===d,[`${g.value}-show-search`]:!0,[`${g.value}-auto-complete`]:!0};if(void 0===a.options){const e=(null===(t=c.dataSource)||void 0===t?void 0:t.call(c))||(null===(s=c.options)||void 0===s?void 0:s.call(c))||[];f=e.length&&function(e){var a,l;return(null===(a=null==e?void 0:e.type)||void 0===a?void 0:a.isSelectOption)||(null===(l=null==e?void 0:e.type)||void 0===l?void 0:l.isSelectOptGroup)}(e[0])?e:r?r.map((e=>{if(n(e))return e;switch(typeof e){case"string":return i(pe,{key:e,value:e},{default:()=>[e]});case"object":return i(pe,{key:e.value,value:e.value},{default:()=>[e.text]});default:throw new Error("AutoComplete[dataSource] only supports type `string[] | Object[]`.")}})):[]}const h=u(e(e(e({},a),v),{mode:oe.SECRET_COMBOBOX_MODE_DO_NOT_USE,getInputElement:m,notFoundContent:_,class:b,popupClassName:a.popupClassName||a.dropdownClassName,ref:p}),["dataSource","loading"]);return i(oe,h,o({default:()=>[f]},u(c,["default","dataSource","options"])))}}}),ye=e(fe,{Option:pe,OptGroup:ge,install:e=>(e.component(fe.name,fe),e.component(pe.displayName,pe),e.component(ge.displayName,ge),e)}),be="system/virtual-team/";let{HEADER_CONFIG:he}=c;const we={getVirtualTeamList:async()=>r.get(`${be}list`),getVirtualTeamOneData:e=>r.get(`${be}list/${e}`),getVirtualTeamUserList:async e=>r.get(`${be}user/list${e}`),getVirtualTeamOneUserData:e=>r.get(`${be}list/${e}/user`),postAddVirtualTeam:e=>r.post(`${be}add`,e),putEditVirtualTeam:(e,a)=>r.put(`${be}edit/${e}`,a),putEditVirtualTeamUser:(e,a)=>r.put(`${be}user/edit/${e}`,a,he)};function Ce({layer:e,customTitleButton:a}){const l=m();let s=t([]),n=t([]),i=t({});const{generateCmdbFormTitle:u,formState:o,initFormState:d,rules:c}=(e=>{let a=v({}),l=v({}),t=v({});return{generateCmdbFormTitle:(s=[])=>{for(let n in s){let i=s[n];const{field:u,field_name:o,page_data_source:d,edit_display:c,edit_required:v}=i;if(d&&(null==d?void 0:d.data_source)&&("url"===(null==d?void 0:d.data_source)||"app_url"===(null==d?void 0:d.data_source)?Object.prototype.hasOwnProperty.call(e.value,u)||(null==d?void 0:d.url)&&r.get(null==d?void 0:d.url).then((a=>{e.value[u]=a})):"data"===(null==d?void 0:d.data_source)?e.value[u]=null==d?void 0:d.data:(null==d?void 0:d.data_origin)&&"method"===(null==d?void 0:d.data_source)&&_[null==d?void 0:d.data_origin]().then((a=>{e.value[u]=a}))),c){let e="",s=[];v&&s.push({required:!0,message:`${o}不能为空`}),d&&((null==d?void 0:d.data_source)?["url","data","app_url"].indexOf(d.data_source)>-1&&("checkbox"===d.form_type||"radio"!==d.form_type&&d.multiple)&&(e=[]):("json"===d.form_type&&(e=null,s.push({validator:ne,message:"请输入正确的json格式"})),"phone"===d.form_type&&(e=null,s.push({validator:p.isValidMobilePhone,message:"请输入正确的手机号"})),"checkbox"===d.form_type&&(e=[]),"select"===d.form_type&&d.multiple&&(e=[]),"input_tag"===d.form_type&&(e=[]),"boole"===d.form_type&&(e=(null==d?void 0:d.unchecked)||0),"alert_level"===d.form_type&&(e={},v&&s.push({validator:se,message:"此项不能为空"})),"table"===d.form_type&&(e=[]),"dynamic_form"===d.form_type&&(e=[])),"default_value"in d&&(e=d.default_value)),l[u]=e,a[u]=e,s.length&&(t[u]=s)}}},formState:l,initFormState:a,rules:t,title_data:e}})(i);return{title:s,button:n,formState:o,initFormState:d,rules:c,title_data:i,getPageTitleButton:async()=>{let t=g();const i=f((()=>null==t?void 0:t.menuList));let o=f((()=>{let e={};for(let a in i.value){let l=i.value[a];if(null==l?void 0:l.submenu)for(let a of l.submenu){let{vue_url:l}=a;l&&(e[l]=a)}}return e}));const d=f((()=>{var e,a;return(null==l?void 0:l.matched)&&(null==(a=o.value[null==(e=null==l?void 0:l.matched[(null==l?void 0:l.matched.length)-1])?void 0:e.path])?void 0:a.sid)}));if(d.value){if(!e)return;s.value=[],n.value=[];try{let l=await _.getCurrentMenuTitleApi({layer:e,id:d.value}),t=[];if(null==l?void 0:l.title_data)for(let e in l.title_data)for(let a of l.title_data[e]){let{types:e}=a;1===e&&(s.value.push(a),t.push(a)),2===e&&n.value.push(a)}await u(t),a&&a(l)}catch(r){s.value=[],n.value=[]}}}}}const ke=y({__name:"UserSearchSelect",props:{disabledUserIds:{type:Array,default:()=>[]}},emits:["update:value","selectChange"],setup(e,{emit:a}){const l=e;let s=t({loading:!1,list:[]});const n=v({data:[],leader_id:null,fetching:!1});const u=b("business_data"),o=a,d=(e,a)=>!e||a.label.toLowerCase().includes(e.toLowerCase()),r=h.debounce((async e=>{if(!e)return void c();const a=await p.isValidMobilePhone(e),l=await p.isValidEmail(e);a||l?c(e):(n.fetching=!1,s.value.loading=!1)}),300),c=async e=>{let a=e?`?search=${e}`:"";s.value.loading=!0,n.fetching=!0;try{const e=await we.getVirtualTeamUserList(a);0,s.value.list=e;const t=e.map((e=>{var a,t,s;let{email:n,username:i,mobile:o,id:d,business_id:r}=e||{};return{label:`${i} - ${n} - (Phone: ${o}) ${null==(s=null==(t=null==(a=u.value)?void 0:a.data)?void 0:t[r])?void 0:s.business}`,value:d,disabled:l.disabledUserIds.includes(d)}}));n.data=t}catch(t){}finally{s.value.loading=!1,n.fetching=!1}};w((()=>l.disabledUserIds),(()=>{n.data=n.data.map((e=>({...e,disabled:l.disabledUserIds.includes(e.value)})))}),{deep:!0}),C((()=>{c()}));const _=e=>{o("update:value",e),o("selectChange",e)};return(e,a)=>{const l=F,t=oe;return k(),x(t,U(e.$attrs,{options:O(n).data,"filter-option":d,"allow-clear":"","show-search":"",placeholder:"支持用户名模糊搜索，手机号、邮箱精确搜索",onSearch:O(r),onChange:_}),T({_:2},[O(n).fetching||!O(n).data.length?{name:"notFoundContent",fn:S((()=>[i(l,{size:"small",spinning:O(n).fetching},null,8,["spinning"]),$(E("span",null,"未搜索到用户",512),[[V,!O(n).data.length]])])),key:"0"}:void 0]),1040,["options","onSearch"])}}},[["__scopeId","data-v-e10612bf"]]),xe={class:"batch-add-container"},Te={class:"action-buttons"},Oe=["onClick"],Se=y({__name:"BatchAddUser",props:{oneVirtualTeam:{type:Object,default:()=>({})},open:{type:Boolean,default:!1}},emits:["update:open","userReload"],setup(e,{expose:a,emit:l}){const s=e,n=t(null),u=v({users:[]}),o=l,d=t(new Set),r=()=>{d.value.clear(),u.users=[{cmdb_user_v3_id:null,user_tag:null,loading:!1,id:Date.now()}]},c=()=>{o("update:open",!1)},_=()=>{u.users.push({cmdb_user_v3_id:null,user_tag:null,loading:!1,id:Date.now()})},p=async()=>{var e,a;try{const t=u.users.filter((e=>e.cmdb_user_v3_id));if(t.length){for(const n of t){const t=u.users.indexOf(n);u.users[t].loading=!0,u.users[t].msg="";const i={action:"add",cmdb_user_v3_id:n.cmdb_user_v3_id,user_tag:n.user_tag||""};try{const e=await we.putEditVirtualTeamUser(s.oneVirtualTeam.id,i);u.users[t].msg=e.msg,u.users[t].status="success"}catch(l){u.users[t].msg=(null==(a=null==(e=null==l?void 0:l.response)?void 0:e.data)?void 0:a.msg)||"添加失败",u.users[t].status="error"}finally{u.users[t].loading=!1}}t.every((e=>{const a=u.users.indexOf(e);return"success"===u.users[a].status}))&&setTimeout((()=>{o("update:open",!1),o("userReload",s.oneVirtualTeam.id)}),1e3)}}catch(l){}},m=f((()=>Array.from(d.value)));return a({dynamicValidateFormRef:n}),(a,l)=>{var t;const s=re,o=M,v=R,g=A("MinusCircleOutlined"),f=F,y=ie,b=Y,h=K,w=ue;return k(),x(w,{title:`【${null==(t=e.oneVirtualTeam)?void 0:t.group_name}】组中批量新增用户`,open:e.open,onAfterOpenChange:r,onClose:c},{footer:S((()=>[i(h,{type:"primary",onClick:p},{default:S((()=>[D("提交")])),_:1})])),default:S((()=>[E("div",xe,[i(s,{class:"search-tips",message:"搜索规则：\n1. 输入用户名可进行模糊搜索\n2. 输入完整手机号可精确匹配用户\n3. 输入完整邮箱地址可精确匹配用户\n4. 已选择的用户将被禁用，无法重复选择",type:"info","show-icon":""}),i(b,{ref_key:"dynamicValidateFormRef",ref:n,name:"dynamic_form_nest_item",model:O(u)},{default:S((()=>[(k(!0),j(P,null,N(O(u).users,((e,a)=>(k(),j("div",{key:e.id,class:"user-row"},[i(y,{style:{display:"flex","margin-bottom":"8px"},align:"baseline"},{default:S((()=>[i(o,{name:["users",a,"cmdb_user_v3_id"]},{default:S((()=>[i(ke,{value:e.cmdb_user_v3_id,"onUpdate:value":a=>e.cmdb_user_v3_id=a,style:{width:"500px"},"disabled-user-ids":O(m),onSelectChange:e=>((e,a)=>{const l=u.users[a].cmdb_user_v3_id;l&&d.value.delete(l),e&&(d.value.add(e),a===u.users.length-1&&_())})(e,a)},null,8,["value","onUpdate:value","disabled-user-ids","onSelectChange"])])),_:2},1032,["name"]),i(o,{name:["users",a,"user_tag"]},{default:S((()=>[i(v,{value:e.user_tag,"onUpdate:value":a=>e.user_tag=a,placeholder:"分组"},null,8,["value","onUpdate:value"])])),_:2},1032,["name"]),E("div",Te,[O(u).users.length>1?(k(),x(g,{key:0,class:"action-icon delete-icon",onClick:a=>(e=>{const a=u.users.indexOf(e);-1!==a&&(u.users.splice(a,1),0===u.users.length&&_())})(e)},null,8,["onClick"])):B("",!0),E("i",{class:"action-icon add-icon vxe-icon--circle-plus",onClick:e=>(e=>{const a={cmdb_user_v3_id:null,user_tag:null,loading:!1,id:Date.now()};u.users.splice(e+1,0,a)})(a)},null,8,Oe)]),i(f,{spinning:e.loading},{default:S((()=>[E("span",{class:I(["message",e.status])},L(null==e?void 0:e.msg),3)])),_:2},1032,["spinning"])])),_:2},1024)])))),128))])),_:1},8,["model"])])])),_:1},8,["title","open"])}}},[["__scopeId","data-v-b09614e9"]]),$e=e=>(le("data-v-284e14bf"),e=e(),te(),e),Ee=$e((()=>E("br",null,null,-1))),Ve={class:"virtualteam-box"},Ue={class:"virtualteam-list-box"},Fe=$e((()=>E("i",{class:"vxe-icon-search",style:{color:"#adb5bd"}},null,-1))),Ae={style:{width:"25%",height:"50px"}},De={style:{width:"100%"}},je={key:0},Pe={class:"user-info"},Ne={class:"info-item"},Be=$e((()=>E("span",{class:"label"},"用户名：",-1))),Ie={class:"value"},Le={class:"info-item"},Me=$e((()=>E("span",{class:"label"},"手机号：",-1))),Re={class:"value"},Ye={class:"info-item"},Ke=$e((()=>E("span",{class:"label"},"邮箱：",-1))),Ge={class:"value"},qe={class:"info-item"},ze=$e((()=>E("span",{class:"label"},"分组：",-1))),He={class:"value"},We=$e((()=>E("i",{class:"vxe-icon-question-circle"},null,-1))),Xe={key:0,class:"edit-controls pl-2"},Ze={class:"leader-select mb-0.5"},Je=$e((()=>E("i",{class:"vxe-icon-question-circle"},null,-1))),Qe={key:0,class:"delete-btn"},ea=y({__name:"index",setup(e){let{getCommonBusinessList:a}=_;const{business_data:l,requestBusinessData:s}=a(),n=t([]);let{initFormState:u,button:o,getPageTitleButton:d,formState:r}=Ce({layer:1});let v=t({list:[],loading:!1,error_msg:null,error_status:null,activeKeyTab:null}),p=t(null),m=t({loading:!1,data:{}}),g=t("");const y=f((()=>{let e={};if(o.value)for(let a of o.value){let{field:l}=a;switch(l){case"add":case"user_edit":case"edit":e[l]=a}}return e})),b=async()=>{var e,a,l,t,s;v.value.loading=!0,v.value.activeKeyTab=null;try{v.value.loading=!1;const s=await we.getVirtualTeamList();v.value.list=s.map((e=>(e.value=e.group_name,e))).reverse(),(null==(a=null==(e=v.value.list)?void 0:e[0])?void 0:a.id)&&await Y(null==(t=null==(l=v.value.list)?void 0:l[0])?void 0:t.id)}catch(n){let e=null==n?void 0:n.response;v.value.error_status=null==e?void 0:e.status,v.value.error_msg=(null==e?void 0:e.message)||(null==(s=null==e?void 0:e.data)?void 0:s.msg),v.value.loading=!1}},U=t([]),I=async e=>{n.value=[],U.value=[],U.value=await we.getVirtualTeamOneUserData(e)||[],U.value=U.value.map((e=>(e.user_tag=e.user_tag&&"null"!==e.user_tag?e.user_tag:"默认分组",n.value.push(e.user_tag),e)))};let M=t(null);const Y=async e=>{le.value.id=e,m.value.loading=!0,m.value.data={},p.value=null,v.value.activeKeyTab=e,r=h.clone(u),we.getVirtualTeamOneData(e).then((async a=>{m.value.loading=!1,m.value.data=a,M.value=(null==a?void 0:a.group_leader_id)?a.group_leader_id:null,await I(e)})).catch((()=>{m.value.loading=!1}))};let le=t({});const te=()=>{p.value=c.FORM_TYPE.ADD_TYPE,v.value.activeKeyTab=null,le.value.id=null,U.value=[],me("","group_name")},se=t({}),ne=()=>{if(r.group_name){let e={group_name:r.group_name,group_leader_id:r.group_leader_id,business_group_id:null};const a=[];for(const[t,s]of Object.entries(se.value)){const e=U.value.find((e=>e.cmdb_user_v3__id===Number(t)));e&&e.user_tag!==s&&a.push({action:"edit",cmdb_user_v3_id:t,user_tag:s})}const l=[];return p.value===c.FORM_TYPE.ADD_TYPE?l.push(we.postAddVirtualTeam(e).then((e=>{var a;return Y(null==(a=null==e?void 0:e.data)?void 0:a.id),e}))):l.push(we.putEditVirtualTeam(v.value.activeKeyTab||m.value.data.id,e).then((e=>{const l=a.map((e=>we.putEditVirtualTeamUser(v.value.activeKeyTab||m.value.data.id,e)));return Promise.all([e,...l])}))),Promise.all(l).then((([e])=>{Y(v.value.activeKeyTab||m.value.data.id),z.success((null==e?void 0:e.msg)||"操作成功"),se.value={},m.value.loading=!1})).catch((e=>{var a;z.error((null==(a=null==e?void 0:e.response)?void 0:a.message)||"操作失败"),m.value.loading=!1}))}return Promise.reject("请填写组名")};C((async()=>{await d(),await b(),s(),me("","group_name")}));let ue=t(!1);const oe=()=>{ue.value=!0,me("","group_name")};let de=t({});const _e=(e,a,l)=>{var t,s;switch(de.value=h.clone(e,!0),l){case"edit":e.is_edit=!0,de.value.idx=a;break;case"delete":H.confirm({icon:i("i",{class:"vxe-icon-warning-triangle-fill text-warning",style:{display:"inline-black"}},` 是否删除 "${null==(s=null==(t=m.value)?void 0:t.data)?void 0:s.group_name}" 组中的 "${e.cmdb_user_v3__username}" 用户？`),okText:"是",cancelText:"否",onOk(){(e=>{var a;let l={action:e,cmdb_user_v3_id:null==(a=de.value)?void 0:a.cmdb_user_v3__id,user_tag:de.value.user_tag};we.putEditVirtualTeamUser(m.value.data.id,l).then((async e=>{z.success(e.msg),await I(m.value.data.id)})).catch((e=>{var a;z.success(null==(a=null==e?void 0:e.response)?void 0:a.message)}))})(l)},onCancel(){}})}},pe=t([]),me=(e,a)=>{const l=()=>{switch(a){case"group_name":return v.value.list.map((e=>({value:e.group_name,label:e.group_name})));case"user_tag":return h.uniq(n.value).map((e=>({value:e,label:e})));default:return[]}};if(!e)return void(pe.value=l());const t=e.toString().trim().toLowerCase();pe.value=l().filter((e=>e.label.toString().toLowerCase().includes(t)))};w((()=>v.value.list),(e=>{e.length&&me("","group_name")}),{deep:!0}),w((()=>n.value),(e=>{e.length&&me("","user_tag")}),{deep:!0});const ge=t({userId:null,isEditing:!1,originalValue:null});return G("business_data",l),(e,a)=>{var l,t,s,n;const u=A("vxe-button"),o=re,d=R,c=W,_=X,f=ye,h=Z,w=J,C=ce,G=A("check-outlined"),le=K,de=A("close-outlined"),fe=Q,be=ie,he=ee,Ce=ve,ke=ae,xe=F;return k(),x(h,{loading:O(v).loading,bordered:!1,class:"vitual-team-card"},T({title:S((()=>{var e,a;return[(null==(a=null==(e=O(y))?void 0:e.add)?void 0:a.page_display)?(k(),x(u,{key:0,icon:"vxe-icon-add",status:"primary",content:"新增",onClick:te})):B("",!0)]})),extra:S((()=>[i(u,{loading:O(v).loading,content:"刷新",icon:"vxe-icon-refresh",status:"primary",onClick:b},null,8,["loading"])])),default:S((()=>[O(p)?(k(),j(P,{key:0},[i(o,{message:"提示",description:`页面处于【${O(p)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}】用户组中...`,type:"warning","show-icon":"",closable:""},null,8,["description"]),Ee],64)):B("",!0),E("div",Ve,[E("div",Ue,[E("div",null,[i(d,{value:O(g),"onUpdate:value":a[0]||(a[0]=e=>q(g)?g.value=e:g=e),placeholder:"仅支持组名的搜索"},{prefix:S((()=>[Fe])),_:1},8,["value"])]),i(_,{"active-key":O(v).activeKeyTab,"onUpdate:activeKey":a[1]||(a[1]=e=>O(v).activeKeyTab=e),"tab-bar-style":{width:"100%"},"tab-position":"left",animated:"",onChange:Y},{default:S((()=>[(k(!0),j(P,null,N(O(v).list,(e=>(k(),x(c,{key:e.id,team:e},{tab:S((()=>[$(E("div",null,L(e.group_name),513),[[V,!O(g).trim()||-1!==e.group_name.toLowerCase().indexOf(O(g).trim().toLowerCase())]])])),_:2},1032,["team"])))),128))])),_:1},8,["active-key"])]),i(xe,{spinning:O(m).loading,"wrapper-class-name":"virtual-team-detail-message"},{default:S((()=>[i(C,{justify:"space-between",class:"mb-2"},{default:S((()=>{var l,t;return[E("div",Ae,[i(w,{text:"组名"},{default:S((()=>[i(h,null,{title:S((()=>{var l;return[O(p)===e.$CONFIG.FORM_TYPE.ADD_TYPE?(k(),x(f,{key:0,value:O(r).group_name,"onUpdate:value":a[2]||(a[2]=e=>O(r).group_name=e),options:O(pe),"allow-clear":!0,style:{width:"100%"},onSearch:a[3]||(a[3]=e=>me(e,"group_name"))},null,8,["value","options"])):(k(),j(P,{key:1},[D(L(null==(l=O(m).data)?void 0:l.group_name),1)],64))]})),_:1})])),_:1})]),O(p)!=e.$CONFIG.FORM_TYPE.ADD_TYPE&&(null==(t=null==(l=O(y))?void 0:l.user_edit)?void 0:t.page_display)?(k(),x(u,{key:0,status:"primary",class:"mb-2",icon:"vxe-icon-add",content:"添加用户",onClick:oe})):B("",!0)]})),_:1}),E("div",De,[O(U)&&O(U).length?(k(),j("div",je,[i(Ce,{value:O(M),"onUpdate:value":a[5]||(a[5]=e=>q(M)?M.value=e:M=e),class:"w-1",style:{width:"100%","background-color":"#f5f5f5",padding:"1.5% 1% 1.5% 1%"},name:"cmdb_user_v3__id","button-style":"solid",size:"small"},{default:S((()=>[(k(!0),j(P,null,N(e.$utils.groupBy(O(U),"user_tag"),((e,l)=>(k(),x(h,{key:l,style:{"margin-bottom":".5%"}},{title:S((()=>[D(L(l&&"null"!==l?l:"默认分组"),1)])),default:S((()=>[e.length?(k(),x(C,{key:0,class:"user-box",wrap:"wrap",gap:"16"},{default:S((()=>[(k(!0),j(P,null,N(e,((e,l)=>{var t;return k(),j("div",{key:e.cmdb_user_v3__id,class:"min-w-[300px]"},[(null==(t=O(m).data)?void 0:t.group_leader_id)!==e.cmdb_user_v3__id||O(p)?B("",!0):(k(),x(w,{key:0,text:"组长",class:"z-10"})),i(h,{style:{"box-shadow":"rgba(0, 0, 0, 0.13) 0px 2px 8px"},class:"user-card"},{default:S((()=>{var t,s,n,o,d,c,v;return[E("div",null,[E("div",Pe,[E("div",Ne,[Be,E("span",Ie,L(e.cmdb_user_v3__username),1)]),E("div",Le,[Me,E("span",Re,L(e.cmdb_user_v3__mobile),1)]),E("div",Ye,[Ke,E("span",Ge,L(e.cmdb_user_v3__email),1)]),E("div",qe,[ze,E("span",He,[O(ge).isEditing&&O(ge).userId===e.cmdb_user_v3__id?(k(),x(be,{key:0},{default:S((()=>[i(f,{value:O(se)[e.cmdb_user_v3__id]??e.user_tag,options:O(pe),"allow-clear":!0,style:{width:"120px"},onSearch:a[4]||(a[4]=e=>me(e,"user_tag")),onChange:a=>((e,a)=>{se.value[a.cmdb_user_v3__id]=e})(a,e)},null,8,["value","options","onChange"]),i(le,{type:"link",size:"small",onClick:a=>(async e=>{var a;try{const a=se.value[e.cmdb_user_v3__id];if(a!==e.user_tag){const l={action:"edit",cmdb_user_v3_id:e.cmdb_user_v3__id,user_tag:a};await we.putEditVirtualTeamUser(m.value.data.id,l),z.success("更新分组成功"),await I(m.value.data.id)}}catch(l){z.error((null==(a=null==l?void 0:l.response)?void 0:a.message)||"更新分组失败")}finally{ge.value.isEditing=!1}})(e)},{icon:S((()=>[i(G)])),_:2},1032,["onClick"]),i(le,{type:"link",size:"small",onClick:a=>(e=>{se.value[e.cmdb_user_v3__id]=ge.value.originalValue,ge.value.isEditing=!1})(e)},{icon:S((()=>[i(de)])),_:2},1032,["onClick"]),i(fe,null,{title:S((()=>[D(" 不填写时为 默认分组 ")])),default:S((()=>[We])),_:1})])),_:2},1024)):(k(),x(he,{key:1,content:O(se)[e.cmdb_user_v3__id]??e.user_tag,editable:!!(null==(s=null==(t=O(y))?void 0:t.user_edit)?void 0:s.page_display)&&{onStart:()=>(e=>(ge.value={userId:e.cmdb_user_v3__id,isEditing:!0,originalValue:e.user_tag},me("","user_tag"),!1))(e)}},null,8,["content","editable"]))])])]),(null==(n=O(m).data)?void 0:n.group_leader_id)!==e.cmdb_user_v3__id&&(null==(d=null==(o=O(y))?void 0:o.user_edit)?void 0:d.page_display)?(k(),j("div",Xe,[E("div",Ze,[i(u,{mode:"text",status:"primary",icon:"vxe-icon-setting",onClick:a=>(e=>{var a,l;H.confirm({title:"",icon:i("i",{class:"vxe-icon-warning-triangle-fill text-warning",style:{display:"inline-black"}},` 是否设置 "${e.cmdb_user_v3__username}" 为 "${null==(l=null==(a=m.value)?void 0:a.data)?void 0:l.group_name}" 组的组长？`),okText:"是",cancelText:"否",onOk:()=>(r.group_name=m.value.data.group_name,r.group_leader_id=e.cmdb_user_v3__id,ne())})})(e)},{default:S((()=>[D(" 设为组长 "),i(fe,null,{title:S((()=>[D(" 一个虚拟用户组仅有一个组长 ")])),default:S((()=>[Je])),_:1})])),_:2},1032,["onClick"])])])):B("",!0)]),(null==(v=null==(c=O(y))?void 0:c.user_edit)?void 0:v.page_display)?(k(),j("div",Qe,[i(u,{mode:"text",status:"error",icon:"vxe-icon-delete",content:"删除",size:"mini",onClick:a=>_e(e,l,"delete")},null,8,["onClick"])])):B("",!0)]})),_:2},1024)])})),128))])),_:2},1024)):B("",!0)])),_:2},1024)))),128))])),_:1},8,["value"])])):(k(),x(ke,{key:1},{description:S((()=>[D(" 该虚拟组无用户 ")])),_:1}))])])),_:1},8,["spinning"])]),i(Se,{open:O(ue),"onUpdate:open":a[6]||(a[6]=e=>q(ue)?ue.value=e:ue=e),"one-virtual-team":O(m).data||{},onUserReload:I},null,8,["open","one-virtual-team"])])),_:2},[(null==(t=null==(l=O(y))?void 0:l.edit)?void 0:t.page_display)||(null==(n=null==(s=O(y))?void 0:s.add)?void 0:n.page_display)?{name:"actions",fn:S((()=>[O(p)?(k(),x(u,{key:0,content:"提交",status:"primary",onClick:ne})):B("",!0)])),key:"0"}:void 0]),1032,["loading"])}}},[["__scopeId","data-v-284e14bf"]]);export{ea as default};
