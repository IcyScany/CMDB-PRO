import{_ as e}from"./ServerTable.53881589.js";import{Q as t,U as l,W as a,c as i,ah as o,Y as d,X as n,a6 as u,aZ as r,v as s,b5 as c,al as p,r as f,O as m,$ as v,R as _,F as y,S as k,a8 as b,aN as h,H as g,q as w,Z as D,an as S,am as U,ao as x,aY as T,a3 as R,J as C,aV as O,x as j,aj as I,cH as L,a7 as E,a9 as A,aa as F,a0 as P,cI as q,aw as Q,ax as B,e5 as N,e6 as W,C as z,e7 as Y,D as $,b6 as M,aS as H,I as V,a_ as G,a$ as K,ad as J}from"./index.872a2bd0.js";import{t as Z}from"./tableRender.a6ff99b7.js";import{o as X,_ as ee,u as te,c as le}from"./opsFormInit.3a4e1794.js";import{_ as ae}from"./index.029351cd.js";import{A as ie,p as oe}from"./cloudWafApi.0df30b42.js";import{_ as de}from"./index.7d980246.js";import{_ as ne}from"./Title.f705c4e3.js";import{D as ue,_ as re}from"./index.a533313d.js";import{a as se}from"./opsDescriptions.dfa169bd.js";import{S as ce,_ as pe}from"./index.44a4e190.js";import{_ as fe}from"./index.48209b21.js";import"./index.6e2fd079.js";import{_ as me,R as ve}from"./Group.b415afa6.js";import{_ as _e}from"./RadioButton.534ff50d.js";import{R as ye}from"./dayjs.c124633a.js";import{C as ke,_ as be}from"./index.fe8e77ef.js";import"./index.2c670fa1.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.fc9664cf.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.65b2e021.js";import"./index.64f8d8d4.js";import"./opsTable.7b07fc7b.js";import"./index.87ccdcd1.js";import"./Checkbox.ddee6d58.js";const he={__name:"index",props:{title:{type:[String,Number],default:""},content:{type:[String,Number],default:""},placement:{type:String,default:"top"},primary:{type:Boolean,default:!0}},emits:["click"],setup(e,{emit:c}){const p=c;return(c,f)=>{const m=r,v=s;return t(),l(v,{placement:e.placement,"overlay-style":{maxWidth:"none"}},{title:a((()=>[i(m,{copyable:{tooltip:!1},class:"tooltip-text"},{default:a((()=>[o(d(e.title||e.content),1)])),_:1})])),default:a((()=>[n("span",{class:u(["truncate block",{"text-primary":e.primary,"cursor-pointer":e.primary}]),style:{width:"100%"},onClick:f[0]||(f[0]=e=>p("click"))},d(e.content),3)])),_:1},8,["placement"])}}},ge={__name:"edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number,default:c},editRow:{type:Array,default:()=>[]}},emits:["update:open","editSuccess"],setup(e,{emit:o}){const d=e,{open:n,sid:u,formType:r}=p(d),s=o,c=f(null),{putEdit:g,getDetail:w,postAdd:D}=ie,{formRenderContent:S,formDataLoading:U,confirmLoading:x,initForm:T,formDataInit:R,editSubmit:C}=X({formRef:c,TITLE_LAYER:1,formType:r,sid:u,emits:s,addApi:D,editApi:g,oneDataApi:w,customSubmitData:async function(e){return e={data:e,ids:null==d?void 0:d.editRow.map((e=>e.id)).join(",")}},customEditData:function(e){e.value=e.value[0]}});const O=()=>{s("update:open",!1)},j=async e=>{e&&(await T(),await R())};return(e,o)=>{const d=ee,u=b,s=h,p=m("vxe-button"),f=ae;return t(),l(f,{title:`\n            ${e.$route.meta.title}\n            ${v(r)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}\n            ${v(r)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"":"编辑"}\n        `,open:v(n),onAfterOpenChange:j,onClose:O},{footer:a((()=>[i(p,{content:"取消",onClick:O}),i(p,{type:"submit",loading:v(x),status:"primary",content:"提交",onClick:v(C)},null,8,["loading","onClick"])])),default:a((()=>[i(s,{spinning:v(U)},{default:a((()=>[i(u,{ref_key:"formRef",ref:c,model:v(S).formState,rules:v(S).rules},{default:a((()=>[(t(!0),_(y,null,k(e.$utils.filter(v(S).title,(e=>e.edit_display)),(e=>{var a,i,o,n;return t(),_(y,{key:e.field},[""===e.field?(t(),l(d,{key:0,value:v(S).formState[e.field],"onUpdate:value":t=>v(S).formState[e.field]=t,title:e,"title-data":null==(i=null==(a=v(S))?void 0:a.title_data)?void 0:i[e.field]},null,8,["value","onUpdate:value","title","title-data"])):(t(),l(d,{key:1,value:v(S).formState[e.field],"onUpdate:value":t=>v(S).formState[e.field]=t,title:e,"title-data":null==(n=null==(o=v(S))?void 0:o.title_data)?void 0:n[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},we={__name:"index",props:{ruleData:Object,open:Boolean,initColumn:Array},emits:["update:open"],setup(e,{emit:o}){const d=e,n=o,u=f(null),r=2,s=g({data:[]}),c=w((()=>{let e=d.initColumn.filter((e=>e.oriTitle.block===r));for(let t of e){let{field:e}=t;if(""===e)t.slots={default:e}}return{columns:e}})),p=e=>{e?(s.data=d.ruleData,u.value.commitRequest()):(s.data=[],u.value.commitRequest())};return(o,r)=>{var f;const m=de,_=ae;return t(),l(_,{open:e.open,title:`近30天触发次数：${(null==(f=d.ruleData)?void 0:f.modelTitle)||""}`,width:"60%","z-index":1e5,onClose:r[0]||(r[0]=e=>n("update:open",!1)),onAfterOpenChange:p},{default:a((()=>[i(m,{ref_key:"tableRef",ref:u,data:v(s).data||[],columns:v(c).columns},null,8,["data","columns"])])),_:1},8,["open","title"])}}},De={key:0,class:"flex items-center justify-center mt-5 text-primary"},Se=n("span",null,"下一跳",-1),Ue={class:"ml-4"},xe={class:"truncate",style:{"max-width":"fit-content"}},Te={__name:"descCard",props:{descData:{type:Object,default:()=>({})},descFields:{type:Object,default:()=>({})},slots:{type:Array,default:()=>[]},customItem:{type:String,default:""},title:{type:String,default:""},arrow:{type:Boolean,default:!1},customSpan:{type:Object,default:()=>({})},cardStyle:{type:Object,default:()=>({})}},setup(e){const o=e,{descData:u,descFields:r}=p(o),c={label:{fontWeight:500},content:{display:"inline-block",paddingRight:"30px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},f={maxWidth:"500px",fontSize:"12px"};return(o,p)=>{const m=x,b=ne,h=s,g=ue,w=re,R=T;return t(),_(y,null,[e.arrow?(t(),_("div",De,[i(m,{iconname:"icon-a-DownArrow",style:{"font-size":"50px"}}),Se])):D("",!0),i(b,{level:4},{default:a((()=>[n("span",Ue,d(e.title),1)])),_:1}),i(R,{style:U(e.cardStyle)},{default:a((()=>[i(w,{"label-style":c.label,"content-style":c.content},{default:a((()=>[(t(!0),_(y,null,k(v(r),((i,r)=>{var s;return t(),l(g,{key:r,label:i,span:(null==(s=e.customSpan)?void 0:s[r])||1},{default:a((()=>[e.slots.includes(r)?S(o.$slots,r,{key:0}):(t(),l(h,{key:1,title:v(u)[r],"overlay-style":f},{default:a((()=>[n("div",xe,d(v(u)[r]),1)])),_:2},1032,["title"]))])),_:2},1032,["label","span"])})),128)),e.customItem?S(o.$slots,e.customItem,{key:0}):D("",!0)])),_:3},8,["label-style","content-style"])])),_:3},8,["style"])],64)}}},Re={style:{padding:"10px"}},Ce={class:"truncate"},Oe={key:1,class:"text-left"},je=R({__name:"index",props:{rowData:{type:Object,default:()=>({})}},setup(e){const r=e,{rowData:c}=p(r),f=g({type:"",data:{waf:[],nat:[]}}),b=g({waf:{title:"WAF信息",fields:{cloud_source:"云类型",hostname:"域名",access_status:"接入状态",access_code:"CNAME",description:"备注"}},source:{title:"源站信息",fields:{ip:"IP地址"}},nat:{title:"NAT信息",fields:{description:"备注"},addressFields:{public_ip:"外网IP",public_port:"外网端口",arrow:"",internal_ip:"内网IP",internal_port:"内网端口",status:"状态"}}}),h={label:{fontWeight:500},content:{display:"inline-block",paddingRight:"30px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},w={maxWidth:"500px",fontSize:"12px"};return C((async()=>{const e=await ie.getNextHop(c.value.id);f.data.waf=c.value,f.data.nat=e,f.data.source=c.value.server})),(e,r)=>{const c=m("vxe-tag"),p=s,g=m("ArrowRightOutlined"),D=ue,S=re;return t(),_("div",Re,[i(Te,{"desc-data":v(f).data.waf,"desc-fields":v(b).waf.fields,slots:["access_status"],title:"WAF信息"},{access_status:a((()=>{var e;return[i(c,{class:u(1==(null==(e=v(f).data.waf)?void 0:e.access_status)?"theme--primary":"theme--error"),size:"small"},{default:a((()=>{var e;return[o(d(1==(null==(e=v(f).data.waf)?void 0:e.access_status)?"接入":"未接入"),1)]})),_:1},8,["class"])]})),_:1},8,["desc-data","desc-fields"]),v(f).data.nat.length?(t(),l(Te,{key:0,"desc-data":v(f).data.nat,"desc-fields":v(b).nat.fields,slots:["description"],title:"NAT信息",arrow:!0,"custom-item":"customItem","custom-span":{description:3}},{description:a((()=>{var e;return[i(p,{title:null==(e=v(f).data.nat)?void 0:e.reduce(((e,t)=>e+t.description+"; "),""),"overlay-style":w},{default:a((()=>{var e;return[n("div",Ce,d(null==(e=v(f).data.nat)?void 0:e.reduce(((e,t)=>e+t.description+"; "),"")),1)]})),_:1},8,["title"])]})),customItem:a((()=>[(t(!0),_(y,null,k(v(f).data.nat,((e,n)=>(t(),l(D,{key:n,span:3},{default:a((()=>[i(S,{column:19,"label-style":h.label,"content-style":h.content},{default:a((()=>[(t(!0),_(y,null,k(v(b).nat.addressFields,((n,r)=>(t(),l(D,{key:r,label:n,span:"arrow"===r?1:["public_port","internal_port","status"].includes(r)?2:3,style:{paddingBottom:0}},{default:a((()=>[i(p,{title:null==e?void 0:e[r],"overlay-style":w},{default:a((()=>["status"===r?(t(),l(c,{key:0,class:u("可用"==(null==e?void 0:e[r])?"theme--primary":"theme--error"),size:"small"},{default:a((()=>[o(d(null==e?void 0:e[r]),1)])),_:2},1032,["class"])):"arrow"===r?(t(),_("div",Oe,[i(g,{style:{fontSize:"20px"}})])):(t(),_(y,{key:2},[o(d(null==e?void 0:e[r]),1)],64))])),_:2},1032,["title"])])),_:2},1032,["label","span"])))),128))])),_:2},1032,["label-style","content-style"])])),_:2},1024)))),128))])),_:1},8,["desc-data","desc-fields"])):(t(),l(Te,{key:1,arrow:!0,title:"回源地址","custom-item":"customItem"},{customItem:a((()=>[(t(!0),_(y,null,k(v(f).data.source,((e,n)=>(t(),l(D,{key:n,span:3},{default:a((()=>[i(S,{column:1,"label-style":h.label,"content-style":h.content},{default:a((()=>[(t(!0),_(y,null,k(v(b).source.fields,((n,u)=>(t(),l(D,{key:u,label:n,style:{paddingBottom:0}},{default:a((()=>[i(p,{title:e,"overlay-style":w},{default:a((()=>[o(d(e),1)])),_:2},1032,["title"])])),_:2},1032,["label"])))),128))])),_:2},1032,["label-style","content-style"])])),_:2},1024)))),128))])),_:1}))])}}},[["__scopeId","data-v-d347ab54"]]),Ie={class:"text-12"},Le={class:"truncate inline"},Ee={__name:"index",props:{data:{type:Object,default:()=>{}},columns:{type:Array,default:()=>[]},column:{type:Number,default:1},titleData:{type:Object,default:()=>{}}},setup:e=>(r,c)=>{const p=O,f=s,v=m("vxe-tag"),_=se;return t(),l(_,{title:null,data:e.data,columns:e.columns,column:e.column,size:"small"},{cloud_source:a((({row:e})=>[i(p,{style:{width:"none","margin-right":"4px"},type:e.cloud_source},null,8,["type"]),n("span",null,d(e.cloud_source),1)])),policy:a((({row:e})=>[i(f,null,{title:a((()=>[n("span",Ie,d(Object.keys(e.policy||{})[0]),1)])),default:a((()=>[n("div",Le,d(Object.keys(e.policy||{})[0]),1)])),_:2},1024)])),access_status:a((({row:e})=>[i(v,{class:u(1==e.access_status?"theme--primary":"theme--error"),size:"small"},{default:a((()=>[o(d(1==e.access_status?"接入":"未接入"),1)])),_:2},1032,["class"])])),protect_status:a((({row:e})=>[i(v,{class:u(1==e.protect_status?"theme--primary":"theme--error"),size:"small"},{default:a((()=>[o(d(1==e.protect_status?"开启防护":0==e.protect_status?"暂停防护":"bypass"),1)])),_:2},1032,["class"])])),proxy:a((({row:e})=>[i(v,{class:u(1==e.proxy?"theme--primary":"theme--error"),size:"small"},{default:a((()=>[o(d(1==e.proxy?"是":"否"),1)])),_:2},1032,["class"])])),cloud_master_account_id:a((({row:t})=>{var l,a,i;return[o(d((null==(i=null==(a=null==(l=e.titleData)?void 0:l.cloud_master_account_id)?void 0:a[t.cloud_master_account_id])?void 0:i.page_display)||""),1)]})),_:1},8,["data","columns","column"])}},Ae={class:"text-info"},Fe={__name:"index",props:{rowData:Object,tableData:Object,searchQuery:String,repeatRuleOpen:Boolean},emits:["showRule","edit","update:repeatRuleOpen"],setup(e,{emit:l}){const u=e,r=l,s=f(null),c=g({data:[],initColumn:[],initButton:[],initTitleData:[],repeatData:[]}),{userDel:p}=te(),m=w((()=>c.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),b=w((()=>{let e=c.initColumn,t=e.filter((e=>1===e.oriTitle.block&&["domain","name","status","conditions","action"].includes(e.field)));t=[{field:"ruleid",title:"ID",slots:{default:"ruleid"},showOverflow:"title",titlePrefix:{content:"点击查看近一个月的规则触发数"}},...t];for(let l of e){let{field:e}=l;switch(e){case"conditions":l.slots={default:e},l.minWidth=220,l.showOverflow=!1;break;case"action":l.slots={default:e},l.showOverflow=!1;break;case"tag_type":case"interept_count":l.slots={default:e};break;case"id":case"ruleid":l.slots={default:e},l.showOverflow="title",l.titlePrefix={content:"点击查看近一个月的规则触发数"}}}return{columns:e.filter((e=>1===e.oriTitle.block)),conditions:c.initColumn.filter((e=>3===e.oriTitle.block)),repeat_columns:t}}));C((async()=>{var e;s.value.tableLoading=!0;const{columns:t,title_data:l,button:a}=await Z.setColumn({layer:2});c.initColumn=t.value||[],c.initTitleData=l.value||[],c.initButton=a.value||[];let i=u.tableData;c.data=null==i?void 0:i.template_rule;let o=!1,d=[],n=null==(e=Object.values((null==i?void 0:i.repeat_domain_ids)||{}))?void 0:e[0];for(let u in n){for(let e in n[u]){let t=n[u][e];d.push({...i.repeat_data[t],rowClassName:o?"row--stripe":""})}o=!o}c.repeatData=d,s.value&&(s.value.searchQuery=u.searchQuery,s.value.commitRequest(),s.value.tableLoading=!1)}));const h=({row:e})=>e.rowClassName,D=e=>{r("showRule",e)},S=()=>{s.value.commitRequest()},U=({row:e})=>{r("edit",u.rowData,e)},x=e=>{let t={cloud_type:"huawei",cloud_master_account_id:u.rowData.cloud_master_account_id,sid:u.rowData.id,rule_id:e.id,policy_id:u.rowData.cc_policy_id};p({sid:e.id,body:t,delApi:oe.cc.del,loadData:S})};return j((()=>u.searchQuery),(e=>{s.value.searchQuery=e,s.value.commitRequest()})),(e,l)=>{const p=he,f=de,g=ae;return t(),_(y,null,[i(f,{ref_key:"tableRef",ref:s,data:v(c).data,columns:v(b).columns,"auth-btn":v(m),onRefresh:l[0]||(l[0]=e=>{v(ie).getDetail(u.rowData.id)}),onUserEdit:U,onUserDel:x},{top:a((()=>[])),id:a((({row:e})=>[i(p,{content:e.id,placement:"topLeft",onClick:t=>D(e)},null,8,["content","onClick"])])),conditions:a((({row:e})=>[(t(!0),_(y,null,k(e.conditions,((e,l)=>{var a,i,u,r,s;return t(),_(y,{key:l},[n("div",null,[o(" 请求"),n("span",Ae,d(null==(i=null==(a=v(c).initTitleData)?void 0:a.category)?void 0:i[e.category]),1),o(" "+d((null==(s=null==(r=null==(u=v(c).initTitleData)?void 0:u.logic_operation)?void 0:r[e.category])?void 0:s[e.logic_operation])||e.logic_operation),1)]),n("div",null,d(e.contents[0]),1)],64)})),128))])),action:a((({row:e})=>{var t,l,a;return[o(d(null==(a=null==(l=null==(t=v(c).initTitleData)?void 0:t.action)?void 0:l.find((t=>{var l;return t.value===(null==(l=e.action)?void 0:l.category)})))?void 0:a.label),1)]})),tag_type:a((({row:e})=>{var t,l;return[o(d(null==(l=null==(t=v(c).initTitleData)?void 0:t.tag_type)?void 0:l[e.tag_type]),1)]})),interept_count:a((({row:e})=>[o(d(e.interept_count)+"/"+d(e.all_count),1)])),_:1},8,["data","columns","auth-btn"]),i(g,{open:u.repeatRuleOpen,title:"华为云重复规则",width:"70%","z-index":1e4,onClose:l[1]||(l[1]=e=>r("update:repeatRuleOpen",!1))},{default:a((()=>[i(f,{data:v(c).repeatData,columns:v(b).repeat_columns,stripe:null,"row-class-name":h,"default-order":{prop:"conditions",order:"desc"}},{ruleid:a((({row:e})=>[i(p,{content:e.ruleid,placement:"topLeft",onClick:t=>D(e)},null,8,["content","onClick"])])),name:a((({row:e})=>[o(d(e.name),1)])),conditions:a((({row:e})=>[o(d(e.conditions),1)])),action:a((({row:e})=>{var t,l,a;return[o(d(null==(a=null==(l=null==(t=v(c).initTitleData)?void 0:t.action)?void 0:l.find((t=>t.value===e.action)))?void 0:a.label),1)]})),_:1},8,["data","columns"])])),_:1},8,["open"])],64)}}},Pe={class:"text-info"},qe={__name:"index",props:{rowData:Object,tableData:Object,searchQuery:String,repeatRuleOpen:Boolean},emits:["showRule","edit","update:repeatRuleOpen"],setup(e,{emit:l}){const u=e,r=l,c=f(null),p=g({data:[],initColumn:[],initTitleData:[],initButton:[],repeatData:[]}),{userEdit:m,userDel:b}=te(),h=w((()=>p.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),D=w((()=>{let e=p.initColumn;for(let t of e){let{field:e}=t;switch(e){case"conditions":t.slots={default:e},t.minWidth=220,t.showOverflow=!1;break;case"action":t.slots={default:e},t.showOverflow=!1;break;case"name":case"tag_type":case"interept_count":t.slots={default:e};break;case"ruleid":t.slots={default:e},t.showOverflow="title",t.titlePrefix={content:"点击查看近一个月的规则触发数"}}}return{template_rule:e,repeat_data:e.filter((e=>["ruleid","domain","name","status","conditions","action"].includes(e.field)))}}));C((async()=>{c.value.tableLoading=!0;const{columns:e,title_data:t,button:l}=await Z.setColumn({layer:5});p.initColumn=e.value||[],p.initTitleData=t.value||[],p.initButton=l.value||[];let a=u.tableData;p.data=null==a?void 0:a.template_rule;let i=!1,o=[],d=null==a?void 0:a.repeat_domain_ids;for(let n in d){for(let e in d[n]){let t=d[n][e];o.push({...a.repeat_data[t],rowClassName:i?"row--stripe":""})}i=!i}p.repeatData=o,c.value&&(c.value.searchQuery=u.searchQuery,c.value.commitRequest(),c.value.tableLoading=!1)}));const S=({row:e})=>e.rowClassName,U=e=>{r("showRule",e)},x=()=>{c.value.commitRequest()},T=({row:e})=>{r("edit",u.rowData,e)},R=e=>{let t={cloud_type:"aliyun",cloud_master_account_id:u.rowData.cloud_master_account_id,sid:u.rowData.id,rule_id:e.ruleid,policy_id:u.rowData.cc_policy_id};b({sid:e.ruleid,body:t,delApi:oe.cc.del,loadData:x})};return j((()=>u.searchQuery),(e=>{c.value.searchQuery=e,c.value.commitRequest()})),(e,l)=>{const f=he,b=s,g=de,w=ae;return t(),_(y,null,[i(g,{ref_key:"tableRef",ref:c,data:v(p).data||[],columns:v(D).template_rule,"auth-btn":v(h),onRefresh:l[0]||(l[0]=e=>{v(ie).getDetail(u.rowData.id)}),onUserEdit:T,onUserAdd:l[1]||(l[1]=t=>v(m)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:R},{top:a((()=>[])),ruleid:a((({row:e})=>[i(f,{content:e.ruleid,placement:"topLeft",onClick:t=>U(e)},null,8,["content","onClick"])])),name:a((({row:e})=>[i(b,{title:e.id},{default:a((()=>[o(d(e.name),1)])),_:2},1032,["title"])])),conditions:a((({row:e})=>[(t(!0),_(y,null,k(e.conditions,((e,l)=>{var a,i;return t(),_(y,{key:l},[n("div",null,[o(" 请求"),n("span",Pe,d(e.key),1),o(" "+d((null==(i=null==(a=v(p).initTitleData)?void 0:a.opValue)?void 0:i[e.opValue])||e.opValue),1)]),n("div",null,d(e.values),1)],64)})),128))])),action:a((({row:e})=>{var t,l;return[o(d((null==(l=null==(t=v(p).initTitleData)?void 0:t.action)?void 0:l[e.action])||e.action),1)]})),tag_type:a((({row:e})=>{var t,l;return[o(d(null==(l=null==(t=v(p).initTitleData)?void 0:t.tag_type)?void 0:l[e.tag_type]),1)]})),interept_count:a((({row:e})=>[o(d(e.interept_count)+"/"+d(e.all_count),1)])),_:1},8,["data","columns","auth-btn"]),i(w,{open:u.repeatRuleOpen,title:"阿里云重复规则",width:"70%","z-index":1e4,onClose:l[2]||(l[2]=e=>r("update:repeatRuleOpen",!1))},{default:a((()=>[i(g,{data:v(p).repeatData,columns:v(D).repeat_data,stripe:null,"row-class-name":S,"default-order":{prop:"conditions",order:"desc"}},{ruleid:a((({row:e})=>[i(f,{content:e.ruleid,placement:"topLeft",onClick:t=>U(e)},null,8,["content","onClick"])])),name:a((({row:e})=>[i(b,{title:e.id},{default:a((()=>[o(d(e.name),1)])),_:2},1032,["title"])])),conditions:a((({row:e})=>[o(d(e.conditions),1)])),action:a((({row:e})=>{var t,l;return[o(d((null==(l=null==(t=v(p).initTitleData)?void 0:t.action)?void 0:l[e.action])||e.action),1)]})),_:1},8,["data","columns"])])),_:1},8,["open"])],64)}}},Qe={key:0},Be={key:0},Ne=R({__name:"index",props:{rowData:Object,tableData:Object,searchQuery:String},emits:["showRule","edit"],setup(e,{emit:u}){const r=e,s=u,c=f(null),p=g({data:[],initColumn:[],initTitleData:[],initButton:[]}),{userDel:m}=te(),b=w((()=>p.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),h=w((()=>{let e=p.initColumn;for(let t of e){let{field:e}=t;switch(e){case"rule":case"update_time":case"interept_count":t.slots={default:e};break;case"conditions":t.slots={default:e},t.showOverflow=!1,t.minWidth=200;break;case"id":t.slots={default:e},t.showOverflow="title",t.titlePrefix={content:"点击查看近一个月的规则触发数"}}}return{columns:e}}));C((async()=>{c.value.tableLoading=!0;const{columns:e,title_data:t,button:l}=await Z.setColumn({layer:3});p.initColumn=e.value||[],p.initTitleData=t.value||[],p.initButton=l.value||[],c.value&&(c.value.searchQuery=r.searchQuery,c.value.commitRequest(),c.value.tableLoading=!1)}));const S=()=>{c.value.commitRequest()},U=({row:e})=>{s("edit",r.rowData,e)},x=e=>{let t={cloud_type:"huawei",cloud_master_account_id:r.rowData.cloud_master_account_id,sid:r.rowData.id,rule_id:e.id,policy_id:r.rowData.cc_policy_id};m({sid:e.id,body:t,delApi:oe.ignore.del,loadData:S})},T=e=>Array.isArray(e)?0===e.length?[[]]:Array.isArray(e[0])?e:[e]:[[]];return j((()=>r.searchQuery),(e=>{c.value.searchQuery=e,c.value.commitRequest()})),(u,f)=>{const m=he,g=de;return t(),l(g,{ref_key:"tableRef",ref:c,data:e.tableData||[],columns:v(h).columns,"auth-btn":v(b),onRefresh:f[0]||(f[0]=e=>{v(ie).getDetail(r.rowData.id)}),onUserEdit:U,onUserDel:x},{top:a((()=>[])),id:a((({row:e})=>[i(m,{content:e.id,placement:"topLeft",onClick:t=>(e=>{s("showRule",e)})(e)},null,8,["content","onClick"])])),update_time:a((({row:e})=>[o(d(new Date(e.update_time).toLocaleString()),1)])),rule:a((({row:e})=>{var t,l;return[o(d(null==(l=null==(t=v(p).initTitleData)?void 0:t.rule)?void 0:l[e.rule]),1)]})),conditions:a((({row:e})=>[(t(!0),_(y,null,k(T(e.conditions),((l,a)=>(t(),_("div",{key:a},[(t(!0),_(y,null,k(l,(e=>{var l,a,i,o,u;return t(),_("div",{key:e.id,class:"condition-item"},[n("span",null,d(null==(a=null==(l=v(p).initTitleData)?void 0:l.category)?void 0:a[e.category]),1),e.index?(t(),_("span",Qe," 子字段 "+d(e.index),1)):D("",!0),n("span",null,d((null==(u=null==(o=null==(i=v(p).initTitleData)?void 0:i.logic_operation)?void 0:o[e.category])?void 0:u[e.logic_operation])||e.logic_operation),1),n("span",null,d(e.contents[0]),1)])})),128)),a!==T(e.conditions).length-1?(t(),_("div",Be,"或者")):D("",!0)])))),128))])),interept_count:a((({row:e})=>[o(d(e.interept_count)+"/"+d(e.all_count),1)])),_:1},8,["data","columns","auth-btn"])}}},[["__scopeId","data-v-0edf252b"]]),We={class:"text-info"},ze={class:"truncate w-[100%]"},Ye={__name:"index",props:{rowData:{type:Object,default:()=>({})},tableData:Object,searchQuery:String},emits:["showRule","edit"],setup(e,{emit:u}){const r=e,c=u,p=f(null),m=g({data:[],initColumn:[],initTitleData:[],initButton:[]}),{userDel:b}=te(),h=w((()=>m.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),D=w((()=>{let e=m.initColumn;for(let t of e){let{field:e}=t;switch(e){case"conditions":case"target":t.slots={default:e},t.showOverflow=!1,t.minWidth=220;break;case"ruleid":t.slots={default:e},t.showOverflow="title",t.titlePrefix={content:"点击查看近一个月的规则触发数"};break;case"interept_count":t.slots={default:e}}}return{columns:e}}));C((async()=>{p.value.tableLoading=!0;const{columns:e,title_data:t,button:l}=await Z.setColumn({layer:7});m.initColumn=e.value||[],m.initTitleData=t.value||[],m.initButton=l.value||[],p.value&&(p.value.searchQuery=r.searchQuery,p.value.commitRequest(),p.value.tableLoading=!1)}));const S=()=>{p.value.commitRequest()},U=({row:e})=>{c("edit",r.rowData,e)},x=e=>{let t={cloud_type:"aliyun",cloud_master_account_id:r.rowData.cloud_master_account_id,sid:r.rowData.id,rule_id:e.id,policy_id:r.rowData.cc_policy_id};b({sid:e.id,body:t,delApi:ie.del,loadData:S})};return j((()=>r.searchQuery),(e=>{p.value.searchQuery=e,p.value.commitRequest()})),(u,f)=>{const b=he,g=s,w=de;return t(),l(w,{ref_key:"tableRef",ref:p,data:e.tableData||[],columns:v(D).columns,"auth-btn":v(h),onRefresh:f[0]||(f[0]=e=>{v(ie).getDetail(r.rowData.id)}),onUserEdit:U,onUserDel:x},{top:a((()=>[])),ruleid:a((({row:e})=>[i(b,{content:e.ruleid,placement:"topLeft",onClick:t=>(e=>{c("showRule",e)})(e)},null,8,["content","onClick"])])),conditions:a((({row:e})=>[(t(!0),_(y,null,k(e.conditions,((e,l)=>{var u,r;return t(),_(y,{key:l},[n("div",null,[o(" 请求"),n("span",We,d(e.key),1),o(" "+d((null==(r=null==(u=v(m).initTitleData)?void 0:u.opValue)?void 0:r[e.opValue])||e.opValue),1)]),i(g,{title:e.values},{default:a((()=>[n("div",ze,d(e.values),1)])),_:2},1032,["title"])],64)})),128))])),target:a((({row:e})=>[o(d(e.target.map((e=>{var t,l;return(null==(l=null==(t=v(m).initTitleData)?void 0:t.target)?void 0:l[e])||e})).join(", ")),1)])),interept_count:a((({row:e})=>[o(d(e.interept_count)+"/"+d(e.all_count),1)])),_:1},8,["data","columns","auth-btn"])}}},$e={class:"text-primary"},Me={class:"text-primary"},He={__name:"index",props:{rowData:Object,tableData:Object,searchQuery:String},emits:["showRule","edit"],setup(e,{emit:u}){const r=e,c=u,p=f(null),m=g({data:[],initColumn:[],initTitleData:[],initButton:[]}),{userDel:b}=te(),h=w((()=>m.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),D=w((()=>{let e=m.initColumn;for(let t of e){let{field:e}=t;switch(e){case"timestamp":case"ip_group":case"white":case"time_mode":case"interept_count":t.slots={default:e};break;case"id":t.slots={default:e},t.showOverflow="title",t.titlePrefix={content:"点击查看近一个月的规则触发数"}}}return{columns:e}}));C((async()=>{p.value.tableLoading=!0;const{columns:e,title_data:t,button:l}=await Z.setColumn({layer:4});m.initColumn=e.value||[],m.initTitleData=t.value||[],m.initButton=l.value||[],p.value&&(p.value.searchQuery=r.searchQuery,p.value.commitRequest(),p.value.tableLoading=!1)}));const S=()=>{p.value.commitRequest()},U=({row:e})=>{c("edit",r.rowData,e)},x=e=>{let t={cloud_type:"huawei",cloud_master_account_id:r.rowData.cloud_master_account_id,sid:r.rowData.id,rule_id:e.id,policy_id:r.rowData.cc_policy_id};b({sid:e.id,body:t,delApi:ie.del,loadData:S})};return j((()=>r.searchQuery),(e=>{p.value.searchQuery=e,p.value.commitRequest()})),(u,f)=>{const b=he,g=s,w=de;return t(),l(w,{ref_key:"tableRef",ref:p,data:e.tableData||[],columns:v(D).columns,"auth-btn":v(h),onRefresh:f[0]||(f[0]=e=>{v(ie).getDetail(r.rowData.id)}),onUserEdit:U,onUserDel:x},{top:a((()=>[])),id:a((({row:e})=>[i(b,{content:e.id,placement:"topLeft",onClick:t=>(e=>{c("showRule",e)})(e)},null,8,["content","onClick"])])),timestamp:a((({row:e})=>[o(d(new Date(e.timestamp).toLocaleString()),1)])),ip_group:a((({row:e})=>{var i;return[(null==(i=e.ip_group)?void 0:i.ips)?(t(),l(g,{key:0},{title:a((()=>[(t(!0),_(y,null,k(e.ip_group.ips.split(","),(e=>(t(),_("div",{key:e},d(e),1)))),128))])),default:a((()=>{var t;return[n("span",$e,d(null==(t=e.ip_group)?void 0:t.name),1)]})),_:2},1024)):(t(),l(g,{key:1},{title:a((()=>[(t(!0),_(y,null,k(e.addr.split(","),(e=>(t(),_("div",{key:e},d(e),1)))),128))])),default:a((()=>[n("span",Me,d(e.addr),1)])),_:2},1024))]})),white:a((({row:e})=>{var t,l;return[o(d((null==(l=null==(t=v(m).initTitleData)?void 0:t.white)?void 0:l[e.white])||e.white),1)]})),time_mode:a((({row:e})=>{var t,l;return[o(d((null==(l=null==(t=v(m).initTitleData)?void 0:t.time_mode)?void 0:l[e.time_mode])||e.time_mode),1)]})),interept_count:a((({row:e})=>[o(d(e.interept_count)+"/"+d(e.all_count),1)])),_:1},8,["data","columns","auth-btn"])}}},Ve={__name:"index",props:{rowData:{type:Object,default:()=>({})},tableData:Object,searchQuery:String},emits:["showRule","edit"],setup(e,{emit:n}){const u=e,r=n,s=f(null),c=g({data:[],initColumn:[],initButton:[],initTitleData:[]}),{userDel:p}=te(),m=w((()=>c.initButton.reduce(((e,t)=>(e[t.field]=t,e)),{}))),_=w((()=>{let e=c.initColumn;for(let t of e){let{field:e}=t;switch(e){case"interept_count":t.slots={default:e};break;case"ruleid":t.slots={default:e},t.showOverflow="title",t.titlePrefix={content:"点击查看近一个月的规则触发数"}}}return{columns:e}}));C((async()=>{s.value.tableLoading=!0;const{columns:e,title_data:t,button:l}=await Z.setColumn({layer:6});c.initColumn=e.value||[],c.initTitleData=t.value||[],c.initButton=l.value||[],s.value&&(s.value.searchQuery=u.searchQuery,s.value.commitRequest(),s.value.tableLoading=!1)}));const y=()=>{s.value.commitRequest()},k=({row:e})=>{r("edit",u.rowData,e)},b=e=>{let t={cloud_type:"aliyun",cloud_master_account_id:u.rowData.cloud_master_account_id,sid:u.rowData.id,rule_id:e.id,policy_id:u.rowData.cc_policy_id};p({sid:e.id,body:t,delApi:ie.del,loadData:y})};return j((()=>u.searchQuery),(e=>{s.value.searchQuery=e,s.value.commitRequest()})),(n,c)=>{const p=he,f=de;return t(),l(f,{ref_key:"tableRef",ref:s,data:e.tableData||[],columns:v(_).columns,"auth-btn":v(m),onRefresh:c[0]||(c[0]=e=>{v(ie).getDetail(u.rowData.id)}),onUserEdit:k,onUserDel:b},{top:a((()=>[])),ruleid:a((({row:e})=>[i(p,{content:e.ruleid,placement:"topLeft",onClick:t=>(e=>{r("showRule",e)})(e)},null,8,["content","onClick"])])),interept_count:a((({row:e})=>[o(d(e.interept_count)+"/"+d(e.all_count),1)])),_:1},8,["data","columns","auth-btn"])}}},Ge={key:1},Ke=["onClick"],Je={style:{color:"#999"}},Ze=R({__name:"conditionsForm",props:{editTitle:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>{}},conditions:{type:Array,default:()=>[]},rules:{type:Object,default:()=>{}}},emits:["update:conditions"],setup(e,{expose:u,emit:r}){const s=e,c=r,p=f([]),m=g({rules:[]}),h={all_index:"所有子字段",any_index:"任意子字段",custom:"自定义"},w=()=>{c("update:conditions",[...s.conditions,{ignore_case:!1}])};return j((()=>s.conditions),(e=>{e.forEach(((e,t)=>{var l,a;m.rules[t]=s.rules;let i=["params","cookie","header","ip","ipv6"].includes(e.category);e.index=i?e.index:"",m.rules[t].index[0].required=i;let o=!["any","all"].includes(null==(a=null==(l=e.logic_operation)?void 0:l.split("_"))?void 0:a.at(-1));e.contents=o?e.contents:"",m.rules[t].contents[0].required=o;let d=!["ip","ipv6"].includes(e.category);e.ignore_case=!!d&&e.ignore_case,m.rules[t].ignore_case[0].required=d}))}),{deep:!0}),u({validateForms:()=>Promise.all(p.value.map((e=>e.validateFields())))}),(u,r)=>{const f=ce,g=pe,S=fe,U=I,x=L,T=E,R=b;return t(),_(y,null,[(t(!0),_(y,null,k(e.conditions,((u,r)=>(t(),l(R,{key:r,ref_for:!0,ref:e=>{e&&(v(p)[r]=e)},layout:"inline",model:u,rules:v(m).rules[r],class:"form-box"},{default:a((()=>[(t(!0),_(y,null,k(e.editTitle.filter((e=>3===e.block)),(p=>(t(),l(T,{key:p.field,name:p.field},{default:a((()=>{var m,v;return[n("div",null,d(p.field_name),1),"category"===p.field?(t(),l(g,{key:0,value:u[p.field],"onUpdate:value":e=>u[p.field]=e,onChange:e=>((e,t)=>{let l=[...s.conditions];l[t].index="",c("update:conditions",l)})(0,r)},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[p.field],((e,i)=>(t(),l(f,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value","onChange"])):"ignore_case"===p.field?(t(),_(y,{key:1},[["ip","ipv6"].includes(u.category)?(t(),_("span",Ge,"--")):(t(),l(S,{key:0,checked:u[p.field],"onUpdate:checked":e=>u[p.field]=e},null,8,["checked","onUpdate:checked"]))],64)):"logic_operation"===p.field?(t(),l(g,{key:2,value:u[p.field],"onUpdate:value":e=>u[p.field]=e},{default:a((()=>{var i;return[(t(!0),_(y,null,k(null==(i=e.titleData[p.field])?void 0:i[u.category],((e,i)=>(t(),l(f,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))]})),_:2},1032,["value","onUpdate:value"])):"index"===p.field?(t(),_(y,{key:3},[["ip","ipv6"].includes(u.category)?(t(),l(g,{key:0,value:u[p.field],"onUpdate:value":e=>u[p.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[p.field],((e,i)=>(t(),l(f,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):(t(),_(y,{key:1},[i(g,{value:u[p.field],"onUpdate:value":e=>u[p.field]=e,disabled:"url"===u.category},{default:a((()=>[(t(),_(y,null,k(h,((e,t)=>i(f,{key:t,value:t},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["value","onUpdate:value","disabled"]),"custom"===u[p.field]?(t(),l(x,{key:0},{default:a((()=>[i(U,{value:u.customIndex,"onUpdate:value":e=>u.customIndex=e,style:{"margin-top":"5px"}},null,8,["value","onUpdate:value"])])),_:2},1024)):D("",!0)],64))],64)):"contents"===p.field?(t(),l(U,{key:4,value:u[p.field],"onUpdate:value":e=>u[p.field]=e,disabled:["all","any"].includes(null==(v=null==(m=u.logic_operation)?void 0:m.split("_"))?void 0:v.at(-1))},null,8,["value","onUpdate:value","disabled"])):(t(),l(U,{key:5,value:u[p.field],"onUpdate:value":e=>u[p.field]=e},null,8,["value","onUpdate:value"]))]})),_:2},1032,["name"])))),128)),n("span",{class:"del-btn",onClick:e=>(e=>{c("update:conditions",s.conditions.filter(((t,l)=>l!==e)))})(r)},"删除",8,Ke)])),_:2},1032,["model","rules"])))),128)),n("div",Je,[e.conditions.length<30?(t(),_("span",{key:0,class:"text-primary cursor-pointer mr-2",onClick:w},"添加条件")):D("",!0),n("span",null,"您还可以添加"+d(30-e.conditions.length)+"个条件。（多个条件同时成立才生效）",1)])],64)}}},[["__scopeId","data-v-7f2c75bf"]]),Xe={class:"template-info"},et=(e=>(A("data-v-4466c699"),e=e(),F(),e))((()=>n("div",{class:"mb-2 font-[500]"},"添加规则同样适用于以下所有域名：",-1))),tt={class:"flex items-center flex-wrap"},lt=R({__name:"hwTemplate",props:{rowData:{type:Object,default:()=>({})}},setup(e){const l=e,a=g({templateList:[],collapse:!0});return C((async()=>{const e=await oe.hwTemplate.getList(l.rowData.id);a.templateList=(null==e?void 0:e.data)||[]})),(e,l)=>(t(),_("div",Xe,[et,n("div",tt,[(t(!0),_(y,null,k(v(a).collapse?v(a).templateList.slice(0,4):v(a).templateList,(e=>(t(),_("div",{key:e.id,class:"w-[25%]"},d(e),1)))),128))]),n("div",{class:"text-primary cursor-pointer absolute right-5 bottom-2",onClick:l[0]||(l[0]=e=>v(a).collapse=!v(a).collapse)},d(v(a).collapse?"展开":"收起"),1)]))}},[["__scopeId","data-v-4466c699"]]),at={style:{color:"#999"}},it={style:{color:"#999"}},ot={class:"flex items-center"},dt={class:"flex items-center"},nt={class:"flex items-center"},ut=n("br",null,null,-1),rt={class:"mt-2"},st={__name:"editForm",props:{sid:{type:[String,Number],default:""},formType:{type:Number,default:c},rowData:{type:Object,default:()=>({})},editData:{type:Object,default:()=>({})}},emits:["editSuccess","editError"],setup(e,{expose:u,emit:r}){const s=e,{sid:c,formType:m}=p(s),S=r,{edit:U,add:x}=oe.cc,T=f(null),R=f(null),O=g({limit_num:0,limit_period:0,lock_page:{content_type:"application/json",content:""},tagIndexType:"",timeRange:[]}),j=w((()=>P.clone(s.editData,!0))),{formRenderContent:E,formDataLoading:A,confirmLoading:F,initForm:Q,formDataInit:B,editSubmit:N,formSubmit:W}=X({formRef:T,editTitleLayer:2,formType:m,sid:c,hasEditData:j,emits:S,addApi:x,editApi:U,customSubmitData:async function(e){e.cloud_type="huawei",e.cloud_master_account_id=s.rowData.cloud_master_account_id,e.sid=s.rowData.id,e.policy_id=s.rowData.cc_policy_id,e.mode=1,"user"===e.tag_type2?e.tag_type=O.tagIndexType:(e.tag_type=e.tag_type2,delete e.tag_index);delete e.tag_type2,e.limit_num=O.limit_num,e.limit_period=O.limit_period,e.action={category:e.action},["block","dynamic_block"].includes(e.action.category)?("dynamic_block"===e.action.category?delete e.lock_time:delete e.unlock_num,e.action.detail={response:{content_type:O.lock_page.content_type,content:O.lock_page.content}}):(delete e.lock_time,delete e.unlock_num,delete e.lock_page);"custom"===e.timestamp&&(e.start=O.timeRange[0]?new Date(O.timeRange[0]).getTime():void 0,e.terminal=O.timeRange[1]?new Date(O.timeRange[1]).getTime():void 0);return delete e.timestamp,delete e.limit_num_limit_period,E.value.title.filter((e=>3===e.block)).forEach((t=>{delete e[t.field]})),e},customEditData:function(e){var t,l;let a=e.value;return a.tag_type2=a.tag_type,a.tag_type=null==(t=Object.entries(z.value).find((([,e])=>e.map((e=>e.value)).includes(a.tag_type2))))?void 0:t[0],a.conditions.forEach((e=>{e.contents=e.contents[0]})),a.action=null==(l=a.action)?void 0:l.category,a},customSubmit:async function(e){try{await R.value[0].validateForms(),e.conditions.forEach((e=>{e.contents=[e.contents],"all_index"===e.index?(e.check_all_indexes_logic=1,delete e.index):"any_index"===e.index?(e.check_any_indexes_logic=2,delete e.index):"custom"===e.index&&(e.index=e.customIndex),delete e.customIndex})),await W(e)}catch(t){F.value=!1,S("editError",t)}}}),z=w((()=>E.value.title_data.tag_type)),Y=w((()=>{var e,t,l;if(!(null==(e=E.value)?void 0:e.title))return[];let a=null==(t=E.value)?void 0:t.title,i=null==(l=E.value)?void 0:l.formState;a.forEach((e=>{"unlock_num"===e.field&&(e.edit_display="dynamic_block"===i.action),"lock_time"===e.field&&(e.edit_display="block"===i.action),"lock_page"===e.field&&(e.edit_display=["block","dynamic_block"].includes(i.action)),"tag_index"===e.field&&(e.edit_display="user"===i.tag_type2)})),a=a.filter((e=>e.edit_display&&1===e.block));let o=a.findIndex((e=>"description"===e.field));if(-1!==o){let e=a.find((e=>"description"===e.field));a.splice(o,1),a.splice(1,0,e)}return a}));C((async()=>{await Q(),await B()}));const $=({target:e})=>{E.value.formState.tag_type2=z.value[e.value][0].value};return u({editSubmit:N,loading:F}),(u,r)=>{const s=ne,c=_e,p=me,f=ee,m=I,g=L,w=le,S=ve,U=q,x=ye,C=b,j=h;return t(),l(j,{spinning:v(A)},{default:a((()=>[i(C,{ref_key:"formRef",ref:T,model:v(E).formState,rules:v(E).rules},{default:a((()=>[i(lt,{"row-data":e.rowData},null,8,["row-data"]),i(s,{level:5},{default:a((()=>[o("配置防护规则")])),_:1}),(t(!0),_(y,null,k(v(Y),(e=>{var u,b,h,T,C,j,I,L,A,F,P,q,Q,B,N,W,Y,M,H,V,G,K;return t(),_(y,{key:e.field},["tag_type"===e.field?(t(),l(f,{key:0,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(b=null==(u=v(E))?void 0:u.title_data)?void 0:b[e.field]},{default:a((()=>[i(p,{value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,onChange:$},{default:a((()=>[(t(!0),_(y,null,k(v(z),((e,i)=>(t(),l(c,{key:i,value:i},{default:a((()=>[o(d(i),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"tag_type2"===e.field?(t(),l(f,{key:1,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(T=null==(h=v(E))?void 0:h.title_data)?void 0:T[e.field]},{default:a((()=>{var u,r;return[i(p,{value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t},{default:a((()=>[(t(!0),_(y,null,k(v(z)[v(E).formState.tag_type],((e,i)=>(t(),l(c,{key:i,value:e.value},{default:a((()=>[o(d(e.label),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"]),n("div",at,d(null==(r=null==(u=v(z)[v(E).formState.tag_type])?void 0:u.find((t=>t.value===v(E).formState[e.field])))?void 0:r.desc),1)]})),_:2},1032,["value","onUpdate:value","title","title-data"])):"tag_index"===e.field?(t(),l(f,{key:2,value:v(O).tagIndexType,"onUpdate:value":r[1]||(r[1]=e=>v(O).tagIndexType=e),title:e,"title-data":null==(j=null==(C=v(E))?void 0:C.title_data)?void 0:j[e.field]},{default:a((()=>{var u,s,f,b;return[i(p,{value:v(O).tagIndexType,"onUpdate:value":r[0]||(r[0]=e=>v(O).tagIndexType=e)},{default:a((()=>{var i,n;return[(t(!0),_(y,null,k(null==(n=null==(i=v(E))?void 0:i.title_data)?void 0:n[e.field],((e,i)=>(t(),l(c,{key:i,value:e.value},{default:a((()=>[o(d(e.label),1)])),_:2},1032,["value"])))),128))]})),_:2},1032,["value"]),i(g,null,{default:a((()=>[i(m,{value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,style:{width:"250px","margin-left":"10px"}},null,8,["value","onUpdate:value"])])),_:2},1024),n("div",it,d(null==(b=null==(f=null==(s=null==(u=v(E))?void 0:u.title_data)?void 0:s[e.field])?void 0:f.find((e=>e.value===v(O).tagIndexType)))?void 0:b.desc),1)]})),_:2},1032,["value","title","title-data"])):"conditions"===e.field?(t(),l(f,{key:3,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(L=null==(I=v(E))?void 0:I.title_data)?void 0:L[e.field]},{default:a((()=>{var t;return[i(Ze,{ref_for:!0,ref_key:"conditionsRef",ref:R,conditions:v(E).formState[e.field],"onUpdate:conditions":t=>v(E).formState[e.field]=t,"edit-title":v(E).title,"title-data":null==(t=v(E))?void 0:t.title_data,rules:v(E).rules},null,8,["conditions","onUpdate:conditions","edit-title","title-data","rules"])]})),_:2},1032,["value","onUpdate:value","title","title-data"])):"limit_num_limit_period"===e.field?(t(),l(f,{key:4,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(F=null==(A=v(E))?void 0:A.title_data)?void 0:F[e.field]},{default:a((()=>[n("div",ot,[i(w,{value:v(O).limit_num,"onUpdate:value":r[2]||(r[2]=e=>v(O).limit_num=e),min:0,style:{"margin-right":"10px"}},null,8,["value"]),o("次 "),i(g,null,{default:a((()=>[i(w,{value:v(O).limit_period,"onUpdate:value":r[3]||(r[3]=e=>v(O).limit_period=e),min:0,style:{margin:"0 10px"}},null,8,["value"]),o("秒 ")])),_:1})])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"action"===e.field?(t(),_(y,{key:5},[i(s,{level:5},{default:a((()=>[o("采取防护措施")])),_:1}),i(f,{title:e,"title-data":null==(q=null==(P=v(E))?void 0:P.title_data)?void 0:q[e.field]},{default:a((()=>{var t,l;return[i(p,{value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,options:null==(l=null==(t=v(E))?void 0:t.title_data)?void 0:l[e.field]},null,8,["value","onUpdate:value","options"])]})),_:2},1032,["title","title-data"])],64)):"lock_time"===e.field?(t(),l(f,{key:6,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(B=null==(Q=v(E))?void 0:Q.title_data)?void 0:B[e.field]},{default:a((()=>[n("div",dt,[i(w,{value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,min:0,style:{"margin-right":"10px"}},null,8,["value","onUpdate:value"]),o("秒 ")])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"unlock_num"===e.field?(t(),l(f,{key:7,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(W=null==(N=v(E))?void 0:N.title_data)?void 0:W[e.field]},{default:a((()=>[n("div",nt,[i(w,{value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,min:0,style:{"margin-right":"10px"}},null,8,["value","onUpdate:value"]),o("次 ")])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"lock_page"===e.field?(t(),l(f,{key:8,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(M=null==(Y=v(E))?void 0:Y.title_data)?void 0:M[e.field]},{default:a((()=>[i(p,{value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t},{default:a((()=>[i(S,{value:"默认设置"},{default:a((()=>[o("默认设置")])),_:1}),i(S,{value:"自定义"},{default:a((()=>[o("自定义")])),_:1})])),_:2},1032,["value","onUpdate:value"]),"自定义"===v(E).formState[e.field]?(t(),l(g,{key:0},{default:a((()=>[i(p,{value:v(O).lock_page.content_type,"onUpdate:value":r[4]||(r[4]=e=>v(O).lock_page.content_type=e),style:{margin:"10px 0",display:"block"}},{default:a((()=>[(t(),_(y,null,k(["application/json","text/html","text/xml"],(e=>i(c,{key:e,value:e},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"]),i(U,{value:v(O).lock_page.content,"onUpdate:value":r[5]||(r[5]=e=>v(O).lock_page.content=e)},null,8,["value"])])),_:1})):D("",!0)])),_:2},1032,["value","onUpdate:value","title","title-data"])):"timestamp"===e.field?(t(),l(f,{key:9,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(V=null==(H=v(E))?void 0:H.title_data)?void 0:V[e.field]},{default:a((()=>[i(p,{value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t},{default:a((()=>[i(c,{value:"立即生效"},{default:a((()=>[o("立即生效")])),_:1}),i(c,{value:"自定义"},{default:a((()=>[o("自定义")])),_:1})])),_:2},1032,["value","onUpdate:value"]),ut,"自定义"===v(E).formState[e.field]?(t(),l(g,{key:0},{default:a((()=>[n("div",rt,[i(x,{value:v(O).timeRange,"onUpdate:value":r[6]||(r[6]=e=>v(O).timeRange=e),"show-time":{format:"HH:mm:ss"},format:"YYYY-MM-DD HH:mm:ss"},null,8,["value"])])])),_:1})):D("",!0)])),_:2},1032,["value","onUpdate:value","title","title-data"])):(t(),l(f,{key:10,value:v(E).formState[e.field],"onUpdate:value":t=>v(E).formState[e.field]=t,title:e,"title-data":null==(K=null==(G=v(E))?void 0:G.title_data)?void 0:K[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])}}},ct=["onClick"],pt={style:{color:"#999"}},ft=R({__name:"conditionsForm",props:{editTitle:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>{}},conditions:{type:Array,default:()=>[]},rules:{type:Object,default:()=>{}}},emits:["update:conditions"],setup(e,{expose:i,emit:u}){const r=e,s=u,c=f([]),p=g({rules:[]}),m=w((()=>{if(!r.editTitle)return[];let e=r.editTitle;return e.forEach((e=>{"subKey"===e.field&&(e.edit_display=!1)})),e.filter((e=>e.edit_display&&2===e.block))})),h=()=>{s("update:conditions",[...r.conditions,{ignore_case:!1}])};return j((()=>r.conditions),(e=>{e.forEach(((e,t)=>{p.rules[t]=r.rules}))}),{deep:!0}),i({validateForms:()=>Promise.all(c.value.map((e=>e.validateFields())))}),(i,u)=>{const f=ce,g=pe,w=I,S=E,U=b;return t(),_(y,null,[(t(!0),_(y,null,k(e.conditions,((i,u)=>(t(),l(U,{key:u,ref_for:!0,ref:e=>{e&&(v(c)[u]=e)},layout:"inline",model:i,rules:v(p).rules[u],class:"form-box"},{default:a((()=>[(t(!0),_(y,null,k(v(m),(u=>(t(),l(S,{key:u.field,name:u.field},{default:a((()=>[n("div",null,d(u.field_name),1),"key"===u.field?(t(),l(g,{key:0,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[u.field],((e,i)=>(t(),l(f,{key:i,value:e},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):"opValue"===u.field?(t(),l(g,{key:1,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[u.field],((e,i)=>(t(),l(f,{key:i,value:e},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):(t(),l(w,{key:2,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},null,8,["value","onUpdate:value"]))])),_:2},1032,["name"])))),128)),n("span",{class:"del-btn",onClick:e=>(e=>{s("update:conditions",r.conditions.filter(((t,l)=>l!==e)))})(u)},"删除",8,ct)])),_:2},1032,["model","rules"])))),128)),n("div",pt,[e.conditions.length<5?(t(),_("span",{key:0,class:"text-primary cursor-pointer mr-2",onClick:h},"添加条件")):D("",!0),n("span",null,"您还可以添加"+d(5-e.conditions.length)+"个条件。（多个条件同时成立才生效）",1)])],64)}}},[["__scopeId","data-v-8c9c67d0"]]),mt=R({__name:"rateLimitForm",props:{editTitle:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>{}},rateLimit:{type:Array,default:()=>[]},rules:{type:Object,default:()=>{}}},setup(e,{expose:u}){const r=e,s=f([]),c=g({code:!1,count:!1,ratio:!1}),p=w((()=>{let e=r.editTitle,t=r.rateLimit[0];return e.forEach((e=>{"sub_key"===e.field&&(e.edit_display=["cookie","queryarg","header"].includes(t.target))})),e.filter((e=>e.edit_display&&3===e.block))})),m=e=>{var t;if(["effect","ttl"].includes(e))return 24;if(["code","ratio","count"].includes(e))return 8;return(null==(t=p.value.find((e=>"sub_key"===e.field)))?void 0:t.edit_display)?6:8};return u({validateForms:()=>Promise.all(s.value.map((e=>e.validateFields())))}),(u,r)=>{const f=ke,h=L,g=ce,w=pe,S=le,U=I,x=ve,T=me,R=E,C=Q,O=B,j=b;return t(!0),_(y,null,k(e.rateLimit,((u,r)=>(t(),l(j,{key:r,ref_for:!0,ref_key:"formRef",ref:s,model:u,rules:e.rules,class:"form-box"},{default:a((()=>[i(O,{gutter:24},{default:a((()=>[(t(!0),_(y,null,k(v(p),(r=>(t(),l(C,{key:r.field,span:m(r.field)},{default:a((()=>[i(R,{name:r.field},{default:a((()=>[n("div",null,[["code","count","ratio"].includes(r.field)?(t(),l(h,{key:0},{default:a((()=>[i(f,{checked:v(c)[r.field],"onUpdate:checked":e=>v(c)[r.field]=e,onChange:e=>{var t;"count"===(t=r.field)?c.ratio=!1:"ratio"===t&&(c.count=!1)}},null,8,["checked","onUpdate:checked","onChange"])])),_:2},1024)):D("",!0),o(" "+d(r.field_name),1)]),"target"===r.field?(t(),l(w,{key:0,value:u[r.field],"onUpdate:value":e=>u[r.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[r.field],((e,i)=>(t(),l(g,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):"interval"===r.field?(t(),l(S,{key:1,value:u[r.field],"onUpdate:value":e=>u[r.field]=e,min:5,max:1800},null,8,["value","onUpdate:value"])):"threshold"===r.field?(t(),l(S,{key:2,value:u[r.field],"onUpdate:value":e=>u[r.field]=e,min:0},null,8,["value","onUpdate:value"])):"code"===r.field?(t(),l(U,{key:3,value:u[r.field],"onUpdate:value":e=>u[r.field]=e,disabled:!v(c).code},null,8,["value","onUpdate:value","disabled"])):"count"===r.field?(t(),l(S,{key:4,value:u[r.field],"onUpdate:value":e=>u[r.field]=e,min:0,disabled:!v(c).count},null,8,["value","onUpdate:value","disabled"])):"ratio"===r.field?(t(),l(S,{key:5,value:u[r.field],"onUpdate:value":e=>u[r.field]=e,min:3,max:5e4,disabled:!v(c).ratio},null,8,["value","onUpdate:value","disabled"])):"effect"===r.field?(t(),l(T,{key:6,value:u[r.field],"onUpdate:value":e=>u[r.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[r.field],((e,i)=>(t(),l(x,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):"ttl"===r.field?(t(),l(S,{key:7,value:u[r.field],"onUpdate:value":e=>u[r.field]=e,min:60,max:86400,style:{width:"200px"}},null,8,["value","onUpdate:value"])):(t(),l(U,{key:8,value:u[r.field],"onUpdate:value":e=>u[r.field]=e},null,8,["value","onUpdate:value"]))])),_:2},1032,["name"])])),_:2},1032,["span"])))),128))])),_:2},1024)])),_:2},1032,["model","rules"])))),128)}}},[["__scopeId","data-v-0afe6c45"]]),vt={class:"flex items-center"},_t=(e=>(A("data-v-8f299218"),e=e(),F(),e))((()=>n("div",{class:"mb-2 text-sm",style:{color:"#999"}},[o(" 模板选择：用于将规则添加至某一模板内。若当前域名无对应模板，需要到 "),n("a",{href:"https://signin.aliyun.com/login.htm#/main",target:"_blank"},"阿里云"),o(" 新增模板。 ")],-1))),yt=["loading"],kt=R({__name:"aliTemplate",props:{templateId:{type:String,default:""},rowData:{type:Object,default:()=>({})},activeTab:{type:String,default:""}},emits:["update:templateId"],setup(e,{emit:l}){const a=e,o=l,u=g({templateInfo:null,templateLoading:!1}),r=w((()=>{var e,t,l;let i=JSON.parse((a.rowData.cc_policy_id||"{}").replace(/'/g,'"')),o=null==(t=null==(e=Bt[a.activeTab])?void 0:e["阿里云"])?void 0:t.key;return null==(l=null==i?void 0:i[`${o}_id`])?void 0:l.map((e=>{var t;return{label:`${e==a.templateId?`${null==(t=u.templateInfo)?void 0:t.resources}(${e})`:e}`,value:`${e}`}}))})),s=async e=>{var t;u.templateLoading=!0;const l=await oe.aliTemplate.getList(a.rowData.cloud_master_account_id,e);u.templateInfo=(null==(t=null==l?void 0:l.data)?void 0:t[e])||{},u.templateLoading=!1},c=async e=>{e&&o("update:templateId",e)};return j((()=>a.templateId),(e=>{e&&s(e)}),{immediate:!0}),(l,a)=>{var o;const p=pe,f=m("vxe-button");return t(),_(y,null,[n("div",vt,[i(p,{value:e.templateId,options:v(r),onChange:c},null,8,["value","options"]),i(f,{icon:"vxe-icon-repeat "+(v(u).templateLoading?"roll":""),circle:"",class:"ml-2",size:"small",onClick:a[0]||(a[0]=t=>s(e.templateId))},null,8,["icon"])]),_t,n("div",{class:"template-info",loading:v(u).templateLoading},[n("div",null,"已生效的域名："+d(null==(o=v(u).templateInfo)?void 0:o.resources),1)],8,yt)],64)}}},[["__scopeId","data-v-8f299218"]]),bt={__name:"editForm",props:{sid:{type:[String,Number],default:""},formType:{type:Number,default:c},editData:{type:Object,default:()=>({})},rowData:{type:Object,default:()=>({})},activeTab:{type:String,default:""}},emits:["editSuccess","editError"],setup(e,{expose:n,emit:u}){const r=e,{sid:s,formType:c}=p(r),m=u,{edit:S,add:U}=oe.cc,x=f(null),T=f(null),R=f(null),O=g({rateLimit:[{}]}),j=w((()=>{var e,t,l;if(!(null==(e=L.value)?void 0:e.title))return[];let a=null==(t=L.value)?void 0:t.title,i=null==(l=L.value)?void 0:l.formState;return(null==i?void 0:i.template_id)?a.filter((e=>e.edit_display&&1===e.block)):a.filter((e=>"template_id"===e.field))})),I=w((()=>P.clone(r.editData,!0))),{formRenderContent:L,formDataLoading:E,confirmLoading:A,initForm:F,formDataInit:q,editSubmit:Q,formSubmit:B}=X({formRef:x,editTitleLayer:5,formType:c,sid:s,hasEditData:I,emits:m,addApi:U,editApi:S,customSubmit:async function(e){var t,l,a,i;try{await(null==(l=null==(t=T.value)?void 0:t[0])?void 0:l.validateForms()),await(null==(i=null==(a=R.value)?void 0:a[0])?void 0:i.validateForms()),await B(e)}catch(o){A.value=!1,m("editError",o)}},customSubmitData:async function(e){if(e.cloud_type="aliyun",e.rule_id=String(r.editData.ruleid),e.cloud_master_account_id=r.rowData.cloud_master_account_id,e.sid=r.rowData.id,"1"===e.cc_status){L.value.title.filter((e=>3===e.block)).forEach((t=>{var l;e[t.field]=null==(l=O.rateLimit[0])?void 0:l[t.field]}))}else{L.value.title.filter((e=>3===e.block)).forEach((t=>{delete e[t.field]}))}return e},customEditData:function(e){let t=e.value;if(t.ttl||t.threshold||t.interval){t.cc_status="1",L.value.title.filter((e=>3===e.block)).forEach((e=>{O.rateLimit[0][e.field]=null==t?void 0:t[e.field]}))}return t}});return C((async()=>{await F(),await q()})),n({editSubmit:Q,loading:A}),(e,n)=>{const u=ee,s=_e,c=me,p=b,f=h;return t(),l(f,{spinning:v(E)},{default:a((()=>[i(p,{ref_key:"formRef",ref:x,model:v(L).formState,rules:v(L).rules},{default:a((()=>[(t(!0),_(y,null,k(v(j),(e=>{var p,f,m,b,h,g,w,S,U,x;return t(),_(y,{key:e.field},["template_id"===e.field?(t(),l(u,{key:0,value:v(L).formState[e.field],"onUpdate:value":t=>v(L).formState[e.field]=t,title:e,"title-data":null==(f=null==(p=v(L))?void 0:p.title_data)?void 0:f[e.field]},{default:a((()=>[i(kt,{"template-id":v(L).formState[e.field],"onUpdate:templateId":t=>v(L).formState[e.field]=t,"row-data":r.rowData,"active-tab":r.activeTab},null,8,["template-id","onUpdate:templateId","row-data","active-tab"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"conditions"===e.field?(t(),l(u,{key:1,value:v(L).formState[e.field],"onUpdate:value":t=>v(L).formState[e.field]=t,title:e,"title-data":null==(b=null==(m=v(L))?void 0:m.title_data)?void 0:b[e.field]},{default:a((()=>{var t;return[i(ft,{ref_for:!0,ref_key:"conditionsRef",ref:T,conditions:v(L).formState[e.field],"onUpdate:conditions":t=>v(L).formState[e.field]=t,"edit-title":v(L).title,"title-data":null==(t=v(L))?void 0:t.title_data,rules:v(L).rules},null,8,["conditions","onUpdate:conditions","edit-title","title-data","rules"])]})),_:2},1032,["value","onUpdate:value","title","title-data"])):"cc_status"===e.field?(t(),l(u,{key:2,value:v(L).formState[e.field],"onUpdate:value":t=>v(L).formState[e.field]=t,title:e,"title-data":null==(g=null==(h=v(L))?void 0:h.title_data)?void 0:g[e.field]},{default:a((()=>{var u;return[i(c,{value:v(L).formState[e.field],"onUpdate:value":t=>v(L).formState[e.field]=t},{default:a((()=>[(t(!0),_(y,null,k(v(L).title_data[e.field],((e,i)=>(t(),l(s,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"]),"1"===v(L).formState[e.field]?(t(),l(mt,{key:0,ref_for:!0,ref_key:"rateLimitRef",ref:R,"rate-limit":v(O).rateLimit,"onUpdate:rateLimit":n[0]||(n[0]=e=>v(O).rateLimit=e),"edit-title":v(L).title,"title-data":null==(u=v(L))?void 0:u.title_data,rules:v(L).rules},null,8,["rate-limit","edit-title","title-data","rules"])):D("",!0)]})),_:2},1032,["value","onUpdate:value","title","title-data"])):"timestamp"===e.field?(t(),l(u,{key:3,value:v(L).formState[e.field],"onUpdate:value":t=>v(L).formState[e.field]=t,title:e,"title-data":null==(S=null==(w=v(L))?void 0:w.title_data)?void 0:S[e.field]},{default:a((()=>[i(c,{value:v(L).formState[e.field],"onUpdate:value":t=>v(L).formState[e.field]=t},{default:a((()=>[i(s,{value:"立即生效"},{default:a((()=>[o("永久生效")])),_:1}),i(s,{value:"自定义",disabled:!0},{default:a((()=>[o("自定义")])),_:1})])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):(t(),l(u,{key:4,value:v(L).formState[e.field],"onUpdate:value":t=>v(L).formState[e.field]=t,title:e,"title-data":null==(x=null==(U=v(L))?void 0:U.title_data)?void 0:x[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])}}},ht={key:1},gt=["onClick"],wt={style:{color:"#999"}},Dt=R({__name:"conditionsForm",props:{editTitle:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>{}},conditions:{type:Array,default:()=>[]},rules:{type:Object,default:()=>{}}},emits:["update:conditions"],setup(e,{expose:i,emit:u}){const r=e,s=u,c=f([]),p=g({rules:[]}),m=()=>{s("update:conditions",[...r.conditions,{ignore_case:!1}])},h=(e,t)=>!("index_type"===e.field&&!["params","cookie","header"].includes(t.category))&&!("index"===e.field&&!["params","cookie","header"].includes(t.category)&&"custom"!==t.index_type);return j((()=>r.conditions),(e=>{e.forEach(((e,t)=>{var l,a;p.rules[t]=r.rules;let i=["params","cookie","header"].includes(e.category);e.index_type=i?e.index_type:"",p.rules[t].index_type[0].required=i;let o=i&&"custom"===e.index_type;e.index=o?e.index:"",p.rules[t].index[0].required=o;let d=!["any","all"].includes(null==(a=null==(l=e.logic_operation)?void 0:l.split("_"))?void 0:a.at(-1));e.contents=d?e.contents:"",p.rules[t].contents[0].required=d}))}),{deep:!0}),i({validateForms:()=>Promise.all(c.value.map((e=>e.validateFields())))}),(i,u)=>{const f=ce,g=pe,w=fe,S=I,U=E,x=b;return t(),_(y,null,[(t(!0),_(y,null,k(e.conditions,((i,u)=>(t(),l(x,{key:u,ref_for:!0,ref:e=>{e&&(v(c)[u]=e)},layout:"inline",model:i,rules:v(p).rules[u],class:"form-box"},{default:a((()=>[(t(!0),_(y,null,k(e.editTitle.filter((e=>2===e.block)),(u=>(t(),_(y,{key:u.field},[h(u,i)?(t(),l(U,{key:0,name:u.field},{default:a((()=>{var r,s;return[n("div",null,d(u.field_name),1),"category"===u.field?(t(),l(g,{key:0,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[u.field],((e,i)=>(t(),l(f,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):"ignore_case"===u.field?(t(),_(y,{key:1},[["ip","ipv6"].includes(i.category)?(t(),_("span",ht,"--")):(t(),l(w,{key:0,checked:i[u.field],"onUpdate:checked":e=>i[u.field]=e},null,8,["checked","onUpdate:checked"]))],64)):"logic_operation"===u.field?(t(),l(g,{key:2,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},{default:a((()=>{var n;return[(t(!0),_(y,null,k(null==(n=e.titleData[u.field])?void 0:n[i.category],((e,i)=>(t(),l(f,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))]})),_:2},1032,["value","onUpdate:value"])):"index_type"===u.field?(t(),l(g,{key:3,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[u.field],((e,i)=>(t(),l(f,{key:i,value:i},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):"index"===u.field?(t(),l(S,{key:4,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},null,8,["value","onUpdate:value"])):"contents"===u.field?(t(),l(S,{key:5,value:i[u.field],"onUpdate:value":e=>i[u.field]=e,disabled:["all","any"].includes(null==(s=null==(r=i.logic_operation)?void 0:r.split("_"))?void 0:s.at(-1))},null,8,["value","onUpdate:value","disabled"])):(t(),l(S,{key:6,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},null,8,["value","onUpdate:value"]))]})),_:2},1032,["name"])):D("",!0)],64)))),128)),n("span",{class:"del-btn",onClick:e=>(e=>{s("update:conditions",r.conditions.filter(((t,l)=>l!==e)))})(u)},"删除",8,gt)])),_:2},1032,["model","rules"])))),128)),n("div",wt,[e.conditions.length<30?(t(),_("span",{key:0,class:"text-primary cursor-pointer mr-2",onClick:m},"添加条件")):D("",!0),n("span",null,"您还可以添加"+d(30-e.conditions.length)+"个条件。（多个条件同时成立才生效）",1)])],64)}}},[["__scopeId","data-v-5c310f9f"]]),St={class:"log-path-input"},Ut=["onClick"],xt={style:{color:"#999","margin-top":"10px"}},Tt={class:"flex items-center gap-2 mt-2"},Rt=R({__name:"editForm",props:{sid:{type:[String,Number],default:""},formType:{type:Number,default:c},editData:{type:Object,default:()=>({})},rowData:{type:Object,default:()=>({})}},emits:["editSuccess","editError"],setup(e,{expose:u,emit:r}){const s=e,{sid:c,formType:m}=p(s),g=r,{add:S,edit:U}=oe.ignore,x=f(null),R=f([]),O=[{label:"Body",value:"body"},{label:"Cookie",value:"cookie"},{label:"Header",value:"header"},{label:"Params",value:"params"},{label:"Multipart",value:"multipart"}],E=[{label:"全部",value:"all"},{label:"自定义",value:"custom"}],A=f({index:"",filedType:"",filedValue:""}),F=w((()=>P.clone(s.editData,!0))),{formRenderContent:q,formDataLoading:Q,confirmLoading:B,initForm:z,formDataInit:Y,editSubmit:$,formSubmit:M}=X({formRef:x,editTitleLayer:3,formType:m,sid:c,hasEditData:F,emits:g,addApi:S,editApi:U,customSubmit:async function(e){let t=P.clone(e,!0);try{await Promise.all(R.value.map((e=>e.validateForms()))).then((()=>{t.conditions.forEach((e=>{e.forEach((e=>{e.contents=[e.contents],delete e.index_type}))})),M(t)}))}catch(l){B.value=!1,g("editError",l)}},customSubmitData:async function(e){e.cloud_type="huawei",e.cloud_master_account_id=s.rowData.cloud_master_account_id,e.sid=s.rowData.id,e.policy_id=s.rowData.cc_policy_id,e.rule_id=s.editData.id,e.domain=e.domain.filter((e=>e)),"所有检测模块"===e.not_check_module?e.rule="bypass":"Web基础防护模块"===e.not_check_module&&"按类别"===e.not_check_mode?e.rule=e.not_check_type.join(";"):"Web基础防护模块"===e.not_check_module&&"按ID"===e.not_check_mode?e.rule=e.not_check_id.join(";"):"Web基础防护模块"===e.not_check_module&&"所有内置规则"===e.not_check_mode?e.rule="all":"非法请求"===e.not_check_module&&(e.rule="illegal");"Web基础防护模块"===e.not_check_module?e.advanced={index:A.index,contents:A.filedValue}:delete e.advanced;return delete e.not_check_module,delete e.not_check_mode,delete e.not_check_type,delete e.not_check_id,e},customEditData:function(e){let t=e.value,l=q.value.title_data;t.domain&&(t.protect_type="指定域名");l.not_check_type[s.editData.rule]&&(t.not_check_module="Web基础防护模块",t.not_check_mode="按类别",t.not_check_type=s.editData.rule.split(";"),t.advanced=l.advanced);return t.conditions=V(t.conditions),t.conditions.forEach((e=>{e.forEach((e=>{e.contents=e.contents[0]}))})),t}}),H=w((()=>{var e;if(!(null==(e=q.value)?void 0:e.title))return[];let t=q.value.title,l=q.value.formState;return t.forEach((e=>{"domain"===e.field&&(e.edit_display="指定域名"===l.protect_type),"not_check_mode"===e.field&&(e.edit_display="Web基础防护模块"===l.not_check_module),"not_check_type"===e.field&&(e.edit_display="Web基础防护模块"===l.not_check_module&&"按类别"===l.not_check_mode),"not_check_id"===e.field&&(e.edit_display="Web基础防护模块"===l.not_check_module&&"按ID"===l.not_check_mode),"advanced"===e.field&&(e.edit_display="Web基础防护模块"===l.not_check_module)})),t=t.filter((e=>e.edit_display&&1===e.block)),t})),V=e=>Array.isArray(e)?0===e.length?[[]]:Array.isArray(e[0])?e:[e]:[[]];const G=({target:e})=>{"指定域名"===e.value&&(q.value.formState.domain=[""])},K=()=>{q.value.formState.conditions.push([{}])},J=e=>{["body","multipart"].includes(e)&&(A.value.filedType="all")};return j((()=>{var e;return null==(e=q.value.formState)?void 0:e.not_check_type}),(e=>{e.includes("all")&&e.length>1&&(q.value.formState.not_check_type=["all"])})),C((async()=>{await z(),await Y()})),u({editSubmit:$,loading:B}),(u,r)=>{const s=_e,c=me,p=ee,f=I,m=L,g=T,w=ve,S=fe,U=pe,C=b,j=h;return t(),l(j,{spinning:v(Q)},{default:a((()=>[i(C,{ref_key:"formRef",ref:x,model:v(q).formState,rules:v(q).rules},{default:a((()=>[i(lt,{"row-data":e.rowData},null,8,["row-data"]),(t(!0),_(y,null,k(v(H),(e=>{var u,b,h,x,T,C,j,I,L,F,P,Q,B,z;return t(),_(y,{key:e.field},["protect_type"===e.field?(t(),l(p,{key:0,value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t,title:e,"title-data":null==(b=null==(u=v(q))?void 0:u.title_data)?void 0:b[e.field]},{default:a((()=>[i(c,{value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t,onChange:G},{default:a((()=>[(t(),_(y,null,k(["全部域名","指定域名"],(e=>i(s,{key:e,value:e},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"domain"===e.field?(t(),l(p,{key:1,value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t,title:e,"title-data":null==(x=null==(h=v(q))?void 0:h.title_data)?void 0:x[e.field]},{default:a((()=>[(t(!0),_(y,null,k(v(q).formState[e.field],((o,d)=>(t(),l(m,{key:d},{default:a((()=>[n("div",St,[i(f,{value:v(q).formState[e.field][d],"onUpdate:value":t=>v(q).formState[e.field][d]=t},null,8,["value","onUpdate:value"]),i(v(N),{onClick:e=>{q.value.formState.domain.push("")}},null,8,["onClick"]),v(q).formState[e.field].length>1?(t(),l(v(W),{key:0,onClick:e=>(e=>{q.value.formState.domain.splice(e,1)})(d)},null,8,["onClick"])):D("",!0)])])),_:2},1024)))),128))])),_:2},1032,["value","onUpdate:value","title","title-data"])):"conditions"===e.field?(t(),l(p,{key:2,value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t,title:e,"title-data":null==(C=null==(T=v(q))?void 0:T.title_data)?void 0:C[e.field]},{default:a((()=>[(t(!0),_(y,null,k(v(q).formState[e.field],((d,n)=>(t(),l(g,{key:n,class:"conditions-card"},{default:a((()=>{var l;return[v(q).formState[e.field].length>0?(t(),_("span",{key:0,class:"text-warning conditions-delete",onClick:e=>(e=>{q.value.formState.conditions.splice(e,1)})(n)},[i(v(W)),o(" 删除 ")],8,Ut)):D("",!0),i(Dt,{ref_for:!0,ref:e=>{e&&(v(R)[n]=e)},conditions:v(q).formState[e.field][n],"onUpdate:conditions":t=>v(q).formState[e.field][n]=t,"edit-title":v(q).title,"title-data":null==(l=v(q))?void 0:l.title_data,rules:v(q).rules},null,8,["conditions","onUpdate:conditions","edit-title","title-data","rules"])]})),_:2},1024)))),128)),n("div",xt,[v(q).formState[e.field].length<3?(t(),_("span",{key:0,class:"text-primary cursor-pointer mr-2",onClick:K},"添加")):D("",!0),n("span",null,"您还可以添加"+d(3-v(q).formState[e.field].length)+"组“或”条件",1)])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"not_check_module"===e.field?(t(),l(p,{key:3,value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t,title:e,"title-data":null==(I=null==(j=v(q))?void 0:j.title_data)?void 0:I[e.field]},{default:a((()=>[i(c,{value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t},{default:a((()=>[(t(!0),_(y,null,k(v(q).title_data[e.field],(e=>(t(),l(w,{key:e,value:e},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"not_check_mode"===e.field?(t(),l(p,{key:4,value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t,title:e,"title-data":null==(F=null==(L=v(q))?void 0:L.title_data)?void 0:F[e.field]},{default:a((()=>[i(c,{value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t},{default:a((()=>[(t(!0),_(y,null,k(v(q).title_data[e.field],(e=>(t(),l(w,{key:e,value:e},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"advanced"===e.field?(t(),l(p,{key:5,value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t,title:e,"title-data":null==(Q=null==(P=v(q))?void 0:P.title_data)?void 0:Q[e.field]},{default:a((()=>[i(S,{checked:v(q).formState[e.field],"onUpdate:checked":t=>v(q).formState[e.field]=t},null,8,["checked","onUpdate:checked"]),v(q).formState[e.field]?(t(),l(m,{key:0},{default:a((()=>[n("div",Tt,[i(U,{value:v(A).index,"onUpdate:value":r[0]||(r[0]=e=>v(A).index=e),options:O,onChange:J},null,8,["value"]),i(U,{value:v(A).filedType,"onUpdate:value":r[1]||(r[1]=e=>v(A).filedType=e),options:E,disabled:["body","multipart"].includes(v(A).index)},null,8,["value","disabled"]),"custom"===v(A).filedType?(t(),l(f,{key:0,value:v(A).filedValue,"onUpdate:value":r[2]||(r[2]=e=>v(A).filedValue=e)},null,8,["value"])):D("",!0)])])),_:1})):D("",!0)])),_:2},1032,["value","onUpdate:value","title","title-data"])):(t(),l(p,{key:6,value:v(q).formState[e.field],"onUpdate:value":t=>v(q).formState[e.field]=t,title:e,"title-data":null==(z=null==(B=v(q))?void 0:B.title_data)?void 0:z[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])}}},[["__scopeId","data-v-8e4e42d2"]]),Ct=["onClick"],Ot={style:{color:"#999"}},jt=R({__name:"conditionsForm",props:{editTitle:{type:Array,default:()=>[]},titleData:{type:Object,default:()=>{}},conditions:{type:Array,default:()=>[]},rules:{type:Object,default:()=>{}}},emits:["update:conditions"],setup(e,{expose:i,emit:u}){const r=e,s=u,c=f([]),p=g({rules:[]}),m=w((()=>{if(!r.editTitle)return[];let e=r.editTitle;return e.forEach((e=>{"subKey"===e.field&&(e.edit_display=!1)})),e.filter((e=>e.edit_display&&2===e.block))})),h=()=>{s("update:conditions",[...r.conditions,{ignore_case:!1}])};return j((()=>r.conditions),(e=>{e.forEach(((e,t)=>{p.rules[t]=r.rules}))}),{deep:!0}),i({validateForms:()=>Promise.all(c.value.map((e=>e.validateFields())))}),(i,u)=>{const f=ce,g=pe,w=I,S=E,U=b;return t(),_(y,null,[(t(!0),_(y,null,k(e.conditions,((i,u)=>(t(),l(U,{key:u,ref_for:!0,ref:e=>{e&&(v(c)[u]=e)},layout:"inline",model:i,rules:v(p).rules[u],class:"form-box"},{default:a((()=>[(t(!0),_(y,null,k(v(m),(u=>(t(),l(S,{key:u.field,name:u.field},{default:a((()=>[n("div",null,d(u.field_name),1),"key"===u.field?(t(),l(g,{key:0,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[u.field],((e,i)=>(t(),l(f,{key:i,value:e},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):"opValue"===u.field?(t(),l(g,{key:1,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},{default:a((()=>[(t(!0),_(y,null,k(e.titleData[u.field],((e,i)=>(t(),l(f,{key:i,value:e},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):(t(),l(w,{key:2,value:i[u.field],"onUpdate:value":e=>i[u.field]=e},null,8,["value","onUpdate:value"]))])),_:2},1032,["name"])))),128)),n("span",{class:"del-btn",onClick:e=>(e=>{s("update:conditions",r.conditions.filter(((t,l)=>l!==e)))})(u)},"删除",8,Ct)])),_:2},1032,["model","rules"])))),128)),n("div",Ot,[e.conditions.length<5?(t(),_("span",{key:0,class:"text-primary cursor-pointer mr-2",onClick:h},"添加条件")):D("",!0),n("span",null,"您还可以添加"+d(5-e.conditions.length)+"个条件。（多个条件同时成立才生效）",1)])],64)}}},[["__scopeId","data-v-b434116e"]]),It={class:"web-core-checkbox"},Lt={class:"mt-5 web-core-radio"},Et=(e=>(A("data-v-026f2db0"),e=e(),F(),e))((()=>n("div",{class:"font-[600]"},"Web核心防护规则",-1))),At={key:1},Ft=R({__name:"editForm",props:{sid:{type:[String,Number],default:""},formType:{type:Number,default:c},editData:{type:Object,default:()=>({})},rowData:{type:Object,default:()=>({})},activeTab:{type:String,default:""}},emits:["editSuccess","editError"],setup(e,{expose:d,emit:u}){const r=e,{sid:s,formType:c}=p(r),m=u,{add:S,edit:U}=oe.ignore,x=f(null),T=f(null),R=[{value:"sqli",label:"SQL 注入"},{value:"xss",label:"跨站脚本"},{value:"code_exec",label:"代码执行"},{value:"crlf",label:"CRLF"},{value:"lfilei",label:"本地文件包含"},{value:"rfilei",label:"远程文件包含"},{value:"webshell",label:"WebShell"},{value:"csrf",label:"CSRF"},{value:"other",label:"其他"}],O=g({checkAll:!1,type:"all",regularRules:"",regularTypes:[]}),j=w((()=>{var e,t,l,a,i,o;let d=null==(l=Object.entries(null==(t=null==(e=A.value)?void 0:e.title_data)?void 0:t.target))?void 0:l.map((([e,t])=>{var l,a,i;return{label:t,value:e,disabled:null==(i=null==(a=null==(l=A.value)?void 0:l.formState)?void 0:a.target)?void 0:i.includes("all")}}));return[{label:"全部",value:"all"},{label:"Web核心防护规则",value:"web_core",disabled:null==(o=null==(i=null==(a=A.value)?void 0:a.formState)?void 0:i.target)?void 0:o.includes("all")},...d]})),I=w((()=>R.map((e=>({label:e.label,value:e.value}))))),E=w((()=>P.clone(r.editData,!0))),{formRenderContent:A,formDataLoading:F,confirmLoading:Q,initForm:B,formDataInit:N,editSubmit:W,formSubmit:z}=X({formRef:x,editTitleLayer:7,formType:c,sid:s,hasEditData:E,emits:m,customSubmit:async function(e){try{await T.value[0].validateForms(),await z(e)}catch(t){Q.value=!1,m("editError",t)}},addApi:S,editApi:U,customSubmitData:async function(e){var t;e.cloud_type="aliyun",e.rule_id=String(r.editData.ruleid),e.cloud_master_account_id=r.rowData.cloud_master_account_id,e.sid=r.rowData.id,e.status="1",e.template_id=String(e.template_id),e.tags=e.target,delete e.target,(null==(t=e.tags)?void 0:t.includes("web_core"))&&("ruleId"===O.type?e.regularRules=O.regularRules.split(","):"ruleType"===O.type&&(e.regularTypes=O.regularTypes));return e},customEditData:function(e){let t=e.value;t.target.includes("web_core")&&(O.type=t.regularRules?"ruleId":t.regularTypes?"ruleType":"all",O.regularRules=t.regularRules.join(","),O.regularTypes=t.regularTypes);return t.template_id=String(t.template_id),t}}),Y=w((()=>{var e,t,l;if(!(null==(e=A.value)?void 0:e.title))return[];let a=null==(t=A.value)?void 0:t.title,i=null==(l=A.value)?void 0:l.formState;return(null==i?void 0:i.template_id)?a.filter((e=>e.edit_display&&1===e.block)):a.filter((e=>"template_id"===e.field))}));const $=e=>{e.includes("all")&&(A.value.formState.target=["all"])},M=()=>{O.checkAll?O.regularTypes=[...R.map((e=>e.value))]:O.regularTypes=[]},H=e=>{O.checkAll=e.length===R.length};return C((async()=>{await B(),await N()})),d({editSubmit:W,loading:Q}),(e,d)=>{const u=ee,s=be,c=ve,p=me,f=q,m=ke,g=L,w=b,S=h;return t(),l(S,{spinning:v(F)},{default:a((()=>[i(w,{ref_key:"formRef",ref:x,model:v(A).formState,rules:v(A).rules},{default:a((()=>[(t(!0),_(y,null,k(v(Y),(e=>{var k,b,h,w,S,U,x,R;return t(),_(y,{key:e.field},["template_id"===e.field?(t(),l(u,{key:0,value:v(A).formState[e.field],"onUpdate:value":t=>v(A).formState[e.field]=t,title:e,"title-data":null==(b=null==(k=v(A))?void 0:k.title_data)?void 0:b[e.field]},{default:a((()=>[i(kt,{"template-id":v(A).formState[e.field],"onUpdate:templateId":t=>v(A).formState[e.field]=t,"row-data":r.rowData,"active-tab":r.activeTab},null,8,["template-id","onUpdate:templateId","row-data","active-tab"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"target"===e.field?(t(),l(u,{key:1,value:v(A).formState[e.field],"onUpdate:value":t=>v(A).formState[e.field]=t,title:e,"title-data":null==(w=null==(h=v(A))?void 0:h.title_data)?void 0:w[e.field]},{default:a((()=>[n("div",It,[i(s,{value:v(A).formState[e.field],"onUpdate:value":t=>v(A).formState[e.field]=t,options:v(j),onChange:$},null,8,["value","onUpdate:value","options"])]),v(A).formState[e.field].includes("web_core")?(t(),l(g,{key:0},{default:a((()=>[n("div",Lt,[Et,i(p,{value:v(O).type,"onUpdate:value":d[0]||(d[0]=e=>v(O).type=e)},{default:a((()=>[i(c,{value:"all"},{default:a((()=>[o("全部规则")])),_:1}),i(c,{value:"ruleId"},{default:a((()=>[o("特定规则ID")])),_:1}),i(c,{value:"ruleType"},{default:a((()=>[o("特定规则类型")])),_:1})])),_:1},8,["value"])]),"ruleId"===v(O).type?(t(),l(f,{key:0,value:v(O).regularRules,"onUpdate:value":d[1]||(d[1]=e=>v(O).regularRules=e),placeholder:"最多可以输入50个，以英文逗号分隔",rows:4},null,8,["value"])):D("",!0),"ruleType"===v(O).type?(t(),_("div",At,[i(m,{checked:v(O).checkAll,"onUpdate:checked":d[2]||(d[2]=e=>v(O).checkAll=e),onChange:M},{default:a((()=>[o("全部")])),_:1},8,["checked"]),i(s,{value:v(O).regularTypes,"onUpdate:value":d[3]||(d[3]=e=>v(O).regularTypes=e),options:v(I),onChange:H},null,8,["value","options"])])):D("",!0)])),_:1})):D("",!0)])),_:2},1032,["value","onUpdate:value","title","title-data"])):"conditions"===e.field?(t(),l(u,{key:2,value:v(A).formState[e.field],"onUpdate:value":t=>v(A).formState[e.field]=t,title:e,"title-data":null==(U=null==(S=v(A))?void 0:S.title_data)?void 0:U[e.field]},{default:a((()=>{var t;return[i(jt,{ref_for:!0,ref_key:"conditionsRef",ref:T,conditions:v(A).formState[e.field],"onUpdate:conditions":t=>v(A).formState[e.field]=t,"edit-title":v(A).title,"title-data":null==(t=v(A))?void 0:t.title_data,rules:v(A).rules},null,8,["conditions","onUpdate:conditions","edit-title","title-data","rules"])]})),_:2},1032,["value","onUpdate:value","title","title-data"])):(t(),l(u,{key:3,value:v(A).formState[e.field],"onUpdate:value":t=>v(A).formState[e.field]=t,title:e,"title-data":null==(R=null==(x=v(A))?void 0:x.title_data)?void 0:R[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])}}},[["__scopeId","data-v-026f2db0"]]),Pt={class:"mt-2"},qt={__name:"editForm",props:{sid:{type:[String,Number],default:""},formType:{type:Number,default:c},editData:{type:Object,default:()=>({})},rowData:{type:Object,default:()=>({})},activeTab:{type:String,default:""}},emits:["editSuccess","editError"],setup(e,{expose:u,emit:r}){const s=e,{sid:c,formType:m}=p(s),S=r,{add:U,edit:x,getAddrList:T}=oe.whiteBlackIp,R=f(null),O=g({addrOptions:[],timeRange:[]}),j=w((()=>P.clone(s.editData,!0))),{formRenderContent:I,formDataLoading:E,confirmLoading:A,initForm:F,formDataInit:q,editSubmit:Q}=X({formRef:R,editTitleLayer:4,formType:m,sid:c,hasEditData:j,emits:S,addApi:U,editApi:x,customSubmitData:async function(e){e.cloud_type="huawei",e.cloud_master_account_id=s.rowData.cloud_master_account_id,e.sid=s.rowData.id,e.policy_id=s.rowData.cc_policy_id,e.rule_id=s.editData.id,"ip_group_id"===e.ip_group&&delete e.addr;"addr"===e.ip_group&&delete e.ip_group_id;delete e.ip_group,"custom"===e.time_mode&&(e.start=O.timeRange[0]?new Date(O.timeRange[0]).getTime():void 0,e.terminal=O.timeRange[1]?new Date(O.timeRange[1]).getTime():void 0);return e},customEditData:function(e){var t;let l=e.value;l.ip_group&&(l.ip_group_id=null==(t=l.ip_group)?void 0:t.id,l.ip_group="ip_group_id");l.addr&&(l.ip_group="addr");return l}}),B=w((()=>{var e,t,l;if(!(null==(e=I.value)?void 0:e.title))return[];let a=null==(t=I.value)?void 0:t.title,i=null==(l=I.value)?void 0:l.formState;return a.forEach((e=>{"ip_group_id"===e.field&&(e.edit_display="ip_group_id"===i.ip_group),"addr"===e.field&&(e.edit_display="addr"===i.ip_group)})),a=a.filter((e=>e.edit_display&&1===e.block)),a}));return C((async()=>{await F(),await q(),await(async()=>{const e=await T(s.rowData.cloud_master_account_id,s.rowData.id);O.addrOptions=e.data.map((e=>({label:e.name,value:e.ip_group_id})))})()})),u({editSubmit:Q,loading:A}),(u,r)=>{const s=_e,c=me,p=ee,f=pe,m=ye,g=L,w=b,S=h;return t(),l(S,{spinning:v(E)},{default:a((()=>[i(w,{ref_key:"formRef",ref:R,model:v(I).formState,rules:v(I).rules},{default:a((()=>[i(lt,{"row-data":e.rowData},null,8,["row-data"]),(t(!0),_(y,null,k(v(B),(e=>{var u,b,h,w,S,U,x,T;return t(),_(y,{key:e.field},["ip_group"===e.field?(t(),l(p,{key:0,value:v(I).formState[e.field],"onUpdate:value":t=>v(I).formState[e.field]=t,title:e,"title-data":null==(b=null==(u=v(I))?void 0:u.title_data)?void 0:b[e.field]},{default:a((()=>[i(c,{value:v(I).formState[e.field],"onUpdate:value":t=>v(I).formState[e.field]=t},{default:a((()=>[(t(),_(y,null,k({ip_group_id:"IP/IP段",addr:"地址组"},((e,t)=>i(s,{key:t,value:t},{default:a((()=>[o(d(e),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["value","onUpdate:value"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"addr"===e.field?(t(),l(p,{key:1,value:v(I).formState[e.field],"onUpdate:value":t=>v(I).formState[e.field]=t,title:e,"title-data":null==(w=null==(h=v(I))?void 0:h.title_data)?void 0:w[e.field]},{default:a((()=>[i(f,{value:v(I).formState[e.field],"onUpdate:value":t=>v(I).formState[e.field]=t,options:v(O).addrOptions},null,8,["value","onUpdate:value","options"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"time_mode"===e.field?(t(),l(p,{key:2,value:v(I).formState[e.field],"onUpdate:value":t=>v(I).formState[e.field]=t,title:e,"title-data":null==(U=null==(S=v(I))?void 0:S.title_data)?void 0:U[e.field]},{default:a((()=>[i(c,{value:v(I).formState[e.field],"onUpdate:value":t=>v(I).formState[e.field]=t},{default:a((()=>[i(s,{value:"permanent"},{default:a((()=>[o("立即生效")])),_:1}),i(s,{value:"custom"},{default:a((()=>[o("自定义")])),_:1})])),_:2},1032,["value","onUpdate:value"]),"custom"===v(I).formState[e.field]?(t(),l(g,{key:0},{default:a((()=>[n("div",Pt,[i(m,{value:v(O).timeRange,"onUpdate:value":r[0]||(r[0]=e=>v(O).timeRange=e),"show-time":{format:"HH:mm:ss"},format:"YYYY-MM-DD HH:mm:ss"},null,8,["value"])])])),_:1})):D("",!0)])),_:2},1032,["value","onUpdate:value","title","title-data"])):(t(),l(p,{key:3,value:v(I).formState[e.field],"onUpdate:value":t=>v(I).formState[e.field]=t,title:e,"title-data":null==(T=null==(x=v(I))?void 0:x.title_data)?void 0:T[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])}}},Qt=n("span",{style:{"font-size":"13px",color:"#999"}}," 多个IP以英文逗号分隔，最多添加200个 ",-1),Bt={cc:{"华为云":{component:Fe,key:"cc"},"阿里云":{component:qe,key:"custom_acl"}},one_white_list:{"华为云":{component:Ne,key:"ignore"},"阿里云":{component:Ye,key:"whitelist"}},one_white_black_ip_list:{"华为云":{component:He,key:"whiteblackip"},"阿里云":{component:Ve,key:"ip_blacklist"}}},Nt={cc:{"华为云":st,"阿里云":bt},one_white_list:{"华为云":Rt,"阿里云":Ft},one_white_black_ip_list:{"华为云":qt,"阿里云":{__name:"editForm",props:{sid:{type:[String,Number],default:""},formType:{type:Number,default:c},editData:{type:Object,default:()=>({})},rowData:{type:Object,default:()=>({})},activeTab:{type:String,default:""}},emits:["editSuccess","editError"],setup(e,{expose:o,emit:d}){const n=e,{sid:u,formType:r}=p(n),s=d,{add:c,edit:m}=oe.whiteBlackIp,g=f(null),D=w((()=>P.clone(n.editData,!0))),{formRenderContent:S,formDataLoading:U,confirmLoading:x,initForm:T,formDataInit:R,editSubmit:O}=X({formRef:g,editTitleLayer:6,formType:r,sid:u,hasEditData:D,emits:s,addApi:c,editApi:m,customSubmitData:async function(e){return e.cloud_type="aliyun",e.rule_id=String(n.editData.ruleid),e.cloud_master_account_id=n.rowData.cloud_master_account_id,e.sid=n.rowData.id,e.template_id=String(e.template_id),e.remote_addr=e.remote_addr.split(",").map((e=>e.trim())),e},customEditData:function(e){let t=e.value;return t.remote_addr=t.remote_addr.join(","),t.template_id=String(t.template_id),t}}),j=w((()=>{var e,t,l;if(!(null==(e=S.value)?void 0:e.title))return[];let a=null==(t=S.value)?void 0:t.title,i=null==(l=S.value)?void 0:l.formState;return(null==i?void 0:i.template_id)?a.filter((e=>e.edit_display&&1===e.block)):a.filter((e=>"template_id"===e.field))}));return C((async()=>{await T(),await R()})),o({editSubmit:O,loading:x}),(e,o)=>{const d=ee,u=q,r=b,s=h;return t(),l(s,{spinning:v(U)},{default:a((()=>[i(r,{ref_key:"formRef",ref:g,model:v(S).formState,rules:v(S).rules},{default:a((()=>[(t(!0),_(y,null,k(v(j),(e=>{var o,r,s,c,p,f;return t(),_(y,{key:e.field},["template_id"===e.field?(t(),l(d,{key:0,value:v(S).formState[e.field],"onUpdate:value":t=>v(S).formState[e.field]=t,title:e,"title-data":null==(r=null==(o=v(S))?void 0:o.title_data)?void 0:r[e.field]},{default:a((()=>[i(kt,{"template-id":v(S).formState[e.field],"onUpdate:templateId":t=>v(S).formState[e.field]=t,"row-data":n.rowData,"active-tab":n.activeTab},null,8,["template-id","onUpdate:templateId","row-data","active-tab"])])),_:2},1032,["value","onUpdate:value","title","title-data"])):"remote_addr"===e.field?(t(),l(d,{key:1,value:v(S).formState[e.field],"onUpdate:value":t=>v(S).formState[e.field]=t,title:e,"title-data":null==(c=null==(s=v(S))?void 0:s.title_data)?void 0:c[e.field]},{default:a((()=>[i(u,{value:v(S).formState[e.field],"onUpdate:value":t=>v(S).formState[e.field]=t,rows:4},null,8,["value","onUpdate:value"]),Qt])),_:2},1032,["value","onUpdate:value","title","title-data"])):(t(),l(d,{key:2,value:v(S).formState[e.field],"onUpdate:value":t=>v(S).formState[e.field]=t,title:e,"title-data":null==(f=null==(p=v(S))?void 0:p.title_data)?void 0:f[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])}}}}},Wt={class:"flex justify-between items-center"},zt={class:"text-error"},Yt={class:"w-[200px]"},$t=R({__name:"policyEdit",props:{open:{type:Boolean,default:!1},formType:{type:Number,default:c},policyRows:{type:Array,default:()=>[]},editData:{type:Object,default:()=>({})},editCloud:{type:String,default:""},activeTab:{type:String,default:""},activeTabTitle:{type:String,default:""}},emits:["update:open","editSuccess"],setup(e,{emit:o}){const u=e,r=o,s=f({}),c=g({checked:{"华为云":!1,"阿里云":!1},success:{"华为云":!1,"阿里云":!1},errorMsg:"",confirmOpen:!1}),p=async e=>{e||(c.errorMsg="",c.success["华为云"]=!1,c.success["阿里云"]=!1,c.checked["华为云"]=!1,c.checked["阿里云"]=!1)},b=()=>{r("update:open",!1)},h=async e=>{!e&&c.checked["华为云"]?c.confirmOpen=!0:(c.confirmOpen=!1,await Promise.all(Object.keys(s.value).filter((e=>c.checked[e])).map((async e=>await s.value[e].editSubmit()))))},w=e=>{c.errorMsg=e},S=e=>{if(u.formType===M){let t=u.editCloud;return c.checked[e]=t===e,u.open&&t===e}return c.checked["华为云"]=!1,c.checked["阿里云"]=!1,u.open};return(o,u)=>{const f=ke,g=O,U=T,x=m("vxe-button"),R=ae,C=H;return t(),_(y,null,[i(R,{title:`${e.activeTabTitle}${e.formType===o.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:e.open,width:"70%",onAfterOpenChange:p,onClose:b},{footer:a((()=>{var e,t;return[n("div",Wt,[n("div",zt,d(v(c).errorMsg),1),n("div",Yt,[i(x,{content:"取消",onClick:b}),i(x,{type:"submit",loading:(null==(e=v(s)[0])?void 0:e.loading)||(null==(t=v(s)[1])?void 0:t.loading),status:"primary",content:"提交",onClick:u[0]||(u[0]=e=>h(!1))},null,8,["loading"])])])]})),default:a((()=>[(t(!0),_(y,null,k(e.policyRows.map((e=>e.cloud_source)),((u,p)=>(t(),_(y,{key:p},[S(u)?(t(),l(U,{key:0},{title:a((()=>[e.formType===o.$CONFIG.FORM_TYPE.ADD_TYPE?(t(),l(f,{key:0,checked:v(c).checked[u],"onUpdate:checked":e=>v(c).checked[u]=e},null,8,["checked","onUpdate:checked"])):D("",!0),i(g,{style:{width:"none",margin:"0 5px"},type:u},null,8,["type"]),n("span",null,d(u),1)])),default:a((()=>{var a,i,o;return[z((t(),l(Y(null==(i=null==(a=v(Nt))?void 0:a[e.activeTab])?void 0:i[u]),{ref_for:!0,ref:e=>{e&&(v(s)[u]=e)},"row-data":e.policyRows.find((e=>e.cloud_source===u))||e.policyRows[0],sid:null==(o=e.editData)?void 0:o.id,"edit-data":e.editData,"form-type":e.formType,"active-tab":e.activeTab,onEditError:w,onEditSuccess:e=>(e=>{c.success[e]=!0,["华为云","阿里云"].every((e=>c.success[e]===c.checked[e]))&&r("editSuccess")})(u)},null,40,["row-data","sid","edit-data","form-type","active-tab","onEditSuccess"])),[[$,v(c).checked[u]]])]})),_:2},1024)):D("",!0)],64)))),128))])),_:1},8,["title","open"]),i(C,{open:v(c).confirmOpen,"onUpdate:open":u[1]||(u[1]=e=>v(c).confirmOpen=e),title:"华为云提示",width:"70%",onOk:u[2]||(u[2]=e=>h(!0))},{default:a((()=>[i(lt,{"row-data":e.policyRows.find((e=>"华为云"===e.cloud_source))||e.policyRows[0]},null,8,["row-data"])])),_:1},8,["open"])],64)}}},[["__scopeId","data-v-15f0ef80"]]),Mt={class:"flex gap-2"},Ht={key:0},Vt={key:1},Gt={key:0,class:"tool-box"},Kt={key:0},Jt={key:1},Zt={class:"h-full"},Xt=R({__name:"detailIndex",props:{open:Boolean,rowColumns:Array,titleData:Object,policyRows:Array,searchPolicyId:String},emits:["update:open"],setup(e,{emit:d}){const u=e,r=d,s=[4,50,98],p=g({initColumn:[],initTitleData:[],activedTab:"",hitCountOpen:!1,hitCountData:{},cardCollapse:!0,searchQuery:"",expandWidth:50,tableLoading:!1,repeatRuleOpen:{"阿里云":!1,"华为云":!1}}),f=g({open:!1,type:0,editData:{},editCloud:""}),b=w((()=>{const e=[...u.rowColumns],t=e.findIndex((e=>"cloud_source"===e.field));if(t>0){const[l]=e.splice(t,1);e.unshift(l)}return p.cardCollapse?e.slice(0,2):e})),h=w((()=>{const e=u.titleData.policy||{},t=Object.entries(Bt).map((([t,l])=>{var a;return{label:e[null==(a=null==l?void 0:l["华为云"])?void 0:a.key]||l.key,key:t}}));return t.push({label:"源站配置信息",key:"source"}),t}));C((async()=>{const{columns:e,title_data:t}=await Z.setColumn({layer:2});p.initColumn=e.value||[],p.initTitleData=t.value||[]}));const S=e=>{var t;e?(p.activedTab=null==(t=h.value[0])?void 0:t.key,u.searchPolicyId&&V((()=>{var e;p.searchQuery=u.searchPolicyId;let t=null==(e=u.policyRows[0])?void 0:e.policy_detail,l=Object.keys(t).find((e=>JSON.stringify(t[e]).includes(u.searchPolicyId)));p.activedTab=l}))):(p.activedTab="",p.cardCollapse=!0,p.searchQuery="",p.expandWidth=50)},x=e=>{ie.getRule(e,e.cloud_source).then((t=>{p.hitCountOpen=!0,p.hitCountData=t,p.hitCountData.modelTitle=e.name||e.ruleid||e.id}))},R=()=>{p.expandWidth=s[s.indexOf(p.expandWidth)+1]||s[0]},j=()=>[{width:u.policyRows[1]?p.expandWidth+"%":"100%",show:p.expandWidth!==s[0]},{width:100-p.expandWidth+"%",show:p.expandWidth!==s[2]}],L=()=>{f.open=!0,f.type=c},E=(e,t)=>{f.open=!0,f.type=M,f.editData=t,f.editCloud=e.cloud_source},A=()=>{f.open=!1},F=async()=>{p.tableLoading=!0,u.policyRows.forEach((async e=>{await ie.getDetail(e.id)})),p.tableLoading=!1};return(d,u)=>{var s,c,g,w,C;const P=m("FullscreenOutlined"),q=m("FullscreenExitOutlined"),Q=T,B=G,N=K,W=m("vxe-button"),M=O,H=I,V=m("DoubleRightOutlined"),J=m("DoubleLeftOutlined"),Z=ae;return t(),_(y,null,[i(Z,{open:e.open,title:(null==(c=null==(s=e.policyRows)?void 0:s[0])?void 0:c.hostname)||(null==(w=null==(g=e.policyRows)?void 0:g[0])?void 0:w.domain),width:"100%",onClose:u[3]||(u[3]=e=>r("update:open",!1)),onAfterOpenChange:S},{default:a((()=>[n("div",Mt,[(t(!0),_(y,null,k(e.policyRows,((d,n)=>(t(),l(Q,{key:n},{default:a((()=>[n===e.policyRows.length-1?(t(),_("div",{key:0,class:"card-collapse",onClick:u[0]||(u[0]=e=>v(p).cardCollapse=!v(p).cardCollapse)},[v(p).cardCollapse?(t(),_("span",Ht,[o("展开 "),i(P)])):(t(),_("span",Vt,[o("折叠 "),i(q)]))])):D("",!0),i(Ee,{data:d,columns:v(b),column:e.policyRows[1]?1:2,"title-data":e.titleData},null,8,["data","columns","column","title-data"])])),_:2},1024)))),128))]),i(N,{activeKey:v(p).activedTab,"onUpdate:activeKey":u[1]||(u[1]=e=>v(p).activedTab=e),size:"small",style:{"margin-top":"10px"}},{default:a((()=>[(t(!0),_(y,null,k(v(h),(e=>(t(),l(B,{key:e.key,tab:e.label},null,8,["tab"])))),128))])),_:1},8,["activeKey"]),"source"!==v(p).activedTab?(t(),_("div",Gt,[i(W,{status:"primary",icon:"vxe-icon-add",size:"small",onClick:L},{default:a((()=>[o("新增")])),_:1}),"cc"===v(p).activedTab?(t(!0),_(y,{key:0},k(e.policyRows.map((e=>e.cloud_source)),(e=>(t(),l(W,{key:e,size:"small",onClick:t=>(e=>{p.repeatRuleOpen[e]=!0})(e)},{default:a((()=>[i(M,{style:{width:"none","margin-right":"4px"},type:e},null,8,["type"]),o(" 重复规则 ")])),_:2},1032,["onClick"])))),128)):D("",!0),i(H,{value:v(p).searchQuery,"onUpdate:value":u[2]||(u[2]=e=>v(p).searchQuery=e),class:"search-input",placeholder:"搜索规则","allow-clear":""},null,8,["value"]),i(W,{icon:"vxe-icon-repeat "+(v(p).tableLoading?"roll":""),circle:"",class:"ml-2",onClick:F},null,8,["icon"])])):D("",!0),n("div",{class:"data-container gap-2",style:U({height:v(p).cardCollapse?"calc(100% - 140px)":"calc(100% - 320px)",width:v(p).cardCollapse?"100%":"calc(100% - 10px)"})},[(t(!0),_(y,null,k(e.policyRows,((a,d)=>{var u,r,s,c,f;return t(),_("div",{key:d,class:"data-section",style:U({width:null==(u=j()[d])?void 0:u.width})},[e.policyRows[1]&&0===d?(t(),_("div",{key:0,class:"expand-icon",onClick:R},[j()[1].show?(t(),_("span",Kt,[o(" 展开 "),i(V)])):(t(),_("span",Jt,[o(" 收起 "),i(J)]))])):D("",!0),z(n("div",Zt,["source"!==v(p).activedTab?(t(),l(Y(null==(c=null==(s=null==(r=v(Bt))?void 0:r[v(p).activedTab])?void 0:s[null==a?void 0:a.cloud_source])?void 0:c.component),{key:0,repeatRuleOpen:v(p).repeatRuleOpen[null==a?void 0:a.cloud_source],"onUpdate:repeatRuleOpen":e=>v(p).repeatRuleOpen[null==a?void 0:a.cloud_source]=e,"row-data":a,"search-query":v(p).searchQuery,"table-data":(null==(f=null==a?void 0:a.policy_detail)?void 0:f[v(p).activedTab])||[],onShowRule:x,onEdit:E},null,40,["repeatRuleOpen","onUpdate:repeatRuleOpen","row-data","search-query","table-data"])):(t(),l(je,{key:1,"row-data":a},null,8,["row-data"]))],512),[[$,j()[d].show]])],4)})),128))],4)])),_:1},8,["open","title"]),i(we,{open:v(p).hitCountOpen,"onUpdate:open":u[4]||(u[4]=e=>v(p).hitCountOpen=e),"rule-data":v(p).hitCountData,"init-column":v(p).initColumn},null,8,["open","rule-data","init-column"]),i($t,{open:v(f).open,"onUpdate:open":u[5]||(u[5]=e=>v(f).open=e),"policy-rows":e.policyRows,"form-type":v(f).type,"edit-data":v(f).editData,"active-tab":v(p).activedTab,"active-tab-title":null==(C=v(h).find((e=>e.key===v(p).activedTab)))?void 0:C.label,"edit-cloud":v(f).editCloud,onEditSuccess:A},null,8,["open","policy-rows","form-type","edit-data","active-tab","active-tab-title","edit-cloud"])],64)}}},[["__scopeId","data-v-ae014f92"]]),el=n("div",{style:{"margin-top":"5px"}},null,-1),tl={class:"text-12"},ll={class:"truncate",style:{width:"100%"}},al={style:{display:"flex","align-items":"center"}},il={__name:"index",setup(l){const c=f(null),p=g({allData:[],initColumn:[],initButton:[],initTitleData:[],subPageColumns:[],titleFieldSearch:[],editRow:[],detailRow:[],detailOpen:!1,searchPolicyId:""}),{userEdit:k,formOpen:b,formType:h,formSid:D}=te(),S=w((()=>{for(let e of p.initColumn){let{field:t}=e;switch(t){case"hostname":e.showOverflow="ellipsis",e.slots={default:t};break;case"access_mode":case"protect_status":case"proxy":e.slots={default:t};break;case"virtual_team_v3_id":e.width=140;break;case"sync_time":e.showOverflow="title"}}return p.initColumn})),U=w((()=>{const e=["edit"];return p.initButton.reduce(((t,l)=>(e.includes(l.field)&&(t[l.field]=l),t)),{})}));C((async()=>{const{button:e,columns:t,title_data:l,title_field_search:a,sub_page_columns:i}=await Z.setColumn({layer:1});p.initColumn=t.value||[],p.initButton=e.value||[],p.initTitleData=l.value||[],p.titleFieldSearch=a.value||[],p.subPageColumns=i||[],c.value.gridOption.proxyConfig.ajax.querySuccess=({response:e})=>{p.allData=e.data,p.searchPolicyId&&p.allData.length&&R(p.allData[0])},await x()}));const x=async()=>{c.value&&await c.value.serverTableRef.commitProxy("query")},T=({type:e,row:t})=>{const l=c.value.serverTableRef.getTableData().fullData;p.editRow=l.filter((e=>e.hostname===t.hostname)),k({type:e,sid:t.id})},R=e=>{const t=c.value.serverTableRef.getTableData().fullData;p.detailRow=t.filter((t=>t.hostname===e.hostname)),p.detailRow=p.detailRow.sort(((e,t)=>["华为云","阿里云"].indexOf(e.cloud_source)-["华为云","阿里云"].indexOf(t.cloud_source))),p.detailOpen=!0},j=({row:e,rowIndex:t,column:l,visibleData:a})=>{const i=e[l.field];if(i&&["hostname"].includes(l.field)){const e=a[t-1];let o=a[t+1];if(e&&e[l.field]===i)return{rowspan:0,colspan:0};{let e=1;for(;o&&o[l.field]===i;)o=a[++e+t];if(e>1)return{rowspan:e,colspan:1}}}},I={fields:[{field:"hostname",field_name:"域名",operator:"vague",validate:e=>e.includes(".")},{field:"policy_detail",field_name:"规则id",operator:"vague"}],placeholder:"支持域名、规则id快速搜索"},L=e=>{var t;p.searchPolicyId=null==(t=e.find((e=>"policy_detail"===e.field)))?void 0:t.value};return(l,f)=>{const k=he,g=m("vxe-tag"),w=r,C=s,E=O,A=e;return t(),_(y,null,[i(A,{ref_key:"tableRef",ref:c,"table-column":v(S),"auth-btn":v(U),"query-api":v(ie).getList,"request-config":{api:v(ie).getList,immediate:!0},"title-field-search":v(p).titleFieldSearch,"is-show-doc":!0,"span-method":j,"default-search-field":I,onUserEdit:T,onSearchCondition:L},{hostname:a((({row:e})=>[i(k,{content:e.hostname,placement:"topLeft",onClick:t=>R(e)},null,8,["content","onClick"])])),protect_status:a((({row:e})=>[i(g,{class:u(1==e.access_status?"theme--primary":"theme--error"),size:"small"},{default:a((()=>[o(d(1==e.access_status?"接入":"未接入"),1)])),_:2},1032,["class"]),el,i(g,{class:u(1==e.protect_status?"theme--primary":"theme--error"),size:"small"},{default:a((()=>[o(d(1==e.protect_status?"开启防护":0==e.protect_status?"暂停防护":"bypass"),1)])),_:2},1032,["class"])])),proxy:a((({row:e})=>[i(g,{class:u(1==e.proxy?"theme--primary":"theme--error"),size:"small"},{default:a((()=>[o(d(1==e.proxy?"是":"否"),1)])),_:2},1032,["class"])])),access_mode:a((({row:e})=>[i(C,{"overlay-style":{maxWidth:"none"}},{title:a((()=>[n("span",tl,[i(w,{class:"tooltip-text",copyable:{tooltip:!1}},{default:a((()=>[o(d(e.access_code),1)])),_:2},1024)])])),default:a((()=>[n("div",ll,d(e.access_mode),1)])),_:2},1024)])),cloud_master_account_id:a((({row:e})=>{var t,l,a;return[n("div",al,[i(E,{type:e.cloud_source},null,8,["type"])]),o(" "+d((null==(a=null==(l=null==(t=v(p).initTitleData)?void 0:t.cloud_master_account_id)?void 0:l[e.cloud_master_account_id])?void 0:a.page_display)||""),1)]})),sync_time:a((({row:e})=>[i(k,{content:e.domain_create_times,primary:!1},null,8,["content"]),i(k,{content:e.sync_time,primary:!1},null,8,["content"])])),_:1},8,["table-column","auth-btn","query-api","request-config","title-field-search"]),i(ge,{open:v(b),"onUpdate:open":f[0]||(f[0]=e=>J(b)?b.value=e:null),sid:v(D),"form-type":v(h),"edit-row":v(p).editRow,onEditSuccess:x},null,8,["open","sid","form-type","edit-row"]),i(Xt,{open:v(p).detailOpen,"onUpdate:open":f[1]||(f[1]=e=>v(p).detailOpen=e),"row-columns":v(p).subPageColumns,"title-data":v(p).initTitleData,"policy-rows":v(p).detailRow,"search-policy-id":v(p).searchPolicyId},null,8,["open","row-columns","title-data","policy-rows","search-policy-id"])],64)}}};export{il as default};
