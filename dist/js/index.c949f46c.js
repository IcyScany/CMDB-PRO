import{a3 as e,H as a,q as t,J as r,Q as s,R as o,X as l,am as i,Y as n,$ as d,F as c,S as u,c as v,W as _,a6 as m,U as y,Z as p,ah as h,aV as w,v as g,aY as b,a9 as f,aa as k,ai as x}from"./index.872a2bd0.js";import{c as z}from"./cloudServerApi.fb0556ca.js";import{i as D,L as C}from"./index.165d9fa7.js";import{_ as $}from"./index.fc9664cf.js";const j=e=>(f("data-v-ccdff669"),e=e(),k(),e),A={class:"overview-container"},B={class:"summary-box"},L={class:"summary-data"},M={class:"summary-value"},S=j((()=>l("div",{class:"summary-title"},"服务器总数",-1))),U=j((()=>l("div",{class:"summary-icon"},[l("img",{src:"/images/kvstore.png"})],-1))),E=j((()=>l("div",{class:"summary-border"},null,-1))),F={class:"summary-data"},I={class:"summary-value",style:{"font-size":"26px"}},O={class:"summary-title"},T=j((()=>l("div",{class:"summary-border"},null,-1))),G={class:"desc-box"},J={class:"desc-title"},P={class:"desc-list"},R={class:"desc-value"},W={key:0},Y={style:{color:"#888"}},q={key:1},H=j((()=>l("div",{id:"trendChart",style:{width:"100%",height:"400px"}},null,-1))),Q={key:0},V={key:1},X=e({__name:"index",emits:["update:viewType"],setup(e,{emit:f}){const k=f,j=a({overviewData:{}}),X={"服务器总数":"#4fb050",status:"#e88250",expired:"#3c79bf",charge_type:"#4fb050"},Z=t((()=>{var e;const a=null==(e=j.overviewData)?void 0:e.server_number;if(!a)return[];const t=(e,a,t)=>{var r;return Array.isArray(e)&&(null==(r=e.find((e=>e[a]===t)))?void 0:r.count)||0};return{status:{"运行中":t(a.server_status_data,"server_cloud_status","运行中"),"停止":t(a.server_status_data,"server_cloud_status","停止")},expired:{"即将过期(大于30小于60天)":a.expired_data_30??0,"即将过期(小于15天)":a.expired_data_15??0},charge_type:{"包年包月":t(a.charge_type_data,"charge_type","包年包月"),"按量付费":t(a.charge_type_data,"charge_type","按量付费")}}})),K={zone_data:{name:"区域分布",key:"zone_id"},environment_data:{name:"环境分布",key:"environment"},physical_resources:{name:"资源统计",key:"physical_resources"},server_type_data:{name:"服务器规格",key:"server_type"}},N=e=>e.sort(((e,a)=>a.count-e.count)),ee=async()=>{await(async()=>{const e=await x.getCloudRegionList();j.overviewData.server_number.zone_data.forEach((a=>{const t=null==e?void 0:e[a.region_id];let r="";"华为云"===a.cloud_source?r=`${a.zone_id}`.replace(`${a.region_id}`,"").toUpperCase():"阿里云"===a.cloud_source&&(r=`${a.zone_id}`.replace(`${a.region_id}-`,"").toUpperCase()),t&&(a.region_id=t,a.zone_id=t+(r[0]||""))}))})();const{physical_resources:e,server_type_data:a,zone_data:t}=j.overviewData.server_number,r={total_cpu:"CPU总数",total_memory:"内存总数",total_disk:"硬盘总数"};j.overviewData.server_number.physical_resources=Object.entries(e[0]).map((([e,a])=>{let t=a;return"total_cpu"===e?t=`${a} 核`:["total_disk","total_memory"].includes(e)&&(t=(e=>{if(0===e)return"0 GB";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(3))+" "+["GB","TB","PB"][a]})(a)),{physical_resources:r[e],count:t}}));const s=N(a);let o,l;s.length>10?(o=s.slice(0,9),l=s.slice(9),o.push({server_type:"其他",count:l.reduce(((e,a)=>e+a.count),0)})):o=s,j.overviewData.server_number.server_type_data=o,j.overviewData.server_number.server_type_data_other=l;const i=N(t);let n,d;i.length>5?(n=i.slice(0,4),d=i.slice(4),n.push({zone_id:"其他",count:d.reduce(((e,a)=>e+a.count),0)})):n=i,j.overviewData.server_number.zone_data=n,j.overviewData.server_number.zone_data_other=d};return r((async()=>{await(async()=>{const e=await z.getOverview();j.overviewData=e,ee()})(),(()=>{var e,a;const t=document.getElementById("trendChart"),r=D(t);let s=null==(a=null==(e=j.overviewData)?void 0:e.server_number)?void 0:a.monthly_stats.reverse();const o={tooltip:{trigger:"axis",formatter:"{b}<br/>{a}: {c}"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:s.map((e=>e.year_month)),axisLabel:{rotate:45}},yAxis:{type:"value",name:"数量"},series:[{name:"资源数量",type:"line",smooth:!0,data:s.map((e=>e.count)),itemStyle:{color:"#1890ff"},areaStyle:{color:new C(0,0,0,1,[{offset:0,color:"rgba(24,144,255,0.3)"},{offset:1,color:"rgba(24,144,255,0.1)"}])}}]};r.setOption(o),window.addEventListener("resize",(()=>{r.resize()}))})()})),(e,a)=>{var t,r;const f=w,x=g,z=$,D=b;return s(),o("div",A,[l("div",B,[l("div",{class:"summary-item",style:i({"--summary-color":X["服务器总数"],cursor:"pointer"}),onClick:a[0]||(a[0]=e=>k("update:viewType","云服务器"))},[l("div",L,[l("div",M,n(null==(r=null==(t=d(j).overviewData)?void 0:t.server_number)?void 0:r.total),1),S]),U,E],4),(s(!0),o(c,null,u(d(Z),((e,a)=>(s(),o("div",{key:a,class:"summary-item",style:i({"--summary-color":X[a]})},[(s(!0),o(c,null,u(e,((e,a)=>(s(),o("div",{key:a},[l("div",F,[l("div",I,n(e),1),l("div",O,n(a),1)]),T])))),128))],4)))),128))]),v(D,{title:"资源分布"},{default:_((()=>[l("div",G,[(s(),o(c,null,u(K,((e,a)=>{var t,r;return l("div",{key:a,class:"desc-card"},[l("div",J,n(e.name),1),l("div",P,[(s(!0),o(c,null,u(null==(r=null==(t=d(j).overviewData)?void 0:t.server_number)?void 0:r[a],(t=>(s(),o("div",{key:t.label,class:m({"two-col":"server_type_data"===a})},[v(x,{title:t[e.key]},{default:_((()=>[l("span",{class:"desc-label truncate",style:i({minWidth:"zone_data"===a?"150px":"100px"})},["zone_data"===a?(s(),y(f,{key:0,type:t.cloud_source,style:{width:"22px"}},null,8,["type"])):p("",!0),h(" "+n(t[e.key])+"： ",1)],4)])),_:2},1032,["title"]),l("span",R,[["server_type_data","zone_data"].includes(a)&&"其他"===t[e.key]?(s(),o("span",W,[v(z,{placement:"right"},{content:_((()=>{var t,r;return[(s(!0),o(c,null,u(null==(r=null==(t=d(j).overviewData)?void 0:t.server_number)?void 0:r[`${a}_other`],((t,r)=>(s(),o("div",{key:r},[l("span",Y,["zone_data"===a?(s(),y(f,{key:0,type:t.cloud_source,style:{width:"22px"}},null,8,["type"])):p("",!0),h(" "+n(t[e.key])+": ",1)]),h(" "+n(t.count),1)])))),128))]})),default:_((()=>[l("span",null,n(t.count),1)])),_:2},1024)])):(s(),o("span",q,n(t.count),1))])],2)))),128))])])})),64))])])),_:1}),v(D,{title:"资源数量趋势"},{default:_((()=>[H])),_:1}),v(D,{class:"overview-section",title:"告警"},{default:_((()=>{var e,a,t,r;return[0===(null==(a=null==(e=d(j).overviewData)?void 0:e.alert_number)?void 0:a.length)?(s(),o("div",Q,"暂无告警")):(s(),o("div",V,"告警数量："+n(null==(r=null==(t=d(j).overviewData)?void 0:t.alert_number)?void 0:r.length),1))]})),_:1})])}}},[["__scopeId","data-v-ccdff669"]]);export{X as default};
