import{aR as e,a5 as t,a3 as a,al as i,r as l,O as n,Q as o,U as r,W as s,c as d,$ as u,R as c,F as p,S as f,ah as h,Z as m,a7 as g,aw as _,aj as v,ax as y,av as b,a8 as w,aN as S,a0 as T,H as E,q as D,x,J as C,X as k,Y as O,ad as A,I as M,aZ as P,cZ as I,au as N,aS as L,cI as R,ap as q,cE as U,C as Y,D as j,ao as $,a1 as F,ak as H,af as X,a_ as B,a$ as V,v as G}from"./index.872a2bd0.js";import{t as K}from"./tableRender.a6ff99b7.js";import{o as W,_ as z,u as J,a as Z}from"./opsFormInit.3a4e1794.js";import{_ as Q}from"./index.029351cd.js";import{_ as ee,S as te}from"./index.44a4e190.js";import{_ as ae}from"./index.7d980246.js";import{a as ie,s as le}from"./alertLevel.8dae0e72.js";import{L as ne,a as oe,_ as re}from"./index.cf09da9a.js";import"./index.9846e408.js";import"./index.65b2e021.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./index.48209b21.js";import"./index.64f8d8d4.js";import"./index.2c670fa1.js";import"./opsTable.7b07fc7b.js";const se="manage/menus/",de={getMenusList:t=>e.get(`${se}list/${t}`),getOneMenusList:t=>e.get(`${se}get-one/${t}`),postOneMenuAdd:t=>e.post(`${se}add`,t),putOneMenuEdit:(t,a)=>e.put(`${se}edit/${t}`,a),putOneMenuSort:(t,a)=>e.put(`${se}sort/${t}?menu_sort=${a}`),delOneMenu:t=>e.delete(`${se}del/${t}`)};let ue=[{layer:1,block:1,types:1,sorting:1,field:"sorting",field_name:"排序",page_display:!0,page_sort:1,edit_display:!1,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:2,field:"id",field_name:"NO.",page_display:!0,page_sort:1,edit_display:!1,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:5,field:"level_2",field_name:"所属一级",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_sort:!0,page_data_source:{url:"manage/menus/list/0",value:"id",label:"menu_name",data_source:"url"},field_explain:null},{layer:1,block:1,types:1,sorting:3,lower_layer:0,field:"menu_name",field_name:"菜单名",page_display:!0,page_sort:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:4,lower_layer:0,field:"level_1",field_name:"一级菜单",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!1,search_display:!0,page_sort:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:5,lower_layer:0,field:"menu_group",field_name:"菜单组",page_display:!0,page_sort:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:{data_source:"data",data:t.MENU_GROUP},field_explain:null},{layer:1,block:1,types:1,sorting:6,field:"icon",field_name:"图标",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_sort:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:7,page_sort:!0,field:"permissions_url",field_name:"权限URL",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:{form_type:"select",multiple:"tags"},field_explain:null},{layer:1,block:1,types:1,sorting:8,field:"vue_url",field_name:"页面URL",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:null,page_sort:!0,field_explain:null},{layer:1,block:1,types:1,sorting:9,page_sort:!0,field:"menu_describe",field_name:"菜单描述",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:11,page_sort:!0,field:"status",field_name:"是否上线",page_display:!1,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!1,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:11,page_sort:!0,field:"page_display",field_name:"是否显示",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!1,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:11,page_sort:!0,field:"page_data_source",field_name:"数据源",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!1,page_data_source:{form_type:"json"},field_explain:null},{layer:1,block:1,types:1,sorting:12,page_sort:!0,field:"operation",field_name:"操作",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!1,search_display:!1,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:13,page_sort:!0,field:"title",field_name:"查看标题",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!1,search_display:!1,page_data_source:null,field_explain:null}];const ce=a({__name:"Edit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const a=e,{open:E,sid:D,formType:x}=i(a),C=t;let k=l(null);const{putOneMenuEdit:O,getOneMenusList:A,postOneMenuAdd:M}=de;let P=l({});const I=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"DELETE",value:"DELETE"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"},{label:"ws",value:"ws"}],N=async()=>{const e=L.value.formState.permissions_url;if(!Array.isArray(e)||0===e.length)return Promise.resolve();return e.some((e=>e.method&&e.url))?Promise.resolve():Promise.reject("请至少填写一组完整的权限URL")};let{formRenderContent:L,formDataLoading:R,confirmLoading:q,initForm:U,formDataInit:Y,editSubmit:j}=W({formRef:k,editTitleLayer:1,formType:x,sid:D,emits:C,editApi:O,addApi:M,oneDataApi:A,customSubmitData:async e=>{const t={...e};if(Array.isArray(t.permissions_url)){const e=t.permissions_url.filter((e=>e.method&&e.url));e.length>0?t.permissions_url=e.map((e=>`${e.method}:${e.url}`)):t.permissions_url=[]}return t.permissions_url||(t.permissions_url=[]),t.page_data_source&&"string"==typeof e.page_data_source?t.page_data_source=JSON.parse(e.page_data_source):t.page_data_source||(t.page_data_source={}),t},customOneData:e=>{let t=T.clone(e.value?e.value:{},!0);t.permissions_url?L.value.formState.permissions_url=t.permissions_url.map(((e,t)=>{const[a,i]=e.indexOf(":")>-1?String(e).split(":"):["",e];return{method:a,url:i,id:Date.now()+t}})):L.value.formState.permissions_url=[{method:"",url:"",id:Date.now()}],L.value.rules||(L.value.rules={}),L.value.rules.permissions_url=[{validator:N,trigger:"change"}],P.value=t},customTitle:ue});const $=()=>{C("update:open",!1)},F=async e=>{e&&(P.value={},await U(),await Y())},H=()=>{Array.isArray(L.value.formState.permissions_url)||(L.value.formState.permissions_url=[]),L.value.formState.permissions_url.push({method:"",url:"",id:Date.now()})};return(e,t)=>{var a,i;const l=ee,T=g,D=_,C=v,O=n("MinusCircleOutlined"),A=y,M=n("PlusOutlined"),N=b,U=z,Y=w,X=S,B=n("vxe-button"),V=Q;return o(),r(V,{title:`(${0!==(null==(a=u(P))?void 0:a.level_2)?"二级":"一级"})${null==(i=u(P))?void 0:i.menu_name} - ${e.$route.meta.title}${u(x)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"}`,open:u(E),onAfterOpenChange:F,onClose:$},{footer:s((()=>[d(B,{content:"取消",onClick:$}),d(B,{type:"submit",loading:u(q),status:"primary",content:"提交",onClick:u(j)},null,8,["loading","onClick"])])),default:s((()=>[d(X,{spinning:u(R)},{default:s((()=>[d(Y,{ref_key:"formRef",ref:k,model:u(L).formState,rules:u(L).rules},{default:s((()=>[(o(!0),c(p,null,f(e.$utils.filter(u(L).title,(e=>e.edit_display)),(e=>{var t,a,i,n,g,_,v,y;return o(),c(p,{key:e.field},["permissions_url"===e.field?(o(),r(U,{key:0,value:u(L).formState[e.field],"onUpdate:value":t=>u(L).formState[e.field]=t,title:e,"title-data":null==(a=null==(t=u(L))?void 0:t.title_data)?void 0:a[e.field]},{default:s((()=>[(o(!0),c(p,null,f(u(L).formState.permissions_url,((e,t)=>(o(),r(A,{key:e.id,class:"mb-2",type:"flex"},{default:s((()=>[d(D,{flex:"20%"},{default:s((()=>[d(T,{name:["permissions_url",t,"method"],rules:{required:!0,message:"请求方式"}},{default:s((()=>[d(l,{value:e.method,"onUpdate:value":t=>e.method=t,options:I,placeholder:"请选择请求方式","show-arrow":"","show-search":""},null,8,["value","onUpdate:value"])])),_:2},1032,["name"])])),_:2},1024),d(D,{flex:"80%"},{default:s((()=>[d(A,{type:"flex"},{default:s((()=>[d(D,{flex:"90%"},{default:s((()=>[d(T,{name:["permissions_url",t,"url"],rules:{required:!1,message:"请输入权限URL"}},{default:s((()=>[d(C,{value:e.url,"onUpdate:value":t=>e.url=t,class:"xy-url-input",placeholder:"输入权限URL"},null,8,["value","onUpdate:value"])])),_:2},1032,["name"])])),_:2},1024),d(D,{flex:"10%"},{default:s((()=>[h("   "),d(O,{onClick:e=>(e=>{L.value.formState.permissions_url.splice(e,1)})(t)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),d(N,{type:"dashed",block:"",onClick:H},{default:s((()=>[d(M),h(" 新增权限URL ")])),_:1})])),_:2},1032,["value","onUpdate:value","title","title-data"])):(o(),c(p,{key:1},["level_2"===e.field?(o(),c(p,{key:0},[0!==(null==(n=null==(i=u(L))?void 0:i.formState)?void 0:n.level_2)?(o(),r(U,{key:0,value:u(L).formState[e.field],"onUpdate:value":t=>u(L).formState[e.field]=t,title:e,"title-data":null==(_=null==(g=u(L))?void 0:g.title_data)?void 0:_[e.field],required:!!(null==e?void 0:e.edit_required)},null,8,["value","onUpdate:value","title","title-data","required"])):m("",!0)],64)):(o(),r(U,{key:1,value:u(L).formState[e.field],"onUpdate:value":t=>u(L).formState[e.field]=t,title:e,"title-data":null==(y=null==(v=u(L))?void 0:v.title_data)?void 0:y[e.field],required:!!(null==e?void 0:e.edit_required)},null,8,["value","onUpdate:value","title","title-data","required"]))],64))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},[["__scopeId","data-v-9bf95ae6"]]);function pe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function fe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(a),!0).forEach((function(t){me(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function me(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ge(){return ge=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},ge.apply(this,arguments)}function _e(e,t){if(null==e)return{};var a,i,l=function(e,t){if(null==e)return{};var a,i,l={},n=Object.keys(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}function ve(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var ye=ve(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),be=ve(/Edge/i),we=ve(/firefox/i),Se=ve(/safari/i)&&!ve(/chrome/i)&&!ve(/android/i),Te=ve(/iP(ad|od|hone)/i),Ee=ve(/chrome/i)&&ve(/android/i),De={capture:!1,passive:!1};function xe(e,t,a){e.addEventListener(t,a,!ye&&De)}function Ce(e,t,a){e.removeEventListener(t,a,!ye&&De)}function ke(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(a){return!1}return!1}}function Oe(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Ae(e,t,a,i){if(e){a=a||document;do{if(null!=t&&(">"===t[0]?e.parentNode===a&&ke(e,t):ke(e,t))||i&&e===a)return e;if(e===a)break}while(e=Oe(e))}return null}var Me,Pe=/\s+/g;function Ie(e,t,a){if(e&&t)if(e.classList)e.classList[a?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(Pe," ").replace(" "+t+" "," ");e.className=(i+(a?" "+t:"")).replace(Pe," ")}}function Ne(e,t,a){var i=e&&e.style;if(i){if(void 0===a)return document.defaultView&&document.defaultView.getComputedStyle?a=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(a=e.currentStyle),void 0===t?a:a[t];t in i||-1!==t.indexOf("webkit")||(t="-webkit-"+t),i[t]=a+("string"==typeof a?"":"px")}}function Le(e,t){var a="";if("string"==typeof e)a=e;else do{var i=Ne(e,"transform");i&&"none"!==i&&(a=i+" "+a)}while(!t&&(e=e.parentNode));var l=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return l&&new l(a)}function Re(e,t,a){if(e){var i=e.getElementsByTagName(t),l=0,n=i.length;if(a)for(;l<n;l++)a(i[l],l);return i}return[]}function qe(){var e=document.scrollingElement;return e||document.documentElement}function Ue(e,t,a,i,l){if(e.getBoundingClientRect||e===window){var n,o,r,s,d,u,c;if(e!==window&&e.parentNode&&e!==qe()?(o=(n=e.getBoundingClientRect()).top,r=n.left,s=n.bottom,d=n.right,u=n.height,c=n.width):(o=0,r=0,s=window.innerHeight,d=window.innerWidth,u=window.innerHeight,c=window.innerWidth),(t||a)&&e!==window&&(l=l||e.parentNode,!ye))do{if(l&&l.getBoundingClientRect&&("none"!==Ne(l,"transform")||a&&"static"!==Ne(l,"position"))){var p=l.getBoundingClientRect();o-=p.top+parseInt(Ne(l,"border-top-width")),r-=p.left+parseInt(Ne(l,"border-left-width")),s=o+n.height,d=r+n.width;break}}while(l=l.parentNode);if(i&&e!==window){var f=Le(l||e),h=f&&f.a,m=f&&f.d;f&&(s=(o/=m)+(u/=m),d=(r/=h)+(c/=h))}return{top:o,left:r,bottom:s,right:d,width:c,height:u}}}function Ye(e,t,a){for(var i=Xe(e,!0),l=Ue(e)[t];i;){var n=Ue(i)[a];if(!("top"===a||"left"===a?l>=n:l<=n))return i;if(i===qe())break;i=Xe(i,!1)}return!1}function je(e,t,a,i){for(var l=0,n=0,o=e.children;n<o.length;){if("none"!==o[n].style.display&&o[n]!==Kt.ghost&&(i||o[n]!==Kt.dragged)&&Ae(o[n],a.draggable,e,!1)){if(l===t)return o[n];l++}n++}return null}function $e(e,t){for(var a=e.lastElementChild;a&&(a===Kt.ghost||"none"===Ne(a,"display")||t&&!ke(a,t));)a=a.previousElementSibling;return a||null}function Fe(e,t){var a=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Kt.clone||t&&!ke(e,t)||a++;return a}function He(e){var t=0,a=0,i=qe();if(e)do{var l=Le(e),n=l.a,o=l.d;t+=e.scrollLeft*n,a+=e.scrollTop*o}while(e!==i&&(e=e.parentNode));return[t,a]}function Xe(e,t){if(!e||!e.getBoundingClientRect)return qe();var a=e,i=!1;do{if(a.clientWidth<a.scrollWidth||a.clientHeight<a.scrollHeight){var l=Ne(a);if(a.clientWidth<a.scrollWidth&&("auto"==l.overflowX||"scroll"==l.overflowX)||a.clientHeight<a.scrollHeight&&("auto"==l.overflowY||"scroll"==l.overflowY)){if(!a.getBoundingClientRect||a===document.body)return qe();if(i||t)return a;i=!0}}}while(a=a.parentNode);return qe()}function Be(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function Ve(e,t){return function(){if(!Me){var a=arguments;1===a.length?e.call(this,a[0]):e.apply(this,a),Me=setTimeout((function(){Me=void 0}),t)}}}function Ge(e,t,a){e.scrollLeft+=t,e.scrollTop+=a}function Ke(e){var t=window.Polymer,a=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):a?a(e).clone(!0)[0]:e.cloneNode(!0)}function We(e,t,a){var i={};return Array.from(e.children).forEach((function(l){var n,o,r,s;if(Ae(l,t.draggable,e,!1)&&!l.animated&&l!==a){var d=Ue(l);i.left=Math.min(null!==(n=i.left)&&void 0!==n?n:Infinity,d.left),i.top=Math.min(null!==(o=i.top)&&void 0!==o?o:Infinity,d.top),i.right=Math.max(null!==(r=i.right)&&void 0!==r?r:-Infinity,d.right),i.bottom=Math.max(null!==(s=i.bottom)&&void 0!==s?s:-Infinity,d.bottom)}})),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var ze="Sortable"+(new Date).getTime();function Je(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==Ne(e,"display")&&e!==Kt.ghost){t.push({target:e,rect:Ue(e)});var a=fe({},t[t.length-1].rect);if(e.thisAnimationDuration){var i=Le(e,!0);i&&(a.top-=i.f,a.left-=i.e)}e.fromRect=a}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var a in e)if(e.hasOwnProperty(a))for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[a][i])return Number(a);return-1}(t,{target:e}),1)},animateAll:function(a){var i=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof a&&a());var l=!1,n=0;t.forEach((function(e){var t=0,a=e.target,o=a.fromRect,r=Ue(a),s=a.prevFromRect,d=a.prevToRect,u=e.rect,c=Le(a,!0);c&&(r.top-=c.f,r.left-=c.e),a.toRect=r,a.thisAnimationDuration&&Be(s,r)&&!Be(o,r)&&(u.top-r.top)/(u.left-r.left)==(o.top-r.top)/(o.left-r.left)&&(t=function(e,t,a,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-a.top,2)+Math.pow(t.left-a.left,2))*i.animation}(u,s,d,i.options)),Be(r,o)||(a.prevFromRect=o,a.prevToRect=r,t||(t=i.options.animation),i.animate(a,u,r,t)),t&&(l=!0,n=Math.max(n,t),clearTimeout(a.animationResetTimer),a.animationResetTimer=setTimeout((function(){a.animationTime=0,a.prevFromRect=null,a.fromRect=null,a.prevToRect=null,a.thisAnimationDuration=null}),t),a.thisAnimationDuration=t)})),clearTimeout(e),l?e=setTimeout((function(){"function"==typeof a&&a()}),n):"function"==typeof a&&a(),t=[]},animate:function(e,t,a,i){if(i){Ne(e,"transition",""),Ne(e,"transform","");var l=Le(this.el),n=l&&l.a,o=l&&l.d,r=(t.left-a.left)/(n||1),s=(t.top-a.top)/(o||1);e.animatingX=!!r,e.animatingY=!!s,Ne(e,"transform","translate3d("+r+"px,"+s+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),Ne(e,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),Ne(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){Ne(e,"transition",""),Ne(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),i)}}}}var Ze=[],Qe={initializeByDefault:!0},et={mount:function(e){for(var t in Qe)Qe.hasOwnProperty(t)&&!(t in e)&&(e[t]=Qe[t]);Ze.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),Ze.push(e)},pluginEvent:function(e,t,a){var i=this;this.eventCanceled=!1,a.cancel=function(){i.eventCanceled=!0};var l=e+"Global";Ze.forEach((function(i){t[i.pluginName]&&(t[i.pluginName][l]&&t[i.pluginName][l](fe({sortable:t},a)),t.options[i.pluginName]&&t[i.pluginName][e]&&t[i.pluginName][e](fe({sortable:t},a)))}))},initializePlugins:function(e,t,a,i){for(var l in Ze.forEach((function(i){var l=i.pluginName;if(e.options[l]||i.initializeByDefault){var n=new i(e,t,e.options);n.sortable=e,n.options=e.options,e[l]=n,ge(a,n.defaults)}})),e.options)if(e.options.hasOwnProperty(l)){var n=this.modifyOption(e,l,e.options[l]);void 0!==n&&(e.options[l]=n)}},getEventProperties:function(e,t){var a={};return Ze.forEach((function(i){"function"==typeof i.eventProperties&&ge(a,i.eventProperties.call(t[i.pluginName],e))})),a},modifyOption:function(e,t,a){var i;return Ze.forEach((function(l){e[l.pluginName]&&l.optionListeners&&"function"==typeof l.optionListeners[t]&&(i=l.optionListeners[t].call(e[l.pluginName],a))})),i}};var tt=["evt"],at=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=a.evt,l=_e(a,tt);et.pluginEvent.bind(Kt)(e,t,fe({dragEl:lt,parentEl:nt,ghostEl:ot,rootEl:rt,nextEl:st,lastDownEl:dt,cloneEl:ut,cloneHidden:ct,dragStarted:Et,putSortable:_t,activeSortable:Kt.active,originalEvent:i,oldIndex:pt,oldDraggableIndex:ht,newIndex:ft,newDraggableIndex:mt,hideGhostForTarget:Xt,unhideGhostForTarget:Bt,cloneNowHidden:function(){ct=!0},cloneNowShown:function(){ct=!1},dispatchSortableEvent:function(e){it({sortable:t,name:e,originalEvent:i})}},l))};function it(e){!function(e){var t=e.sortable,a=e.rootEl,i=e.name,l=e.targetEl,n=e.cloneEl,o=e.toEl,r=e.fromEl,s=e.oldIndex,d=e.newIndex,u=e.oldDraggableIndex,c=e.newDraggableIndex,p=e.originalEvent,f=e.putSortable,h=e.extraEventProperties;if(t=t||a&&a[ze]){var m,g=t.options,_="on"+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||ye||be?(m=document.createEvent("Event")).initEvent(i,!0,!0):m=new CustomEvent(i,{bubbles:!0,cancelable:!0}),m.to=o||a,m.from=r||a,m.item=l||a,m.clone=n,m.oldIndex=s,m.newIndex=d,m.oldDraggableIndex=u,m.newDraggableIndex=c,m.originalEvent=p,m.pullMode=f?f.lastPutMode:void 0;var v=fe(fe({},h),et.getEventProperties(i,t));for(var y in v)m[y]=v[y];a&&a.dispatchEvent(m),g[_]&&g[_].call(t,m)}}(fe({putSortable:_t,cloneEl:ut,targetEl:lt,rootEl:rt,oldIndex:pt,oldDraggableIndex:ht,newIndex:ft,newDraggableIndex:mt},e))}var lt,nt,ot,rt,st,dt,ut,ct,pt,ft,ht,mt,gt,_t,vt,yt,bt,wt,St,Tt,Et,Dt,xt,Ct,kt,Ot=!1,At=!1,Mt=[],Pt=!1,It=!1,Nt=[],Lt=!1,Rt=[],qt="undefined"!=typeof document,Ut=Te,Yt=be||ye?"cssFloat":"float",jt=qt&&!Ee&&!Te&&"draggable"in document.createElement("div"),$t=function(){if(qt){if(ye)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Ft=function(e,t){var a=Ne(e),i=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),l=je(e,0,t),n=je(e,1,t),o=l&&Ne(l),r=n&&Ne(n),s=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+Ue(l).width,d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Ue(n).width;if("flex"===a.display)return"column"===a.flexDirection||"column-reverse"===a.flexDirection?"vertical":"horizontal";if("grid"===a.display)return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(l&&o.float&&"none"!==o.float){var u="left"===o.float?"left":"right";return!n||"both"!==r.clear&&r.clear!==u?"horizontal":"vertical"}return l&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||s>=i&&"none"===a[Yt]||n&&"none"===a[Yt]&&s+d>i)?"vertical":"horizontal"},Ht=function(e){function t(e,a){return function(i,l,n,o){var r=i.options.group.name&&l.options.group.name&&i.options.group.name===l.options.group.name;if(null==e&&(a||r))return!0;if(null==e||!1===e)return!1;if(a&&"clone"===e)return e;if("function"==typeof e)return t(e(i,l,n,o),a)(i,l,n,o);var s=(a?i:l).options.group.name;return!0===e||"string"==typeof e&&e===s||e.join&&e.indexOf(s)>-1}}var a={},i=e.group;i&&"object"==he(i)||(i={name:i}),a.name=i.name,a.checkPull=t(i.pull,!0),a.checkPut=t(i.put),a.revertClone=i.revertClone,e.group=a},Xt=function(){!$t&&ot&&Ne(ot,"display","none")},Bt=function(){!$t&&ot&&Ne(ot,"display","")};qt&&!Ee&&document.addEventListener("click",(function(e){if(At)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),At=!1,!1}),!0);var Vt=function(e){if(lt){e=e.touches?e.touches[0]:e;var t=(l=e.clientX,n=e.clientY,Mt.some((function(e){var t=e[ze].options.emptyInsertThreshold;if(t&&!$e(e)){var a=Ue(e),i=l>=a.left-t&&l<=a.right+t,r=n>=a.top-t&&n<=a.bottom+t;return i&&r?o=e:void 0}})),o);if(t){var a={};for(var i in e)e.hasOwnProperty(i)&&(a[i]=e[i]);a.target=a.rootEl=t,a.preventDefault=void 0,a.stopPropagation=void 0,t[ze]._onDragOver(a)}}var l,n,o},Gt=function(e){lt&&lt.parentNode[ze]._isOutsideThisEl(e.target)};function Kt(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=ge({},t),e[ze]=this;var a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ft(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Kt.supportPointer&&"PointerEvent"in window&&!Se,emptyInsertThreshold:5};for(var i in et.initializePlugins(this,e,a),a)!(i in t)&&(t[i]=a[i]);for(var l in Ht(t),this)"_"===l.charAt(0)&&"function"==typeof this[l]&&(this[l]=this[l].bind(this));this.nativeDraggable=!t.forceFallback&&jt,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?xe(e,"pointerdown",this._onTapStart):(xe(e,"mousedown",this._onTapStart),xe(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(xe(e,"dragover",this),xe(e,"dragenter",this)),Mt.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),ge(this,Je())}function Wt(e,t,a,i,l,n,o,r){var s,d,u=e[ze],c=u.options.onMove;return!window.CustomEvent||ye||be?(s=document.createEvent("Event")).initEvent("move",!0,!0):s=new CustomEvent("move",{bubbles:!0,cancelable:!0}),s.to=t,s.from=e,s.dragged=a,s.draggedRect=i,s.related=l||t,s.relatedRect=n||Ue(t),s.willInsertAfter=r,s.originalEvent=o,e.dispatchEvent(s),c&&(d=c.call(u,s,o)),d}function zt(e){e.draggable=!1}function Jt(){Lt=!1}function Zt(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,a=t.length,i=0;a--;)i+=t.charCodeAt(a);return i.toString(36)}function Qt(e){return setTimeout(e,0)}function ea(e){return clearTimeout(e)}Kt.prototype={constructor:Kt,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Dt=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,lt):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,a=this.el,i=this.options,l=i.preventOnFilter,n=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,r=(o||e).target,s=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,d=i.filter;if(function(e){Rt.length=0;var t=e.getElementsByTagName("input"),a=t.length;for(;a--;){var i=t[a];i.checked&&Rt.push(i)}}(a),!lt&&!(/mousedown|pointerdown/.test(n)&&0!==e.button||i.disabled)&&!s.isContentEditable&&(this.nativeDraggable||!Se||!r||"SELECT"!==r.tagName.toUpperCase())&&!((r=Ae(r,i.draggable,a,!1))&&r.animated||dt===r)){if(pt=Fe(r),ht=Fe(r,i.draggable),"function"==typeof d){if(d.call(this,e,r,this))return it({sortable:t,rootEl:s,name:"filter",targetEl:r,toEl:a,fromEl:a}),at("filter",t,{evt:e}),void(l&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some((function(i){if(i=Ae(s,i.trim(),a,!1))return it({sortable:t,rootEl:i,name:"filter",targetEl:r,fromEl:a,toEl:a}),at("filter",t,{evt:e}),!0}))))return void(l&&e.cancelable&&e.preventDefault());i.handle&&!Ae(s,i.handle,a,!1)||this._prepareDragStart(e,o,r)}}},_prepareDragStart:function(e,t,a){var i,l=this,n=l.el,o=l.options,r=n.ownerDocument;if(a&&!lt&&a.parentNode===n){var s=Ue(a);if(rt=n,nt=(lt=a).parentNode,st=lt.nextSibling,dt=a,gt=o.group,Kt.dragged=lt,vt={target:lt,clientX:(t||e).clientX,clientY:(t||e).clientY},St=vt.clientX-s.left,Tt=vt.clientY-s.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,lt.style["will-change"]="all",i=function(){at("delayEnded",l,{evt:e}),Kt.eventCanceled?l._onDrop():(l._disableDelayedDragEvents(),!we&&l.nativeDraggable&&(lt.draggable=!0),l._triggerDragStart(e,t),it({sortable:l,name:"choose",originalEvent:e}),Ie(lt,o.chosenClass,!0))},o.ignore.split(",").forEach((function(e){Re(lt,e.trim(),zt)})),xe(r,"dragover",Vt),xe(r,"mousemove",Vt),xe(r,"touchmove",Vt),xe(r,"mouseup",l._onDrop),xe(r,"touchend",l._onDrop),xe(r,"touchcancel",l._onDrop),we&&this.nativeDraggable&&(this.options.touchStartThreshold=4,lt.draggable=!0),at("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(be||ye))i();else{if(Kt.eventCanceled)return void this._onDrop();xe(r,"mouseup",l._disableDelayedDrag),xe(r,"touchend",l._disableDelayedDrag),xe(r,"touchcancel",l._disableDelayedDrag),xe(r,"mousemove",l._delayedDragTouchMoveHandler),xe(r,"touchmove",l._delayedDragTouchMoveHandler),o.supportPointer&&xe(r,"pointermove",l._delayedDragTouchMoveHandler),l._dragStartTimer=setTimeout(i,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){lt&&zt(lt),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;Ce(e,"mouseup",this._disableDelayedDrag),Ce(e,"touchend",this._disableDelayedDrag),Ce(e,"touchcancel",this._disableDelayedDrag),Ce(e,"mousemove",this._delayedDragTouchMoveHandler),Ce(e,"touchmove",this._delayedDragTouchMoveHandler),Ce(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?xe(document,"pointermove",this._onTouchMove):xe(document,t?"touchmove":"mousemove",this._onTouchMove):(xe(lt,"dragend",this),xe(rt,"dragstart",this._onDragStart));try{document.selection?Qt((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(a){}},_dragStarted:function(e,t){if(Ot=!1,rt&&lt){at("dragStarted",this,{evt:t}),this.nativeDraggable&&xe(document,"dragover",Gt);var a=this.options;!e&&Ie(lt,a.dragClass,!1),Ie(lt,a.ghostClass,!0),Kt.active=this,e&&this._appendGhost(),it({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(yt){this._lastX=yt.clientX,this._lastY=yt.clientY,Xt();for(var e=document.elementFromPoint(yt.clientX,yt.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(yt.clientX,yt.clientY))!==t;)t=e;if(lt.parentNode[ze]._isOutsideThisEl(e),t)do{if(t[ze]){if(t[ze]._onDragOver({clientX:yt.clientX,clientY:yt.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);Bt()}},_onTouchMove:function(e){if(vt){var t=this.options,a=t.fallbackTolerance,i=t.fallbackOffset,l=e.touches?e.touches[0]:e,n=ot&&Le(ot,!0),o=ot&&n&&n.a,r=ot&&n&&n.d,s=Ut&&kt&&He(kt),d=(l.clientX-vt.clientX+i.x)/(o||1)+(s?s[0]-Nt[0]:0)/(o||1),u=(l.clientY-vt.clientY+i.y)/(r||1)+(s?s[1]-Nt[1]:0)/(r||1);if(!Kt.active&&!Ot){if(a&&Math.max(Math.abs(l.clientX-this._lastX),Math.abs(l.clientY-this._lastY))<a)return;this._onDragStart(e,!0)}if(ot){n?(n.e+=d-(bt||0),n.f+=u-(wt||0)):n={a:1,b:0,c:0,d:1,e:d,f:u};var c="matrix(".concat(n.a,",").concat(n.b,",").concat(n.c,",").concat(n.d,",").concat(n.e,",").concat(n.f,")");Ne(ot,"webkitTransform",c),Ne(ot,"mozTransform",c),Ne(ot,"msTransform",c),Ne(ot,"transform",c),bt=d,wt=u,yt=l}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!ot){var e=this.options.fallbackOnBody?document.body:rt,t=Ue(lt,!0,Ut,!0,e),a=this.options;if(Ut){for(kt=e;"static"===Ne(kt,"position")&&"none"===Ne(kt,"transform")&&kt!==document;)kt=kt.parentNode;kt!==document.body&&kt!==document.documentElement?(kt===document&&(kt=qe()),t.top+=kt.scrollTop,t.left+=kt.scrollLeft):kt=qe(),Nt=He(kt)}Ie(ot=lt.cloneNode(!0),a.ghostClass,!1),Ie(ot,a.fallbackClass,!0),Ie(ot,a.dragClass,!0),Ne(ot,"transition",""),Ne(ot,"transform",""),Ne(ot,"box-sizing","border-box"),Ne(ot,"margin",0),Ne(ot,"top",t.top),Ne(ot,"left",t.left),Ne(ot,"width",t.width),Ne(ot,"height",t.height),Ne(ot,"opacity","0.8"),Ne(ot,"position",Ut?"absolute":"fixed"),Ne(ot,"zIndex","100000"),Ne(ot,"pointerEvents","none"),Kt.ghost=ot,e.appendChild(ot),Ne(ot,"transform-origin",St/parseInt(ot.style.width)*100+"% "+Tt/parseInt(ot.style.height)*100+"%")}},_onDragStart:function(e,t){var a=this,i=e.dataTransfer,l=a.options;at("dragStart",this,{evt:e}),Kt.eventCanceled?this._onDrop():(at("setupClone",this),Kt.eventCanceled||((ut=Ke(lt)).removeAttribute("id"),ut.draggable=!1,ut.style["will-change"]="",this._hideClone(),Ie(ut,this.options.chosenClass,!1),Kt.clone=ut),a.cloneId=Qt((function(){at("clone",a),Kt.eventCanceled||(a.options.removeCloneOnHide||rt.insertBefore(ut,lt),a._hideClone(),it({sortable:a,name:"clone"}))})),!t&&Ie(lt,l.dragClass,!0),t?(At=!0,a._loopId=setInterval(a._emulateDragOver,50)):(Ce(document,"mouseup",a._onDrop),Ce(document,"touchend",a._onDrop),Ce(document,"touchcancel",a._onDrop),i&&(i.effectAllowed="move",l.setData&&l.setData.call(a,i,lt)),xe(document,"drop",a),Ne(lt,"transform","translateZ(0)")),Ot=!0,a._dragStartId=Qt(a._dragStarted.bind(a,t,e)),xe(document,"selectstart",a),Et=!0,Se&&Ne(document.body,"user-select","none"))},_onDragOver:function(e){var t,a,i,l,n=this.el,o=e.target,r=this.options,s=r.group,d=Kt.active,u=gt===s,c=r.sort,p=_t||d,f=this,h=!1;if(!Lt){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),o=Ae(o,r.draggable,n,!0),O("dragOver"),Kt.eventCanceled)return h;if(lt.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||f._ignoreWhileAnimating===o)return M(!1);if(At=!1,d&&!r.disabled&&(u?c||(i=nt!==rt):_t===this||(this.lastPutMode=gt.checkPull(this,d,lt,e))&&s.checkPut(this,d,lt,e))){if(l="vertical"===this._getDirection(e,o),t=Ue(lt),O("dragOverValid"),Kt.eventCanceled)return h;if(i)return nt=rt,A(),this._hideClone(),O("revert"),Kt.eventCanceled||(st?rt.insertBefore(lt,st):rt.appendChild(lt)),M(!0);var m=$e(n,r.draggable);if(!m||function(e,t,a){var i=Ue($e(a.el,a.options.draggable)),l=We(a.el,a.options,ot),n=10;return t?e.clientX>l.right+n||e.clientY>i.bottom&&e.clientX>i.left:e.clientY>l.bottom+n||e.clientX>i.right&&e.clientY>i.top}(e,l,this)&&!m.animated){if(m===lt)return M(!1);if(m&&n===e.target&&(o=m),o&&(a=Ue(o)),!1!==Wt(rt,n,lt,t,o,a,e,!!o))return A(),m&&m.nextSibling?n.insertBefore(lt,m.nextSibling):n.appendChild(lt),nt=n,P(),M(!0)}else if(m&&function(e,t,a){var i=Ue(je(a.el,0,a.options,!0)),l=We(a.el,a.options,ot),n=10;return t?e.clientX<l.left-n||e.clientY<i.top&&e.clientX<i.right:e.clientY<l.top-n||e.clientY<i.bottom&&e.clientX<i.left}(e,l,this)){var g=je(n,0,r,!0);if(g===lt)return M(!1);if(a=Ue(o=g),!1!==Wt(rt,n,lt,t,o,a,e,!1))return A(),n.insertBefore(lt,g),nt=n,P(),M(!0)}else if(o.parentNode===n){a=Ue(o);var _,v,y,b=lt.parentNode!==n,w=!function(e,t,a){var i=a?e.left:e.top,l=a?e.right:e.bottom,n=a?e.width:e.height,o=a?t.left:t.top,r=a?t.right:t.bottom,s=a?t.width:t.height;return i===o||l===r||i+n/2===o+s/2}(lt.animated&&lt.toRect||t,o.animated&&o.toRect||a,l),S=l?"top":"left",T=Ye(o,"top","top")||Ye(lt,"top","top"),E=T?T.scrollTop:void 0;if(Dt!==o&&(v=a[S],Pt=!1,It=!w&&r.invertSwap||b),_=function(e,t,a,i,l,n,o,r){var s=i?e.clientY:e.clientX,d=i?a.height:a.width,u=i?a.top:a.left,c=i?a.bottom:a.right,p=!1;if(!o)if(r&&Ct<d*l){if(!Pt&&(1===xt?s>u+d*n/2:s<c-d*n/2)&&(Pt=!0),Pt)p=!0;else if(1===xt?s<u+Ct:s>c-Ct)return-xt}else if(s>u+d*(1-l)/2&&s<c-d*(1-l)/2)return function(e){return Fe(lt)<Fe(e)?1:-1}(t);if((p=p||o)&&(s<u+d*n/2||s>c-d*n/2))return s>u+d/2?1:-1;return 0}(e,o,a,l,w?1:r.swapThreshold,null==r.invertedSwapThreshold?r.swapThreshold:r.invertedSwapThreshold,It,Dt===o),0!==_){var D=Fe(lt);do{D-=_,y=nt.children[D]}while(y&&("none"===Ne(y,"display")||y===ot))}if(0===_||y===o)return M(!1);Dt=o,xt=_;var x=o.nextElementSibling,C=!1,k=Wt(rt,n,lt,t,o,a,e,C=1===_);if(!1!==k)return 1!==k&&-1!==k||(C=1===k),Lt=!0,setTimeout(Jt,30),A(),C&&!x?n.appendChild(lt):o.parentNode.insertBefore(lt,C?x:o),T&&Ge(T,0,E-T.scrollTop),nt=lt.parentNode,void 0===v||It||(Ct=Math.abs(v-Ue(o)[S])),P(),M(!0)}if(n.contains(lt))return M(!1)}return!1}function O(r,s){at(r,f,fe({evt:e,isOwner:u,axis:l?"vertical":"horizontal",revert:i,dragRect:t,targetRect:a,canSort:c,fromSortable:p,target:o,completed:M,onMove:function(a,i){return Wt(rt,n,lt,t,a,Ue(a),e,i)},changed:P},s))}function A(){O("dragOverAnimationCapture"),f.captureAnimationState(),f!==p&&p.captureAnimationState()}function M(t){return O("dragOverCompleted",{insertion:t}),t&&(u?d._hideClone():d._showClone(f),f!==p&&(Ie(lt,_t?_t.options.ghostClass:d.options.ghostClass,!1),Ie(lt,r.ghostClass,!0)),_t!==f&&f!==Kt.active?_t=f:f===Kt.active&&_t&&(_t=null),p===f&&(f._ignoreWhileAnimating=o),f.animateAll((function(){O("dragOverAnimationComplete"),f._ignoreWhileAnimating=null})),f!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(o===lt&&!lt.animated||o===n&&!o.animated)&&(Dt=null),r.dragoverBubble||e.rootEl||o===document||(lt.parentNode[ze]._isOutsideThisEl(e.target),!t&&Vt(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),h=!0}function P(){ft=Fe(lt),mt=Fe(lt,r.draggable),it({sortable:f,name:"change",toEl:n,newIndex:ft,newDraggableIndex:mt,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){Ce(document,"mousemove",this._onTouchMove),Ce(document,"touchmove",this._onTouchMove),Ce(document,"pointermove",this._onTouchMove),Ce(document,"dragover",Vt),Ce(document,"mousemove",Vt),Ce(document,"touchmove",Vt)},_offUpEvents:function(){var e=this.el.ownerDocument;Ce(e,"mouseup",this._onDrop),Ce(e,"touchend",this._onDrop),Ce(e,"pointerup",this._onDrop),Ce(e,"touchcancel",this._onDrop),Ce(document,"selectstart",this)},_onDrop:function(e){var t=this.el,a=this.options;ft=Fe(lt),mt=Fe(lt,a.draggable),at("drop",this,{evt:e}),nt=lt&&lt.parentNode,ft=Fe(lt),mt=Fe(lt,a.draggable),Kt.eventCanceled||(Ot=!1,It=!1,Pt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),ea(this.cloneId),ea(this._dragStartId),this.nativeDraggable&&(Ce(document,"drop",this),Ce(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Se&&Ne(document.body,"user-select",""),Ne(lt,"transform",""),e&&(Et&&(e.cancelable&&e.preventDefault(),!a.dropBubble&&e.stopPropagation()),ot&&ot.parentNode&&ot.parentNode.removeChild(ot),(rt===nt||_t&&"clone"!==_t.lastPutMode)&&ut&&ut.parentNode&&ut.parentNode.removeChild(ut),lt&&(this.nativeDraggable&&Ce(lt,"dragend",this),zt(lt),lt.style["will-change"]="",Et&&!Ot&&Ie(lt,_t?_t.options.ghostClass:this.options.ghostClass,!1),Ie(lt,this.options.chosenClass,!1),it({sortable:this,name:"unchoose",toEl:nt,newIndex:null,newDraggableIndex:null,originalEvent:e}),rt!==nt?(ft>=0&&(it({rootEl:nt,name:"add",toEl:nt,fromEl:rt,originalEvent:e}),it({sortable:this,name:"remove",toEl:nt,originalEvent:e}),it({rootEl:nt,name:"sort",toEl:nt,fromEl:rt,originalEvent:e}),it({sortable:this,name:"sort",toEl:nt,originalEvent:e})),_t&&_t.save()):ft!==pt&&ft>=0&&(it({sortable:this,name:"update",toEl:nt,originalEvent:e}),it({sortable:this,name:"sort",toEl:nt,originalEvent:e})),Kt.active&&(null!=ft&&-1!==ft||(ft=pt,mt=ht),it({sortable:this,name:"end",toEl:nt,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){at("nulling",this),rt=lt=nt=ot=st=ut=dt=ct=vt=yt=Et=ft=mt=pt=ht=Dt=xt=_t=gt=Kt.dragged=Kt.ghost=Kt.clone=Kt.active=null,Rt.forEach((function(e){e.checked=!0})),Rt.length=bt=wt=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":lt&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],a=this.el.children,i=0,l=a.length,n=this.options;i<l;i++)Ae(e=a[i],n.draggable,this.el,!1)&&t.push(e.getAttribute(n.dataIdAttr)||Zt(e));return t},sort:function(e,t){var a={},i=this.el;this.toArray().forEach((function(e,t){var l=i.children[t];Ae(l,this.options.draggable,i,!1)&&(a[e]=l)}),this),t&&this.captureAnimationState(),e.forEach((function(e){a[e]&&(i.removeChild(a[e]),i.appendChild(a[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Ae(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var a=this.options;if(void 0===t)return a[e];var i=et.modifyOption(this,e,t);a[e]=void 0!==i?i:t,"group"===e&&Ht(a)},destroy:function(){at("destroy",this);var e=this.el;e[ze]=null,Ce(e,"mousedown",this._onTapStart),Ce(e,"touchstart",this._onTapStart),Ce(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Ce(e,"dragover",this),Ce(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),Mt.splice(Mt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!ct){if(at("hideClone",this),Kt.eventCanceled)return;Ne(ut,"display","none"),this.options.removeCloneOnHide&&ut.parentNode&&ut.parentNode.removeChild(ut),ct=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(ct){if(at("showClone",this),Kt.eventCanceled)return;lt.parentNode!=rt||this.options.group.revertClone?st?rt.insertBefore(ut,st):rt.appendChild(ut):rt.insertBefore(ut,lt),this.options.group.revertClone&&this.animate(lt,ut),Ne(ut,"display",""),ct=!1}}else this._hideClone()}},qt&&xe(document,"touchmove",(function(e){(Kt.active||Ot)&&e.cancelable&&e.preventDefault()})),Kt.utils={on:xe,off:Ce,css:Ne,find:Re,is:function(e,t){return!!Ae(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},throttle:Ve,closest:Ae,toggleClass:Ie,clone:Ke,index:Fe,nextTick:Qt,cancelNextTick:ea,detectDirection:Ft,getChild:je},Kt.get=function(e){return e[ze]},Kt.mount=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Kt.utils=fe(fe({},Kt.utils),e.utils)),et.mount(e)}))},Kt.create=function(e,t){return new Kt(e,t)},Kt.version="1.15.2";var ta,aa,ia,la,na,oa,ra=[],sa=!1;function da(){ra.forEach((function(e){clearInterval(e.pid)})),ra=[]}function ua(){clearInterval(oa)}var ca=Ve((function(e,t,a,i){if(t.scroll){var l,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,s=t.scrollSpeed,d=qe(),u=!1;aa!==a&&(aa=a,da(),ta=t.scroll,l=t.scrollFn,!0===ta&&(ta=Xe(a,!0)));var c=0,p=ta;do{var f=p,h=Ue(f),m=h.top,g=h.bottom,_=h.left,v=h.right,y=h.width,b=h.height,w=void 0,S=void 0,T=f.scrollWidth,E=f.scrollHeight,D=Ne(f),x=f.scrollLeft,C=f.scrollTop;f===d?(w=y<T&&("auto"===D.overflowX||"scroll"===D.overflowX||"visible"===D.overflowX),S=b<E&&("auto"===D.overflowY||"scroll"===D.overflowY||"visible"===D.overflowY)):(w=y<T&&("auto"===D.overflowX||"scroll"===D.overflowX),S=b<E&&("auto"===D.overflowY||"scroll"===D.overflowY));var k=w&&(Math.abs(v-n)<=r&&x+y<T)-(Math.abs(_-n)<=r&&!!x),O=S&&(Math.abs(g-o)<=r&&C+b<E)-(Math.abs(m-o)<=r&&!!C);if(!ra[c])for(var A=0;A<=c;A++)ra[A]||(ra[A]={});ra[c].vx==k&&ra[c].vy==O&&ra[c].el===f||(ra[c].el=f,ra[c].vx=k,ra[c].vy=O,clearInterval(ra[c].pid),0==k&&0==O||(u=!0,ra[c].pid=setInterval(function(){i&&0===this.layer&&Kt.active._onTouchMove(na);var t=ra[this.layer].vy?ra[this.layer].vy*s:0,a=ra[this.layer].vx?ra[this.layer].vx*s:0;"function"==typeof l&&"continue"!==l.call(Kt.dragged.parentNode[ze],a,t,e,na,ra[this.layer].el)||Ge(ra[this.layer].el,a,t)}.bind({layer:c}),24))),c++}while(t.bubbleScroll&&p!==d&&(p=Xe(p,!1)));sa=u}}),30),pa=function(e){var t=e.originalEvent,a=e.putSortable,i=e.dragEl,l=e.activeSortable,n=e.dispatchSortableEvent,o=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var s=a||l;o();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(d.clientX,d.clientY);r(),s&&!s.el.contains(u)&&(n("spill"),this.onSpill({dragEl:i,putSortable:a}))}};function fa(){}function ha(){}fa.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,a=e.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var i=je(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(t,i):this.sortable.el.appendChild(t),this.sortable.animateAll(),a&&a.animateAll()},drop:pa},ge(fa,{pluginName:"revertOnSpill"}),ha.prototype={onSpill:function(e){var t=e.dragEl,a=e.putSortable||this.sortable;a.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),a.animateAll()},drop:pa},ge(ha,{pluginName:"removeOnSpill"}),Kt.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?xe(document,"dragover",this._handleAutoScroll):this.options.supportPointer?xe(document,"pointermove",this._handleFallbackAutoScroll):t.touches?xe(document,"touchmove",this._handleFallbackAutoScroll):xe(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?Ce(document,"dragover",this._handleAutoScroll):(Ce(document,"pointermove",this._handleFallbackAutoScroll),Ce(document,"touchmove",this._handleFallbackAutoScroll),Ce(document,"mousemove",this._handleFallbackAutoScroll)),ua(),da(),clearTimeout(Me),Me=void 0},nulling:function(){na=aa=ta=sa=oa=ia=la=null,ra.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var a=this,i=(e.touches?e.touches[0]:e).clientX,l=(e.touches?e.touches[0]:e).clientY,n=document.elementFromPoint(i,l);if(na=e,t||this.options.forceAutoScrollFallback||be||ye||Se){ca(e,this.options,n,t);var o=Xe(n,!0);!sa||oa&&i===ia&&l===la||(oa&&ua(),oa=setInterval((function(){var n=Xe(document.elementFromPoint(i,l),!0);n!==o&&(o=n,da()),ca(e,a.options,n,t)}),10),ia=i,la=l)}else{if(!this.options.bubbleScroll||Xe(n,!0)===qe())return void da();ca(e,this.options,Xe(n,!1),!1)}}},ge(e,{pluginName:"scroll",initializeByDefault:!0})}),Kt.mount(ha,fa);const ma=[{layer:1,block:1,types:1,sorting:3,lower_layer:0,field:"sorting",field_name:"排序",page_sort:1,page_display:!0,edit_display:!1,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:1,field:"id",field_name:"NO.",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:2,lower_layer:0,field:"field",field_name:"DB字段",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:4,lower_layer:0,field:"field_name",field_name:"字段名",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:5,lower_layer:0,field:"types",field_name:"类型",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:{data:{1:"Title",2:"Button"},data_source:"data"},field_explain:null},{layer:1,block:1,types:1,sorting:7,page_sort:!0,field:"permissions_url",field_name:"权限URL",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"select",multiple:"tags"},field_explain:null},{layer:1,block:1,types:1,sorting:6,lower_layer:0,field:"page_display",field_name:"页面显示",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:11,page_sort:!0,field:"sub_page_display",field_name:"子页面展示",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!1,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:7,lower_layer:0,field:"layer",field_name:"层号",page_display:!0,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:{data:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13},data_source:"data"},field_explain:null},{layer:1,block:1,types:1,sorting:8,lower_layer:0,field:"block",field_name:"块号",page_display:!1,edit_display:!0,edit_required:!0,edit_change:!0,search_display:!0,page_data_source:null,field_explain:null},{layer:1,block:1,types:1,sorting:9,lower_layer:0,field:"edit_display",field_name:"编辑显示",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:10,lower_layer:0,field:"edit_required",field_name:"必填",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:11,lower_layer:0,field:"edit_change",field_name:"可否编辑",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:12,lower_layer:0,field:"search_display",field_name:"搜索显示",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:16,lower_layer:0,field:"page_sort",field_name:"是否排序",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"boole"},field_explain:null},{layer:1,block:1,types:1,sorting:14,lower_layer:null,field:"page_data_source",field_name:"数据源",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!0,page_data_source:{form_type:"json"},field_explain:"仅支持JSON格式字符串"},{layer:1,block:1,types:1,sorting:15,lower_layer:null,field:"field_explain",field_name:"字段说明",page_display:!0,edit_display:!0,edit_required:!1,edit_change:!0,search_display:!1,page_data_source:null,field_explain:""},{layer:1,block:1,types:1,sorting:18,lower_layer:0,field:"operation",field_name:"操作",page_display:!0,edit_display:!1,edit_required:!1,edit_change:!1,search_display:!1,page_data_source:null,field_explain:null}],ga="manage/title/",_a={getTitleList:t=>e.get(`${ga}list/${t}`),getOneTitleList:t=>e.get(`${ga}get-one/${t}`),postOneTitleAdd:t=>e.post(`${ga}add`,t),putOneTitleEdit:(t,a)=>e.put(`${ga}edit/${t}`,a),putOneTitleSort:(t,a)=>e.put(`${ga}sort/${t}?title_sort=${a}`),delOneTitle:t=>e.delete(`${ga}del/${t}`)},va={__name:"TitleEdit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},menuId:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open","editSuccess"],setup(e,{emit:t}){const a=e,{open:m,sid:E,formType:D,menuId:x}=i(a),C=t;let k=l(null);const{putOneTitleEdit:O,getOneTitleList:A,postOneTitleAdd:M}=_a,P=[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"DELETE",value:"DELETE"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"},{label:"ws",value:"ws"}];let{formRenderContent:I,formDataLoading:N,confirmLoading:L,initForm:R,formDataInit:q,editSubmit:U}=W({formRef:k,editTitleLayer:1,formType:D,sid:E,emits:C,editApi:O,oneDataApi:A,addApi:M,customSubmitData:async e=>{const t={...e};if(t.menu_id=x.value,Array.isArray(t.permissions_url)){const e=t.permissions_url.filter((e=>e.method&&e.url));e.length>0?t.permissions_url=e.map((e=>`${e.method}:${e.url}`)):t.permissions_url=[]}return e.page_data_source&&"string"==typeof e.page_data_source&&(t.page_data_source=JSON.parse(e.page_data_source)),t},customOneData:e=>{let t=T.clone(e.value?e.value:{},!0);t.permissions_url?I.value.formState.permissions_url=t.permissions_url.map((e=>{const[t,a]=e.indexOf(":")>-1?String(e).split(":"):["",e];return{method:t,url:a,id:Date.now()}})):I.value.formState.permissions_url=[]},customTitle:ma,customTitleInit:()=>{const e=I.value.title.find((e=>"permissions_url"===e.field));e&&(e.edit_required=!1)}});const Y=()=>{C("update:open",!1)},j=async e=>{e&&(await R(),await q())},$=()=>{Array.isArray(I.value.formState.permissions_url)||(I.value.formState.permissions_url=[]),I.value.formState.permissions_url.push({method:"",url:"",id:Date.now()})};return(e,t)=>{const a=ee,i=g,l=_,T=v,E=n("MinusCircleOutlined"),x=y,C=n("PlusOutlined"),O=b,A=z,M=w,R=S,q=n("vxe-button"),F=Q;return o(),r(F,{title:"Title"+(u(D)===e.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"),open:u(m),onAfterOpenChange:j,onClose:Y},{footer:s((()=>[d(q,{content:"取消",onClick:Y}),d(q,{type:"submit",loading:u(L),status:"primary",content:"提交",onClick:u(U)},null,8,["loading","onClick"])])),default:s((()=>[d(R,{spinning:u(N)},{default:s((()=>[d(M,{ref_key:"formRef",ref:k,model:u(I).formState},{default:s((()=>[(o(!0),c(p,null,f(e.$utils.filter(u(I).title,(e=>e.edit_display)),(e=>{var t,n,m,g;return o(),c(p,{key:e.field},["permissions_url"===e.field?(o(),r(A,{key:0,value:u(I).formState[e.field],"onUpdate:value":t=>u(I).formState[e.field]=t,title:e,"title-data":null==(n=null==(t=u(I))?void 0:t.title_data)?void 0:n[e.field]},{default:s((()=>[(o(!0),c(p,null,f(u(I).formState.permissions_url,((e,t)=>(o(),r(x,{key:e.id,class:"mb-2",type:"flex"},{default:s((()=>[d(l,{flex:"20%"},{default:s((()=>[d(i,{name:["permissions_url",t,"method"],rules:{required:!0,message:"请求方式"}},{default:s((()=>[d(a,{value:e.method,"onUpdate:value":t=>e.method=t,options:P,placeholder:"请选择请求方式","show-arrow":"","show-search":""},null,8,["value","onUpdate:value"])])),_:2},1032,["name"])])),_:2},1024),d(l,{flex:"80%"},{default:s((()=>[d(x,{type:"flex"},{default:s((()=>[d(l,{flex:"90%"},{default:s((()=>[d(i,{name:["permissions_url",t,"url"],rules:{required:!1,message:"请输入权限URL"}},{default:s((()=>[d(T,{value:e.url,"onUpdate:value":t=>e.url=t,class:"xy-url-input",placeholder:"输入权限URL"},null,8,["value","onUpdate:value"])])),_:2},1032,["name"])])),_:2},1024),d(l,{flex:"10%"},{default:s((()=>[h("   "),d(E,{onClick:e=>(e=>{I.value.formState.permissions_url.splice(e,1)})(t)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),d(O,{type:"dashed",block:"",onClick:$},{default:s((()=>[d(C),h(" 新增权限URL ")])),_:1})])),_:2},1032,["value","onUpdate:value","title","title-data"])):(o(),r(A,{key:1,value:u(I).formState[e.field],"onUpdate:value":t=>u(I).formState[e.field]=t,title:e,"title-data":null==(g=null==(m=u(I))?void 0:m.title_data)?void 0:g[e.field],required:!!(null==e?void 0:e.edit_required)},null,8,["value","onUpdate:value","title","title-data","required"]))],64)})),128))])),_:1},8,["model"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},ya={class:"flex items-center space-x-4"},ba={class:"flex items-center"},wa=k("span",{class:"mr-2"},"类型",-1),Sa=k("i",{class:"vxe-icon-funnel mr-2"},null,-1),Ta={key:0,class:"flex items-center"},Ea=k("span",{class:"mr-2"},"层号",-1),Da=k("i",{class:"vxe-icon-funnel mr-2"},null,-1),xa={key:0,class:"overflow-hidden"},Ca=k("span",null,"层号 / 块号",-1),ka=["innerHTML"],Oa={__name:"Title",props:{menuId:{type:[String,Number]},showTitle:{type:Boolean,default:!1}},setup(e,{expose:t}){const a=e,{menuId:_}=i(a),v=E({initColumn:[],initTableData:{},filterConditions:{types:null,layer:1},showHelpTip:!1,dataSourceHighlight:"",dataSourceVisible:!1,fullData:[],canUserAction:{edit:{page_display:!0},add:{page_display:!0},del:{page_display:!0}},copyTitle:D((()=>T.clone(v.fullData,!0).map((e=>(delete e.id,delete e.create_time,delete e.menu_id,delete e.update_time,e)))))}),y=l(null),S=D((()=>T.groupBy(v.fullData,"layer"))),q=async()=>{_.value&&M((async()=>{var e;await(null==(e=y.value)?void 0:e.commitRequest())}))};x(_,(()=>{v.filterConditions={types:null,layer:1},q()})),C((async()=>{let{table_columns:e,table_title_data:t}=await K.formatTitle({title:ma,isCustomTitle:!0}),a=["title","operation","permissions_url"];if(v.initTableData=t.value||{},e&&Array.isArray(e))for(let i of e){let{field:e,oriTitle:t}=i;switch(a.indexOf(e)>-1&&(i.slots={default:e}),e){case"sorting":i.dragSort=!0,i.fixed="left";break;case"types":i.formatter=({cellValue:e})=>{var a;return(null==t?void 0:t.title_data)&&(null==(a=t.title_data)?void 0:a[e])||e};break;case"permissions_url":case"page_data_source":i.showOverflow=!1,i.slots={default:e};break;case"layer":i.showOverflow=!1,i.slots={default:e,header:`${e}_header`};break;case"edit_display":case"edit_required":case"edit_change":case"search_display":case"page_sort":i.visible=!1,i.sortable=!0}}v.initColumn=e||[]}));const U=({newRow:e,oldRow:t})=>{M((async()=>{const a=S.value[t.layer];let i=T.findKey(a,(t=>t.id===e.id));if(i>-1)try{const e=await _a.putOneTitleSort(t.id,i);Z({content:null==e?void 0:e.msg,closeCallback:async()=>{await q(),v.filterConditions.layer&&G(t.layer)}})}catch{q()}}))},{userDel:Y,userEdit:j,formOpen:$,formType:F,formSid:H}=J(),X=({type:e,row:t})=>{j({type:e,sid:t.id})},B=e=>{Y({delApi:_a.delOneTitle,sid:e.id,loadData:q})},V=e=>{M((()=>{v.filterConditions.types="all"===e?null:e}))},G=e=>{M((()=>{v.filterConditions.layer=e}))};let W=l(!1),z=l(null),Q=E({multiAddValue:""}),ne=E({multiAddValue:[{required:!0,message:"此项不能为空"},{validator:ie,message:"请输入正确的json格式"}]});function oe(){W.value=!0,z.value&&z.value.clearValidate(),Q.multiAddValue=""}let re=l(!1);function se(){z.value.validateFields().then((async()=>{re.value=!0;let e=JSON.parse(Q.multiAddValue);e.forEach((e=>{e.menu_id=_.value})),_a.postOneTitleAdd(e).then((e=>{re.value=!1,Z({content:null==e?void 0:e.msg,closeCallback:q})})).catch((()=>{re.value=!1}))}))}const de=e=>{v.fullData=e};return t({handlePageInit:()=>{M((()=>{v.filterConditions={types:null,layer:1},q()}))}}),(t,a)=>{const i=n("vxe-button"),l=P,S=b,T=I,E=te,D=ee,x=N,C=ae,M=L,Y=R,K=g,J=w;return o(),c(p,null,[e.showTitle?(o(),r(C,{key:0,ref_key:"titleTableRef",ref:y,columns:u(v).initColumn,"auth-btn":u(v).canUserAction,"scroll-y":{enabled:!0,gt:100},"request-config":{api:u(_a).getTitleList,params:u(_),immediate:!1},"switch-click-status-config":{api:u(_a).putOneTitleEdit},"row-config":{isHover:!0,isCurrent:!0,drag:!0},"default-order":{field:"sorting",order:"asc"},"filter-conditions":u(v).filterConditions,onUserEdit:X,onUserAdd:a[2]||(a[2]=e=>u(j)({type:t.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:B,onRowDragend:U,"onUpdate:fullData":de},{other_toolbar_buttons:s((()=>[d(i,{status:"primary",content:"批量新增",onClick:oe}),d(l,{copyable:{text:JSON.stringify(u(v).copyTitle)}},null,8,["copyable"])])),toolSearchPrefix:s((()=>{var e;return[k("div",ya,[k("div",ba,[wa,Sa,d(T,null,{default:s((()=>[d(S,{type:"primary",ghost:null!==u(v).filterConditions.types,onClick:a[0]||(a[0]=e=>V("all"))},{default:s((()=>[h(" 全部 ")])),_:1},8,["ghost"]),(o(!0),c(p,null,f(u(v).initTableData.types,((e,t)=>(o(),r(S,{key:t,type:"primary",ghost:u(v).filterConditions.types!==t,onClick:e=>V(t)},{default:s((()=>[h(O(e),1)])),_:2},1032,["ghost","onClick"])))),128))])),_:1})]),(null==(e=u(v).initTableData)?void 0:e.layer)?(o(),c("div",Ta,[Ea,Da,d(D,{value:u(v).filterConditions.layer,"onUpdate:value":a[1]||(a[1]=e=>u(v).filterConditions.layer=e),class:"w-[100px]","show-search":"",onChange:G},{default:s((()=>[(o(!0),c(p,null,f(u(v).initTableData.layer,(e=>(o(),r(E,{key:e,label:e},{default:s((()=>[h(O(e)+"层 ",1)])),_:2},1032,["label"])))),128))])),_:1},8,["value"])])):m("",!0)])]})),permissions_url:s((({row:e})=>[(null==e?void 0:e.permissions_url)?(o(),c("div",xa,[(o(!0),c(p,null,f(e.permissions_url,(e=>(o(),r(x,{key:e,color:"purple",class:"mb-1"},{default:s((()=>[h(O(e),1)])),_:2},1024)))),128))])):m("",!0)])),page_data_source:s((({row:e})=>[e.page_data_source?(o(),r(i,{key:0,status:"primary",content:"点击查看",onClick:t=>{return a=e.page_data_source,v.dataSourceVisible=!0,void(v.dataSourceHighlight=le(a));var a}},null,8,["onClick"])):m("",!0)])),layer_header:s((()=>[Ca])),layer:s((({row:e})=>[h(O(e.layer)+" / "+O(e.block),1)])),_:1},8,["columns","auth-btn","request-config","switch-click-status-config","filter-conditions"])):m("",!0),d(M,{open:u(v).dataSourceVisible,"onUpdate:open":a[3]||(a[3]=e=>u(v).dataSourceVisible=e),title:"",centered:!0,closable:!1,footer:null},{default:s((()=>[k("pre",{innerHTML:u(v).dataSourceHighlight},null,8,ka)])),_:1},8,["open"]),d(va,{open:u($),"onUpdate:open":a[4]||(a[4]=e=>A($)?$.value=e:null),sid:u(H),"menu-id":u(_),"form-type":u(F),onEditSuccess:q},null,8,["open","sid","menu-id","form-type"]),d(M,{open:u(W),"onUpdate:open":a[6]||(a[6]=e=>A(W)?W.value=e:W=e),title:"批量新增Title","confirm-loading":u(re),centered:!0,width:800,onOk:se},{default:s((()=>[d(J,{ref_key:"formRef",ref:z,model:u(Q),rules:u(ne),"label-col":{span:4},"label-align":"left",colon:!1},{default:s((()=>[d(K,{name:"multiAddValue"},{default:s((()=>[d(Y,{value:u(Q).multiAddValue,"onUpdate:value":a[5]||(a[5]=e=>u(Q).multiAddValue=e),"auto-size":{minRows:6}},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["open","confirm-loading"])],64)}}},Aa=k("span",{class:"drag-menu-level1-btn cursor-move"},[k("i",{class:"vxe-table-icon-drag-handle"})],-1),Ma={style:{float:"right"}},Pa={key:0,style:{overflow:"hidden"}},Ia=k("br",null,null,-1),Na=["innerHTML"],La={__name:"index",setup(e){const t=l(null);let a=null;const i=E({initColumn:[],tableData:[],allData:[],tableLoading:!1,leftMenuLevel:[],selectedLeftKeys:[],leftMenuLoading:!1,collapsed:!1,activeTab:null,tabArr:[],sortable1:null,sortableMenuLevel:null,showHelpTip:!1,initTime:null,dataSourceVisible:!1,dataSourceHighlight:""}),g={edit:{page_display:!0},add:{page_display:!0},del:{page_display:!0}},_=async(e,a)=>{i.tableLoading=!0,a&&(i.activeTab=e,i.tabArr=a?[a.item]:[]);try{M((async()=>{var e;t.value&&await(null==(e=t.value)?void 0:e.commitRequest())})),i.tableLoading=!1}catch(l){i.tableLoading=!1}},{userDel:v,userEdit:y,formOpen:b,formType:w,formSid:x}=J(),P=({type:e,row:t})=>{y({type:e,sid:t.id})},I=e=>{v({delApi:de.delOneMenu,sid:e.id,loadData:_})};C((async()=>{let{table_columns:e}=await K.formatTitle({title:ue,isCustomTitle:!0});const t=["title","level_1","permissions_url"];if(e&&Array.isArray(e))for(let a of e){let{field:e,oriTitle:i}=a;switch(t.indexOf(e)>-1&&(a.slots={default:e}),e){case"sorting":a.dragSort=!0;break;case"permissions_url":case"page_data_source":a.showOverflow=!1,a.slots={default:e};break;case"level_2":a.formatter=({cellValue:e})=>{var t,a;return(null==i?void 0:i.title_data)&&(null==(a=null==(t=i.title_data)?void 0:t[T.findKey(i.title_data,(t=>t.id===e))])?void 0:a.menu_name)||e}}}i.initColumn=e||[],await(async()=>{var e,t;i.leftMenuLoading=!0;try{const a=await de.getMenusList(0);i.leftMenuLevel=a,i.selectedLeftKeys=[null==(e=null==a?void 0:a[0])?void 0:e.id],i.activeTab=null==(t=null==a?void 0:a[0])?void 0:t.id,i.tabArr=[a[0]],i.leftMenuLoading=!1}catch(a){i.leftMenuLoading=!1}})(),await _(),M((()=>{a=setTimeout((()=>{te()}),500)}))}));const R=D((()=>{var e;return 0!==(null==(e=i.tabArr.find((e=>e.id===i.activeTab)))?void 0:e.level_2)})),W=e=>{var a;let l=i.tabArr[T.findKey(i.tabArr,(t=>t.id===e))];l.level_1?t.value&&(null==(a=t.value)||a.commitRequest()):i.activeTab=l.id},z=(e,a)=>{var l;if("remove"===a)if(i.tabArr=i.tabArr.filter((t=>t.id!==e)),0===i.tabArr.length)i.activeTab=null;else{let e=i.tabArr[i.tabArr.length-1];i.activeTab=i.tabArr[i.tabArr.length-1].id,e.level_1&&t.value&&(null==(l=t.value)||l.commitRequest())}};let Q=null,ee=l(null);const te=()=>{Q=Kt.create(document.getElementById("menu-level1-box"),{handle:".drag-menu-level1-btn",onEnd:e=>{const t=e.newIndex,a=e.oldIndex,l=i.leftMenuLevel.splice(a,1)[0];i.leftMenuLevel.splice(t,0,l);const n=T.findKey(i.leftMenuLevel,(e=>e.id===l.id));de.putOneMenuSort(l.id,n).then((e=>{Z({content:null==e?void 0:e.msg,closeCallback:()=>{_(0)}})})).catch((()=>{M((()=>{_(0)}))}))}})},ie=({newRow:e,oldRow:t})=>{let a=i.tableData.findIndex((t=>t.id===e.id));a>-1&&de.putOneMenuSort(t.id,a+1).then((e=>{Z({content:null==e?void 0:e.msg,closeCallback:()=>{_(i.selectedLeftKeys)}})})).catch((()=>{M((()=>{_(i.selectedLeftKeys)}))}))};return q((()=>{clearTimeout(a),Q&&Q.destroy()})),(e,a)=>{const l=$,v=n("vxe-button"),E=F,D=H,C=X,M=S,q=ne,K=B,J=V,Z=N,Q=G,te=oe,se=re,ue=L;return o(),c(p,null,[d(se,{style:{height:"100%"}},{default:s((()=>[d(q,{collapsed:i.collapsed,"onUpdate:collapsed":a[2]||(a[2]=e=>i.collapsed=e),collapsible:"",theme:"light","collapsed-width":"30"},{default:s((()=>[d(M,{spinning:i.leftMenuLoading},{default:s((()=>[d(C,{id:"menu-level1-box",ref_key:"menuBox",ref:ee,selectedKeys:i.selectedLeftKeys,"onUpdate:selectedKeys":a[0]||(a[0]=e=>i.selectedLeftKeys=e),theme:"light",mode:"inline",onSelect:a[1]||(a[1]=({key:e,item:t})=>_(e,t))},{default:s((()=>[i.leftMenuLevel.length?(o(!0),c(p,{key:0},f(i.leftMenuLevel,(t=>(o(),r(E,{key:t.id,item:t},{default:s((()=>[Aa,k("span",null,[d(l,{iconname:t.icon},null,8,["iconname"]),h(" "+O(t.menu_name),1)]),k("span",Ma,[d(v,{mode:"text",icon:"vxe-icon-edit",status:"primary",onClick:U((a=>P({type:e.$CONFIG.FORM_TYPE.EDIT_TYPE,row:t})),["stop"])},null,8,["onClick"])])])),_:2},1032,["item"])))),128)):(o(),r(D,{key:1}))])),_:1},8,["selectedKeys"])])),_:1},8,["spinning"])])),_:1},8,["collapsed"]),d(se,{style:{background:"#fff",height:"100%"}},{default:s((()=>[d(J,{activeKey:i.activeTab,"onUpdate:activeKey":a[3]||(a[3]=e=>i.activeTab=e),type:"editable-card","hide-add":"",onChange:W,onEdit:z},{default:s((()=>[(o(!0),c(p,null,f(i.tabArr,(e=>(o(),r(K,{key:e.id,tab:0!==e.level_2?`【${e.menu_name}】Title配置`:`【${e.menu_name}】二级菜单`,closable:0!==e.level_2,"force-render":!0},null,8,["tab","closable"])))),128))])),_:1},8,["activeKey"]),d(te,null,{default:s((()=>[d(Oa,{"show-title":u(R),"menu-id":i.activeTab},null,8,["show-title","menu-id"]),Y(d(ae,{ref_key:"indexTableRef",ref:t,data:i.allData,"onUpdate:data":a[4]||(a[4]=e=>i.allData=e),fullData:i.tableData,"onUpdate:fullData":a[5]||(a[5]=e=>i.tableData=e),columns:i.initColumn,"auth-btn":g,"row-config":{isHover:!0,isCurrent:!0,drag:!0},"default-order":{field:"sorting",order:"asc"},"request-config":{api:u(de).getMenusList,params:i.selectedLeftKeys[0],immediate:!1},"switch-click-status-config":{api:u(de).putOneMenuEdit},onUserEdit:P,onUserAdd:a[6]||(a[6]=t=>u(y)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})),onUserDel:I,onRowDragend:ie},{level_1:s((({row:e})=>[d(Z,{color:e.level_1?"green":"red"},{default:s((()=>[h(O(e.level_1?"是":"否"),1)])),_:2},1032,["color"])])),permissions_url:s((({row:e})=>[(null==e?void 0:e.permissions_url)?(o(),c("div",Pa,[(o(!0),c(p,null,f(e.permissions_url,(e=>(o(),c(p,{key:e},[d(Z,{color:"purple"},{default:s((()=>[h(O(e),1)])),_:2},1024),h(),Ia],64)))),128))])):m("",!0)])),page_data_source:s((({row:e})=>[e.page_data_source?(o(),r(v,{key:0,status:"primary",content:"点击查看",onClick:t=>{return a=e.page_data_source,i.dataSourceVisible=!0,void(i.dataSourceHighlight=le(a));var a}},null,8,["onClick"])):m("",!0)])),title:s((({row:e})=>[1!==e.level_1?(o(),r(Q,{key:0,title:"页面title入口",placement:"left","get-popup-container":e=>e.parentNode},{default:s((()=>[d(v,{mode:"text",status:"primary",content:"查看标题",onClick:t=>(async e=>{i.activeTab=null==e?void 0:e.id;const t=T.clone(e,!0);i.tabArr.push(t),i.tabArr=T.uniq(i.tabArr,"id")})(e)},null,8,["onClick"])])),_:2},1032,["get-popup-container"])):m("",!0)])),_:1},8,["data","fullData","columns","request-config","switch-click-status-config"]),[[j,!u(R)]])])),_:1})])),_:1})])),_:1}),d(ce,{open:u(b),"onUpdate:open":a[7]||(a[7]=e=>A(b)?b.value=e:null),sid:u(x),"form-type":u(w),onEditSuccess:_},null,8,["open","sid","form-type"]),d(ue,{open:i.dataSourceVisible,"onUpdate:open":a[8]||(a[8]=e=>i.dataSourceVisible=e),title:"",centered:!0,closable:!1,footer:null},{default:s((()=>[k("pre",{innerHTML:i.dataSourceHighlight},null,8,Na)])),_:1},8,["open"])],64)}}};export{La as default};
