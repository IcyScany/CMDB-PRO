import{_ as e}from"./index.029351cd.js";import{o as t,_ as a,u as l,a as i}from"./opsFormInit.3a4e1794.js";import{aR as s,al as o,r,O as u,Q as n,U as d,W as p,c,$ as m,R as f,F as v,S as y,a8 as _,aN as g,a3 as k,q as b,X as U,Z as h,ah as x,Y as C,ad as E,aj as w,v as D,aY as T,aw as j,ax as G,ak as S,a5 as $,J as R,au as A,aZ as L,I as P,a_ as O,a$ as F}from"./index.872a2bd0.js";import{t as Y}from"./tableRender.a6ff99b7.js";import{c as I}from"./cmdbEntityFormInit.bd634033.js";import{_ as N}from"./index.48209b21.js";import{_ as q}from"./index.7d980246.js";import{A as M}from"./index.a6841843.js";import"./index.64f8d8d4.js";import"./index.44a4e190.js";import"./index.9846e408.js";import"./index.65b2e021.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6e2fd079.js";import"./Group.b415afa6.js";import"./RadioButton.534ff50d.js";import"./alertLevel.8dae0e72.js";import"./successModal.c280f18f.js";import"./index.2c670fa1.js";import"./opsTable.7b07fc7b.js";import"./useBreakpoint.e81952b0.js";import"./eagerComputed.bb706adf.js";import"./index.fc9664cf.js";const B="system/user-group/",K={getUserGroupList:()=>s.get(`${B}list`),postUserGroupAdd:e=>s.post(`${B}add`,e),putUserGroupEdit:(e,t)=>s.put(`${B}edit/${e}`,t)},z={__name:"UserGroupListEdit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open","editSuccess"],setup(l,{emit:i}){const s=l,{open:k,sid:b,formType:U}=o(s),h=i;let x=r(null);const{postUserGroupAdd:C}=K;let{formRenderContent:E,formDataLoading:w,confirmLoading:D,initForm:T,formDataInit:j,editSubmit:G}=t({formRef:x,editTitleLayer:2,formType:U,sid:b,emits:h,addApi:C,customSubmitData:async e=>e,customEditData:()=>{}});const S=()=>{h("update:open",!1)},$=async e=>{e&&(await T(),await j())};return(t,l)=>{const i=a,s=_,o=g,r=u("vxe-button"),b=e;return n(),d(b,{title:"用户组"+(m(U)===t.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"),open:m(k),onAfterOpenChange:$,onClose:S},{footer:p((()=>[c(r,{content:"取消",onClick:S}),c(r,{type:"submit",loading:m(D),status:"primary",content:"提交",onClick:m(G)},null,8,["loading","onClick"])])),default:p((()=>[c(o,{spinning:m(w)},{default:p((()=>[c(s,{ref_key:"formRef",ref:x,model:m(E).formState,rules:m(E).rules},{default:p((()=>[(n(!0),f(v,null,y(t.$utils.filter(m(E).title,(e=>e.edit_display)),(e=>{var t,a;return n(),d(i,{key:e.field,value:m(E).formState[e.field],"onUpdate:value":t=>m(E).formState[e.field]=t,title:e,"title-data":null==(a=null==(t=m(E))?void 0:t.title_data)?void 0:a[e.field]},null,8,["value","onUpdate:value","title","title-data"])})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},W={class:"user-group-action"},Z={key:0},J={key:0},Q=k({__name:"GroupList",setup(e,{expose:t}){let a=r([]),s=r(!1),o=r([]),_=r({});const k=async()=>{s.value=!0,a.value=[],A(),K.getUserGroupList().then((e=>{a.value=e,s.value=!1})).catch((()=>{s.value=!1}))};let $=b((()=>{let e={};if(o.value)for(let t of o.value){let{field:a}=t;switch(a){case"add":case"del":case"edit":e[a]=t}}return e})),R=r(null);const A=()=>{R.value=null},L=()=>{R.value.loading=!0,K.putUserGroupEdit(R.value.id,R.value).then((e=>{R.value.loading=!1,i({content:e.msg,closeCallback:k})})).catch((()=>{R.value.loading=!1}))},P=async()=>{let{title_data:e,button:t}=await Y.setColumn({layer:2});o.value=t.value||[],_.value=e.value||{},await k()},{userEdit:O,formOpen:F,formType:q,formSid:M}=l(),{userClickStatus:B}=I({urlPrefix:"system/user-group/",getData:k});return t({initUserGroupPage:P,userGroupLoading:s,handleGetUserGroupData:k}),(e,t)=>{var l,i;const o=u("vxe-button"),r=w,_=N,k=D,b=u("setting-outlined"),Y=u("router-link"),I=T,K=j,Q=G,X=S,H=g;return n(),f("div",null,[U("div",W,[(null==(i=null==(l=m($))?void 0:l.add)?void 0:i.page_display)?(n(),d(o,{key:0,content:"新增",icon:"vxe-icon-add",status:"primary",onClick:t[0]||(t[0]=t=>(({type:e})=>{O({type:e})})({type:e.$CONFIG.FORM_TYPE.ADD_TYPE}))})):h("",!0),c(o,{loading:m(s),content:"刷新","class-name":"refreash-user-group",icon:"vxe-icon-refresh",status:"primary",onClick:P},null,8,["loading"])]),c(H,{spinning:m(s)},{default:p((()=>[m(a).length>0?(n(),d(Q,{key:0,gutter:[16,8]},{default:p((()=>[(n(!0),f(v,null,y(m(a),(({group_name:t,id:a,describe:l,note:i,virtual_team_status:s})=>(n(),d(K,{key:a,span:4,style:{height:"100%"}},{default:p((()=>[c(I,{title:t,bordered:!0,"body-style":{padding:"5px",height:"60%"},style:{"box-shadow":"0px 2px 8px rgba(0,0,0,0.13)"}},{extra:p((()=>[c(k,{title:"接口组过滤状态，修改请联系管理员"},{default:p((()=>{var o,r;return[c(_,{checked:s,"checked-value":1,"un-checked-value":0,disabled:!(null==(r=null==(o=m($))?void 0:o.edit)?void 0:r.page_display),"checked-children":"开","un-checked-children":"关",size:"small",onClick:s=>m(B)({sid:a,type:e.EDIT_TYPE,field:"virtual_team_status",checked:s,otherBody:{group_name:t,describe:l,note:i}})},null,8,["checked","disabled","onClick"])]})),_:2},1024)])),actions:p((()=>{var e,r,u,y;return[(null==(e=m(R))?void 0:e.id)===a?(n(),f(v,{key:0},[c(o,{icon:"vxe-icon-success-circle-fill",mode:"text",status:"success",onClick:L},{default:p((()=>[x(" 提交 ")])),_:1}),c(o,{icon:"vxe-icon-error-circle-fill",mode:"text",status:"error",onClick:A},{default:p((()=>[x(" 取消 ")])),_:1})],64)):h("",!0),(null==(u=null==(r=m($))?void 0:r.edit)?void 0:u.page_display)&&!m(R)||(null==(y=m(R))?void 0:y.id)!==a?(n(),d(o,{key:1,mode:"text",status:"primary",icon:"vxe-icon-edit",onClick:e=>{return o={group_name:t,id:a,describe:l,note:i,virtual_team_status:s},void(R.value=o);var o}},{default:p((()=>[x("编辑")])),_:2},1032,["onClick"])):h("",!0),c(k,{title:"用户组权限"},{default:p((()=>[c(Y,{to:{name:"systemUserGroupPermissionPage",query:{sid:a}}},{default:p((()=>[c(b,{key:"delete",class:"text-primary"})])),_:2},1032,["to"])])),_:2},1024)]})),default:p((()=>{var e,t;return[U("p",null,[x("描述： "),m(R)?h("",!0):(n(),f("span",Z,C(l),1)),(null==(e=m(R))?void 0:e.id)===a?(n(),d(r,{key:1,value:m(R).describe,"onUpdate:value":e=>m(R).describe=e,name:"describe"},null,8,["value","onUpdate:value"])):h("",!0)]),U("p",null,[x("备注： "),m(R)?h("",!0):(n(),f("span",J,C(i),1)),(null==(t=m(R))?void 0:t.id)===a?(n(),d(r,{key:1,value:m(R).note,"onUpdate:value":e=>m(R).note=e,name:"note"},null,8,["value","onUpdate:value"])):h("",!0)])]})),_:2},1032,["title"])])),_:2},1024)))),128))])),_:1})):(n(),d(X,{key:1}))])),_:1},8,["spinning"]),c(z,{open:m(F),"onUpdate:open":t[1]||(t[1]=e=>E(F)?F.value=e:null),sid:m(M),"form-type":m(q),onEditSuccess:P},null,8,["open","sid","form-type"])])}}},[["__scopeId","data-v-3a832e7c"]]),X="system/user/",H={getUserList:e=>s.get(`${X}list${e?`/${e}`:""}`),postUserAdd:e=>s.post(`${X}add`,e),putUserEdit:(e,t)=>s.put(`${X}edit/${e}`,t),delUser:(e,t)=>s.delete(`${X}del/${e}`,t)},V={__name:"UserEdit",props:{open:{type:Boolean,default:!1},sid:{type:[String,Number],default:""},formType:{type:Number}},emits:["update:open","editSuccess"],setup(l,{emit:i}){const s=l,{open:k,sid:b,formType:U}=o(s),x=i;let C=r(null);const{putUserEdit:E,getUserList:w,postUserAdd:D}=H;let{formRenderContent:T,formDataLoading:j,confirmLoading:G,initForm:S,formDataInit:R,editSubmit:A}=t({formRef:C,editTitleLayer:1,formType:U,sid:b,emits:x,editApi:E,addApi:D,oneDataApi:w,customSubmitData:async e=>e,customEditData:()=>{}});const L=()=>{x("update:open",!1)},P=async e=>{var t,a,l,i;if(e&&(await S(),await R(),U.value===$.FORM_TYPE.EDIT_TYPE))for(let s in T.value.rules)(null==(i=null==(l=null==(a=null==(t=T.value)?void 0:t.rules)?void 0:a[s])?void 0:l[0])?void 0:i.required)&&(T.value.rules[s][0].required=!1)};return(t,l)=>{const i=a,s=_,o=g,r=u("vxe-button"),b=e;return n(),d(b,{title:"用户"+(m(U)===t.$CONFIG.FORM_TYPE.ADD_TYPE?"新增":"编辑"),open:m(k),onAfterOpenChange:P,onClose:L},{footer:p((()=>[c(r,{content:"取消",onClick:L}),c(r,{type:"submit",loading:m(G),status:"primary",content:"提交",onClick:m(A)},null,8,["loading","onClick"])])),default:p((()=>[c(o,{spinning:m(j)},{default:p((()=>[c(s,{ref_key:"formRef",ref:C,model:m(T).formState,rules:m(T).rules},{default:p((()=>[(n(!0),f(v,null,y(t.$utils.filter(m(T).title,(e=>e.edit_display)),(e=>{var a,l,s,o;return n(),f(v,{key:e.field},["mobile"===e.field?(n(),f(v,{key:0},[m(U)===t.$CONFIG.FORM_TYPE.ADD_TYPE?(n(),d(i,{key:0,value:m(T).formState[e.field],"onUpdate:value":t=>m(T).formState[e.field]=t,title:e,"title-data":null==(l=null==(a=m(T))?void 0:a.title_data)?void 0:l[e.field]},null,8,["value","onUpdate:value","title","title-data"])):h("",!0)],64)):(n(),d(i,{key:1,value:m(T).formState[e.field],"onUpdate:value":t=>m(T).formState[e.field]=t,title:e,"title-data":null==(o=null==(s=m(T))?void 0:s.title_data)?void 0:o[e.field]},null,8,["value","onUpdate:value","title","title-data"]))],64)})),128))])),_:1},8,["model","rules"])])),_:1},8,["spinning"])])),_:1},8,["title","open"])}}},ee=U("br",null,null,-1),te={key:1},ae={__name:"UserList",setup(e,{expose:t}){let a=r([]),i=r([]),s=r({});R((async()=>{let{title_data:e,button:t,columns:l}=await Y.setColumn({layer:1});a.value=l.value||[],i.value=t.value||[],s.value=e.value||{}}));const o=b((()=>{for(let e of a.value){let{field:t}=e;switch(t){case"user_group":delete e.showOverflow,e.slots={default:t};break;case"images":case"password":e.slots={default:t}}}return a.value}));let u=b((()=>{let e={};if(i.value)for(let t of i.value){let{field:a}=t;switch(a){case"add":case"edit":case"del":e[a]=t}}return e}));const{userDel:_,userEdit:g,formOpen:k,formType:U,formSid:w}=l(),D=({type:e,row:t})=>{g({type:e,sid:t.id})},T=r(null),j=async()=>{var e;T.value&&await(null==(e=T.value)?void 0:e.commitRequest())},G=e=>{_({sid:e.id,delApi:H.delUser,loadData:j})};return t({initUserList:j}),(e,t)=>{const a=A,l=M,i=L,r=q;return n(),f(v,null,[c(r,{ref_key:"userListTableRef",ref:T,columns:m(o),"auth-btn":m(u),"request-config":{api:m(H).getUserList,immediate:!1},"switch-click-status-config":{api:m(H).putUserEdit,params:["email"]},onUserEdit:D,onUserAdd:t[0]||(t[0]=t=>{m(g)({type:e.$CONFIG.FORM_TYPE.ADD_TYPE})}),onUserDel:G},{user_group:p((({row:e})=>[e.user_group?(n(),f(v,{key:0},[m(s).user_group?(n(!0),f(v,{key:0},y(m(s).user_group,(t=>(n(),f(v,{key:t.id},[e.user_group.indexOf(t.id)>-1?(n(),f(v,{key:0},[c(a,{color:"blue"},{default:p((()=>[x(C(t.group_name),1)])),_:2},1024),ee],64)):h("",!0)],64)))),128)):(n(),f(v,{key:1},[x(C(e.user_group),1)],64))],64)):h("",!0)])),images:p((({row:e})=>[e.images?(n(),f(v,{key:0},[e.images.startsWith("http")?(n(),d(l,{key:0,src:e.images},null,8,["src"])):(n(),f("span",te,C(e.images),1))],64)):h("",!0)])),password:p((({row:e})=>[c(i,{copyable:{text:e.password}},null,8,["copyable"])])),_:1},8,["columns","auth-btn","request-config","switch-click-status-config"]),c(V,{open:m(k),"onUpdate:open":t[1]||(t[1]=e=>E(k)?k.value=e:null),sid:m(w),"form-type":m(U),onEditSuccess:j},null,8,["open","sid","form-type"])],64)}}},le=k({__name:"index",setup(e){const t=r(null),a=r(null),l=r("user_group"),i=async e=>{var i;l.value=e,"user_group"===e&&t.value&&(null==(i=t.value)||i.initUserGroupPage()),"user"===e&&await P((async()=>{var e;await a.value&&(null==(e=a.value)||e.initUserList())}))};return R((async()=>{await P((async()=>{var e;t.value&&(null==(e=t.value)||e.initUserGroupPage())}))})),(e,s)=>{const o=O,r=F;return n(),d(r,{activeKey:m(l),"onUpdate:activeKey":s[0]||(s[0]=e=>E(l)?l.value=e:null),style:{height:"100%"},onChange:i},{default:p((()=>[c(o,{key:"user_group",tab:"用户组清单",style:{height:"100%",overflow:"auto"}},{default:p((()=>[c(Q,{ref_key:"userGroupRef",ref:t},null,512)])),_:1}),c(o,{key:"user",tab:"用户清单"},{default:p((()=>[c(ae,{ref_key:"userRef",ref:a},null,512)])),_:1})])),_:1},8,["activeKey"])}}},[["__scopeId","data-v-76b79064"]]);export{le as default};
