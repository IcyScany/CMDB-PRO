import{o as l,_ as e,a,b as o}from"./index.2c670fa1.js";import{x as n,H as i,q as t,al as u,a0 as d,I as r,a3 as s,N as c,cj as v,ck as p,r as f,J as g,O as m,Q as _,U as h,ag as y,S as C,W as b,an as x,aU as k,Z as w,$ as D,c as R,ad as S,cl as T,X as O,cm as A,R as E,F as P,ah as j,cn as q,aj as $}from"./index.872a2bd0.js";import{t as B,a as L,d as z}from"./opsTable.7b07fc7b.js";import{_ as G}from"./index.9846e408.js";function I(l={columns:[]},e){function a(l){l.forEach((l=>{l.children&&a(l.children)}))}n((()=>l.columns),(()=>{!function(a){var o,n,i;if(["checkbox","radio","seq","expand"].includes(null==(o=null==a?void 0:a[0])?void 0:o.type)){const l=a[0];l.minWidth=l.minWidth??"65px",l.width=l.width??"65px",l.align=l.align??"center",l.fixed=l.fixed??"left"}for(let t of a){let{field:a,page_data_source:o,title_data:u}=t;if("operation"===a)t.slots={default:a},t.fixed="right",delete t.showOverflow;else if(o&&"boole"===o.form_type)t.cellRender={name:"VxeSwitch",props:{openValue:o&&(null==o?void 0:o.checked)||1,closeValue:o&&!1===(null==o?void 0:o.unchecked)||(null==o?void 0:o.unchecked)||0,openLabel:o&&(null==o?void 0:o.checkedChildren)||"打开",closeLabel:o&&(null==o?void 0:o.unCheckedChildren)||"关闭",disabled:!(null==(i=null==(n=null==l?void 0:l.authBtn)?void 0:n.edit)?void 0:i.page_display)},events:{change:({row:a,column:o},n)=>{var i,t;if(null==(i=null==l?void 0:l.switchClickStatusConfig)?void 0:i.api){let i=(null==(t=null==l?void 0:l.switchClickStatusConfig)?void 0:t.params)||[],u={};for(let l in i)u[i[l]]=a[i[l]];let d={[o.field]:n.value,...u};l.switchClickStatusConfig.api(a.id,d).then((()=>{e&&e(),l.loading=!1})).catch((()=>{l.loading=!1}))}}}};let d=null==o?void 0:o.template_render;d&&(t.cellRender={name:null==d?void 0:d.name,props:{data_source:u,...d}})}}(l.columns),a(l.columns)}),{immediate:!0})}function Q({tableRef:e,props:a,emit:o}){const n=i({tableAllData:[],showData:[],filteredData:[],searchQuery:"",loading:!1,pagination:{currentPage:1,pageSize:l.VXE_PAGE_SIZES[0],total:0,pageSizes:l.VXE_PAGE_SIZES,layout:l.VXE_PAGER_LAYOUTS}}),s=t((()=>{var l,e;return(null==a?void 0:a.defaultOrder)&&Object.keys(null==a?void 0:a.defaultOrder).length?a.defaultOrder:{field:(null==(e=null==(l=null==a?void 0:a.columns)?void 0:l[0])?void 0:e.field)||"id",order:"desc"}}));const c=(l=!1)=>{l&&(n.pagination.currentPage=1),v(a.filterConditions,n.searchQuery),p(),f(),o("update:data",n.showData)},v=(l,e=n.searchQuery)=>{var a;const o=String(e).trim().toLowerCase();n.filteredData=d.clone(n.tableAllData,!0),o&&(n.filteredData=n.filteredData.filter((l=>Object.values(l).some((l=>JSON.stringify(l).toLowerCase().includes(o))))));Object.values(l).some((l=>l))&&(n.filteredData=n.filteredData.filter((e=>Object.entries(l).every((([l,a])=>null==a||""===a||String(e[l]).toLowerCase().includes(String(a).toLowerCase())))))),n.pagination.total=(null==(a=n.filteredData)?void 0:a.length)||0},p=()=>{if(!a.noSort&&e.value){const l=e.value.getSortColumns();l.length?n.filteredData=d.orderBy(n.filteredData,l):n.filteredData=d.orderBy(n.filteredData,[s.value])}},f=()=>{const{pageSize:l,currentPage:e}=n.pagination;n.showData=-1===l?d.clone(n.filteredData,!0):d.clone(n.filteredData,!0).slice((e-1)*l,e*l)};return{...u(n),updateShowData:c,commitRequest:async l=>(await r(),await async function(l){var e,i;const t={status:"",data:null};if(n.loading||"function"!=typeof a.requestConfig.api)t.data=a.data;else{n.loading=!0;try{const o=await a.requestConfig.api(l??a.requestConfig.params);let n=(null==(e=null==a?void 0:a.requestConfig)?void 0:e.accept_field)?(null==o?void 0:o[null==(i=null==a?void 0:a.requestConfig)?void 0:i.accept_field])||[]:o;t.status="success",t.data=n}catch(u){t.status="failed",t.data=u}finally{n.loading=!1}}return n.tableAllData=d.clone(t.data,!0),o("update:fullData",d.clone(t.data,!0)),c(),t}(l))}}const V={class:"inline-flex items-center"},U={name:"OpsTable"},X=s(Object.assign(U,{props:B,emits:L,setup(l,{expose:i,emit:u}){let r=c(),s=t((()=>{var l;return null==(l=null==r?void 0:r.current_user_menu)?void 0:l.current_menu}));const B=l,L=u,U=v(),X=p(),F=f(null),N=f(null),W=Object.keys(U),Y=[{code:"myToolbarCustom",icon:"vxe-icon-custom-column",circle:!0}],Z=t((()=>{var l;return{...z,...X,toolbarConfig:{...B.toolbarConfig,slots:{...null==(l=B.toolbarConfig)?void 0:l.slots}},sortConfig:{trigger:"cell",remote:!0,orders:["desc","asc"]}}})),{loading:J,pagination:K,showData:H,tableAllData:M,searchQuery:ll,updateShowData:el,commitRequest:al}=Q({tableRef:F,props:B,emit:L});I(B,al);const ol=l=>{},nl=()=>{al(),L("refresh")},il=l=>{l.length&&(H.value=M.value.filter((e=>l.indexOf(e.environment)>-1)),el())},tl={pageChange:({pageSize:l,currentPage:e})=>{K.value.currentPage=e,K.value.pageSize=l,el()},sortChange:()=>{el()}},ul=d.debounce(el,100);g((()=>{var l,e;(null==(l=F.value)?void 0:l.connect)&&N.value&&(null==(e=F.value)||e.connect(N.value)),!1!==B.requestConfig.immediate&&al()})),n((()=>B.filterConditions),(()=>{el(!0)}),{deep:!0});return i({getDom:()=>F.value,commitRequest:al,tableLoading:J,tableAllData:M,updateShowData:el,vxeGridRef:F,searchQuery:ll,tableCheckboxCheckedAll:()=>{let l=[];if(F.value){let e=F.value.getCheckboxRecords(!0),a=F.value.getCheckboxReserveRecords();l=e.concat(a)}return l},clearCheckBox:()=>{F.value&&(F.value.clearCheckboxRow(),F.value.clearCheckboxReserve())},tableRadioCheckedAll:()=>{let l=null;if(F.value){let e=F.value.getRadioRecord(),a=F.value.getRadioReserveRecord();l=e||a}return l},clearRadioCheck:()=>{F.value&&(F.value.clearRadioRow(),F.value.clearRadioReserve())}}),(l,n)=>{const i=e,t=m("vxe-button"),u=$,d=a,r=o,c=m("vxe-toolbar"),v=G,p=m("vxe-grid");return _(),h(p,k({id:`ops_client_table_${(new Date).getTime()}`,ref_key:"vxeGridRef",ref:F,class:"z-0"},D(Z),{attr:l.$attrs,data:D(H),"pager-config":D(K),columns:B.columns,loading:D(J),onCheckboxChange:n[2]||(n[2]=l=>L("select",l)),onCheckboxAll:n[3]||(n[3]=l=>L("select",l))},q(tl)),y({top:b((()=>[x(l.$slots,"topPrefix",{},(()=>{var l,e,a,o,n,t,u,d,r,c,v,p,f,g,m,y,C,b,x,k,R,S,T,O,A,E,P,j,q,$,L;return[(null==(t=null==(n=null==(o=D(s))?void 0:o[null==(a=null==(e=null==(l=B.columns)?void 0:l[0])?void 0:e.oriTitle)?void 0:a.layer])?void 0:n.page_data_source)?void 0:t.env_search)||!(null==(c=D(s))?void 0:c[null==(r=null==(d=null==(u=B.columns)?void 0:u[0])?void 0:d.oriTitle)?void 0:r.layer])&&((null==(y=null==(p=null==(v=D(s))?void 0:v.page_data_source)?void 0:p.allow_layer)?void 0:y.includes(null==(m=null==(g=null==(f=B.columns)?void 0:f[0])?void 0:g.oriTitle)?void 0:m.layer))||1===(null==(x=null==(b=null==(C=B.columns)?void 0:C[0])?void 0:b.oriTitle)?void 0:x.layer))&&(null==(R=null==(k=D(s))?void 0:k.page_data_source)?void 0:R.env_search)?(_(),h(i,{key:0,"page-app-name":(null==(j=null==(P=null==(E=null==(A=D(s))?void 0:A[null==(O=null==(T=null==(S=B.columns)?void 0:S[0])?void 0:T.oriTitle)?void 0:O.layer])?void 0:E.page_data_source)?void 0:P.env_search)?void 0:j.app_name)||(null==(L=null==($=null==(q=D(s))?void 0:q.page_data_source)?void 0:$.env_search)?void 0:L.app_name),onEnvSearch:il},null,8,["page-app-name"])):w("",!0)]}),!0),R(c,{ref_key:"toolBarRef",ref:N,tools:Y,onToolClick:ol},{buttonPrefix:b((()=>{var e,a;return[x(l.$slots,"other_toolbar_buttons_left",{},void 0,!0),(null==(a=null==(e=B.authBtn)?void 0:e.add)?void 0:a.page_display)?(_(),h(t,{key:0,content:"新增",icon:"vxe-icon-add",status:"primary",onClick:n[0]||(n[0]=l=>L("userAdd"))})):w("",!0),x(l.$slots,"other_toolbar_buttons",{},void 0,!0)]})),toolPrefix:b((()=>[x(l.$slots,"toolSearchPrefix",{},void 0,!0),B.showSearch?(_(),h(u,{key:0,value:D(ll),"onUpdate:value":n[1]||(n[1]=l=>S(ll)?ll.value=l:null),type:"search","allow-clear":"",placeholder:"全表搜索",style:{"padding-right":".5rem","margin-right":"12px",width:"400px"},clearable:"",onKeyup:D(ul),onChange:D(ul)},null,8,["value","onKeyup","onChange"])):w("",!0),R(t,{icon:"vxe-icon-repeat "+(D(J)?"roll":""),circle:"",onClick:nl},null,8,["icon"])])),toolSuffix:b((()=>{var l,e,a,o,n,i,t,u,c,v,p,f,g,m,y,C,b,x,R,S,O,A,E,P,j,q,$,L,z,G,I,Q,V,U,X,F,N,W,Y,Z,J,K,H,M,ll,el,al,ol,nl,il,tl,ul,dl,rl,sl,cl,vl,pl;return[(null==(i=null==(n=null==(o=D(s))?void 0:o[null==(a=null==(e=null==(l=B.columns)?void 0:l[0])?void 0:e.oriTitle)?void 0:a.layer])?void 0:n.page_data_source)?void 0:i.data_sync)||!(null==(v=D(s))?void 0:v[null==(c=null==(u=null==(t=B.columns)?void 0:t[0])?void 0:u.oriTitle)?void 0:c.layer])&&((null==(C=null==(f=null==(p=D(s))?void 0:p.page_data_source)?void 0:f.allow_layer)?void 0:C.includes(null==(y=null==(m=null==(g=B.columns)?void 0:g[0])?void 0:m.oriTitle)?void 0:y.layer))||1===(null==(R=null==(x=null==(b=B.columns)?void 0:b[0])?void 0:x.oriTitle)?void 0:R.layer))&&(null==(O=null==(S=D(s))?void 0:S.page_data_source)?void 0:O.data_sync)?(_(),h(d,{key:0,uri:(null==(L=null==($=null==(q=null==(j=D(s))?void 0:j[null==(P=null==(E=null==(A=B.columns)?void 0:A[0])?void 0:E.oriTitle)?void 0:P.layer])?void 0:q.page_data_source)?void 0:$.data_sync)?void 0:L.uri)||(null==(I=null==(G=null==(z=D(s))?void 0:z.page_data_source)?void 0:G.data_sync)?void 0:I.uri)},null,8,["uri"])):w("",!0),(null==(N=null==(F=null==(X=D(s))?void 0:X[null==(U=null==(V=null==(Q=B.columns)?void 0:Q[0])?void 0:V.oriTitle)?void 0:U.layer])?void 0:F.page_data_source)?void 0:N.show_doc)||!(null==(J=D(s))?void 0:J[null==(Z=null==(Y=null==(W=B.columns)?void 0:W[0])?void 0:Y.oriTitle)?void 0:Z.layer])&&((null==(al=null==(H=null==(K=D(s))?void 0:K.page_data_source)?void 0:H.allow_layer)?void 0:al.includes(null==(el=null==(ll=null==(M=B.columns)?void 0:M[0])?void 0:ll.oriTitle)?void 0:el.layer))||1===(null==(il=null==(nl=null==(ol=B.columns)?void 0:ol[0])?void 0:nl.oriTitle)?void 0:il.layer))&&(null==(ul=null==(tl=D(s))?void 0:tl.page_data_source)?void 0:ul.show_doc)?(_(),h(r,T(k({key:1},null==(pl=null==(vl=null==(cl=D(s))?void 0:cl[null==(sl=null==(rl=null==(dl=B.columns)?void 0:dl[0])?void 0:rl.oriTitle)?void 0:sl.layer])?void 0:vl.page_data_source)?void 0:pl.show_doc)),null,16)):w("",!0)]})),_:3},512),x(l.$slots,"topSuffix",{},void 0,!0)])),operation:b((({row:e})=>{var a,o,n,i;return[O("span",V,[(null==(o=null==(a=B.authBtn)?void 0:a.edit)?void 0:o.page_display)?(_(),h(t,{key:0,mode:"text",status:"primary",icon:"vxe-icon-edit",onClick:a=>L("userEdit",{type:l.$CONFIG.FORM_TYPE.EDIT_TYPE,row:e})},null,8,["onClick"])):w("",!0),x(l.$slots,"other_operation",T(A({row:e})),void 0,!0)]),(null==(i=null==(n=B.authBtn)?void 0:n.del)?void 0:i.page_display)?(_(),E(P,{key:0},[R(v,{type:"vertical"}),j(),R(t,{mode:"text",status:"error",icon:"vxe-icon-delete",onClick:l=>L("userDel",e)},null,8,["onClick"])],64)):w("",!0)]})),_:2},[C(D(W),(e=>({name:e,fn:b((a=>[e&&B.columns&&B.columns.length>0?x(l.$slots,e,k({key:0,scope:a},a||{}),void 0,!0):w("",!0)]))})))]),1040,["id","attr","data","pager-config","columns","loading"])}}}),[["__scopeId","data-v-7b4516a9"]]);export{X as _};
