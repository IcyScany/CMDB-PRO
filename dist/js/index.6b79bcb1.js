import{s as e,_ as l}from"./subPage.2201bfd5.js";import{_ as t}from"./ServerTable.53881589.js";import{a3 as i,r,H as a,q as o,J as n,O as u,Q as s,U as d,W as c,c as p,$ as _,X as v,R as m,F as f,S as b,ah as y,Y as g,Z as w,v as j,d2 as h,a9 as x,aa as R,ad as k,aZ as C,aV as D}from"./index.872a2bd0.js";import{t as P}from"./tableRender.a6ff99b7.js";import{A as O}from"./securityGroup.34f942b2.js";import{_ as T}from"./index.029351cd.js";import{_ as I}from"./index.7d980246.js";import"./opsDescriptions.dfa169bd.js";import"./index.87ccdcd1.js";import"./index.fc9664cf.js";import"./index.a533313d.js";import"./index.2c670fa1.js";import"./index.fe8e77ef.js";import"./Checkbox.ddee6d58.js";import"./index.6f715054.js";import"./useBreakpoint.e81952b0.js";import"./index.e3d002e2.js";import"./index.9846e408.js";import"./alertLevel.8dae0e72.js";import"./index.64f8d8d4.js";import"./opsTable.7b07fc7b.js";const S=e=>(x("data-v-8120bf5b"),e=e(),R(),e),q=S((()=>v("br",null,null,-1))),B=S((()=>v("br",null,null,-1))),A=S((()=>v("br",null,null,-1))),F=S((()=>v("br",null,null,-1))),L=S((()=>v("br",null,null,-1))),U=S((()=>v("br",null,null,-1))),G={class:"header-title"},$={key:0},z={key:1},H=S((()=>v("br",null,null,-1))),W=S((()=>v("br",null,null,-1))),Z=S((()=>v("br",null,null,-1))),E=S((()=>v("br",null,null,-1))),J={class:"header-title"},K=S((()=>v("br",null,null,-1))),Q=S((()=>v("br",null,null,-1))),V=S((()=>v("br",null,null,-1))),X=S((()=>v("br",null,null,-1))),Y={class:"header-title"},M=i({__name:"index",props:{open:{type:Boolean,default:!1},rowData:{type:Object,default:()=>({})},cloudSource:{type:String,default:""}},emits:["update:open"],setup(e,{emit:l}){const t=e,i=l,x=r(null),R=a({columns:[],data:[],direction:"ingress"}),k=o((()=>{let e=R.columns.filter((e=>!("ingress"===R.direction&&"dest_address"===e.field||"egress"===R.direction&&"source_address"===e.field)));for(let l of e){let{field:e}=l;switch(e){case"dest_address":case"source_address":case"protocol":l.slots={default:e,header:`${e}_header`};break;case"status":case"type":case"action":l.slots={default:e}}}return e})),C=o((()=>R.data.filter((e=>e.direction===R.direction))));n((async()=>{const{columns:e}=await P.setColumn({layer:2});R.columns=e.value||[]}));const D=async()=>{x.value.tableLoading=!0;const e=await O.getSecurityGroupRule(t.rowData.id);R.data=e,x.value&&await x.value.commitRequest(),x.value.tableLoading=!1},S=()=>{t.open?D():(R.data=[],R.direction="ingress",x.value.commitRequest())},M=e=>{var l,i,r,a;return"华为云"===t.rowData.cloud_source?(null==(l=e.cloud_specific)?void 0:l.remote_address_group_id)||(null==(i=e.cloud_specific)?void 0:i.remote_group_id)||(null==(r=e.cloud_specific)?void 0:r.remote_ip_prefix):null==(a=Object.entries(e.cloud_specific).find((([e,l])=>(e.includes("source")||e.includes("dest"))&&l)))?void 0:a[1]};return(l,r)=>{const a=u("vxe-button"),o=j,n=h,P=I,O=T;return s(),d(O,{title:`安全组规则详情 - ${e.rowData.name}`,open:e.open,width:"80%","onUpdate:open":r[0]||(r[0]=e=>i("update:open",e)),onAfterOpenChange:S},{default:c((()=>[p(P,{ref_key:"tableRef",ref:x,columns:_(k),data:_(C),onRefresh:D},{other_toolbar_buttons_left:c((()=>[v("div",null,[(s(),m(f,null,b([{label:"入方向规则",value:"ingress"},{label:"出方向规则",value:"egress"}],(e=>p(a,{key:e.value,size:"small",status:_(R).direction===e.value?"primary":"default",onClick:l=>{return t=e.value,R.direction=t,void x.value.commitRequest();var t}},{default:c((()=>[y(g(e.label),1)])),_:2},1032,["status","onClick"]))),64))])])),protocol_header:c((()=>[p(o,{"overlay-style":{maxWidth:"400px"},placement:"leftBottom"},{title:c((()=>[y(" 安全组规则作用的协议和端口："),q,y(" · 选择全部协议，表示全部协议端口。"),B,y(" · 单个端口：例如22"),A,y(" · 连续端口：例如22-30"),F,y(" · 多个端口：例如22,23-30"),L,y(" · 全部端口：为空或1-65535"),U,y(" 某些端口被部分运营商判断为高危端口，无法访问。 ")])),default:c((()=>{var e;return[v("span",G,g(null==(e=_(k).find((e=>"protocol"===e.field)))?void 0:e.title),1)]})),_:1})])),protocol:c((({row:e})=>[e.protocol?(s(),m("span",$,g(String(e.protocol).toUpperCase()),1)):w("",!0),e.port_range?(s(),m("span",z,":"+g(e.port_range),1)):w("",!0)])),dest_address_header:c((()=>[p(o,null,{title:c((()=>[y(" 目的地址可以是单个IP地址、IP地址段或安全组。"),H,y(" · 单个IP地址：例如192.168.10.10/32"),W,y(" · IP地址段：例如192.168.52.0/24"),Z,y(" · 所有IP地址：0.0.0.0/0"),E,y(" · 安全组：例如sg-abc ")])),default:c((()=>{var e;return[v("span",J,g(null==(e=_(k).find((e=>"dest_address"===e.field)))?void 0:e.title),1)]})),_:1})])),source_address_header:c((()=>[p(o,null,{title:c((()=>[y(" 源地址可以是单个IP地址、IP地址段或安全组。"),K,y(" · 单个IP地址：例如192.168.10.10/32"),Q,y(" · IP地址段：例如192.168.52.0/24"),V,y(" · 所有IP地址：0.0.0.0/0"),X,y(" · 安全组：例如sg-abc ")])),default:c((()=>{var e;return[v("span",Y,g(null==(e=_(k).find((e=>"source_address"===e.field)))?void 0:e.title),1)]})),_:1})])),dest_address:c((({row:e})=>[y(g(M(e)),1)])),source_address:c((({row:e})=>[y(g(M(e)),1)])),status:c((({row:e})=>{var l,t;return[(null==(l=e.cloud_specific)?void 0:l.enabled)?(s(),d(n,{key:0,value:null==(t=e.cloud_specific)?void 0:t.enabled,"active-value":!0,"transform-rule":{true:"已启用",false:"已禁用"}},null,8,["value"])):w("",!0)]})),action:c((({row:e})=>["阿里云"===t.cloudSource?(s(),d(n,{key:0,value:e.action,"active-value":"Accept","transform-rule":{Accept:"接受",Drop:"拒绝"}},null,8,["value"])):(s(),d(n,{key:1,value:e.action,"active-value":"allow","transform-rule":{allow:"接受",deny:"拒绝"}},null,8,["value"]))])),type:c((({row:e})=>{var l,t;return[y(g((null==(l=null==e?void 0:e.cloud_specific)?void 0:l.nic_type)||(null==(t=null==e?void 0:e.cloud_specific)?void 0:t.ethertype)),1)]})),_:1},8,["columns","data"])])),_:1},8,["title","open"])}}},[["__scopeId","data-v-8120bf5b"]]),N=["onClick"],ee={style:{display:"flex","align-items":"center"}},le=["onClick"],te=["onClick"],ie=i({__name:"index",setup(i){const u=r(null),d=a({initColumn:[],subPageColumns:[],initButton:[],initTitleData:[],tableOrder:{},titleFieldSearch:[],securityRuleOpen:!1,securityRuleRow:{}}),b=o((()=>{for(let e of d.initColumn){let{field:l}=e;switch(l){case"id":case"region_id":case"enterprise_project_id":case"security_group_id":e.slots={default:l};break;case"virtual_team_v3_id":e.showOverflow=!1}}return d.initColumn})),w=o((()=>d.initButton.reduce(((e,l)=>(e[l.field]=l,e)),{})));n((async()=>{const{button:e,columns:l,title_data:t,order:i,title_field_search:r,sub_page_columns:a}=await P.setColumn({layer:1});d.initColumn=l.value||[],d.initButton=e.value||[],d.initTitleData=t.value||[],d.tableOrder=i.value||{},d.titleFieldSearch=r.value||[],d.subPageColumns=a||[],await h()}));const h=async()=>{u.value&&await u.value.serverTableRef.commitProxy("query")},x=e=>{d.securityRuleRow=e,d.securityRuleOpen=!0},{subPageOpen:R,subPageRow:T,handleSubPageOpen:I}=e();return(e,i)=>{var r,a,o;const n=C,h=j,P=D,S=t,q=l;return s(),m(f,null,[p(S,{ref_key:"tableRef",ref:u,"table-column":_(b),"auth-btn":_(w),order:_(d).tableOrder,"query-api":_(O).getList,"title-field-search":_(d).titleFieldSearch},{id:c((({row:e})=>[p(h,{placement:"topLeft"},{title:c((()=>[p(n,{copyable:{tooltip:!1},class:"copy-text"},{default:c((()=>[y(g(e.security_group_id),1)])),_:2},1024)])),default:c((()=>[v("span",{class:"cursor-pointer text-primary",onClick:l=>_(I)(e)},g(e.id),9,N)])),_:2},1024)])),cloud_master_account_id:c((({row:e})=>{var l,t,i;return[v("div",ee,[p(P,{type:null==e?void 0:e.cloud_source},null,8,["type"])]),y(" "+g((null==(i=null==(t=null==(l=_(d).initTitleData)?void 0:l.cloud_master_account_id)?void 0:t[e.cloud_master_account_id])?void 0:i.page_display)||""),1)]})),region_id:c((({row:e})=>{var l,t,i;return[v("div",null,g((null==(l=_(d).initTitleData)?void 0:l.region_id)&&(null==(i=null==(t=_(d).initTitleData)?void 0:t.region_id)?void 0:i[null==e?void 0:e.region_id])||(null==e?void 0:e.region_id)),1)]})),enterprise_project_id:c((({row:e})=>{var l,t;return[y(g((null==(t=null==(l=_(d).initTitleData)?void 0:l.enterprise_project_id)?void 0:t[e.enterprise_project_id])||e.enterprise_project_id),1)]})),security_group_id:c((({row:e})=>[v("span",{class:"cursor-pointer text-primary",onClick:l=>x(e)},g(e.security_group_id),9,le)])),_:1},8,["table-column","auth-btn","order","query-api","title-field-search"]),p(q,{open:_(R),"onUpdate:open":i[0]||(i[0]=e=>k(R)?R.value=e:null),"row-data":_(T),title:null==(r=_(T))?void 0:r.name,"basic-config":{api:_(O).getDetail,sid:null==(a=_(T))?void 0:a.id,title:"安全组信息",columns:_(d).subPageColumns}},{cloud_master_account_id:c((({row:e})=>{var l,t,i;return[y(g((null==(i=null==(t=null==(l=_(d).initTitleData)?void 0:l.cloud_master_account_id)?void 0:t[e.cloud_master_account_id])?void 0:i.page_display)||""),1)]})),region_id:c((({row:e})=>{var l,t,i;return[v("div",null,g((null==(l=_(d).initTitleData)?void 0:l.region_id)&&(null==(i=null==(t=_(d).initTitleData)?void 0:t.region_id)?void 0:i[null==e?void 0:e.region_id])||(null==e?void 0:e.region_id)),1)]})),enterprise_project_id:c((({row:e})=>{var l,t;return[y(g((null==(t=null==(l=_(d).initTitleData)?void 0:l.enterprise_project_id)?void 0:t[e.enterprise_project_id])||e.enterprise_project_id),1)]})),security_group_id:c((({row:e})=>[v("span",{class:"cursor-pointer text-primary",onClick:l=>x(e)},g(e.security_group_id),9,te)])),_:1},8,["open","row-data","title","basic-config"]),p(M,{open:_(d).securityRuleOpen,"onUpdate:open":i[1]||(i[1]=e=>_(d).securityRuleOpen=e),"row-data":_(d).securityRuleRow,"cloud-source":null==(o=_(d).securityRuleRow)?void 0:o.cloud_source},null,8,["open","row-data","cloud-source"])],64)}}},[["__scopeId","data-v-bdd6a07d"]]);export{ie as default};
