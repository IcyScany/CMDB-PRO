Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_ui=require("../../ui"),_dom=require("../../ui/src/dom"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let{renderer,renderEmptyElement}=_ui.VxeUI,renderType="footer";function mergeFooterMethod(l,t,o){for(let e=0;e<l.length;e++){var{row:r,col:i,rowspan:n,colspan:a}=l[e];if(-1<i&&-1<r&&n&&a){if(r===t&&i===o)return{rowspan:n,colspan:a};if(r<=t&&t<r+n&&i<=o&&o<i+a)return{rowspan:0,colspan:0}}}}var _default=exports.default=(0,_vue.defineComponent)({name:"VxeTableFooter",props:{footerTableData:{type:Array,default:()=>[]},tableColumn:{type:Array,default:()=>[]},fixedColumn:{type:Array,default:()=>[]},fixedType:{type:String,default:null}},setup(m){let J=(0,_vue.inject)("$xeTable",{}),{xID:g,props:_,reactData:h,internalData:b}=J,{computeTooltipOpts:l,computeColumnOpts:w,computeColumnDragOpts:y,computeCellOpts:t,computeFooterCellOpts:o,computeDefaultRowHeight:r,computeResizableOpts:i}=J.getComputeMaps(),C=(0,_vue.ref)(),T=(0,_vue.ref)(),F=(0,_vue.ref)(),D=(0,_vue.ref)(),O=(0,_vue.ref)(),I=(0,_vue.ref)(),S=(y,C,T,F,D)=>{let O=J.xeGrid,I=m.fixedType,{resizable:S,border:E,footerCellClassName:M,footerCellStyle:k,footerAlign:z,footerSpanMethod:U,align:R,columnKey:$,showFooterOverflow:A}=_,{scrollXLoad:j,scrollYLoad:q,overflowX:L,currentColumn:X,mergeFooterList:N}=h,{fullColumnIdData:G,scrollXStore:H}=b,P=l.value;let W=i.value.isAllColumnDrag,B=w.value;var e=r.value;let K=t.value,V=o.value,Y=(0,_util.getCellHeight)(V.height||K.height)||e;return y.map((l,e)=>{var{type:t,showFooterOverflow:o,footerAlign:r,align:i,footerClassName:n,editRender:a,cellRender:u}=l,s=l.id,d=G[s]||{},a=a||u,u=a?renderer.get(a.name):null;let c=P.showAll;var a=l.children&&l.children.length,a=I?l.fixed!==I&&!a:l.fixed&&L,p=(_xeUtils.default.isBoolean(V.padding)?V:K).padding,o=_xeUtils.default.eqNull(o)?A:o,r=r||(u?u.tableFooterCellAlign:"")||z||i||(u?u.tableCellAlign:"")||R;let f="ellipsis"===o,v="title"===o,x=!0===o||"tooltip"===o,m=v||x||f;var i=_xeUtils.default.isBoolean(l.resizable)?l.resizable:B.resizable||S,u={colid:s},o={},g=d.index,d=d._index,_=d;let h={$table:J,$grid:O,row:T,rowIndex:D,_rowIndex:D,$rowIndex:F,column:l,columnIndex:g,$columnIndex:e,_columnIndex:d,itemIndex:_,items:T,fixed:I,type:renderType,data:C},b=(j&&!m&&(f=m=!0),(v||x||c)&&(o.onMouseenter=e=>{v?(0,_dom.updateCellTitle)(e.currentTarget,l):(x||c)&&J.triggerFooterTooltipEvent(e,h)}),(x||c)&&(o.onMouseleave=e=>{(x||c)&&J.handleTargetLeaveEvent(e)}),o.onClick=e=>{J.dispatchEvent("footer-cell-click",Object.assign({cell:e.currentTarget},h),e)},!(o.onDblclick=e=>{J.dispatchEvent("footer-cell-dblclick",Object.assign({cell:e.currentTarget},h),e)}));if(N.length){g=mergeFooterMethod(N,D,d);if(g){var{rowspan:_,colspan:g}=g;if(!_||!g)return null;1<_&&(b=!0,u.rowspan=_),1<g&&(b=!0,u.colspan=g)}}else if(U){var{rowspan:_=1,colspan:g=1}=U(h)||{};if(!_||!g)return null;1<_&&(u.rowspan=_),1<g&&(u.colspan=g)}_=e===y.length-1,g=!l.resizeWidth&&("auto"===l.minWidth||"auto"===l.width);let w=!1;b||j&&!l.fixed&&(d<H.visibleStartIndex-H.preloadSize||d>H.visibleEndIndex+H.preloadSize)&&(w=!0);d={};return m?d.height=Y+"px":d.minHeight=Y+"px",(0,_vue.h)("td",Object.assign(Object.assign(Object.assign(Object.assign({class:["vxe-footer--column",l.id,{["col--"+r]:r,["col--"+t]:t,"col--last":_,"fixed--width":!g,"fixed--hidden":a,"is--padding":p,"col--ellipsis":m,"col--current":X===l},(0,_dom.getPropClass)(n,h),(0,_dom.getPropClass)(M,h)]},u),{style:k?_xeUtils.default.isFunction(k)?k(h):k:null}),o),{key:$||j||q||B.useKey||B.drag?l.id:e}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":v,"c--tooltip":x,"c--ellipsis":f}],style:d},w?[]:[(0,_vue.h)("div",{colid:s,class:"vxe-cell--wrapper"},l.renderFooter(h))]),!a&&i&&W?(0,_vue.h)("div",{class:["vxe-cell--col-resizable",{"is--line":!E||"none"===E}],onMousedown:e=>J.handleColResizeMousedownEvent(e,I,h),onDblclick:e=>J.handleColResizeDblclickEvent(e,h)}):renderEmptyElement(J)])})};return(0,_vue.onMounted)(()=>{(0,_vue.nextTick)(()=>{var e=m.fixedType,l=b.elemStore,e=`${e||"main"}-footer-`;l[e+"wrapper"]=C,l[e+"scroll"]=T,l[e+"table"]=F,l[e+"colgroup"]=D,l[e+"list"]=O,l[e+"xSpace"]=I})}),(0,_vue.onUnmounted)(()=>{var e=m.fixedType,l=b.elemStore,e=`${e||"main"}-footer-`;l[e+"wrapper"]=null,l[e+"scroll"]=null,l[e+"table"]=null,l[e+"colgroup"]=null,l[e+"list"]=null,l[e+"xSpace"]=null}),()=>{let{fixedType:l,fixedColumn:e,tableColumn:t}=m;var{spanMethod:o,footerSpanMethod:r,showFooterOverflow:i}=_,{visibleColumn:n,fullColumnIdData:a}=b,{isGroup:u,isColLoading:s,overflowX:d,scrollXLoad:c,scrollYLoad:p,dragCol:f}=h;let v=t,x=!(c||p||i)||o||r?!1:!0;return s||!l&&d||(v=n),l&&x&&(v=e||[]),l||u||c&&f&&2<v.length&&(p=a[f.id])&&(i=p._index,o=v[0],r=v[v.length-1],s=a[o.id],d=a[r.id],s)&&d&&(n=s._index,u=d._index,i<n?v=[f].concat(v):u<i&&(v=v.concat([f]))),(0,_vue.h)("div",{ref:C,class:["vxe-table--footer-wrapper",l?`fixed-${l}--wrapper`:"body--wrapper"],xid:g},[(0,_vue.h)("div",{ref:T,class:"vxe-table--footer-inner-wrapper",onScroll(e){J.triggerFooterScrollEvent(e,l)}},[l?renderEmptyElement(J):(0,_vue.h)("div",{ref:I,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:F,class:"vxe-table--footer",xid:g,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:D},v.map((e,l)=>(0,_vue.h)("col",{name:e.id,key:l,style:{width:e.renderWidth+"px"}}))),(0,_vue.h)("tfoot",{ref:O},(r=>{let{fixedType:i,footerTableData:n}=m,{footerRowClassName:a,footerRowStyle:u}=_,{isColLoading:s,isDragColMove:d}=h,c=w.value,p=y.value;return n.map((e,l)=>{let t=l;var o={$table:J,row:e,_rowIndex:t,$rowIndex:l,fixed:i,type:renderType};return!s&&c.drag&&p.animation?(0,_vue.h)(_vue.TransitionGroup,{key:l,name:"vxe-header--col-list"+(d?"":"-disabled"),tag:"tr",class:["vxe-footer--row",a?_xeUtils.default.isFunction(a)?a(o):a:""],style:u?_xeUtils.default.isFunction(u)?u(o):u:null},{default:()=>S(r,n,e,l,t)}):(0,_vue.h)("tr",{key:l,class:["vxe-footer--row",a?_xeUtils.default.isFunction(a)?a(o):a:""],style:u?_xeUtils.default.isFunction(u)?u(o):u:null},S(r,n,e,l,t))})})(v))])])])}}});